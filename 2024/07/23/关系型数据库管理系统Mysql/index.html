<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>关系型数据库管理系统MySQL | L66</title><meta name="description" content="[TOC] Day01一、数据库介绍1、什么是数据库 数据库就是一个存放计算机数据的仓库，这个仓库是按照一定的数据结构（数据结构是指数据的组织形式或数据之间的联系）来对数据进行组织和存储的，可以通过数据库提供的多种方法来管理其中的数据。 数据库（Database）是一个有组织的数据集合，通常以电子方式存储和管理。它们允许用户高效地存储、检索、更新和删除数据。数据库可以用于多种目的，从简单的个人信息"><meta name="keywords" content="Linux,MySQL"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="关系型数据库管理系统MySQL"><meta name="twitter:description" content="[TOC] Day01一、数据库介绍1、什么是数据库 数据库就是一个存放计算机数据的仓库，这个仓库是按照一定的数据结构（数据结构是指数据的组织形式或数据之间的联系）来对数据进行组织和存储的，可以通过数据库提供的多种方法来管理其中的数据。 数据库（Database）是一个有组织的数据集合，通常以电子方式存储和管理。它们允许用户高效地存储、检索、更新和删除数据。数据库可以用于多种目的，从简单的个人信息"><meta name="twitter:image" content="https://l66stbz.github.io/2024/07/23/关系型数据库管理系统mysql/1.png"><meta property="og:type" content="article"><meta property="og:title" content="关系型数据库管理系统MySQL"><meta property="og:url" content="https://l66stbz.github.io/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/"><meta property="og:site_name" content="L66"><meta property="og:description" content="[TOC] Day01一、数据库介绍1、什么是数据库 数据库就是一个存放计算机数据的仓库，这个仓库是按照一定的数据结构（数据结构是指数据的组织形式或数据之间的联系）来对数据进行组织和存储的，可以通过数据库提供的多种方法来管理其中的数据。 数据库（Database）是一个有组织的数据集合，通常以电子方式存储和管理。它们允许用户高效地存储、检索、更新和删除数据。数据库可以用于多种目的，从简单的个人信息"><meta property="og:image" content="https://l66stbz.github.io/2024/07/23/关系型数据库管理系统mysql/1.png"><meta property="article:published_time" content="2024-07-23T13:00:00.000Z"><meta property="article:modified_time" content="2024-07-23T13:17:31.742Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/"><link rel="next" title="WEB服务器" href="https://l66stbz.github.io/2024/07/05/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">20</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Day01"><span class="toc-number">1.</span> <span class="toc-text">Day01</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#一、数据库介绍"><span class="toc-number">2.</span> <span class="toc-text">一、数据库介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、什么是数据库"><span class="toc-number">2.0.1.</span> <span class="toc-text">1、什么是数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-关键概念"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">1.1 关键概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、数据库的种类"><span class="toc-number">2.0.2.</span> <span class="toc-text">2、数据库的种类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、生产环境常用数据库"><span class="toc-number">2.0.3.</span> <span class="toc-text">3、生产环境常用数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、关系型数据库"><span class="toc-number">2.0.4.</span> <span class="toc-text">4、关系型数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、关系型数据库介绍"><span class="toc-number">2.0.4.1.</span> <span class="toc-text">1、关系型数据库介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、关系型数据库小结"><span class="toc-number">2.0.4.2.</span> <span class="toc-text">2、关系型数据库小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、非关系型数据库"><span class="toc-number">2.0.5.</span> <span class="toc-text">5、非关系型数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、非关系数据库诞生的背景"><span class="toc-number">2.0.5.1.</span> <span class="toc-text">1、非关系数据库诞生的背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#非关系型数据库小结"><span class="toc-number">2.0.5.2.</span> <span class="toc-text">非关系型数据库小结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、非关系型数据库种类"><span class="toc-number">2.0.5.3.</span> <span class="toc-text">3、非关系型数据库种类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、常用关系型数据库管理系统"><span class="toc-number">2.0.6.</span> <span class="toc-text">6、常用关系型数据库管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、Oracle-数据库"><span class="toc-number">2.0.6.1.</span> <span class="toc-text">1、Oracle 数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、MySQL-数据库"><span class="toc-number">2.0.6.2.</span> <span class="toc-text">2、MySQL 数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、MariaDB-数据库"><span class="toc-number">2.0.6.3.</span> <span class="toc-text">3、MariaDB 数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、SQL-Server-数据库"><span class="toc-number">2.0.6.4.</span> <span class="toc-text">4、SQL Server 数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7、常用非关系型数据库管理系统"><span class="toc-number">2.0.7.</span> <span class="toc-text">7、常用非关系型数据库管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、Memcached（Key-Value）"><span class="toc-number">2.0.7.1.</span> <span class="toc-text">1、Memcached（Key-Value）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、Redis（Key-Value）"><span class="toc-number">2.0.7.2.</span> <span class="toc-text">2、Redis（Key-Value）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、MongoDB-（Document-Web）"><span class="toc-number">2.0.7.3.</span> <span class="toc-text">3、MongoDB  （Document-Web）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、前言"><span class="toc-number">3.</span> <span class="toc-text">二、前言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-类型"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">MySQL  类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-安装方式"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">MySQL 安装方式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1、yum-安装"><span class="toc-number">3.0.0.2.0.1.</span> <span class="toc-text">1、yum 安装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2、编译安装"><span class="toc-number">3.0.0.2.0.2.</span> <span class="toc-text">2、编译安装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3、二进制安装"><span class="toc-number">3.0.0.2.0.3.</span> <span class="toc-text">3、二进制安装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4、rpm-安装"><span class="toc-number">3.0.0.2.0.4.</span> <span class="toc-text">4、rpm 安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-版本号"><span class="toc-number">3.0.0.3.</span> <span class="toc-text">MySQL 版本号</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#关系型数据库与非关系型数据库的区别"><span class="toc-number">3.0.0.3.1.</span> <span class="toc-text">关系型数据库与非关系型数据库的区别:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql安装"><span class="toc-number">3.0.1.</span> <span class="toc-text">mysql安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、编译安装mysql5-7"><span class="toc-number">3.0.1.1.</span> <span class="toc-text">1、编译安装mysql5.7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、yum安装方式"><span class="toc-number">3.0.1.2.</span> <span class="toc-text">2、yum安装方式</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、数据库基本操作"><span class="toc-number">4.</span> <span class="toc-text">三、数据库基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、数据库存储引擎（扩展）"><span class="toc-number">4.0.1.</span> <span class="toc-text">一、数据库存储引擎（扩展）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#事务控制语言-TCL"><span class="toc-number">4.0.1.1.</span> <span class="toc-text">事务控制语言(TCL)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#事务要符合四个条件-ACID-："><span class="toc-number">4.0.1.1.0.1.</span> <span class="toc-text">事务要符合四个条件(ACID)：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、sql语句"><span class="toc-number">4.0.2.</span> <span class="toc-text">二、sql语句</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day02"><span class="toc-number">5.</span> <span class="toc-text">Day02</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、数据类型"><span class="toc-number">6.</span> <span class="toc-text">四、数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、数据类型"><span class="toc-number">6.1.</span> <span class="toc-text">1、数据类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、表完整性约束"><span class="toc-number">7.</span> <span class="toc-text">五、表完整性约束</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六、表操作"><span class="toc-number">8.</span> <span class="toc-text">六、表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-添加字段"><span class="toc-number">8.0.1.</span> <span class="toc-text">6.1 添加字段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-表最后列添加一个新字段"><span class="toc-number">8.0.1.1.</span> <span class="toc-text">6.1.1 表最后列添加一个新字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-表最后列添加多个新字段"><span class="toc-number">8.0.1.2.</span> <span class="toc-text">6.1.2 表最后列添加多个新字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-3-添加字段至表内指定字段之后"><span class="toc-number">8.0.1.3.</span> <span class="toc-text">6.1.3 添加字段至表内指定字段之后</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-4-添加字段到第一列"><span class="toc-number">8.0.1.4.</span> <span class="toc-text">6.1.4 添加字段到第一列</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-修改字段和类型"><span class="toc-number">8.0.2.</span> <span class="toc-text">6.2 修改字段和类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-修改字段名称（慎用）"><span class="toc-number">8.0.2.1.</span> <span class="toc-text">6.2.1 修改字段名称（慎用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-修改字段类型长度"><span class="toc-number">8.0.2.2.</span> <span class="toc-text">6.2.2 修改字段类型长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-删除字段（慎用）"><span class="toc-number">8.0.2.3.</span> <span class="toc-text">6.2.3 删除字段（慎用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-插入数据-添加纪录"><span class="toc-number">8.0.3.</span> <span class="toc-text">6.3 插入数据(添加纪录)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-添加一条数据"><span class="toc-number">8.0.3.1.</span> <span class="toc-text">6.3.1 添加一条数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-添加多条数据"><span class="toc-number">8.0.3.2.</span> <span class="toc-text">6.3.2 添加多条数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-3-更新字段值"><span class="toc-number">8.0.3.3.</span> <span class="toc-text">6.3.3 更新字段值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-4-删除单行记录"><span class="toc-number">8.0.3.4.</span> <span class="toc-text">6.3.4 删除单行记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-5-删除整张表记录"><span class="toc-number">8.0.3.5.</span> <span class="toc-text">6.3.5 删除整张表记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-单表查询"><span class="toc-number">8.0.4.</span> <span class="toc-text">6.4 单表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-整表查询（慎用）"><span class="toc-number">8.0.4.1.</span> <span class="toc-text">6.4.1 整表查询（慎用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-2-多字段查询"><span class="toc-number">8.0.4.2.</span> <span class="toc-text">6.4.2 多字段查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-3-比较运算符使用"><span class="toc-number">8.0.4.3.</span> <span class="toc-text">6.4.3 比较运算符使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-4-查询字段别名设置AS"><span class="toc-number">8.0.4.4.</span> <span class="toc-text">6.4.4 查询字段别名设置AS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-5-去除重复行"><span class="toc-number">8.0.4.5.</span> <span class="toc-text">6.4.5 去除重复行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-6-逻辑运算符"><span class="toc-number">8.0.4.6.</span> <span class="toc-text">6.4.6 逻辑运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-函数"><span class="toc-number">8.0.5.</span> <span class="toc-text">6.5 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-1-MySQL内置函数分类"><span class="toc-number">8.0.5.1.</span> <span class="toc-text">6.5.1 MySQL内置函数分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-2-单行函数"><span class="toc-number">8.0.5.2.</span> <span class="toc-text">6.5.2 单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-数值函数"><span class="toc-number">8.0.5.2.1.</span> <span class="toc-text">1. 数值函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-字符串函数"><span class="toc-number">8.0.5.2.2.</span> <span class="toc-text">2. 字符串函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-日期和时间函数"><span class="toc-number">8.0.5.2.3.</span> <span class="toc-text">3. 日期和时间函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-流程控制函数"><span class="toc-number">8.0.5.2.4.</span> <span class="toc-text">4. 流程控制函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-3-聚合函数"><span class="toc-number">8.0.5.3.</span> <span class="toc-text">6.5.3 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-分组查询GROUP-BY"><span class="toc-number">8.0.5.3.1.</span> <span class="toc-text">1. 分组查询GROUP BY</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-表复制"><span class="toc-number">8.0.6.</span> <span class="toc-text">6.6 表复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-1-单、多字段复制"><span class="toc-number">8.0.6.1.</span> <span class="toc-text">6.6.1 单、多字段复制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7-范围查询BETWEEN-AND"><span class="toc-number">8.0.7.</span> <span class="toc-text">6.7 范围查询BETWEEN AND</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-IS-NULL空值和IS-NOT-NULL非空值查询"><span class="toc-number">8.0.8.</span> <span class="toc-text">6.8 IS NULL空值和IS NOT NULL非空值查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-1-IS-NULL-查询"><span class="toc-number">8.0.8.1.</span> <span class="toc-text">6.8.1 IS NULL 查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-2-IS-NOT-NULL"><span class="toc-number">8.0.8.2.</span> <span class="toc-text">6.8.2 IS NOT NULL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-IN运算符使用"><span class="toc-number">8.0.9.</span> <span class="toc-text">6.9 IN运算符使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-排序查询"><span class="toc-number">8.0.10.</span> <span class="toc-text">6.10 排序查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-1-单列排序"><span class="toc-number">8.0.10.1.</span> <span class="toc-text">6.10.1 单列排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-2-多列排序"><span class="toc-number">8.0.10.2.</span> <span class="toc-text">6.10.2 多列排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-3-按别名排序"><span class="toc-number">8.0.10.3.</span> <span class="toc-text">6.10.3 按别名排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11-分页查询"><span class="toc-number">8.0.11.</span> <span class="toc-text">6.11 分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-12-行关联"><span class="toc-number">8.0.12.</span> <span class="toc-text">6.12 行关联</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-12-1-多表查询分类"><span class="toc-number">8.0.12.1.</span> <span class="toc-text">6.12.1 多表查询分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-等值连接"><span class="toc-number">8.0.12.1.1.</span> <span class="toc-text">1. 等值连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-非等值连接"><span class="toc-number">8.0.12.1.2.</span> <span class="toc-text">2. 非等值连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-自连接"><span class="toc-number">8.0.12.1.3.</span> <span class="toc-text">3. 自连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-非自连接"><span class="toc-number">8.0.12.1.4.</span> <span class="toc-text">4. 非自连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-内连接"><span class="toc-number">8.0.12.1.5.</span> <span class="toc-text">5. 内连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-外连接"><span class="toc-number">8.0.12.1.6.</span> <span class="toc-text">6. 外连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-破解密码"><span class="toc-number">8.0.13.</span> <span class="toc-text">6.13 破解密码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day03"><span class="toc-number">9.</span> <span class="toc-text">Day03</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#七、MySQL-索引"><span class="toc-number">10.</span> <span class="toc-text">七、MySQL 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">10.0.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-索引的优点"><span class="toc-number">10.0.2.</span> <span class="toc-text">7.1 索引的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-索引的缺点"><span class="toc-number">10.0.3.</span> <span class="toc-text">7.2 索引的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-MySQL-索引的分类"><span class="toc-number">10.0.4.</span> <span class="toc-text">7.1 MySQL 索引的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-MySQL-不同类型索引用途和区别"><span class="toc-number">10.0.5.</span> <span class="toc-text">7.2 MySQL 不同类型索引用途和区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-MySQL-使用索引"><span class="toc-number">10.0.6.</span> <span class="toc-text">7.3 MySQL 使用索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-创建索引"><span class="toc-number">10.0.6.1.</span> <span class="toc-text">7.3.1 创建索引</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-普通索引（INDEX）"><span class="toc-number">10.0.6.1.1.</span> <span class="toc-text">1. 普通索引（INDEX）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-唯一索引（UNIQUE）"><span class="toc-number">10.0.6.1.2.</span> <span class="toc-text">2. 唯一索引（UNIQUE）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-主键索引（PRIMARY-KEY）"><span class="toc-number">10.0.6.1.3.</span> <span class="toc-text">3. 主键索引（PRIMARY KEY）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-删除索引"><span class="toc-number">10.0.6.2.</span> <span class="toc-text">7.3.2 删除索引</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-普通索引（INDEX）-1"><span class="toc-number">10.0.6.2.1.</span> <span class="toc-text">1. 普通索引（INDEX）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-唯一索引（UNIQUE）-1"><span class="toc-number">10.0.6.2.2.</span> <span class="toc-text">2. 唯一索引（UNIQUE）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-主键索引（PRIMARY-KEY）-1"><span class="toc-number">10.0.6.2.3.</span> <span class="toc-text">3. 主键索引（PRIMARY KEY）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-查看索引"><span class="toc-number">10.0.6.3.</span> <span class="toc-text">7.3.3 查看索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-设置索引的原则"><span class="toc-number">10.0.7.</span> <span class="toc-text">7.4 设置索引的原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-索引失效的场景？怎么避免设置的索引失效？"><span class="toc-number">10.0.8.</span> <span class="toc-text">7.5 索引失效的场景？怎么避免设置的索引失效？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#八、权限管理"><span class="toc-number">11.</span> <span class="toc-text">八、权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-用户管理"><span class="toc-number">11.0.1.</span> <span class="toc-text">8.1 用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-MySQL服务器登录方式"><span class="toc-number">11.0.1.1.</span> <span class="toc-text">8.1.1 MySQL服务器登录方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-创建用户"><span class="toc-number">11.0.2.</span> <span class="toc-text">8.2 创建用户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-方式一：CREATE-USER"><span class="toc-number">11.0.2.1.</span> <span class="toc-text">8.2.1 方式一：CREATE USER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-方式二：GRANT命令"><span class="toc-number">11.0.2.2.</span> <span class="toc-text">8.2.2 方式二：GRANT命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-权限简介"><span class="toc-number">11.0.3.</span> <span class="toc-text">8.3 权限简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-授予权限原则"><span class="toc-number">11.0.3.1.</span> <span class="toc-text">8.3.1 授予权限原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-查看权限"><span class="toc-number">11.0.4.</span> <span class="toc-text">8.4 查看权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-1-查看当前用户权限"><span class="toc-number">11.0.4.1.</span> <span class="toc-text">8.4.1 查看当前用户权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-2-查看其他用户权限"><span class="toc-number">11.0.4.2.</span> <span class="toc-text">8.4.2 查看其他用户权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-添加权限"><span class="toc-number">11.0.5.</span> <span class="toc-text">8.5 添加权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-回收权限"><span class="toc-number">11.0.6.</span> <span class="toc-text">8.6 回收权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-修改密码"><span class="toc-number">11.0.7.</span> <span class="toc-text">8.7 修改密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-1-修改当前用户密码"><span class="toc-number">11.0.7.1.</span> <span class="toc-text">8.7.1 修改当前用户密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-2-修改其他用户密码"><span class="toc-number">11.0.7.2.</span> <span class="toc-text">8.7.2 修改其他用户密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-3-MySQL-5-7-密码管理（了解）"><span class="toc-number">11.0.7.3.</span> <span class="toc-text">8.7.3 MySQL 5.7 密码管理（了解）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-删除用户"><span class="toc-number">11.0.8.</span> <span class="toc-text">8.8 删除用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-9-查看密码复杂度"><span class="toc-number">11.0.9.</span> <span class="toc-text">8.9 查看密码复杂度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-10-权限控制机制"><span class="toc-number">11.0.10.</span> <span class="toc-text">8.10 权限控制机制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#九、日志管理"><span class="toc-number">12.</span> <span class="toc-text">九、日志管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-MySQL-5-7日志分类"><span class="toc-number">12.0.1.</span> <span class="toc-text">9.1 MySQL 5.7日志分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-1-错误日志"><span class="toc-number">12.0.1.1.</span> <span class="toc-text">9.1.1 错误日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-2-通用查询日志（了解）"><span class="toc-number">12.0.1.2.</span> <span class="toc-text">9.1.2 通用查询日志（了解）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-3-二进制日志"><span class="toc-number">12.0.1.3.</span> <span class="toc-text">9.1.3 二进制日志</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-查看二进制日志是否开启"><span class="toc-number">12.0.1.3.1.</span> <span class="toc-text">1. 查看二进制日志是否开启</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-开启二进制日志"><span class="toc-number">12.0.1.3.2.</span> <span class="toc-text">2. 开启二进制日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-查看二进制日志"><span class="toc-number">12.0.1.3.3.</span> <span class="toc-text">3. 查看二进制日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-二进制日志三种格式"><span class="toc-number">12.0.1.3.4.</span> <span class="toc-text">4. 二进制日志三种格式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#4-1-Statement格式"><span class="toc-number">12.0.1.3.4.1.</span> <span class="toc-text">4.1 Statement格式</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-ROW格式"><span class="toc-number">12.0.1.3.4.2.</span> <span class="toc-text">4.2 ROW格式</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-3-MIXED格式"><span class="toc-number">12.0.1.3.4.3.</span> <span class="toc-text">4.3 MIXED格式</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-4-MySQL-5-7-运行时修改"><span class="toc-number">12.0.1.3.4.4.</span> <span class="toc-text">4.4 MySQL 5.7 运行时修改</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-MySQL-5-7二进制日常管理事项"><span class="toc-number">12.0.1.3.5.</span> <span class="toc-text">5. MySQL 5.7二进制日常管理事项</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-查看慢查询日志参数"><span class="toc-number">12.0.1.3.6.</span> <span class="toc-text">2. 查看慢查询日志参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-验证"><span class="toc-number">12.0.1.3.7.</span> <span class="toc-text">3.  验证</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-5-中继日志"><span class="toc-number">12.0.1.4.</span> <span class="toc-text">9.1.5 中继日志</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day04"><span class="toc-number">13.</span> <span class="toc-text">Day04</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#十、数据备份与恢复"><span class="toc-number">14.</span> <span class="toc-text">十、数据备份与恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-为什么要备份"><span class="toc-number">14.1.</span> <span class="toc-text">10.1 为什么要备份</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-MySQL备份的专业名词"><span class="toc-number">14.1.1.</span> <span class="toc-text">10.1.1 MySQL备份的专业名词</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-MySQL数据备份需要重视的内容"><span class="toc-number">14.2.</span> <span class="toc-text">10.2 MySQL数据备份需要重视的内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-MySQL-备份类型"><span class="toc-number">14.3.</span> <span class="toc-text">10.3 MySQL 备份类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-MySQL-备份工具"><span class="toc-number">14.4.</span> <span class="toc-text">10.4 MySQL 备份工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5-物理备份的方式"><span class="toc-number">14.5.</span> <span class="toc-text">10.5 物理备份的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-1-完全备份（完整备份）"><span class="toc-number">14.5.1.</span> <span class="toc-text">10.5.1 完全备份（完整备份）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-2-增量备份"><span class="toc-number">14.5.2.</span> <span class="toc-text">10.5.2 增量备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-3-差异备份"><span class="toc-number">14.5.3.</span> <span class="toc-text">10.5.3 差异备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-4-percona-xtrabackup-物理备份"><span class="toc-number">14.5.4.</span> <span class="toc-text">*10.5.4 percona-xtrabackup 物理备份 *</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-安装xtrabackup"><span class="toc-number">14.5.4.0.1.</span> <span class="toc-text">1. 安装xtrabackup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-完全备份流程"><span class="toc-number">14.5.4.0.2.</span> <span class="toc-text">2.完全备份流程:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-增量备份流程"><span class="toc-number">14.5.4.0.3.</span> <span class="toc-text">3. 增量备份流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4、差异备份流程"><span class="toc-number">14.5.4.0.4.</span> <span class="toc-text">4、差异备份流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-5-mysqldump逻辑备份-—-推荐优先使用"><span class="toc-number">14.5.5.</span> <span class="toc-text">10.5.5 mysqldump逻辑备份   —- 推荐优先使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-常用备份选项"><span class="toc-number">14.5.5.0.1.</span> <span class="toc-text">1.常用备份选项</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-备份表"><span class="toc-number">14.5.5.0.2.</span> <span class="toc-text">2.备份表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3、备份库"><span class="toc-number">14.5.5.0.3.</span> <span class="toc-text">3、备份库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4、恢复数据库和表"><span class="toc-number">14.5.5.0.4.</span> <span class="toc-text">4、恢复数据库和表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5、恢复库"><span class="toc-number">14.5.5.0.5.</span> <span class="toc-text">5、恢复库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6、恢复表"><span class="toc-number">14.5.5.0.6.</span> <span class="toc-text">6、恢复表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7、备份及恢复表结构"><span class="toc-number">14.5.5.0.7.</span> <span class="toc-text">7、备份及恢复表结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8、数据的导入导出-没有表结构。"><span class="toc-number">14.5.5.0.8.</span> <span class="toc-text">8、数据的导入导出,没有表结构。</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5、通过binlog恢复"><span class="toc-number">14.5.5.1.</span> <span class="toc-text">5、通过binlog恢复</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Day05"><span class="toc-number">15.</span> <span class="toc-text">Day05</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#十一、mysql优化"><span class="toc-number">16.</span> <span class="toc-text">十一、mysql优化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#十二、AB复制"><span class="toc-number">17.</span> <span class="toc-text">十二、AB复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-什么是主从复制"><span class="toc-number">17.1.</span> <span class="toc-text">12.1 什么是主从复制?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-主从复制原理"><span class="toc-number">17.2.</span> <span class="toc-text">12.2 主从复制原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-主从同步的模式"><span class="toc-number">17.3.</span> <span class="toc-text">12.3 主从同步的模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4-M-S-架构GTID-基于事务ID复制"><span class="toc-number">17.4.</span> <span class="toc-text">12.4 M-S 架构GTID 基于事务ID复制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#12-4-1-什么是GTID？"><span class="toc-number">17.4.0.0.1.</span> <span class="toc-text">12.4.1 什么是GTID？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-4-2-GTID工作原理"><span class="toc-number">17.4.0.0.2.</span> <span class="toc-text">12.4.2 GTID工作原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-4-3-部署主从复制（一主一从）"><span class="toc-number">17.4.0.0.3.</span> <span class="toc-text">12.4.3 部署主从复制（一主一从）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-5-主从复制binlog日志方式"><span class="toc-number">17.5.</span> <span class="toc-text">12.5 主从复制binlog日志方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-6-基于Gtid日志方式实现互为主从"><span class="toc-number">17.6.</span> <span class="toc-text">12.6 基于Gtid日志方式实现互为主从</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-7-基于GTID实现双主双从"><span class="toc-number">17.7.</span> <span class="toc-text">12.7 基于GTID实现双主双从</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-8-MySQL主从复制面试题"><span class="toc-number">17.8.</span> <span class="toc-text">17.8 MySQL主从复制面试题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#十三、读写分离"><span class="toc-number">18.</span> <span class="toc-text">十三、读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-什么是读写分离"><span class="toc-number">18.1.</span> <span class="toc-text">13.1 什么是读写分离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-读写分离的好处"><span class="toc-number">18.2.</span> <span class="toc-text">13.2 读写分离的好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-MySQL中间件"><span class="toc-number">18.3.</span> <span class="toc-text">13.3 MySQL中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-4-Mycat部署"><span class="toc-number">18.4.</span> <span class="toc-text">13.4 Mycat部署</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/07/23/关系型数据库管理系统mysql/1.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">关系型数据库管理系统MySQL</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2024-07-23 21:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2024-07-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2024-07-23 21:17:31"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2024-07-23</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>[TOC]</p>
<h1 id="Day01"><a href="#Day01" class="headerlink" title="Day01"></a>Day01</h1><h1 id="一、数据库介绍"><a href="#一、数据库介绍" class="headerlink" title="一、数据库介绍"></a>一、数据库介绍</h1><h3 id="1、什么是数据库"><a href="#1、什么是数据库" class="headerlink" title="1、什么是数据库"></a>1、什么是数据库</h3><ul>
<li>数据库就是一个存放计算机数据的仓库，这个仓库是按照一定的数据结构（数据结构是指数据的组织形式或数据之间的联系）来对数据进行组织和存储的，可以通过数据库提供的多种方法来管理其中的数据。</li>
<li>数据库（Database）是一个<code>有组织的数据集合</code>，通常以电子方式存储和管理。它们<code>允许用户高效地存储、检索、更新和删除数据</code>。数据库可以用于多种目的，从简单的个人信息管理到复杂的企业级应用程序。数据库通常通过<code>数据库管理系统</code>（DBMS）来进行管理和操作。</li>
</ul>
<h4 id="1-1-关键概念"><a href="#1-1-关键概念" class="headerlink" title="1.1 关键概念"></a>1.1 <strong>关键概念</strong></h4><ul>
<li><strong>数据表（Table）</strong>：数据库中的基本结构，数据以行和列的形式存储，每行代表一个记录，每列代表一个字段。</li>
<li><strong>记录（Record）</strong>：表中的一行，表示一个完整的数据项。</li>
<li><strong>字段（Field）</strong>：表中的一列，表示数据的一个属性。</li>
<li><strong>主键（Primary Key）</strong>：唯一标识表中每条记录的字段或字段组合。</li>
<li><strong>外键（Foreign Key）</strong>：在一个表中引用另一个表的主键，用于建立表之间的关系。</li>
<li><strong>查询（Query）</strong>：用于从数据库中检索数据的请求，可以使用结构化查询语言（SQL）来编写。</li>
</ul>
<p>​        </p>
<h3 id="2、数据库的种类"><a href="#2、数据库的种类" class="headerlink" title="2、数据库的种类"></a>2、数据库的种类</h3><ul>
<li>最常用的数据库模式主要有两种，即<strong>关系型数据库</strong>和<strong>非关系型数据库</strong>。</li>
</ul>
<h3 id="3、生产环境常用数据库"><a href="#3、生产环境常用数据库" class="headerlink" title="3、生产环境常用数据库"></a>3、生产环境常用数据库</h3><ul>
<li><strong>关系型数据库：</strong>数据以表格的形式存储，通过SQL进行操作。常见的关系型数据库包括<code>MySQL</code>、<code>PostgreSQL</code>、<code>Oracle</code>和<code>SQL Server</code>。</li>
<li><strong>非关系型数据库：</strong>：不使用表格存储数据，适用于处理大规模和非结构化数据。常见的NoSQL数据库包括<code>MongoDB</code>、<code>Redis</code>。</li>
</ul>
<h3 id="4、关系型数据库"><a href="#4、关系型数据库" class="headerlink" title="4、关系型数据库"></a>4、关系型数据库</h3><h4 id="1、关系型数据库介绍"><a href="#1、关系型数据库介绍" class="headerlink" title="1、关系型数据库介绍"></a>1、关系型数据库介绍</h4><ul>
<li>关系型数据库模型是把复杂的数据结构归结为简单的二元关系（即二维表格形式）。在关系型数据库中，对数据的操作几乎全部建立在一个或多个关系表格上，通过这些关联的表格分类、合并、连接或选取等运算来实现数据的管理。</li>
<li>关系型数据可以很好地存储一些关系模型的数据，比如一个老师对应多个学生的数据（“一对多”），一本书对应多个作者（“一对多”），一本书对应一个出版日期（“一对一”）</li>
</ul>
<ul>
<li><p>关系型数据库诞生距今已有 40 多年了，从理论产生到发展到实现产品，例如：常见的 MySQL 和 Oracle 数据库，Oracle 在数据库领域里上升到了霸主地位，形成每年高达数百亿美元的庞大产业市场，而 MySQL 也是不容忽视的数据库，以至于被 Oracle 重金收购了。</p>
</li>
<li><p>数据的存储形式：</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220800545.png" alt="1566118937818"></p>
</li>
</ul>
<h4 id="2、关系型数据库小结"><a href="#2、关系型数据库小结" class="headerlink" title="2、关系型数据库小结"></a>2、关系型数据库小结</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 关系型数据库在存储数据时实际就是采用的一张二维表（和 Word 和 Excell 里表格几乎一样）。</span><br><span class="line">- 市场占有量较大的是 MySQL 和 Oracle 数据库，而互联网场景最常用的是 MySQL 数据库。</span><br><span class="line">- 通过 SQL 结构化查询语言来存取、管理关系型数据库的数据。</span><br><span class="line">- 关系型数据库在保持数据安全和数据一致性方面很强，遵循 ACID 理论 ACID指的的事务的4大特性</span><br></pre></td></tr></table></figure>

<h3 id="5、非关系型数据库"><a href="#5、非关系型数据库" class="headerlink" title="5、非关系型数据库"></a>5、非关系型数据库</h3><h4 id="1、非关系数据库诞生的背景"><a href="#1、非关系数据库诞生的背景" class="headerlink" title="1、非关系数据库诞生的背景"></a>1、非关系数据库诞生的背景</h4><ul>
<li>非关系型数据库也被称为 NoSQL 数据库，NoSQL 的本意是 “Not Only SQL”，指的是非关系型数据库，而不是“NO SQL”的意思，NoSQL 的产生并不是要彻底否定关系型数据库，而是作为传统数据库的一个有效补充。NoSQL 数据库在特定的场景下可以发挥难以想象的高效率和高性能。特别是对于规模日益扩大的海量数据，超大规模和高并发的微博、微信、SNS 类型的纯动态网站已经显得力不从心，暴露了很多难以克服的问题，例如：传统的关系型数据库IO瓶颈、性能瓶颈都难以有效突破，于是开始出现了大批针对特定场景，以高性能和使用便利为目的功能特异化的数据库产品。NoSQL（非关系型）类的数据库就是这样的情景中诞生并得到了非常迅速的发展。</li>
</ul>
<ul>
<li>NoSQL 是非关系型数据库的广义定义。它打破了长久以来关系型数据库与ACID理论大一统的局面。NoSQL数据存储不需要固定的表结构，通常也不存在连续操作。</li>
</ul>
<h4 id="非关系型数据库小结"><a href="#非关系型数据库小结" class="headerlink" title="非关系型数据库小结"></a>非关系型数据库小结</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- NoSQL 数据库不是否定关系型数据库，而是作为关系数据库的一个重要补充。</span><br><span class="line">- NoSQL 数据库为了灵活及高性能、高并发而生，忽略影响高性能、高并发的功能。</span><br><span class="line">- 在NoSQL 数据库领域，当今的最典型产品为 Redis（持久化缓存）、MongoDB、Memcached（纯内存）等。</span><br><span class="line">- NoSQL 数据库没有标准的查询语言（SQL），通常使用数据接口或者查询API。</span><br></pre></td></tr></table></figure>

<h4 id="3、非关系型数据库种类"><a href="#3、非关系型数据库种类" class="headerlink" title="3、非关系型数据库种类"></a>3、非关系型数据库种类</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.键值（Key-Value）存储数据库</span><br><span class="line">- 键值数据库就类似传统语言中使用的哈希表。可以通过key来添加、查询或者删除数据，因为使用key主键访问，所以会获得很高的性能及扩展性。这个表中有一个特定的键和一个指针指向特定的数据。Key-Value模型对于IT系统来说的优势在于简单、易部署、高并发。</span><br><span class="line">- 典型产品：Memcached、Redis、MemcachedB</span><br><span class="line"></span><br><span class="line">2、列存储（Column-Oriented）数据库</span><br><span class="line">- 列存储数据库将数据存储存在列族（Column Family）中，一个列族存储经常被一起查询的相关数据。举个例子，如果有一个 Person 类，通常会一起查询他们的姓名和年龄而不是薪资。这种情况下，姓名和年龄就会被放入一个列族中，而薪资则在另一个列族中。这部分数据库通常用来应对分布式存储的海量数据。键仍然存在，但是他们的特点是指向了多个列。这些列是由列家族来安排的。</span><br><span class="line">- 典型产品：Cassandra，HBase</span><br><span class="line"></span><br><span class="line">3、面向文档（Document-Oriented）的数据库</span><br><span class="line">- 面向文档数据库会将数据以文档的形式存储,数据存储的最小单位是文档，同一个表中存储的文档属性可以是不同的，数据可以使用XML、JSON等多种形式存储。</span><br><span class="line">- 典型产品：MongDB、CouchDB</span><br><span class="line"></span><br><span class="line">4、图形（Graph）数据库</span><br><span class="line">- 图形数据库允许我们将数据以图的方式存储。图形结构的数据库同其他行列以及刚性结构的 SQL 数据库不同，它是使用灵活的图形模型，并且能够扩展到多个服务器上。</span><br><span class="line">- 典型产品：Neo4J、InfoGr id</span><br></pre></td></tr></table></figure>

<h3 id="6、常用关系型数据库管理系统"><a href="#6、常用关系型数据库管理系统" class="headerlink" title="6、常用关系型数据库管理系统"></a>6、常用关系型数据库管理系统</h3><h4 id="1、Oracle-数据库"><a href="#1、Oracle-数据库" class="headerlink" title="1、Oracle 数据库"></a>1、Oracle 数据库</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215689.png" alt="image-20200816141727203"></p>
<ul>
<li>Oracle 前身叫 SDL，由 Larry Ellison 和另两个编程人员在1977创办，他们开发了自己的拳头产品，在市场上大量销售，1979年，Oracle 公司引入了第一个商用 SQL关系数据库管理系统。Oracle公司是最早开发关系数据库的厂商之一，其产品支持最广泛的操作系统平台。目前 Oracle 关系数据库产品的市场占有率数一数二。</li>
</ul>
<ul>
<li>Oracle 公司是目前全球最大的数据库软件公司，也是近年业务增长极为迅速的软件提供与服务商。</li>
</ul>
<ul>
<li>主要应用范围：传统大企业，大公司，政府，金融，证券等等。</li>
</ul>
<ul>
<li>版本升级：Oracle8i，Oracle9i，Oracle10g，Oracle11g，Oracle12c。</li>
</ul>
<h4 id="2、MySQL-数据库"><a href="#2、MySQL-数据库" class="headerlink" title="2、MySQL 数据库"></a>2、MySQL 数据库</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215154.png" alt="image-20200816141801461"></p>
<ul>
<li>MySQL 数据库是一个中小型关系型数据库管理系统，软件开发者为瑞典 MySQL AB 公司。在2008年1月16号被 Sun 公司收购，后 Sun 公司又被 Oracle 公司收购。目前MySQL 被广泛地应用在 Internet 上的大中小型网站中。由于其体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，许多大中小型网站为了降低网站总体拥有成本而选择了 MySQL 作为网站数据库，甚至国内知名的淘宝网也选择弃用 Oracle 而更换为更开放的 MySQL。</li>
</ul>
<ul>
<li>MySQL 数据库主要应用范围：互联网领域，大中小型网站，游戏公司，电商平台等等。</li>
</ul>
<h4 id="3、MariaDB-数据库"><a href="#3、MariaDB-数据库" class="headerlink" title="3、MariaDB 数据库"></a>3、MariaDB 数据库</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215837.png" alt="image-20200816141836935"></p>
<ul>
<li>MariaDB 数据库管理系统是 MySQL 数据库的一个分支，主要由开源社区维护。开发这个 MariaDB 数据库分支的可能原因之一是：甲骨文公司收购了MySQL 后，有将 MySQL 闭源的潜在风险，因此 MySQL 开源社区采用分支的方式来避开这个风险。</li>
</ul>
<ul>
<li>开发 MariaDB 数据库的目的是完全兼容 MySQL 数据库，包括 API 和命令行，使之能轻松的成为 MySQL 的代替品。在存储引擎方面，使用 XtraDB （英语：XtraDB）来代替MySQL 的 InnoDB MariaDB 由 MySQL 的创始人 Michael Widenius（英语：Michael Widenius）主导开发，他早前曾以 10 亿美元的价格，将自己创建的公司MySQL AB卖给了 SUN，此后，随着 SUN 被甲骨文收购，MySQL 的所有权也落入Oracle 的手中，MariaDB 数据库的名称来自 MySQL 的创始人Michael Widenius 的女儿 Maria 的名字。</li>
</ul>
<h4 id="4、SQL-Server-数据库"><a href="#4、SQL-Server-数据库" class="headerlink" title="4、SQL Server 数据库"></a>4、SQL Server 数据库</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215233.png" alt="image-20200816141945977"></p>
<ul>
<li>Microsoft SQL Server是微软公司开发的大型关系型数据库系统。1987年，微软和IBM合作开发完成 OS/2，IBM 在其销售的 OS/2 ExtendedEdition 系统中绑定了 OS/2 DatabaseManager，而微软产品线中尚缺少数据库产品。为此，微软将目光投向 Sybase，同 Sybase 签订了合作协议，使用 Sybase 的技术开发基于 OS/2 平台的关系型数据库。1989年，微软发布了 SQLServer1.0 版。</li>
</ul>
<ul>
<li>SQL Server 的功能比较全面，效率高，可以作为中型企业或单位的数据库平台。</li>
<li>SQL Server 可以与 Windows 操作系统紧密集成，不论是应用程序开发速度还是系统事务处理运行速度，都能得到较大的 提升。SQL Server 的缺点是只能在 Windows 系统下运行。</li>
</ul>
<ul>
<li>主要应用范围：部分企业电商（央视购物），使用windows服务器平台的企业。</li>
</ul>
<h3 id="7、常用非关系型数据库管理系统"><a href="#7、常用非关系型数据库管理系统" class="headerlink" title="7、常用非关系型数据库管理系统"></a>7、常用非关系型数据库管理系统</h3><h4 id="1、Memcached（Key-Value）"><a href="#1、Memcached（Key-Value）" class="headerlink" title="1、Memcached（Key-Value）"></a>1、Memcached（Key-Value）</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215159.png" alt="image-20200816202927598"> </p>
<ul>
<li>Memcached 是一个开源的、高性能的、具有分布式内存对象的缓存系统。通过它可以减轻数据库负载，加速动态的 Web 应用，最初版本由 LiveJoumal 的 Brad Fitzpatrick在2003年开发完成。目前全球有非常多的用户都在使用它来构建自己的大负载网站或提高自己的高访问网站的响应速度。注意：Memcache 是这个项目的名称，而Memcached 是服务器端的主程序文件名。</li>
</ul>
<ul>
<li>缓存一般用来保存一些经常被存取的对象或数据（例如，浏览器会把经常访问的网页缓存起来一样），通过缓存来存取对象或数据要比在磁盘上存取快很多，前者是内存，后 者是磁盘。Memcached 是一种纯内存缓存系统，把经常存取的对象或数据缓存在 Memcached 的内存中，这些被缓存的数据被程序通过API的方式被存取，Memcached里面的数据就像一张巨大的 HASH 表，数据以 Key-Value 对的方式存在。Memcached 通过缓存经常被存取的对象或数据，从而减轻频繁读取数据库的压力，提高网站的响应速度.官方：<a href="http://Memcached.org/" target="_blank" rel="noopener">http://Memcached.org/</a></li>
</ul>
<ul>
<li>由于Memcached 为纯内存缓存软件，一旦重启所有数据都会丢失，因此，新浪网基于 Memcached 开发了一个开源项目 MemcacheDB。通过为 Memcached 增加 Berkeley DB 的持久化存储机制和异步主辅复制机制，使 Memcached 具备了事务恢复能力、持久化数据存储能力和分布式复制能力，但是最近几年逐渐被其他的持久化产品替代例如Redis。 </li>
</ul>
<p>Memcached缺点：</p>
<p>1、存储的数据类型比较单一  只能存储字符串</p>
<p>2、无法持久化(没办法把数据存放到磁盘中)</p>
<h4 id="2、Redis（Key-Value）"><a href="#2、Redis（Key-Value）" class="headerlink" title="2、Redis（Key-Value）"></a>2、Redis（Key-Value）</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215519.jpg" alt="img"></p>
<ul>
<li><p>Redis 是一个Key-Value型存储系统。但Redis支持的存储value 类型相对更多，包括 string（字符串）、list（列表）、set（集合）和 zset（有序集合）等。这些数据类型都支持 push/pop、add/remove 及取交集、并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上，Redis 支持各种不同方式的排序。与 Memcached 一样，为了保证效率，Redis 的数据都是缓存在内存中。区别是 Redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 Master-Slave（主从）同步。</p>
</li>
<li><p>Redis 是一个高性能的 Key-Value 数据库。Redis 的出现，很大程度补偿了 Memcached 这类 Key-Value 存储的不足，在部分场合可以对关系数据库有很好的补充作用。它提供了 Python，Ruby，Erlang，PHP 客户端，使用很方便。官方：<a href="http://www.Redis.io/documentation" target="_blank" rel="noopener">http://www.Redis.io/documentation</a></p>
</li>
<li><p>Redis 特点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 支持内存缓存，这个功能相当于 Memcached。</span><br><span class="line">2. 支持持久化存储，这个功能相当于 MemcacheDB。</span><br><span class="line">3. 数据类型更丰富。比其他 Key-Value 库功能更强。</span><br><span class="line">4. 支持主从集群，分布式。</span><br></pre></td></tr></table></figure>
</li>
<li><p>应用：缓存从存取 Memcached 更改存取 Redis。</p>
</li>
</ul>
<h4 id="3、MongoDB-（Document-Web）"><a href="#3、MongoDB-（Document-Web）" class="headerlink" title="3、MongoDB  （Document-Web）"></a>3、MongoDB  （Document-Web）</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215347.jpg" alt="img"></p>
<ul>
<li>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，类似 Json 的 Bjson 格式，因此可以存储比较复杂的数据类型。MongoDB 最大的特点是他支持查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高性能、易部署、易使用，存储数据非常方便。</li>
<li>MongoDB 服务端可运行在 Linux、Windows 或 OS X 平台，支持32位和64位应用，默认端口为 27017。推荐运行在64位平台。</li>
</ul>
<ul>
<li>MongoDB 把数据存储在文件中（默认路径为：/data/db）。</li>
</ul>
<h1 id="二、前言"><a href="#二、前言" class="headerlink" title="二、前言"></a>二、前言</h1><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407092215528.png" alt="image-20200816143411900"></p>
<p>MySQL是一个<strong>关系型数据库管理系统</strong>，由瑞典MySQL AB 公司开发，目前属于 <a href="https://baike.baidu.com/item/Oracle" target="_blank" rel="noopener">Oracle</a> 旗下产品。MySQL 是最流行的<a href="https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/696511" target="_blank" rel="noopener">关系型数据库管理系统</a>之一，在 WEB 应用方面，MySQL是最好的 <a href="https://baike.baidu.com/item/RDBMS/1048260" target="_blank" rel="noopener">RDBMS</a> (Relational Database Management System，关系数据库管理系统) 应用软件之一。关系数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。</p>
<p>MySQL所使用的 SQL 语言是用于访问<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728" target="_blank" rel="noopener">数据库</a>的最常用标准化语言。MySQL 软件采用了双授权政策，分为社区版和商业版，由于其体积小、速度快、总体拥有成本低，尤其是<a href="https://baike.baidu.com/item/%E5%BC%80%E6%94%BE%E6%BA%90%E7%A0%81/7176422" target="_blank" rel="noopener">开放源码</a>这一特点，一般中小型网站的开发都选择 MySQL 作为网站数据库。</p>
<p>RDBMS即关系数据库管理系统(Relational Database Management System)</p>
<h4 id="MySQL-类型"><a href="#MySQL-类型" class="headerlink" title="MySQL  类型"></a>MySQL  类型</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### 1、MySQL Community Server</span></span></span><br><span class="line"></span><br><span class="line">- MySQL Community Server是社区版本，开源免费，但不提供官方技术支持。MySQL Community Server也是我们通常用的MySQL的版本。根据不同的操作系统平台细分为多个版本。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### 2、MySQL Enterprise Edition</span></span></span><br><span class="line"></span><br><span class="line">- MySQL Enterprise Edition企业版本，需付费，可以试用30天。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### 3、MySQL Cluster</span></span></span><br><span class="line"></span><br><span class="line">- MySQL Cluster集群版，开源免费。可将几个MySQL Server封装成一个Server。MySQL Cluster CGE 高级集群版，需付费。</span><br></pre></td></tr></table></figure>

<h4 id="MySQL-安装方式"><a href="#MySQL-安装方式" class="headerlink" title="MySQL 安装方式"></a>MySQL 安装方式</h4><h6 id="1、yum-安装"><a href="#1、yum-安装" class="headerlink" title="1、yum 安装"></a>1、yum 安装</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">优点：操作简单易用。不用单独下载，服务器可以联网且yum源没有问题即可(可以选择国内的163/阿里源)</span><br></pre></td></tr></table></figure>

<h6 id="2、编译安装"><a href="#2、编译安装" class="headerlink" title="2、编译安装"></a>2、编译安装</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 5.1.X 及之前的版本是通过下载tar包以后解压后进入软件包解压路径。然后./configure、make、make install</span><br><span class="line"></span><br><span class="line">- 5.4.X 到 5.7.X 通过下载tar包以后解压后进入软件包解压路径。然后 cmake、make、make install(cmake需要提前安装)</span><br><span class="line"></span><br><span class="line">优点：可以定制功能特性。</span><br></pre></td></tr></table></figure>

<h6 id="3、二进制安装"><a href="#3、二进制安装" class="headerlink" title="3、二进制安装"></a>3、二进制安装</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">官方下载二进制包，解压初始化即可直接使用不用安装</span><br></pre></td></tr></table></figure>

<h6 id="4、rpm-安装"><a href="#4、rpm-安装" class="headerlink" title="4、rpm 安装"></a>4、rpm 安装</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 需要提前下载 rpm 软件包上传到服务器系统本地</span><br><span class="line">- 使用 rpm 或者 yum 命令直接安装</span><br></pre></td></tr></table></figure>

<h4 id="MySQL-版本号"><a href="#MySQL-版本号" class="headerlink" title="MySQL 版本号"></a>MySQL 版本号</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以 MySQL 5.7.27 这个版本的版本号为例说明每个数字含义。</span><br><span class="line"></span><br><span class="line">- 第一个数字(5)主版本号：文件格式改动时，将作为新的版本发布；</span><br><span class="line">- 第二个数字(7)发行版本号：新增特性或者改动不兼容时，发行版本号需要更改；</span><br><span class="line">- 第三个数字(27)发行序列号：主要是小的改动，如bug的修复、函数添加或更改、配置参数的更改等。</span><br></pre></td></tr></table></figure>

<h5 id="关系型数据库与非关系型数据库的区别"><a href="#关系型数据库与非关系型数据库的区别" class="headerlink" title="关系型数据库与非关系型数据库的区别:"></a>关系型数据库与非关系型数据库的区别:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.关系型数据库:</span><br><span class="line">优点：</span><br><span class="line">1、易于维护：都是使用表结构，格式一致；</span><br><span class="line">2、使用方便：SQL语言通用，可用于复杂查询；</span><br><span class="line">3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。</span><br><span class="line">缺点：</span><br><span class="line">1、读写性能比较差，尤其是海量数据的高效率读写；</span><br><span class="line">2、固定的表结构，灵活度稍欠；</span><br><span class="line">3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈。</span><br><span class="line">=============================================================================</span><br><span class="line">2.非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。</span><br><span class="line">优点：</span><br><span class="line">1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，使用灵活，应用场景广泛。</span><br><span class="line">2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；</span><br><span class="line">3、高扩展性；</span><br><span class="line">4、成本低：nosql数据库部署简单，基本都是开源软件。</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">1、不提供sql支持；</span><br><span class="line">2、无事务处理；</span><br><span class="line">3、数据结构相对复杂，复杂查询方面稍欠。</span><br></pre></td></tr></table></figure>
<p>MySQL的官方网址： <a href="http://www.mysql.com/" target="_blank" rel="noopener">http://www.mysql.com/</a> ，MySQL的社区版本下载地址为： <a href="http://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">http://dev.mysql.com/downloads/mysql/</a> ，在写本文时，当前的MySQL最新版本是：8.0 。</p>
<p><strong>什么是sql？</strong></p>
<p>SQL代表结构化查询语言(Structured Query Language)。SQL是用于访问数据库的标准化语言。</p>
<p>SQL包含三个部分：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据定义语言包含定义数据库及其对象的语句，例如表，视图，触发器，存储过程等。</span><br><span class="line">数据操作语言包含允许您更新和查询数据的语句。</span><br><span class="line">数据控制语言允许授予用户权限访问数据库中特定数据的权限。</span><br></pre></td></tr></table></figure>

<h3 id="mysql安装"><a href="#mysql安装" class="headerlink" title="mysql安装"></a>mysql安装</h3><p>关闭防火墙和selinux</p>
<h4 id="1、编译安装mysql5-7"><a href="#1、编译安装mysql5-7" class="headerlink" title="1、编译安装mysql5.7"></a>1、编译安装mysql5.7</h4><p>1、清理安装环境：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum erase mariadb mariadb-server mariadb-libs mariadb-devel -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> userdel -r mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rm -rf /etc/my*</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rm -rf /var/lib/mysql</span></span><br></pre></td></tr></table></figure>

<p>2、创建mysql用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# useradd -r mysql -M -s /bin/false</span><br></pre></td></tr></table></figure>

<p>3、从官网下载tar包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-boost-5.7.27.tar.gz</span><br></pre></td></tr></table></figure>

<p>4、安装编译工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum -y install ncurses ncurses-devel openssl-devel bison gcc gcc-c++ make</span></span><br><span class="line">cmake:</span><br><span class="line"><span class="meta">#</span><span class="bash"> yum -y install cmake</span></span><br></pre></td></tr></table></figure>

<p>5、创建mysql目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# mkdir -p /usr/local/&#123;data,mysql,log&#125;</span><br></pre></td></tr></table></figure>

<p>6、解压</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# tar xzvf mysql-boost-5.7.27.tar.gz -C /usr/local/</span><br><span class="line">注:如果安装的MySQL5.7及以上的版本，在编译安装之前需要安装boost,因为高版本mysql需要boots库的安装才可以正常运行。否则会报CMake Error at cmake/boost.cmake:81错误</span><br><span class="line">安装包里面自带boost包</span><br><span class="line">Boost库是为C++语言标准库提供扩展的一些C++程序库</span><br></pre></td></tr></table></figure>

<p>7、编译安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cd 解压的mysql目录</span><br><span class="line">[root@mysql-server ~]# cd /usr/local/mysql-5.7.27/</span><br><span class="line">[root@mysql-server mysql-5.7.27]# cmake . \</span><br><span class="line">-DWITH_BOOST=boost/boost_1_59_0/ \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \</span><br><span class="line">-DSYSCONFDIR=/etc \</span><br><span class="line">-DMYSQL_DATADIR=/usr/local/mysql/data \</span><br><span class="line">-DINSTALL_MANDIR=/usr/share/man \</span><br><span class="line">-DMYSQL_TCP_PORT=3306 \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DEXTRA_CHARSETS=all \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1</span><br><span class="line"></span><br><span class="line">提示：boost也可以使用如下指令自动下载，如果不下载bost压缩包，把下面的这一条添加到配置中第二行</span><br><span class="line">-DDOWNLOAD_BOOST=1/</span><br><span class="line">参数详解:</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \   安装目录</span><br><span class="line">-DSYSCONFDIR=/etc \   配置文件存放 （默认可以不安装配置文件）</span><br><span class="line">-DMYSQL_DATADIR=/usr/local/mysql/data \   数据目录   错误日志文件也会在这个目录</span><br><span class="line">-DINSTALL_MANDIR=/usr/share/man \     帮助文档 </span><br><span class="line">-DMYSQL_TCP_PORT=3306 \     默认端口</span><br><span class="line">-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \  sock文件位置，用来做网络通信的，客户端连接服务器的时候用</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \    默认字符集。字符集的支持，可以调</span><br><span class="line">-DEXTRA_CHARSETS=all \   扩展的字符集支持所有的</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \  支持的</span><br><span class="line">-DWITH_READLINE=1 \    上下翻历史命令</span><br><span class="line">-DWITH_SSL=system \    使用私钥和证书登陆（公钥）  可以加密。 适用与长连接。坏处：速度慢</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \   嵌入式数据库</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \    从本地倒入数据，不是备份和恢复。</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1  默认的存储引擎，支持外键</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801366.png" alt="image-20201202104048131"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql-5.7.27]# make &amp;&amp; make install</span><br><span class="line">如果安装出错，想重新安装：</span><br><span class="line">    不用重新解压，只需要删除安装目录中的缓存文件CMakeCache.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801462.png" alt="image-20201202104258768"></p>
<p><strong>需要很长时间！</strong>大约半小时</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801542.png" alt="image-20201202110755681"></p>
<p>8、初始化</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql-5.7.27]# cd /usr/local/mysql</span><br><span class="line">[root@mysql-server mysql]# chown -R mysql.mysql .</span><br><span class="line">[root@mysql-server mysql]# ./bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data     ---初始化完成之后，一定要记住提示最后的密码用于登陆或者修改密码</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801149.png" alt="image-20201202110930476"></p>
<p>2720C+Xa:E+j</p>
<p> 初始化,只需要初始化一次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# vim /etc/my.cnf    ---将文件中所有内容注释掉在添加如下内容</span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">user = mysql</span><br><span class="line">basedir = /usr/local/mysql  #指定安装目录</span><br><span class="line">datadir = /usr/local/mysql/data  #指定数据存放目录</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">character_set_server = utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">参数详解：</span><br><span class="line">[client]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认连接端口</span></span><br><span class="line">port = 3306</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用于本地连接的socket套接字</span></span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编码</span></span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 服务端口号，默认3306</span></span><br><span class="line">port = 3306</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql启动用户</span></span><br><span class="line">user = mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql安装根目录</span></span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql数据文件所在位置</span></span><br><span class="line">datadir = /usr/local/mysql/data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 为MySQL客户端程序和服务器之间的本地通讯指定一个套接字文件</span></span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库默认字符集,主流字符集支持一些特殊表情符号(特殊表情符占用4个字节)</span></span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801157.png" alt="image-20201202111147795"></p>
<p>9、启动mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# cd /usr/local/mysql</span><br><span class="line">[root@mysql-server mysql]# ./bin/mysqld_safe --user=mysql &amp;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801514.png" alt="image-20201202111228305"></p>
<p>10、登录mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql]# /usr/local/mysql/bin/mysql -uroot -p'2720C+Xa:E+j'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.27</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure>

<p>11、修改密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql]# /usr/local/mysql/bin/mysqladmin -u root -p'2720C+Xa:E+j'  password '1'</span><br><span class="line">mysqladmin: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.</span><br></pre></td></tr></table></figure>

<p>12、添加环境变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql]# vim /etc/profile    ---添加如下</span><br><span class="line">PATH=$PATH:$HOME/bin:/usr/local/mysql/bin</span><br><span class="line">[root@mysql-server mysql]# source /etc/profile</span><br><span class="line">之后就可以在任何地方使用mysql命令登陆Mysql服务器：</span><br><span class="line">[root@mysql-server mysql]# mysql --version</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.27, for Linux (x86_64) using  EditLine wrapper</span><br><span class="line">[root@mysql-server mysql]# mysql -uroot -p'1'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.27 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure>

<p>13、配置mysqld服务的管理工具：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql]# cd /usr/local/mysql/support-files/</span><br><span class="line">[root@mysql-server support-files]# cp mysql.server /etc/init.d/mysqld</span><br><span class="line">[root@mysql-server support-files]# chkconfig --add mysqld</span><br><span class="line">[root@mysql-server support-files]# chkconfig mysqld on</span><br><span class="line">先将原来的进程杀掉</span><br><span class="line">[root@mysql-server ~]# /etc/init.d/mysqld start </span><br><span class="line">Starting MySQL. SUCCESS! </span><br><span class="line">[root@mysql-server ~]# netstat -lntp </span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1087/sshd           </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1087/sshd           </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      31249/mysqld        </span><br><span class="line">[root@mysql-server ~]# /etc/init.d/mysqld stop</span><br></pre></td></tr></table></figure>

<p>数据库编译安装完成.</p>
<h4 id="2、yum安装方式"><a href="#2、yum安装方式" class="headerlink" title="2、yum安装方式"></a>2、yum安装方式</h4><p>关闭防火墙和selinux</p>
<p>mysql的官方网站：<a href="http://www.mysql.com" target="_blank" rel="noopener">www.mysql.com</a></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801865.png" alt="1566135397943"></p>
<p>拉到底</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801462.png" alt="1566135423896"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801573.png" alt="1566135475994"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801722.png" alt="1566135502131"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801129.png" alt="1566135543502"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801983.png" alt="1566136040912"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">下载</span><br><span class="line">[root@mysql-server ~]# wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">或者下载到本地上传到服务器</span><br></pre></td></tr></table></figure>

<p>2.安装mysql的yum仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">[root@mysql-server ~]# yum -y install yum-utils    #安装yum工具包</span><br></pre></td></tr></table></figure>

<p>3、配置yum源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# vim /etc/yum.repos.d/mysql-community.repo   #修改如下</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801807.png" alt="1566136558444"></p>
<p>1表示开启，0表示关闭</p>
<p>或者</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum-config-manager --<span class="built_in">enable</span> mysql57-community   将禁用的yum源库启用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum-config-manager --<span class="built_in">disable</span> mysql80-community   将启用的yum源库禁用</span></span><br></pre></td></tr></table></figure>

<p>4、安装数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# yum install -y mysql-community-server</span><br><span class="line">启动服务</span><br><span class="line">[root@mysql-server ~]# systemctl start mysqld</span><br><span class="line">设置开机启动</span><br><span class="line">[root@mysql-server ~]# systemctl enable mysqld</span><br></pre></td></tr></table></figure>

<p>5、查找密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">密码保存在日志文件中</span><br><span class="line">[root@mysql-server ~]# grep password /var/log/mysqld.log</span><br><span class="line">2019-08-18T14:03:51.991454Z 1 [Note] A temporary password is generated for root@localhost: woHtkMgau9,w</span><br></pre></td></tr></table></figure>

<p>6、修改密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">两种方式：</span><br><span class="line">第一种：</span><br><span class="line">[root@mysql-server ~]# mysql -uroot -p'woHtkMgau9,w'   #登录</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.27</span><br><span class="line">....</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter user <span class="string">'root'</span>@<span class="string">'localhost'</span> identified by <span class="string">'1'</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br><span class="line">[root@mysql-server ~]# mysql -uroot -p'1'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.27 MySQL Community Server (GPL)</span><br><span class="line">...</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">第二种：</span><br><span class="line"><span class="meta">#</span><span class="bash"> mysqladmin -u root -p<span class="string">'旧密码'</span> password <span class="string">'新密码'</span></span></span><br><span class="line">注：修改密码必须大小写数字和特殊符号都有。</span><br></pre></td></tr></table></figure>

<p><strong>扩展</strong></p>
<p>通过配置文件设置密码强度</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># vim /etc/my.cnf   #在最后添加如下内容</span></span><br><span class="line">validate_password=off</span><br><span class="line"></span><br><span class="line">[root@mysql-server ~]<span class="comment"># systemctl restart mysqld   #重启mysql生效</span></span><br><span class="line">可以用第二种方式修改为简单的密码：</span><br><span class="line">[root@mysql-server ~]<span class="comment"># mysqladmin -uroot -p'1' password '1'</span></span><br><span class="line">mysqladmin: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Warning: Since password will be sent to server <span class="keyword">in</span> plain text, use ssl connection to ensure password safety.</span><br><span class="line">[root@mysql-server ~]<span class="comment"># mysql -uroot -p1</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.27 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">exit</span></span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">编译安装：</span><br><span class="line"><span class="meta">#</span><span class="bash"> ls</span></span><br><span class="line">COPYING       README       bin   include  mysql-test  support-files</span><br><span class="line">COPYING-test  README-test  docs  lib      share</span><br><span class="line"></span><br><span class="line">1、bin目录</span><br><span class="line">用于放置一些可执行文件，如mysql、mysqld、mysqlbinlog等。</span><br><span class="line">2、include目录</span><br><span class="line">用于放置一些头文件，如：mysql.h、mysql_ername.h等。</span><br><span class="line">3、lib目录</span><br><span class="line">用于放置一系列库文件。</span><br><span class="line">4、share目录</span><br><span class="line">用于存放字符集、语言等信息。</span><br><span class="line"></span><br><span class="line">yum安装：</span><br><span class="line">/var/lib/mysql    #存放数据文件</span><br><span class="line">/usr/share/mysql  #用于存放字符集、语言等信息。</span><br></pre></td></tr></table></figure>

<h1 id="三、数据库基本操作"><a href="#三、数据库基本操作" class="headerlink" title="三、数据库基本操作"></a>三、数据库基本操作</h1><h3 id="一、数据库存储引擎（扩展）"><a href="#一、数据库存储引擎（扩展）" class="headerlink" title="一、数据库存储引擎（扩展）"></a>一、数据库存储引擎（扩展）</h3><p>​       数据库存储引擎是数据库底层软件组织，数据库管理系统（DBMS）使用数据引擎进行创建、查询、更新和删除数据。不同的存储引擎提供不同的存储机制、索引、锁定等功能，使用不同的存储引擎，还可以 获得特定的功能。现在许多不同的数据库管理系统都支持多种不同的数据引擎。MySQL的核心就是存储引擎。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MySQL存储引擎介绍 </span><br><span class="line">文件系统： 操作系统组织和存取数据的一种机制。文件系统是一种软件。 </span><br><span class="line">类型：ext2 3 4 ，xfs</span><br><span class="line">不管使用什么文件系统，数据内容不会变化 不同的是，存储空间、大小、速度。 </span><br><span class="line">MySQL引擎： 可以理解为，MySQL的“文件系统”，只不过功能更加强大。 </span><br><span class="line">MySQL引擎功能： 除了可以提供基本的存取功能，还有更多功能事务功能、锁定、备份和恢复、优化以及特殊功能。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1、InnoDB存储引擎:默认引擎，最常用的。 #速度较慢，但是非常安全，支持事务。</span><br><span class="line">  InnoDB是事务型数据库的首选引擎，支持事务安全表（ACID），支持行锁定和外键;InnoDB是默认的MySQL引擎</span><br><span class="line">InnoDB特点： </span><br><span class="line">  支持事务处理，支持外键，支持崩溃修复和并发控制。如果需要对事务的完整性要求比较高（比如银行），要求实现并发控制（比如售票），那选择InnoDB有很大的优势。如果需要频繁的更新、删除操作的数据库，也可以选择InnoDB，因为支持事务的提交（commit）和回滚（rollback）。</span><br><span class="line"></span><br><span class="line">2、MyISAM存储引擎：（了解）#牺牲一些安全性，一般不出错，不支持事务，速度比innodb引擎要快一些。</span><br><span class="line">     MyISAM基于ISAM存储引擎，并对其进行扩展。它是在Web、数据仓储和其他应用环境下最常使用的存储引擎之一。MyISAM拥有较高的插入、查询速度，但不支持事务。</span><br><span class="line">MyISAM特点： </span><br><span class="line">     插入数据快，空间和内存使用比较低。如果表主要是用于插入新记录和读出记录，那么选择MyISAM能实现处理高效率。如果应用的完整性、并发性要求比较低，也可以使用。</span><br><span class="line">12306查询 只生成一条数据这种适合</span><br><span class="line"></span><br><span class="line">3、MEMORY内存型引擎(了解)#很大程度牺牲安全性，速度很快，全部占用的内存。</span><br><span class="line">   MEMORY存储引擎将表中的数据存储到内存中，为查询和引用其他表数据提供快速访问</span><br><span class="line">MEMORY特点： </span><br><span class="line">   所有的数据都在内存中，数据的处理速度快，但是安全性不高。如果需要很快的读写速度，对数据的安全性要求较低，可以选择MEMOEY。它对表的大小有要求，不能建立太大的表。所以，这类数据库只使用在相对较小的数据库表。</span><br><span class="line"></span><br><span class="line">4、Archive(归档引擎)</span><br></pre></td></tr></table></figure>

<p>  <strong>如何选择引擎：</strong>如果要提供提交、回滚、并要求实现并发控制，InnoDB是一个好的选择；如果数据表主要用来插入和查询记录，则MyISAM引擎能提供较高的处理效率；如果只是临时存放数据，数据量不大，并且不需要较高的数据安全性，可以选择将数据保存在内存中的Memory引擎；MySQL中使用该引擎作为临时表，存放查询的中间结果；如果只有INSERT和SELECT操作，可以选择Archive，Archive支持高并发的插入操作，但是本身不是事务安全的。Archive非常适合存储归档数据，如记录日志信息可以使用Archive。</p>
<p>​        <strong>使用哪一种引擎需要灵活选择，一个数据库中多个表可以使用不同引擎以满足各种性能和实际需求，使用合适的存储引擎，将会提高整个数据库的性能。</strong></p>
<p> 存储引擎查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801947.png" alt="1566142892507"></p>
<p>修改搜索引擎</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ENGINE=引擎;</span><br></pre></td></tr></table></figure>

<p>看你的mysql当前默认的存储引擎:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%storage_engine%&#39;;</span><br></pre></td></tr></table></figure>

<p>如何查看Mysql服务器上的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br></pre></td></tr></table></figure>

<p>创建时候指定引擎</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t1(id int,manager char(10)) engine &#x3D;innodb;</span><br></pre></td></tr></table></figure>

<p><strong>了解:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.什么是外键：外键的主要作用是保持数据的一致性、完整性。</span><br><span class="line">2.什么是索引:索引相当于书中的目录，可以提高数据检索的效率，降低数据库的IO的压力。MySQL在300万条记录左右性能开始逐渐下降，虽然官方文档说500~800w记录，所以大数据量建立索引是非常有必要的</span><br><span class="line">3.什么是行锁定与锁表：可以将一张表锁定和可以单独锁一行的记录。为了防止你在操作的同时也有别人在操作。</span><br><span class="line">4.什么是事务：事务是由一步或几步数据库的操作。这系列操作要么全部执行，要么全部放弃执行。</span><br></pre></td></tr></table></figure>

<h4 id="事务控制语言-TCL"><a href="#事务控制语言-TCL" class="headerlink" title="事务控制语言(TCL)"></a>事务控制语言(TCL)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事务控制语言 （Transation Control Language）  有时可能需要使用 DML 进行批量数据的删除，修改，增加。比如，在一个员工系统中，想删除一个人的信息。除了删除这个人的基本信息外，还应该删除与此人有关的其他信息，如邮箱，地址等等。那么从开始执行到结束，就会构成一个事务。对于事务，要保证事务的完整性。要么成功，要么撤回。</span><br></pre></td></tr></table></figure>

<h6 id="事务要符合四个条件-ACID-："><a href="#事务要符合四个条件-ACID-：" class="headerlink" title="事务要符合四个条件(ACID)："></a>事务要符合四个条件(ACID)：</h6><p>事务具有<strong>四个特性</strong>：<strong>原子性</strong>（Atomicity）、<strong>一致性</strong>（Consistency）、<strong>隔离性</strong>（Isolation）和<strong>持续性</strong>（Durability）。这四个特性也简称<strong>ACID</strong>性。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">（1）原子性：事务是应用中最小的执行单位，就如原子是自然界最小颗粒，事务要么成功，要么撤回.具有不可再分的特征一样。事务是应用中不可再分的最小执行体。（最小了，不可再分了）</span><br><span class="line"></span><br><span class="line">（2）一致性：事务执行的结果，必须使数据库从一个一致性状态，变到另一个一致性状态比如：当数据库中只包含事务成功提交的结果时，数据库处于一致性状态。一致性是通过原子性来保证的。</span><br><span class="line"></span><br><span class="line">（3）隔离性：当涉及到多用户操作同一张表时，数据库会为每一个用户开启一个事务。各个事务的执行互不干扰，任意一个事务的内部操作对其他并发的事务都是隔离的。也就是说：并发执行的事务之间不能看到对方的中间状态，并发执行的事务之间不相互影响。（说白了，就是你做你的，我做我的！）</span><br><span class="line"></span><br><span class="line">（4）持续性：持续性也称为持久性指事务一旦提交对数据所做的任何改变，都要记录到永久存储器中，通常是保存进物理数据库。即使数据库崩溃了，我们也要保证事务的完整性。</span><br></pre></td></tr></table></figure>

<h3 id="二、sql语句"><a href="#二、sql语句" class="headerlink" title="二、sql语句"></a>二、sql语句</h3><p>增删改查</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SQL（Structured Query Language 即结构化查询语言）</span><br><span class="line">SQL语言主要用于存取数据、查询数据、更新数据和管理关系数据库系统，SQL语言由IBM开发。</span><br><span class="line">DDL语句	数据库定义语言：数据库、表、视图、索引、存储过程，例如CREATE DROP ALTER</span><br><span class="line">DML语句   数据库操纵语言（对记录的操作）： 插入数据INSERT、删除数据DELETE、更新数据UPDATE</span><br><span class="line">DCL语句	数据库控制语言（和权限有关）： 例如控制用户的访问权限GRANT、REVOKE</span><br><span class="line">DQL语句   数据库查询语言：查询数据SELECT</span><br></pre></td></tr></table></figure>

<p><strong>程序连接数据库的文件:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A. ODBC --------- PHP&lt;.php&gt;</span><br><span class="line">B. JDBC ----------- JAVA &lt;.jsp&gt;</span><br></pre></td></tr></table></figure>

<p>==========================================================================</p>
<p>库—-相当于一个目录，存放数据的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">库里面存放的表， 相当于是文件。</span><br><span class="line">每一行叫做记录，除第一行。</span><br><span class="line">每一列叫一个字段。列上面的第一个叫字段名称。</span><br><span class="line">创建一个库：----&gt;查看库---&gt;进入这个库-----&gt;创建表-----&gt;查看表：查看表名，表的字段（表结构），表里面的内容（表记录），查看表的状态-----&gt;修改表：添加字段，删除字段，修改字段-----&gt;修改记录（更新记录），添加记录，删除记录。各种查询，删除表，删除库。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.创建库</span><br><span class="line">mysql&gt; create database 库名;</span><br><span class="line">2.查看数据库</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">3.进入数据库</span><br><span class="line">mysql&gt; use 库名</span><br><span class="line">4.查看当前所在的库</span><br><span class="line">mysql&gt; select database();</span><br><span class="line">5.查看当前库下所有的表格</span><br><span class="line">mysql&gt; show tables;</span><br></pre></td></tr></table></figure>

<p>创建表</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">语法:</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">		字段名<span class="number">1</span>  类型[(宽度) 约束条件],</span><br><span class="line">		字段名<span class="number">2</span>  类型[(宽度) 约束条件],</span><br><span class="line">		字段名<span class="number">3</span>  类型[(宽度) 约束条件]</span><br><span class="line">)[存储引擎 字符集];</span><br><span class="line">==在同一张表中，字段名是不能相同</span><br><span class="line">==宽度和约束条件可选</span><br><span class="line">==字段名和类型是必须的</span><br><span class="line">=========================================================</span><br><span class="line">1.创建表:</span><br><span class="line">创建表 <span class="keyword">create</span> <span class="keyword">table</span> t1(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>),age <span class="built_in">int</span>); </span><br><span class="line">                      字段 类型 字段 类型(长度)，字段 类型 </span><br><span class="line">mysql&gt; create table t1(id int,name varchar(50),sex enum('m','f'),age int);</span><br><span class="line"></span><br><span class="line">2.查看有哪些表</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line"></span><br><span class="line">3.查看表结构：</span><br><span class="line">mysql&gt; desc t1;</span><br><span class="line"></span><br><span class="line">4.查看表里面的所有记录:</span><br><span class="line">语法: <span class="keyword">select</span> 内容 <span class="keyword">from</span> 表名；</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line">*:代表所有内容</span><br><span class="line"></span><br><span class="line">5.查看表里面的指定字段：</span><br><span class="line">语法:<span class="keyword">select</span> 字段，字段 <span class="keyword">from</span> 表名；</span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">name</span>,sex <span class="keyword">from</span> t1;</span><br><span class="line"></span><br><span class="line">6.查看表的状态</span><br><span class="line">mysql&gt; show table status like '表名'\G    ---每条SQL语句会以分号结尾，想看的清楚一些以\G结尾，一条记录一条记录显示。（把表90度向左反转，第一列显示字段，第二列显示记录）使用的\G就不用添加分号了</span><br><span class="line"></span><br><span class="line">7.修改表名称</span><br><span class="line">方式一、语法:<span class="keyword">rename</span> <span class="keyword">table</span> 旧表名 <span class="keyword">to</span> 新表名;</span><br><span class="line">mysql&gt; rename table t1 to t2;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">方式二、语法:<span class="keyword">alter</span> <span class="keyword">table</span> 旧表名 <span class="keyword">rename</span> 新表名;</span><br><span class="line">mysql&gt; alter table t2 rename t3;</span><br><span class="line"></span><br><span class="line">8.使用edit(\e)编辑<span class="comment">------了解</span></span><br><span class="line">mysql&gt; \e  #可以写新的语句，调用的vim编辑器，在里面结尾的时候不加分号，保存退出之后在加“;”</span><br><span class="line">    -&gt; ;</span><br><span class="line">    </span><br><span class="line">9.删除表</span><br><span class="line">mysql&gt; drop table 表名;</span><br><span class="line"></span><br><span class="line">10.删除库</span><br><span class="line">mysql&gt; drop database 库名;</span><br></pre></td></tr></table></figure>

<h1 id="Day02"><a href="#Day02" class="headerlink" title="Day02"></a>Day02</h1><h1 id="四、数据类型"><a href="#四、数据类型" class="headerlink" title="四、数据类型"></a>四、数据类型</h1><h2 id="1、数据类型"><a href="#1、数据类型" class="headerlink" title="1、数据类型"></a><strong>1、数据类型</strong></h2><p>在MySQL数据库管理系统中，可以通过存储引擎来决定表的类型。同时，MySQL数据库管理系统也<br>提供了数据类型决定表存储数据的类型。</p>
<hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">1.整型</span><br><span class="line">作用：用于存储用户的年龄、游戏的Level、经验值等。</span><br><span class="line">分类：tinyint  smallint  mediumint  int  bigint</span><br><span class="line"></span><br><span class="line">常用的是int</span><br><span class="line">显示宽度：类型后面小括号内的数字是显示的最小宽度，并不能限制插入数值的大小    </span><br><span class="line">比如：bigint(2)    2是显示宽度</span><br><span class="line">取值范围：</span><br><span class="line">| MySQL数据类型   |       最小值                |  最大值              |</span><br><span class="line">| <span class="comment">------------- | -------------------------- | -------------------- |</span></span><br><span class="line">| tinyint(n)    |  -128                      |  127                 |</span><br><span class="line">| smallint(n)   |  -32,768                   |  32,767              |</span><br><span class="line">| mediumint(n)  |  -8388608                  |  8388607             |</span><br><span class="line">| int(n)        |  -2,147,483,648            |  2,147,483,647       |</span><br><span class="line">| bigint(n)     |  -9,223,372,036,854,775,808|  9,223,372,036,854,7 |</span><br><span class="line"><span class="comment">---------------------------------------------------------------------</span></span><br><span class="line">结论：</span><br><span class="line">- 当整数值超过 int 数据类型支持的范围时，就可以采用 bigint。</span><br><span class="line">- 在 MySQL 中，int 数据类型是主要的整数数据类型。</span><br><span class="line">- int(n)里的n是表示<span class="keyword">SELECT</span>查询结果集中的显示宽度，并不影响实际的取值范围，没有影响到显示的宽度</span><br><span class="line"></span><br><span class="line"><span class="comment">#整形的宽度仅为显示宽度，不是限制。因此建议整形无须指定宽度。</span></span><br><span class="line">示例：</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> ldq.test1(age <span class="built_in">int</span>(<span class="number">10</span>));     //在ldq库下创建test1表格，设置数据类型</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into  test1(age) values(1000);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into  test1(age) values(2147483647);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into  test1(age) values(2147483648);    //超出范围，报错</span><br><span class="line">ERROR 1264 (22003): Out of range value for column 'age' at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test1;			//查询</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| age        |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|        100 |</span><br><span class="line">|       1000 |</span><br><span class="line">| 2147483647 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">=====================================================</span><br><span class="line"><span class="number">2.</span>浮点数类型	     <span class="built_in">FLOAT</span> <span class="keyword">DOUBLE</span></span><br><span class="line">作用：用于存储用户的身高、体重、薪水等</span><br><span class="line"><span class="built_in">float</span>(<span class="number">5</span>,<span class="number">3</span>)      <span class="comment">#一共5位，小数占3位.做了限制</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test4(float_test <span class="built_in">float</span>(<span class="number">5</span>,<span class="number">2</span>));  <span class="comment">#案例   宽度不算小数点</span></span><br><span class="line">mysql&gt; desc test4;</span><br><span class="line">+<span class="comment">------------+------------+------+-----+---------+-------+</span></span><br><span class="line">| Field      | Type       | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">------------+------------+------+-----+---------+-------+</span></span><br><span class="line">| float_test | float(5,2) | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">------------+------------+------+-----+---------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test4(float_test) <span class="keyword">values</span>(<span class="number">123.345534354</span>);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test4(float_test) values(34.39567);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test4(float_test) values(678.99993);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test4(float_test) values(6784.9);</span><br><span class="line">ERROR 1264 (22003): Out of range value for column 'float_test' at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test4;</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| float_test |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|     123.35 |</span><br><span class="line">|      34.40 |</span><br><span class="line">|     679.00 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">====================================================================================</span><br><span class="line">定点数类型   	 <span class="built_in">DEC</span></span><br><span class="line">定点数在MySQL内部以字符串形式存储，比浮点数更精确，适合用来表示货币等精度高的数据。</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>字符串类型  </span><br><span class="line">作用：用于存储用户的姓名、爱好、电话，邮箱地址，发布的文章等 </span><br><span class="line">字符类型 <span class="built_in">char</span> <span class="built_in">varchar</span>  <span class="comment">--存字符串</span></span><br><span class="line"></span><br><span class="line">- <span class="built_in">char</span>表示定长字符串，长度是固定的；如果插入数据的长度小于<span class="built_in">char</span>的固定长度时，则用空格填充；因为长度固定，所以存取速度要比<span class="built_in">varchar</span>快很多，甚至能快<span class="number">50</span>%，但正因为其长度固定，所以会占据多余的空间。</span><br><span class="line">- <span class="built_in">varchar</span>表示可变长字符串，长度是可变的；插入的数据是多长，就按照多长来存储；<span class="built_in">varchar</span>在存取方面与<span class="built_in">char</span>相反，它存取慢，因为长度不固定，但正因如此，不占据多余的空间。</span><br><span class="line">- 结合性能角度（<span class="built_in">char</span>更快），节省磁盘空间角度（<span class="built_in">varchar</span>更小），具体情况还需具体来设计数据库才是妥当的做法。</span><br><span class="line"></span><br><span class="line"><span class="built_in">char</span>(<span class="number">10</span>)        根据<span class="number">10</span>，占<span class="number">10</span>个.</span><br><span class="line">    列的长度固定为创建表时声明的长度： <span class="number">0</span> ~ <span class="number">255</span></span><br><span class="line"><span class="built_in">varchar</span>(<span class="number">10</span>)     根据实际字符串长度占空间，最多<span class="number">10</span>个</span><br><span class="line">    列中的值为可变长字符串，长度： <span class="number">0</span> ~ <span class="number">65535</span></span><br><span class="line"></span><br><span class="line">案例:</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> t8(c <span class="built_in">char</span>(<span class="number">5</span>),v <span class="built_in">varchar</span>(<span class="number">12</span>));</span><br><span class="line">Query OK, 0 rows affected (0.42 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t8 values('abcde','abcdef');</span><br><span class="line">Query OK, 1 row affected (0.38 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t8 values('abc','abcdef');  #char可以少于规定长度。</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t8 values('abc777','abcdef7');  #char不能大于规定的长度。</span><br><span class="line">ERROR 1406 (22001): Data too long for column 'c' at row 1</span><br><span class="line">mysql&gt; </span><br><span class="line">=====================================================================</span><br><span class="line">总结：</span><br><span class="line">1.经常变化的字段用varchar</span><br><span class="line">2.知道固定长度的用char</span><br><span class="line">3.超过255字符的只能用varchar或者text</span><br><span class="line">4.能用varchar的地方不用text</span><br><span class="line">text：文本格式</span><br><span class="line"><span class="comment">-----------------------------------------------------------------</span></span><br><span class="line">4.枚举类型 enum </span><br><span class="line">mysql&gt; create table t10(name enum('m','w'));</span><br><span class="line">只能从tom,jim两个里面2选其1</span><br><span class="line">（enumeration）  </span><br><span class="line"> 有限制的时候用枚举</span><br><span class="line"> </span><br><span class="line">案例：</span><br><span class="line">mysql&gt; insert into t10(sex) values('m');</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t10 values('w');</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t10 values('n');</span><br><span class="line">ERROR 1265 (01000): Data truncated for column 'sex' at row 1</span><br><span class="line">==================================================================</span><br><span class="line">5.日期类型</span><br><span class="line">===时间和日期类型测试：year、date、time、datetime、timestamp</span><br><span class="line">作用：用于存储用户的注册时间，文章的发布时间，文章的更新时间，员工的入职时间等</span><br><span class="line">注意事项:</span><br><span class="line">==插入年份时，尽量使用4位值</span><br><span class="line">==插入两位年份时，&lt;=69，以20开头，比如65,  结果2065      </span><br><span class="line">                 &gt;=70，以19开头，比如82，结果1982</span><br><span class="line">案例:</span><br><span class="line">mysql&gt; create table test_time(d date,t time,dt datetime);</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)+</span><br><span class="line">mysql&gt; desc test_time;</span><br><span class="line">+<span class="comment">-------+----------+------+-----+---------+-------+</span></span><br><span class="line">| Field | Type     | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------+----------+------+-----+---------+-------+</span></span><br><span class="line">| d     | date     | YES  |     | NULL    |       |</span><br><span class="line">| t     | time     | YES  |     | NULL    |       |</span><br><span class="line">| dt    | datetime | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">-------+----------+------+-----+---------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_time <span class="keyword">values</span>(<span class="keyword">now</span>(),<span class="keyword">now</span>(),<span class="keyword">now</span>());</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.02 sec)</span><br><span class="line">mysql&gt; select * from test_time;</span><br><span class="line">+<span class="comment">------------+----------+---------------------+</span></span><br><span class="line">| d          | t        | dt                  |</span><br><span class="line">+<span class="comment">------------+----------+---------------------+</span></span><br><span class="line">| 2019-08-23 | 00:26:29 | 2019-08-23 00:26:29 |</span><br><span class="line">+<span class="comment">------------+----------+---------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">测试年：</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> t3(born_year <span class="keyword">year</span>);</span><br><span class="line">Query OK, 0 rows affected (0.40 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc t3;</span><br><span class="line">+<span class="comment">-----------+---------+------+-----+---------+-------+</span></span><br><span class="line">| Field     | Type    | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-----------+---------+------+-----+---------+-------+</span></span><br><span class="line">| born_year | year(4) | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">-----------+---------+------+-----+---------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">values</span> (<span class="number">12</span>),(<span class="number">80</span>);</span><br><span class="line">Query OK, 2 rows affected (0.06 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| born_year |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">|      2012 |</span><br><span class="line">|      1980 |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">values</span> (<span class="number">2019</span>),(<span class="number">81</span>);</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| born_year |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">|      2012 |</span><br><span class="line">|      1980 |</span><br><span class="line">|      2019 |</span><br><span class="line">|      1981 |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h1 id="五、表完整性约束"><a href="#五、表完整性约束" class="headerlink" title="五、表完整性约束"></a>五、表完整性约束</h1><p>作用：用于保证数据的完整性和一致性</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">约束条件						说明</span><br><span class="line">PRIMARY KEY (PK)	标识该字段为该表的主键，可以唯一的标识记录，不可以为空  UNIQUE + NOT NULL</span><br><span class="line">FOREIGN KEY (FK)	标识该字段为该表的外键，实现表与表之间的关联</span><br><span class="line">NULL                标识是否允许为空，默认为NULL。</span><br><span class="line">NOT NULL			标识该字段不能为空，可以修改。</span><br><span class="line">UNIQUE KEY  (UK)    标识该字段的值是唯一的，可以为空，一个表中可以有多个UNIQUE KEY</span><br><span class="line">AUTO_INCREMENT		标识该字段的值自动增长（整数类型，而且为主键）</span><br><span class="line">DEFAULT				为该字段设置默认值</span><br><span class="line">UNSIGNED            无符号，正数</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.主键</span><br><span class="line">每张表里只能有一个主键，不能为空，而且唯一，主键保证记录的唯一性，主键自动为NOT NULL。</span><br><span class="line">一个 UNIQUE KEY 又是一个NOT NULL的时候，那么它被当做PRIMARY KEY主键。</span><br><span class="line"></span><br><span class="line">定义两种方式：</span><br><span class="line"><span class="meta">#</span><span class="bash">表存在，添加约束</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table t7 add primary key (hostname);</span></span><br><span class="line"></span><br><span class="line">创建表并指定约束</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t9(hostname char(20),ip char(150),primary key(hostname));</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801430.png" alt="1566197904818"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t9(hostname,ip) values(<span class="string">'l66.com'</span>, <span class="string">'10.10.10.11'</span>);</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t9(hostname,ip) values(<span class="string">'l66.com'</span>, <span class="string">'10.10.10.12'</span>);</span></span><br><span class="line">ERROR 1062 (23000): Duplicate entry 'l66.com' for key 'PRIMARY'</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t9(hostname,ip) values(<span class="string">'l66'</span>, <span class="string">'10.10.10.11'</span>);</span></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from t9;</span></span><br><span class="line">+-----------+-------------+</span><br><span class="line">| hostname  | ip          |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| l66     | 10.10.10.11 |</span><br><span class="line">| l66.com | 10.10.10.11 |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t9(hostname,ip) values(<span class="string">'ldqjy'</span>, <span class="string">'10.10.10.12'</span>);</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from t9;</span></span><br><span class="line">+-----------+-------------+</span><br><span class="line">| hostname  | ip          |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| l66     | 10.10.10.11 |</span><br><span class="line">| l66.com | 10.10.10.11 |</span><br><span class="line">| ldqjy      | 10.10.10.12 |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">删除主键</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table tab_name  drop  primary key;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2.auto_increment自增--------自动编号，且必须与主键组合使用默认情况下，起始值为1，每次的增量为1。当插入记录时，如果为AUTO_INCREMENT数据列明确指定了一个数值，则会出现两种情况：</span><br><span class="line">- 如果插入的值与已有的编号重复，则会出现出错信息，因为AUTO_INCREMENT数据列的值必须是唯一的；</span><br><span class="line">- 如果插入的值大于已编号的值，则会把该插入到数据列中，并使在下一个编号将从这个新值开始递增。也就是说，可以跳过一些编号。如果自增序列的最大值被删除了，则在插入新记录时，该值被重用。</span><br><span class="line">（每张表只能有一个字段为自曾） （成了key才可以自动增长）</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE TABLE department3 (</span></span><br><span class="line">    dept_id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    dept_name VARCHAR(30),</span><br><span class="line">    comment VARCHAR(50)</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220801232.png" alt="1566200736746"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from department3;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">插入值</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into department3(dept_name, comment) values(<span class="string">'tom'</span>,<span class="string">'test'</span>), (<span class="string">'jack'</span>, <span class="string">'test2'</span>);</span></span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from department3;</span></span><br><span class="line">+---------+-----------+---------+</span><br><span class="line">| dept_id | dept_name | comment |</span><br><span class="line">+---------+-----------+---------+</span><br><span class="line">|       1 | tom       | test    |</span><br><span class="line">|       2 | jack      | test2   |</span><br><span class="line">+---------+-----------+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">删除自动增长</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> ALTER TABLE department3 CHANGE dept_id  dept_id INT NOT NULL;</span></span><br><span class="line">Query OK, 2 rows affected (0.01 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> desc department3;</span></span><br><span class="line">+-----------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field     | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-----------+-------------+------+-----+---------+-------+</span><br><span class="line">| dept_id   | int(11)     | NO   | PRI | NULL    |       |</span><br><span class="line">| dept_name | varchar(30) | YES  |     | NULL    |       |</span><br><span class="line">| comment   | varchar(50) | YES  |     | NULL    |       |</span><br><span class="line">+-----------+-------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">再次插入数据，报错</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into department3(dept_name,comment) values(<span class="string">'tom'</span>,<span class="string">'test1'</span>),(<span class="string">'jack'</span>,<span class="string">'test2'</span>);</span></span><br><span class="line">ERROR 1364 (HY000): Field 'dept_id' doesn't have a default value</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3.设置唯一约束 UNIQUE，字段添加唯一约束之后，该字段的值不能重复，也就是说在一列当中不能出现一样的值。</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE TABLE department2 (</span></span><br><span class="line">     dept_id INT,</span><br><span class="line">     dept_name VARCHAR(30) UNIQUE,</span><br><span class="line">     comment VARCHAR(50)</span><br><span class="line">     );</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220802291.png" alt="1566201134895"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407220802255.png" alt="1566201535604"></p>
<p>插入数据的时候id和comment字段相同可以插入数据，如果有相同的名字不唯一。所以插入数据失败。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">4.null与not null</span><br><span class="line">1. 是否允许为空，默认NULL，可设置NOT NULL，字段不允许为空，必须赋值</span><br><span class="line">2. 字段是否有默认值，缺省的默认值是NULL，如果插入记录时不给字段赋值，此字段使用默认值</span><br><span class="line">sex enum('male','female') not null default 'male'  #只能选择male和female，不允许为空，默认是male</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t4(id int(5),name varchar(10),sex enum(<span class="string">'male'</span>,<span class="string">'female'</span>) not null default <span class="string">'male'</span>);</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t4(id,name) values(1,<span class="string">'tom'</span>);</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from t4;</span></span><br><span class="line">+------+------+------+</span><br><span class="line">| id   | name | sex  |</span><br><span class="line">+------+------+------+</span><br><span class="line">|    1 | tom  | male |</span><br><span class="line">+------+------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">允许为null</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t1(id int(5),name varchar(10),age int(5));</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> desc t1;</span></span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| id    | int(5)      | YES  |     | NULL    |       |</span><br><span class="line">| name  | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">| age   | int(5)      | YES  |     | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t1(id,name) values(1,<span class="string">'tom'</span>);</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from t1;</span></span><br><span class="line">+------+------+------+</span><br><span class="line">| id   | name | age  |</span><br><span class="line">+------+------+------+</span><br><span class="line">|    1 | tom  | NULL |</span><br><span class="line">+------+------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>指定字符集:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">修改字符集 ：在创建表的最后面指定一下： default charset=utf8  #可以指定中文</span><br><span class="line"></span><br><span class="line">* 未指定之前，插入</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t1(id,name) values(1,<span class="string">'石宇飞'</span>);</span></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: '\xE7\x9F\xB3\xE5\xAE\x87...' for column 'name' at row 1</span><br><span class="line"></span><br><span class="line">* 创建表格式指定字符集为utf-8</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t6(id int(2),name char(5),age int(4)) default charset=utf8;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> desc t6;</span></span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(2)  | YES  |     | NULL    |       |</span><br><span class="line">| name  | char(5) | YES  |     | NULL    |       |</span><br><span class="line">| age   | int(4)  | YES  |     | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into t6(id,name) values(1,<span class="string">'石宇飞'</span>);</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">5.默认约束</span><br><span class="line">添加/删除默认约束</span><br><span class="line"></span><br><span class="line">1.创建一个表</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table user(id int not null, name varchar(20), number int, primary key(id));</span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> describe user;</span></span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type        | Null | Key | Default | Extra |</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">| id     | int(11)     | NO   | PRI | NULL    |       |</span><br><span class="line">| name   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| number | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">2、设置默认值</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> ALTER TABLE user ALTER number SET DEFAULT 0;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> DESCRIBE user;</span></span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field  | Type        | Null | Key | Default | Extra |</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">| id     | int(11)     | NO   | PRI | NULL    |       |</span><br><span class="line">| name   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| number | int(11)     | YES  |     | 0       |       |</span><br><span class="line">+--------+-------------+------+-----+---------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3、插入值</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> ALTER TABLE user CHANGE id id INT NOT NULL AUTO_INCREMENT;</span></span><br><span class="line">Query OK, 2 rows affected (0.01 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> INSERT INTO user(name) VALUES(<span class="string">'rock'</span>); </span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> INSERT INTO user(name) VALUES(<span class="string">'rock'</span>);</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from user;</span></span><br><span class="line">+----+------+--------+</span><br><span class="line">| id | name | number |</span><br><span class="line">+----+------+--------+</span><br><span class="line">|  1 | rock |      0 |</span><br><span class="line">|  2 | rock |      0 |</span><br><span class="line">+----+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">删除默认值</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> ALTER TABLE user ALTER number drop DEFAULT;</span></span><br></pre></td></tr></table></figure>

<p><strong>作业</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.查一下oracle和mysql的区别写出几点即可。---面试</span><br></pre></td></tr></table></figure>

<h1 id="六、表操作"><a href="#六、表操作" class="headerlink" title="六、表操作"></a>六、表操作</h1><h3 id="6-1-添加字段"><a href="#6-1-添加字段" class="headerlink" title="6.1 添加字段"></a>6.1 添加字段</h3><p>格式：<code>ALTER TABLE 表名 ADD [COLUMN] 字段名 字段类型 [FIRST|AFTER 字段名];</code></p>
<p>使用<code>ALTER TABLE 语句</code>可以实现： </p>
<ul>
<li>向已有的表中添加列 </li>
<li>修改现有表中的列 </li>
<li>删除现有表中的列 </li>
<li>重命名现有表中的列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 准备基础库</span></span><br><span class="line">mysql&gt; create database emp01 character set utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建基础表</span></span><br><span class="line">mysql&gt; create table emp (</span><br><span class="line">         id int,</span><br><span class="line">         name varchar(20)</span><br><span class="line">       );</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| id    | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name  | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-1-1-表最后列添加一个新字段"><a href="#6-1-1-表最后列添加一个新字段" class="headerlink" title="6.1.1 表最后列添加一个新字段"></a>6.1.1 表最后列添加一个新字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 在emp01表最后一列添加一个新字段</span></span><br><span class="line">mysql&gt; alter table emp add math int(10);</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| id    | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name  | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| math  | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">-------+-------------+------+-----+---------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-1-2-表最后列添加多个新字段"><a href="#6-1-2-表最后列添加多个新字段" class="headerlink" title="6.1.2 表最后列添加多个新字段"></a>6.1.2 表最后列添加多个新字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 添加多个字段,中间用逗号隔开。</span></span><br><span class="line">mysql&gt; alter table emp  add (chinese int(10),english int(10));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-1-3-添加字段至表内指定字段之后"><a href="#6-1-3-添加字段至表内指定字段之后" class="headerlink" title="6.1.3 添加字段至表内指定字段之后"></a>6.1.3 添加字段至表内指定字段之后</h4><p>语法格式：<code>alter table 表名 add 添加字段名 类型(长度) after 字段名;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 把添加的字段放到name后面</span></span><br><span class="line">mysql&gt; alter table emp add age char(3) after name;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-1-4-添加字段到第一列"><a href="#6-1-4-添加字段到第一列" class="headerlink" title="6.1.4 添加字段到第一列"></a>6.1.4 添加字段到第一列</h4><p>语法格式：<code>alter table 表名 add 添加字段名 类型(长度) first;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table emp add class char(10) first;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| class   | char(10)    | YES  |     | NULL    |       |</span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="6-2-修改字段和类型"><a href="#6-2-修改字段和类型" class="headerlink" title="6.2 修改字段和类型"></a>6.2 修改字段和类型</h3><h4 id="6-2-1-修改字段名称（慎用）"><a href="#6-2-1-修改字段名称（慎用）" class="headerlink" title="6.2.1 修改字段名称（慎用）"></a>6.2.1 修改字段名称（慎用）</h4><p>语法格式：<code>ALTER TABLE 表名 CHANGE 旧列名 新列名 新数据类型;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 原表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| class   | char(10)    | YES  |     | NULL    |       |</span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改name字段名为names</span></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">change</span> <span class="keyword">name</span> <span class="keyword">names</span> <span class="built_in">varchar</span>(<span class="number">20</span>);</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 新表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| class   | char(10)    | YES  |     | NULL    |       |</span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| names   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-2-2-修改字段类型长度"><a href="#6-2-2-修改字段类型长度" class="headerlink" title="6.2.2 修改字段类型长度"></a>6.2.2 修改字段类型长度</h4><p>语法格式：<code>ALTER TABLE 表名 MODIFY 【COLUMN】 字段名1 字段类型 【DEFAULT 默认值】【FIRST|AFTER 字段名 2】;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 原表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| class   | char(10)    | YES  |     | NULL    |       |</span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| names   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改name字段类型的长度为30，并且移动至math字段后</span></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> emp  <span class="keyword">modify</span> <span class="keyword">names</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">after</span> math;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 新表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| class   | char(10)    | YES  |     | NULL    |       |</span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| names   | varchar(30) | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-删除字段（慎用）"><a href="#6-2-3-删除字段（慎用）" class="headerlink" title="6.2.3 删除字段（慎用）"></a>6.2.3 删除字段（慎用）</h4><p>语法格式：<code>ALTER TABLE 表名 DROP 【COLUMN】字段名</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 原表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| class   | char(10)    | YES  |     | NULL    |       |</span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| names   | varchar(30) | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 删除class字段</span></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">drop</span> <span class="keyword">class</span>;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 新表结构</span></span><br><span class="line">mysql&gt; desc emp;</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">| id      | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| age     | char(3)     | YES  |     | NULL    |       |</span><br><span class="line">| math    | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| names   | varchar(30) | YES  |     | NULL    |       |</span><br><span class="line">| chinese | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">| english | int(10)     | YES  |     | NULL    |       |</span><br><span class="line">+<span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 也可以使用以下SQL语句查看表结构</span></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> emp \G</span><br></pre></td></tr></table></figure>

<h3 id="6-3-插入数据-添加纪录"><a href="#6-3-插入数据-添加纪录" class="headerlink" title="6.3 插入数据(添加纪录)"></a>6.3 插入数据(添加纪录)</h3><p><strong>创建初始表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t3(</span><br><span class="line">    id int,</span><br><span class="line">    name varchar(20),</span><br><span class="line">    sex enum('m','f'),</span><br><span class="line">    age int</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"> <span class="comment">#&gt;&gt;&gt; 查看表结构</span></span><br><span class="line"> mysql&gt; show create table t3 \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: t3</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t3`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`sex`</span> enum(<span class="string">'m'</span>,<span class="string">'f'</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：字符串必须引号引起来；记录与表头相对应，表头与字段用逗号隔开。</strong></p>
</blockquote>
<h4 id="6-3-1-添加一条数据"><a href="#6-3-1-添加一条数据" class="headerlink" title="6.3.1 添加一条数据"></a>6.3.1 添加一条数据</h4><p>语法格式：<code>insert into 表名(字段1,字段2,字段3,字段4) values(值1,&quot;值2&quot;,&quot;值3&quot;,值4);</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into t3(id,name,sex,age) values(1,"小贺","f",18);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select  * from t3;</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">| id   | name   | sex  | age  |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">|    1 | 小贺   | f    |   1 |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：添加的记录与表头要对应。</p>
</blockquote>
<h4 id="6-3-2-添加多条数据"><a href="#6-3-2-添加多条数据" class="headerlink" title="6.3.2 添加多条数据"></a>6.3.2 添加多条数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into t3(id,name,sex,age) values(2,"小飞","m",18),(3,"铭哥","m",17);</span><br><span class="line">Query OK, 2 rows affected (0.01 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select  * from t3;</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">| id   | name   | sex  | age  |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">|    1 | 小贺   | f    |   60 |</span><br><span class="line">|    2 | 小飞   | m    |   18 |</span><br><span class="line">|    3 | 铭哥   | m    |   17 |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用set命令添加</span></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">set</span>  <span class="keyword">id</span>=<span class="number">4</span>,<span class="keyword">name</span>=<span class="string">"小建"</span>,sex=<span class="string">"f"</span>,age=<span class="number">15</span>;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select  * from t3;</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">| id   | name   | sex  | age  |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">|    1 | 小贺   | f    |   60 |</span><br><span class="line">|    2 | 小飞   | m    |   18 |</span><br><span class="line">|    3 | 铭哥   | m    |   17 |</span><br><span class="line">|    4 | 小建   | f    |   15 |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-3-3-更新字段值"><a href="#6-3-3-更新字段值" class="headerlink" title="6.3.3 更新字段值"></a>6.3.3 更新字段值</h4><p>语法格式：<code>UPDATE 表名 SET 更新字段=更新值 where  更新字段=原有值</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 将名字为小建改为贝贝</span></span><br><span class="line">mysql&gt; update t3 set name = "贝贝" where id = 4;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select  name from t3;</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">| id   | name   | sex  | age  |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">|    1 | 小贺   | f    |   60 |</span><br><span class="line">|    2 | 小飞   | m    |   18 |</span><br><span class="line">|    3 | 铭哥   | m    |   17 |</span><br><span class="line">|    4 | 贝贝   | f    |   15 |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-3-4-删除单行记录"><a href="#6-3-4-删除单行记录" class="headerlink" title="6.3.4 删除单行记录"></a>6.3.4 删除单行记录</h4><p>语法格式：<code>delete from 表名 where 字段=值</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 删除名称为小贺那一行记录</span></span><br><span class="line">mysql&gt; delete from t3 where name = "小贺";</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">| id   | name   | sex  | age  |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">|    2 | 小飞   | m    |   18 |</span><br><span class="line">|    3 | 铭哥   | m    |   17 |</span><br><span class="line">|    4 | 贝贝   | f    |   15 |</span><br><span class="line">+<span class="comment">------+--------+------+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-3-5-删除整张表记录"><a href="#6-3-5-删除整张表记录" class="headerlink" title="6.3.5 删除整张表记录"></a>6.3.5 删除整张表记录</h4><p>语法格式：<code>delete from 表名;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from t3;</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="6-4-单表查询"><a href="#6-4-单表查询" class="headerlink" title="6.4 单表查询"></a>6.4 <code>单表查询</code></h3><p><strong>准备测试表</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># mysql -uroot -pabc123 &lt; study.sql </span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看所有数据库</span></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 切换study数据库</span></span><br><span class="line">mysql&gt; <span class="keyword">use</span> study;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup <span class="keyword">with</span> -A</span><br><span class="line"></span><br><span class="line"><span class="keyword">Database</span> <span class="keyword">changed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看当前数据库所有的表</span></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">| Tables_in_study  |</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">| countries        |  <span class="comment"># 国家表</span></span><br><span class="line">| departments      |  <span class="comment"># 部门表</span></span><br><span class="line">| emp_details_view |  </span><br><span class="line">| employees        |  <span class="comment"># 员工表</span></span><br><span class="line">| job_grades       |</span><br><span class="line">| job_history      |</span><br><span class="line">| jobs             |  <span class="comment"># 职业</span></span><br><span class="line">| locations        |  <span class="comment"># 位置</span></span><br><span class="line">| order            |</span><br><span class="line">| regions          |  <span class="comment"># 城市</span></span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-4-1-整表查询（慎用）"><a href="#6-4-1-整表查询（慎用）" class="headerlink" title="6.4.1 整表查询（慎用）"></a>6.4.1 整表查询（慎用）</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407122343671.png" alt="img"></p>
<h4 id="6-4-2-多字段查询"><a href="#6-4-2-多字段查询" class="headerlink" title="6.4.2 多字段查询"></a>6.4.2 多字段查询</h4><p>语法格式：<code>select 字段1,字段2,字段3，.. from employees;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看部门表中员工部门id，员工名字，员工姓氏</span></span><br><span class="line">mysql&gt; select employee_id,first_name,last_name from employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407122350956.png" alt="img"></p>
<h4 id="6-4-3-比较运算符使用"><a href="#6-4-3-比较运算符使用" class="headerlink" title="6.4.3 比较运算符使用"></a>6.4.3 比较运算符使用</h4><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407122351821.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查询员工工资大于1000的员工id和名字</span></span><br><span class="line">mysql&gt; select employee_id,first_name,salary from employees where salary &gt; 1000;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工等于10000的员工Id和名字</span></span><br><span class="line">mysql&gt; select employee_id,first_name,salary from employees where salary = 10000;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工工资不等于10000的员工Id和名字</span></span><br><span class="line">mysql&gt; select employee_id,first_name,salary from employees where salary != 10000;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工小于10000的员工Id和名字</span></span><br><span class="line">mysql&gt; select employee_id,first_name,salary from employees where salary &lt; 10000;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工工资大于等于10000的员工Id和名字</span></span><br><span class="line">mysql&gt; select employee_id,first_name,salary from employees where salary &gt;= 10000;</span><br></pre></td></tr></table></figure>

<h4 id="6-4-4-查询字段别名设置AS"><a href="#6-4-4-查询字段别名设置AS" class="headerlink" title="6.4.4 查询字段别名设置AS"></a>6.4.4 查询字段别名设置<code>AS</code></h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查询员工工资大于等于10000的员工信息</span></span><br><span class="line">mysql&gt; select employee_id,first_name,salary as "salry_num" from employees where salary &gt;= 10000;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407130006848.png" alt="img"></p>
<h4 id="6-4-5-去除重复行"><a href="#6-4-5-去除重复行" class="headerlink" title="6.4.5 去除重复行"></a>6.4.5 去除重复行</h4><p>语法格式：<code>SELECT DISTINCT 字段名 FROM 表名;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct  department_id from employees;</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">| department_id |</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">|          NULL |</span><br><span class="line">|            10 |</span><br><span class="line">|            20 |</span><br><span class="line">|            30 |</span><br><span class="line">|            40 |</span><br><span class="line">|            50 |</span><br><span class="line">|            60 |</span><br><span class="line">|            70 |</span><br><span class="line">|            80 |</span><br><span class="line">|            90 |</span><br><span class="line">|           100 |</span><br><span class="line">|           110 |</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-4-6-逻辑运算符"><a href="#6-4-6-逻辑运算符" class="headerlink" title="6.4.6 逻辑运算符"></a>6.4.6 逻辑运算符</h4><p>​        逻辑运算符主要用来判断表达式的真假，在MySQL中，逻辑运算符的返回结果为1、0或者NULL。</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131642416.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; NOT使用</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 查询职业不是"PR_REP(销售)"和"SH_CLERK(业务员)"的员工信息</span></span><br><span class="line">mysql&gt;  select employee_id,first_name,last_name,job_id from employees where job_id not in ("PR_REP","SH_CLERK");</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; AND或&amp;&amp;使用</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 查询工资大于等于10000且小于等于20000的员工信息</span></span><br><span class="line">mysql&gt; select last_name,salary from study.employees where salary &gt;= 10000 and salary &lt;= 20000;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; OR或者||使用</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 查询工资大于等于10000或者小于等于20000的员工信息</span></span><br><span class="line">mysql&gt; select last_name,salary from study.employees where salary &gt;= 10000 || salary &lt;= 20000;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意： OR可以和AND一起使用，但是在使用时要注意两者的优先级，由于AND的优先级高于OR，因此先对AND两边的操作数进行操作，再与OR中的操作数结合。</strong></p>
</blockquote>
<h3 id="6-5-函数"><a href="#6-5-函数" class="headerlink" title="6.5 函数"></a>6.5 函数</h3><p>简介：函数可以把我们<code>经常使用的代码</code>封装起来， 需要的时候直接调用即可。这样既 <code>提高了代码效率</code> ，又 <code>提高了可维护性</code> 。在 SQL 中我们也可以使用函数对检索出来的数据进行函数操作。使用这些函数，可以极大地提高用户对数据库的管理效率 。</p>
<p>​        函数分成<code>内置函数</code>和 <code>自定义函数</code> 。在 SQL 语言中，同样也包括了<code>内置函数</code>和<code>自定义函数</code>。内置函数是系统内置的通用函数，而自定义函数是我们根据自己的需要编写的</p>
<h4 id="6-5-1-MySQL内置函数分类"><a href="#6-5-1-MySQL内置函数分类" class="headerlink" title="6.5.1 MySQL内置函数分类"></a>6.5.1 MySQL内置函数分类</h4><p>​        MySQL提供的内置函数从实现的功能角度可以分为<strong>数值函数、字符串函数、日期和时间函数、流程控制函数、聚合函数等。</strong>这些丰富的内置函数再分为两类： <strong>单行函数 、聚合函数</strong> 。</p>
<h4 id="6-5-2-单行函数"><a href="#6-5-2-单行函数" class="headerlink" title="6.5.2 单行函数"></a>6.5.2 单行函数</h4><p>​        只对一行进行变换；每行返回一个结果。</p>
<h5 id="1-数值函数"><a href="#1-数值函数" class="headerlink" title="1. 数值函数"></a>1. 数值函数</h5><table>
<thead>
<tr>
<th>函数名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ABS(x)</td>
<td>取x的绝对值</td>
</tr>
<tr>
<td>SIGN(X)</td>
<td>取X的符号。正数返回1，负数返回-1，0返回0</td>
</tr>
<tr>
<td>PI()</td>
<td>取圆周率的值</td>
</tr>
<tr>
<td>RAND()</td>
<td>取0~1的随机值</td>
</tr>
<tr>
<td>ROUND(x)</td>
<td>取一个对x的值进行四舍五入后，最接近于X的整数</td>
</tr>
<tr>
<td>TRUNCATE(x,y)</td>
<td>取数字x截断为y位小数的结果</td>
</tr>
</tbody></table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT ABS(-321),ABS(456),SIGN(-10),SIGN(10),PI(),RAND(),ROUND(1.5),TRUNCATE(3.1415,2)  FROM DUAL;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131330422.png" alt="img"></p>
<h5 id="2-字符串函数"><a href="#2-字符串函数" class="headerlink" title="2. 字符串函数"></a>2. 字符串函数</h5><table>
<thead>
<tr>
<th>函数名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR_LENGTH(s)</td>
<td>字符串s的字符数。</td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>返回字符串s的字节数</td>
</tr>
<tr>
<td>CONCAT(s1,s2,……,sn)</td>
<td>连接s1,s2,……,sn为一个字符串</td>
</tr>
<tr>
<td>CONCAT_WS(z, s1,s2,……,sn)</td>
<td>同CONCAT(s1,s2,…)函数，但是每个字符串之间要加上z</td>
</tr>
<tr>
<td>REPLACE(str, a, b)</td>
<td>字符串b替换字符串str中所有出现的字符串a</td>
</tr>
<tr>
<td>UPPER(s)</td>
<td>字符串s的所有字母转成大写字母</td>
</tr>
<tr>
<td>LOWER(s)</td>
<td>字符串s的所有字母转成小写字母</td>
</tr>
<tr>
<td>LEFT(str,n)</td>
<td>返回字符串str最左边的n个字符</td>
</tr>
<tr>
<td>RIGHT(str,n)</td>
<td>返回字符串str最右边的n个字符</td>
</tr>
<tr>
<td>LPAD(str, len, pad)</td>
<td>用字符串pad对str最左边进行填充，直到str的长度为len个字符</td>
</tr>
<tr>
<td>RPAD(str ,len, pad)</td>
<td>用字符串pad对str最右边进行填充，直到str的长度为len个字符</td>
</tr>
<tr>
<td>LTRIM(s)</td>
<td>去掉字符串s左侧的空格</td>
</tr>
<tr>
<td>RTRIM(s)</td>
<td>去掉字符串s右侧的空格</td>
</tr>
</tbody></table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select char_length("mingge"),length("铭哥"),concat("胡","佳","铭"),concat_ws("z","胡","佳","铭"),replace("azzzzzZbbb","z","c") from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131351392.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select upper("mingge"),lower("mingge"),left("hello,world",5),right("hello,world",5),lpad("world",10,"hello"),rpad("hello",10,"world") from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131356932.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ltrim(" hello"),rtrim("world ") from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131357439.png" alt="img"></p>
<h5 id="3-日期和时间函数"><a href="#3-日期和时间函数" class="headerlink" title="3. 日期和时间函数"></a>3. 日期和时间函数</h5><table>
<thead>
<tr>
<th>函数名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>CURDATE() ，CURRENT_DATE()</td>
<td>当前日期，只包含年、 月、日</td>
</tr>
<tr>
<td>CURTIME() ， CURRENT_TIME()</td>
<td>当前时间，只包含时、 分、秒</td>
</tr>
<tr>
<td>NOW() / SYSDATE() / CURRENT_TIMESTAMP() / LOCALTIME() / LOCALTIMESTAMP()</td>
<td>当前系统日期和时间</td>
</tr>
<tr>
<td>UTC_DATE()</td>
<td>UTC（世界标准时间） 日期</td>
</tr>
<tr>
<td>UTC_TIME()</td>
<td>UTC（世界标准时间） 时间</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP()。单位为毫秒</td>
<td>UNIX时间戳的形式返回当前时间。</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP(date)</td>
<td>将时间date以UNIX时间戳的形式返回。</td>
</tr>
<tr>
<td>FROM_UNIXTIME(timestamp)</td>
<td>将UNIX时间戳的时间转换为普通格式的时间</td>
</tr>
</tbody></table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT CURDATE(),CURTIME(),NOW(),UTC_DATE(),UTC_TIME() FROM DUAL;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131416980.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select unix_timestamp(),from_unixtime(1720851662),unix_timestamp('2024-07-13 14:22:50'),from_unixtime(1720851770) from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131423364.png" alt="img"></p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>YEAR(date) / MONTH(date) / DAY(date)</td>
<td>返回具体的日期值</td>
</tr>
<tr>
<td>HOUR(time) / MINUTE(time) / SECOND(time)</td>
<td>返回具体的时间值</td>
</tr>
<tr>
<td>MONTHNAME(date)</td>
<td>返回月份</td>
</tr>
<tr>
<td>DAYNAME(date)</td>
<td>返回星期几</td>
</tr>
<tr>
<td>WEEKDAY(date)</td>
<td>返回周几，注意，周1是0，周2是1，。。。周日是6</td>
</tr>
<tr>
<td>QUARTER(date)</td>
<td>返回日期对应的季度，范围为1～4</td>
</tr>
<tr>
<td>WEEK(date) ， WEEKOFYEAR(date)</td>
<td>返回一年中的第几周</td>
</tr>
<tr>
<td>DAYOFYEAR(date)</td>
<td>返回日期是一年中的第几天</td>
</tr>
<tr>
<td>DAYOFMONTH(date)</td>
<td>返回日期位于所在月份的第几天</td>
</tr>
<tr>
<td>DAYOFWEEK(date)</td>
<td>返回周几，注意：周日是1，周一是2，。。。周六是 7</td>
</tr>
</tbody></table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select year(curdate()),month(curdate()),day(curdate()) from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131429665.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select hour(curtime()),minute(now()),second(sysdate()) from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131431728.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select monthname('2024-7-13'),dayname('2024-7-13'),weekday('2024-7-13'),quarter(curdate()),week(curdate()),dayofyear(now()),dayofmonth(now()),dayofweek(now()) from dual;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131435666.png" alt="img"></p>
<h5 id="4-流程控制函数"><a href="#4-流程控制函数" class="headerlink" title="4. 流程控制函数"></a>4. 流程控制函数</h5><p>​    流程处理函数可以根据不同的条件，执行不同的处理流程，可以在SQL语句中实现不同的条件选择。</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value,value1,value2)</td>
<td>如果value的值为TRUE，返回value1， 否则返回value2</td>
</tr>
<tr>
<td>IFNULL(value1, value2)</td>
<td>如果value1不为NULL，返回value1，否则返回value2</td>
</tr>
<tr>
<td>CASE WHEN 条件1 THEN 结果1 WHEN 条件2 THEN 结果2 …. [ELSE resultn] END</td>
<td>相当于shell的if…else if…else…</td>
</tr>
</tbody></table>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select employee_id,first_name,last_name,salary,if(salary &gt;= 10000,'工资略高','工资一般') from employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131446726.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select first_name,last_name,commission_pct,if(commission_pct is null,0,commission_pct) from employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131450819.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select first_name,last_name,commission_pct,ifnull(commission_pct,0) from employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131452019.png" alt="img"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select employee_id,first_name,last_name,salary, </span><br><span class="line">              case when salary&gt;=17000 then '工资挺高'</span><br><span class="line">                   when salary&gt;=10000 then '工资一般'</span><br><span class="line">                   when salary&gt;=8000 then '工资很低'</span><br><span class="line">                   else '呵呵' <span class="keyword">END</span> <span class="string">"工资收入"</span></span><br><span class="line">       <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131457403.png" alt="img"></p>
<h4 id="6-5-3-聚合函数"><a href="#6-5-3-聚合函数" class="headerlink" title="6.5.3 聚合函数"></a>6.5.3 聚合函数</h4><p>​        对一组数据进行汇总的函数，输入的是一组数据的集合，输出的是单个值。聚合函数作用于一组数据，并对一组数据返回一个值。</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>AVG()</td>
<td>平均值</td>
</tr>
<tr>
<td>SUM()</td>
<td>总和</td>
</tr>
<tr>
<td>MAX()</td>
<td>最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>最小值</td>
</tr>
<tr>
<td>COUNT()</td>
<td>个数</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工表中所有员工平均工资</span></span><br><span class="line">mysql&gt; select avg(salary) from employees;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| avg(salary) |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| 6461.682243 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工工资总和</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">sum</span>(salary) <span class="keyword">from</span> employees;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| sum(salary) |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|   691400.00 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工12个月的工资总和</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">sum</span>(salary * <span class="number">12</span>) <span class="keyword">from</span> employees;</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">| sum(salary * 12) |</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">|       8296800.00 |</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看最高工资和最低工资的员工</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">max</span>(salary),<span class="keyword">min</span>(salary) <span class="keyword">from</span> employees;</span><br><span class="line">+<span class="comment">-------------+-------------+</span></span><br><span class="line">| max(salary) | min(salary) |</span><br><span class="line">+<span class="comment">-------------+-------------+</span></span><br><span class="line">|    24000.00 |     2100.00 |</span><br><span class="line">+<span class="comment">-------------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看员工id的个数</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">count</span>(employee_id) <span class="keyword">from</span> employees;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| count(employee_id) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">|                107 |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看表中总记录</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">count</span>(*)  <span class="keyword">from</span> employees;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|      107 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查询表中包含空值的记录</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">count</span>(employee_id)  <span class="keyword">from</span> employees  <span class="keyword">where</span> employee_id <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| count(employee_id) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">|                  0 |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：conut函数在统计默认情况不包含空值</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt; 查询员工的平均奖金率</span></span><br><span class="line">mysql&gt; select sum(commission_pct) / count(ifnull(commission_pct,0)) from employees;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131625383.png" alt></p>
<h5 id="1-分组查询GROUP-BY"><a href="#1-分组查询GROUP-BY" class="headerlink" title="1. 分组查询GROUP BY"></a>1. 分组查询<code>GROUP BY</code></h5><p>​        在MySQL中，<code>GROUP BY</code>子句用于将结果集中的行按一个或多个列进行分组。常与聚合函数（如<code>COUNT()</code>、<code>SUM()</code>、<code>AVG()</code>、<code>MAX()</code>、<code>MIN()</code>等）结合使用，以对每个组执行某种计算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 准备初始表</span></span><br><span class="line">mysql&gt; CREATE TABLE employees (</span><br><span class="line">       id INT PRIMARY KEY, <span class="comment">-- 员工ID，主键</span></span><br><span class="line">       name VARCHAR(50), <span class="comment">-- 员工姓名</span></span><br><span class="line">       department VARCHAR(50), <span class="comment">-- 部门</span></span><br><span class="line">       salary INT <span class="comment">-- 工资</span></span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt;  插入数据</span></span><br><span class="line">mysql&gt; INSERT INTO employees (id, name, department, salary) VALUES</span><br><span class="line">(1, 'Alice', 'Sales', 5000),</span><br><span class="line">(2, 'Bob', 'HR', 4000),</span><br><span class="line">(3, 'Charlie', 'Sales', 5500),</span><br><span class="line">(4, 'David', 'IT', 6000),</span><br><span class="line">(5, 'Eve', 'IT', 6200),</span><br><span class="line">(6, 'Frank', 'Sales', 5300);</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 统计每个部门的员工人数</span></span><br><span class="line">mysql&gt; SELECT department,COUNT(*) AS num_employees</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department;</span><br><span class="line">+<span class="comment">------------+---------------+</span></span><br><span class="line">| department | num_employees |</span><br><span class="line">+<span class="comment">------------+---------------+</span></span><br><span class="line">| HR         |             1 |</span><br><span class="line">| IT         |             2 |</span><br><span class="line">| Sales      |             3 |</span><br><span class="line">+<span class="comment">------------+---------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 计算每个部门的平均工资</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> department, <span class="keyword">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department;</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| department | avg_salary |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| HR         |  4000.0000 |</span><br><span class="line">| IT         |  6100.0000 |</span><br><span class="line">| Sales      |  5266.6667 |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 获取每个部门的最高工资</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> department, <span class="keyword">MAX</span>(salary) <span class="keyword">AS</span> max_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department;</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| department | max_salary |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| HR         |       4000 |</span><br><span class="line">| IT         |       6200 |</span><br><span class="line">| Sales      |       5500 |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<ul>
<li><code>GROUP BY</code>子句应出现在<code>SELECT</code>查询的<code>WHERE</code>子句之后和<code>ORDER BY</code>子句之前。</li>
<li><code>SELECT</code>查询中的列必须出现在<code>GROUP BY</code>子句中，或者是聚合函数的参数。</li>
</ul>
</blockquote>
<h3 id="6-6-表复制"><a href="#6-6-表复制" class="headerlink" title="6.6 表复制"></a>6.6 表复制</h3><p>​        在MySQL中可以基于某一张存在的表创建新表，但主键、外键和索引不会复制</p>
<p>语法格式：<code>create table 新表名 select * from 存在的表名</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table emp01.test  select * from   study.employees;</span><br><span class="line">Query OK, 107 rows affected (0.04 sec)</span><br><span class="line">Records: 107  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp01.test</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131632370.png" alt="img"></p>
<h4 id="6-6-1-单、多字段复制"><a href="#6-6-1-单、多字段复制" class="headerlink" title="6.6.1 单、多字段复制"></a>6.6.1 单、多字段复制</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table emp01.test02  select mployee_id,first_name,last_name  from study.employees;</span><br><span class="line">Query OK, 107 rows affected (0.02 sec)</span><br><span class="line">Records: 107  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp01.test02</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407131634865.png" alt></p>
<h3 id="6-7-范围查询BETWEEN-AND"><a href="#6-7-范围查询BETWEEN-AND" class="headerlink" title="6.7 范围查询BETWEEN AND"></a>6.7 范围查询<code>BETWEEN AND</code></h3><p>​        BETWEEN运算符使用的格式通常为<code>SELECT 字段名 FROM TABLE WHERE 字段名 BETWEEN 值1 AND 值2</code>，此时，当值大于或等于值1，并且值小于或等于值2时，结果为1，否则结果为0。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select last_name,salary from employees where salary between 5000 AND 10000;</span><br></pre></td></tr></table></figure>

<h3 id="6-8-IS-NULL空值和IS-NOT-NULL非空值查询"><a href="#6-8-IS-NULL空值和IS-NOT-NULL非空值查询" class="headerlink" title="6.8 IS NULL空值和IS NOT NULL非空值查询"></a>6.8 <code>IS NULL空值和IS NOT NULL非空值查询</code></h3><h4 id="6-8-1-IS-NULL-查询"><a href="#6-8-1-IS-NULL-查询" class="headerlink" title="6.8.1 IS NULL 查询"></a>6.8.1 IS NULL 查询</h4><p>​        空运算符（IS NULL或者ISNULL）判断一个值是否为NULL，如果为NULL则返回1，否则返回 0。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查询commission_pct等于NULL</span></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE commission_pct IS NULL;</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE commission_pct &lt;=&gt; NULL;</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE ISNULL(commission_pct);</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL 5.7 此语句无法实现</span></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE commission_pct = NULL;</span><br></pre></td></tr></table></figure>

<h4 id="6-8-2-IS-NOT-NULL"><a href="#6-8-2-IS-NOT-NULL" class="headerlink" title="6.8.2 IS NOT NULL"></a>6.8.2 IS NOT NULL</h4><p>​        非空运算符（IS NOT NULL）判断一个值是否不为NULL，如果不为NULL则返回1，否则返回0。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查询commission_pct不等于NULL</span></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE commission_pct IS NOT NULL;</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE NOT commission_pct &lt;=&gt; NULL;</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT employee_id,commission_pct FROM employees WHERE NOT ISNULL(commission_pct);</span><br></pre></td></tr></table></figure>

<h3 id="6-9-IN运算符使用"><a href="#6-9-IN运算符使用" class="headerlink" title="6.9 IN运算符使用"></a>6.9 <code>IN运算符使用</code></h3><p>​            IN运算符用于判断给定的值是否是IN列表中的一个值，如果是则返回1，否则返回0。如果给定的值为NULL，或者IN列表中存在NULL，则结果为NULL。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT employee_id,last_name,salary,manager_id FROM employees WHERE manager_id IN (100,101);</span><br></pre></td></tr></table></figure>

<h3 id="6-10-排序查询"><a href="#6-10-排序查询" class="headerlink" title="6.10 排序查询"></a>6.10 排序查询</h3><p>​        <strong>使用 <code>ORDER BY</code>子句排序;ASC:：升序；DESC：降序。<code>ORDER BY</code>子句在SELECT语句的结尾。在排序时，默认升序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 准备初始表</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 创建 employees 表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>, <span class="comment">-- 员工ID，主键</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">    department <span class="built_in">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 部门</span></span><br><span class="line">    salary <span class="built_in">INT</span>, <span class="comment">-- 工资</span></span><br><span class="line">    hire_date <span class="built_in">DATE</span> <span class="comment">-- 入职日期</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 插入初始数据</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees (<span class="keyword">id</span>, <span class="keyword">name</span>, department, salary, hire_date) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">'Alice'</span>, <span class="string">'Sales'</span>, <span class="number">5000</span>, <span class="string">'2020-01-15'</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">'Bob'</span>, <span class="string">'HR'</span>, <span class="number">4000</span>, <span class="string">'2019-03-22'</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">'Charlie'</span>, <span class="string">'Sales'</span>, <span class="number">5500</span>, <span class="string">'2021-06-10'</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">'David'</span>, <span class="string">'IT'</span>, <span class="number">6000</span>, <span class="string">'2018-11-30'</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">'Eve'</span>, <span class="string">'IT'</span>, <span class="number">6200</span>, <span class="string">'2017-07-19'</span>),</span><br><span class="line">(<span class="number">6</span>, <span class="string">'Frank'</span>, <span class="string">'Sales'</span>, <span class="number">5300</span>, <span class="string">'2020-05-25'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="6-10-1-单列排序"><a href="#6-10-1-单列排序" class="headerlink" title="6.10.1 单列排序"></a>6.10.1 单列排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 按salary升序排序</span></span><br><span class="line">mysql&gt; SELECT * FROM employees</span><br><span class="line">       ORDER BY salary ASC;</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">| id | name    | department | salary | hire_date  |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">|  2 | Bob     | HR         |   4000 | 2019-03-22 |</span><br><span class="line">|  1 | Alice   | Sales      |   5000 | 2020-01-15 |</span><br><span class="line">|  6 | Frank   | Sales      |   5300 | 2020-05-25 |</span><br><span class="line">|  3 | Charlie | Sales      |   5500 | 2021-06-10 |</span><br><span class="line">|  4 | David   | IT         |   6000 | 2018-11-30 |</span><br><span class="line">|  5 | Eve     | IT         |   6200 | 2017-07-19 |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 按hire_date降序排序</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees</span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date <span class="keyword">DESC</span>;</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">| id | name    | department | salary | hire_date  |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">|  3 | Charlie | Sales      |   5500 | 2021-06-10 |</span><br><span class="line">|  6 | Frank   | Sales      |   5300 | 2020-05-25 |</span><br><span class="line">|  1 | Alice   | Sales      |   5000 | 2020-01-15 |</span><br><span class="line">|  2 | Bob     | HR         |   4000 | 2019-03-22 |</span><br><span class="line">|  4 | David   | IT         |   6000 | 2018-11-30 |</span><br><span class="line">|  5 | Eve     | IT         |   6200 | 2017-07-19 |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="6-10-2-多列排序"><a href="#6-10-2-多列排序" class="headerlink" title="6.10.2 多列排序"></a>6.10.2 多列排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 按salary升序，然后按hire_date降序排序</span></span><br><span class="line">mysql&gt; SELECT * FROM employees</span><br><span class="line">       ORDER BY salary ASC, hire_date DESC;</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">| id | name    | department | salary | hire_date  |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">|  2 | Bob     | HR         |   4000 | 2019-03-22 |</span><br><span class="line">|  1 | Alice   | Sales      |   5000 | 2020-01-15 |</span><br><span class="line">|  6 | Frank   | Sales      |   5300 | 2020-05-25 |</span><br><span class="line">|  3 | Charlie | Sales      |   5500 | 2021-06-10 |</span><br><span class="line">|  4 | David   | IT         |   6000 | 2018-11-30 |</span><br><span class="line">|  5 | Eve     | IT         |   6200 | 2017-07-19 |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><code>在对多列进行排序的时候，首先排序的第一列必须有相同的列值，才会对第二列进行排序。如果第 一列数据中所有值都是唯一的，将不再对第二列进行排序。</code></strong></p>
</blockquote>
<h4 id="6-10-3-按别名排序"><a href="#6-10-3-按别名排序" class="headerlink" title="6.10.3 按别名排序"></a>6.10.3 按别名排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 按工资的10%升序排序</span></span><br><span class="line">mysql&gt; SELECT *,(salary * 0.1) AS salary_bonus FROM employees</span><br><span class="line">       ORDER BY salary_bonus ASC;</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+--------------+</span></span><br><span class="line">| id | name    | department | salary | hire_date  | salary_bonus |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+--------------+</span></span><br><span class="line">|  2 | Bob     | HR         |   4000 | 2019-03-22 |        400.0 |</span><br><span class="line">|  1 | Alice   | Sales      |   5000 | 2020-01-15 |        500.0 |</span><br><span class="line">|  6 | Frank   | Sales      |   5300 | 2020-05-25 |        530.0 |</span><br><span class="line">|  3 | Charlie | Sales      |   5500 | 2021-06-10 |        550.0 |</span><br><span class="line">|  4 | David   | IT         |   6000 | 2018-11-30 |        600.0 |</span><br><span class="line">|  5 | Eve     | IT         |   6200 | 2017-07-19 |        620.0 |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+--------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>



<h3 id="6-11-分页查询"><a href="#6-11-分页查询" class="headerlink" title="6.11 分页查询"></a>6.11 分页查询</h3><p>​        分页显示，就是将数据库中的结果集，一段一段显示出来需要的条件。</p>
<p>语法格式：<code>LIMIT [偏移量,] 行数</code></p>
<p>第一个“偏移量”参数指示MySQL从哪一行开始显示，是一个可选参数，如果不指定“位置偏移 量”，将会从表中的第一条记录开始（第一条记录的位置偏移量是0，第二条记录的位置偏移量是 1，以此类推）；第二个参数“行数”指示返回的记录条数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 前3条记录：</span></span><br><span class="line">mysql&gt; SELECT * FROM  employees LIMIT 0,3;</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">| id | name    | department | salary | hire_date  |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">|  1 | Alice   | Sales      |   5000 | 2020-01-15 |</span><br><span class="line">|  2 | Bob     | HR         |   4000 | 2019-03-22 |</span><br><span class="line">|  3 | Charlie | Sales      |   5500 | 2021-06-10 |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">LIMIT</span> <span class="number">3</span>;</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">| id | name    | department | salary | hire_date  |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">|  1 | Alice   | Sales      |   5000 | 2020-01-15 |</span><br><span class="line">|  2 | Bob     | HR         |   4000 | 2019-03-22 |</span><br><span class="line">|  3 | Charlie | Sales      |   5500 | 2021-06-10 |</span><br><span class="line">+<span class="comment">----+---------+------------+--------+------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查询第二页的3条记录（第4条到第6条记录）</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">name</span>,department,salary,hire_date</span><br><span class="line">       <span class="keyword">FROM</span> employees</span><br><span class="line">       <span class="keyword">LIMIT</span> <span class="number">3</span> <span class="keyword">OFFSET</span> <span class="number">3</span>;</span><br><span class="line">+<span class="comment">----+-------+------------+--------+------------+</span></span><br><span class="line">| id | name  | department | salary | hire_date  |</span><br><span class="line">+<span class="comment">----+-------+------------+--------+------------+</span></span><br><span class="line">|  4 | David | IT         |   6000 | 2018-11-30 |</span><br><span class="line">|  5 | Eve   | IT         |   6200 | 2017-07-19 |</span><br><span class="line">|  6 | Frank | Sales      |   5300 | 2020-05-25 |</span><br><span class="line">+<span class="comment">----+-------+------------+--------+------------+</span></span><br></pre></td></tr></table></figure>



<h3 id="6-12-行关联"><a href="#6-12-行关联" class="headerlink" title="6.12 行关联"></a>6.12 行关联</h3><p><strong>环境准备：</strong></p>
<p><code>员工表</code></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407132040962.png" alt="img"></p>
<blockquote>
<p><strong>字段解释：</strong><br>    <strong>employee_id：员工ID</strong><br>    <strong>first_name：员工名称</strong><br>    <strong>last_name：员工姓氏</strong><br>    <strong>email：邮箱</strong><br>    <strong>phone_number：电话号码</strong><br>    <strong>hire_date：入职时间</strong><br>    <strong>job_id：职位ID</strong><br>    <strong>salary：工资</strong><br>    <strong>commission_pct：奖金百分比</strong><br>    <strong>manager_id：管理者ID</strong><br>    <strong>department_id：部门ID</strong></p>
</blockquote>
<p><code>部门表</code></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407132040542.png" alt="img"></p>
<blockquote>
<p><strong>字段解释：</strong><br>    <strong>department_id：部门ID</strong><br>    <strong>department_name：部门名称</strong><br>    <strong>manager_id：管理者ID</strong><br>    <strong>location_id：位置ID</strong></p>
</blockquote>
<p><code>位置表</code></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407132041774.png" alt="img"></p>
<blockquote>
<p><strong>字段解释：</strong><br>    <strong>location_id：位置ID</strong><br>    <strong>street_address：街道地址</strong><br>    <strong>postal_code：邮政编码</strong><br>    <strong>city：城市名称</strong><br>    <strong>state_province：州或省</strong><br>    <strong>country_id：国家ID</strong></p>
</blockquote>
<p><strong><code>测试：查看名为king的员工部门信息</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 错误示范</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span>  last_name = <span class="string">"king"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> department_id,department_name</span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id = <span class="number">80</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 正确操作</span></span><br><span class="line"><span class="keyword">SELECT</span> employees.last_name,employees.department_id,departments.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees,departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.last_name = <span class="string">"king"</span> <span class="keyword">AND</span> employees.department_id = departments.department_id;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意在多表联查时需要注意表与表之前必须具备一个连接条件，且在查询指定字段时多个表出现相同字段需要指定是从那个表中查询。</strong></p>
</blockquote>
<p>优化：由于在进行多表联查时，需要指定查询的字段出现在哪个表中，所以导致SQL可定性较差，故可以给表设定别名；但是一旦给表设定了别名，在查询字段时必须指定。否则无法正常执行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.last_name,t1.department_id,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1,departments t2</span><br><span class="line"><span class="keyword">WHERE</span> t1.last_name = <span class="string">"king"</span> <span class="keyword">AND</span> t1.department_id = t2.department_id;</span><br></pre></td></tr></table></figure>

<p><code>测试：查询员工的员工id、姓氏、部门名称、城市</code><br>    字段名：<code>employee_id,last_name,department_name,city</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name,t3.city</span><br><span class="line"><span class="keyword">FROM</span> employees t1,departments t2,locations t3</span><br><span class="line"><span class="keyword">WHERE</span> t1.department_id = t2.department_id <span class="keyword">AND</span> t2.location_id = t3.location_id;</span><br></pre></td></tr></table></figure>

<h4 id="6-12-1-多表查询分类"><a href="#6-12-1-多表查询分类" class="headerlink" title="6.12.1 多表查询分类"></a>6.12.1 多表查询分类</h4><h5 id="1-等值连接"><a href="#1-等值连接" class="headerlink" title="1. 等值连接"></a>1. 等值连接</h5><p>​        等值连接是指使用等值条件将两个或多个表的相关联字段连接在一起，从而获取符合条件的数据。</p>
<p><strong><code>示例：查询员工的员工id、姓氏、部门名称、城市</code></strong></p>
<p>​    字段名：<code>employees.employee_id,employees.last_name,departments.department_name,locations.city</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name,t3.city</span><br><span class="line"><span class="keyword">FROM</span> employees t1,departments t2,locations t3</span><br><span class="line"><span class="keyword">WHERE</span> t1.department_id = t2.department_id <span class="keyword">AND</span> t2.location_id = t3.location_id;</span><br></pre></td></tr></table></figure>

<h5 id="2-非等值连接"><a href="#2-非等值连接" class="headerlink" title="2. 非等值连接"></a>2. 非等值连接</h5><p>​        非等值连接是指使用非等值条件（如 <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code> 等）将两个或多个表的相关联字段连接在一起，从而获取符合条件的数据。</p>
<p><strong>引入新表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc job_grades;  # 工资表等级表</span><br><span class="line">+<span class="comment">-------------+------------+------+-----+---------+-------+</span></span><br><span class="line">| Field       | Type       | Null | Key | Default | Extra |</span><br><span class="line">+<span class="comment">-------------+------------+------+-----+---------+-------+</span></span><br><span class="line">| grade_level | varchar(3) | YES  |     | NULL    |       |  <span class="comment"># 工资等级</span></span><br><span class="line">| lowest_sal  | int(11)    | YES  |     | NULL    |       |  <span class="comment"># 最低工资</span></span><br><span class="line">| highest_sal | int(11)    | YES  |     | NULL    |       |  <span class="comment"># 最高工资</span></span><br><span class="line">+<span class="comment">-------------+------------+------+-----+---------+-------+</span></span><br></pre></td></tr></table></figure>

<p><strong><code>示例:查询每位员工的工资等级</code></strong></p>
<p>字段名：<code>employees.last_name,employees.salary,job_grades.grade_level</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT t1.last_name,t1.salary,t2.grade_level</span><br><span class="line">FROM employees t1,job_grades t2</span><br><span class="line">WHERE t1.salary BETWEEN t2.lowest_sal AND t2.highest_sal;</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line">SELECT t1.last_name,t1.salary,t2.grade_level</span><br><span class="line">FROM employees t1,job_grades t2</span><br><span class="line">WHERE t1.salary &gt;&#x3D; t2.lowest_sal AND t1.salary &lt;&#x3D; t2.highest_sal;</span><br></pre></td></tr></table></figure>

<h5 id="3-自连接"><a href="#3-自连接" class="headerlink" title="3. 自连接"></a>3. 自连接</h5><p>​        自连接是指在同一张表内进行连接查询，通常用于在表的不同行之间建立关系。这种<strong>连接可以使用表的别名</strong>来区分同一个表的不同实例。自连接在处理层次结构或关联关系的数据时非常有用。</p>
<p><strong>表内容</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407132301850.png" alt="img"></p>
<p>如上图所示：表中几乎每一位员工都有一个管理者id</p>
<p><strong><code>示例：查询所有员工的管理者姓名</code></strong></p>
<p>​    字段名：<code>employees_id,last_name,manager_id</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.employee_id,t2.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1,employees t2</span><br><span class="line"><span class="keyword">WHERE</span> t1.manager_id = t2.employee_id;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="4-非自连接"><a href="#4-非自连接" class="headerlink" title="4. 非自连接"></a>4. 非自连接</h5><p>​    非自连接主要指的是通过连接两个或多个不同的表来获取所需的数据。这些表之间的连接不是通过表本身的字段，而是通过多个表的字段。</p>
<h5 id="5-内连接"><a href="#5-内连接" class="headerlink" title="5. 内连接"></a>5. 内连接</h5><p>​        内连接用于从多个表中获取同时存在于这些表中的数据。也就是说，只有当连接条件满足时，才会返回记录。内连接是关系数据库中最常用的一种连接方式。</p>
<p><strong><code>示例：查询员工的员工id、姓氏、部门名称、城市</code></strong></p>
<p>​    字段名：<code>employees.employee_id,employees.last_name,departments.department_name,locations.city</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name,t3.city</span><br><span class="line"><span class="keyword">FROM</span> employees t1,departments t2,locations t3</span><br><span class="line"><span class="keyword">WHERE</span> t1.department_id = t2.department_id <span class="keyword">AND</span> t2.location_id = t3.location_id;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者 SQL99语法</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.last_name,t2.department_name,t3.city</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id  = t2.department_id </span><br><span class="line"><span class="keyword">JOIN</span> locations t3</span><br><span class="line"><span class="keyword">ON</span> t2.location_id = t3.location_id;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="6-外连接"><a href="#6-外连接" class="headerlink" title="6. 外连接"></a>6. 外连接</h5><p>外连接（Outer Join）用于从多个表中获取匹配的和不匹配的记录。外连接分为左外连接（Left Join）和右外连接（Right Join）。在使用外连接时，即使在一个表中没有匹配的记录，另一个表中的记录仍会包含在结果集中。</p>
<p><strong>左外连接</strong></p>
<p>​        两个表（员工表和部门表）在来连接过程中除了返回<code>满足连接条件</code>的行以外还返回<code>左表中不满足条件</code>的行</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407132343833.png" alt="img"></p>
<p>如上图所示：在<code>employees</code>表中，名为<code>Grant</code>这位员工没有部门，在进行内连接查询时，只能查询处<code>106</code>条记录。但是在某些场景下。需要查询处所有员工的部门情况。所以此时就需要外连接。</p>
<p><strong><code>示例：查询所有员工的姓氏、部门名称（包括没有部门的员工）</code></strong></p>
<p>字段名：<code>employees.last_name,deparments.deparment_name</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.first_name,<span class="number">1.</span>last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407140005866.png" alt="img"></p>
<blockquote>
<p>此时所有的员工的部门信息都查询出来了。共107条记录，包括部门为空值的员工</p>
</blockquote>
<hr>
<p><strong>右外连接</strong></p>
<p>​        两个表在来连接过程中除了返回<strong><code>满足连接条件的行</code></strong>以外还返回<strong><code>右表中不满足条件</code></strong>的行</p>
<p><strong><code>示例：查询所有没有员工的部门信息</code></strong></p>
<p>​    字段名：<code>employees.last_name,deparments.deparment_name</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.first_name,t1.last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407140011967.png" alt="img"></p>
<hr>
<p><strong>满外连接</strong></p>
<p>​    两个表在来连接过程中除了返回满足连接条件的行以外还返回两张表中不满足条件的行</p>
<p><code>合并查询结果</code>利用UNION关键字，可以给出多条SELECT语句，并将它们的结果组合成单个结果集。合并时，<strong>两个表对应的列数和数据类型必须相同</strong>，并且相互对应。各个SELECT语句之间使用UNION或UNION ALL关键字分隔。</p>
<p><strong><code>UNION</code> 操作符</strong></p>
<p>1+106+106+16</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407140024016.png" alt="img"></p>
<p><strong><code>UNION</code> 操作符返回两个查询的结果集的并集，去除重复记录。</strong></p>
<p><strong>示例：</strong>经以上实验查询出来的结论发现。<code>employees</code>员工表中有106名员工具有部门。<code>departments</code>部门表中有16个部门没有员工。那么在<code>UNION ALL</code>进行满外连接查询时，最终的查询结果应该是<code>1(没有部门的员工数量)+106(有部门的员工数量)+16(没有员工的部门数量)=123条记录</code>。相关查询SQL语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查询存在部门的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t1.first_name,t1.salary,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1,departments t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.department_id = t2.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看没有员工的部门</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看没有部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t1.first_name,t1.salary,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id</span><br><span class="line"><span class="keyword">WHERE</span> t2.department_id <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment"># 或者</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong><code>UNION ALL</code>操作符</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407140027063.png" alt="img"></p>
<p><strong><code>UNION ALL</code>操作符返回两个查询的结果集的并集。对于两个结果集的重复部分，不去重。</strong></p>
<blockquote>
<p>注意：执行UNION ALL语句时所需要的资源比UNION语句少。如果明确知道合并数据后的结果数据不存在重复数据，或者不需要去除重复的数据，则尽量使用UNION ALL语句，以提高数据查询的效率。</p>
</blockquote>
<p><strong><code>扩展内容</code></strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407140033145.png" alt="img"></p>
<p>代码实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 中图：查询具有部门的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.last_name,t1.salary,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 左上图：查询所有员工的部门信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.last_name,t1.salary,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 右上图：查询所有部门的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id  = t2.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 左中图：查询没有部门的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.last_name,t1.first_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id</span><br><span class="line"><span class="keyword">WHERE</span> t2.department_id <span class="keyword">IS</span> <span class="literal">null</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 右中图：查询所有没有员工的部门信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.last_name,t2.department_name,t2.department_id </span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id</span><br><span class="line"><span class="keyword">WHERE</span> t1.department_id <span class="keyword">IS</span> <span class="literal">NULL</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 左下图：满外连接</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 查询没有部门的员工信息以及所有员工的部门信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id</span><br><span class="line"><span class="keyword">WHERE</span> t2.department_id <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="comment">#没有去重操作，效率高</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 右下图</span></span><br><span class="line">	<span class="comment">#&gt;&gt;&gt; 查询没有部门的员工信息以及没有员工的部门信息</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id</span><br><span class="line"><span class="keyword">WHERE</span> t2.<span class="string">`department_id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> t1.employee_id,t1.last_name,t2.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments t2</span><br><span class="line"><span class="keyword">ON</span> t1.department_id = t2.department_id</span><br><span class="line"><span class="keyword">WHERE</span> t1.department_id <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-13-破解密码"><a href="#6-13-破解密码" class="headerlink" title="6.13 破解密码"></a>6.13 破解密码</h3><p>先将这个修改成简单密码注释掉</p>
<p><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/1566298427407.png" alt="1566298427407"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root账户没了或者root密码丢失：</span><br><span class="line">关闭Mysql使用下面方式进入Mysql直接修改表权限                       </span><br><span class="line">  5.6/5.7版本：</span><br><span class="line">    # mysqld --skip-grant-tables --user=mysql &amp;    </span><br><span class="line">    </span><br><span class="line">    # mysql -uroot</span><br><span class="line">    mysql&gt; UPDATE mysql.user SET authentication_string=password('1') WHERE user='root' AND host='localhsot';</span><br><span class="line">    mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash">编辑配置文件将skip-grant-tables参数注释</span></span><br><span class="line"><span class="meta">#</span><span class="bash">重启mysql</span></span><br></pre></td></tr></table></figure>

<h1 id="Day03"><a href="#Day03" class="headerlink" title="Day03"></a>Day03</h1><h1 id="七、MySQL-索引"><a href="#七、MySQL-索引" class="headerlink" title="七、MySQL 索引"></a>七、MySQL 索引</h1><p>​        索引作为一种数据结构，其用途是用于提升检索数据的效率。<code>索引（Index）是帮助MySQL高效获取数据的数据结构。</code> </p>
<p>​        索引的本质：索引是数据结构。你可以简单理解为“排好序的快速查找数据结构”，满足特定查找算法。 </p>
<p>​        索引是在<code>存储引擎</code>中实现的 ，因此每种存储引擎的索引不一定完全相同，并且每种存储引擎不一定支持所有索引类型。同时，存储引擎可以定义每个表的 <code>最大索引数</code> 和<code>最大索引长度</code>。所有存储引擎支持每个表至少16个索引，总索引长度至少为256字节。有些存储引擎支持更多的索引数和更大的索引长度。</p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>​        索引是存储引擎用于快速找到数据记录的一种数据结构，就好比一本教课书的目录部分，通过目录中找到对应文章的页码，便可快速定位到需要的文章。MySQL中也是一样的道理，进行数据查找时，<strong>首先查看查询条件是否命中某条索引，符合则通过索引査找相关数据，如果不符合则需要全表扫描 ，即需要一条一条地查找记录，直到找到与条件符合的记录。<code>减少磁盘的IO次数，加快查询速度。</code></strong></p>
<h3 id="7-1-索引的优点"><a href="#7-1-索引的优点" class="headerlink" title="7.1 索引的优点"></a>7.1 索引的优点</h3><ul>
<li>提高数据检索的效率，降低 <code>数据库的IO成本</code>。</li>
<li>通过创建唯一索引，可以保证数据库表中每一行 <code>数据的唯一性</code>。</li>
<li>对于有依赖关系的子表和父表联合查询时， 可以提高查询速度。</li>
<li>在使用分组和排序子句进行数据查询时，可以显著 <code>减少查询中分组和排序的时间 ，降低了CPU的消耗</code>。</li>
</ul>
<h3 id="7-2-索引的缺点"><a href="#7-2-索引的缺点" class="headerlink" title="7.2 索引的缺点"></a>7.2 索引的缺点</h3><ul>
<li>创建索引和维护索引要耗费时间，并且随着数据量的增加，所耗费的时间也会增加。</li>
<li>索引需要占用磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间。</li>
<li>虽然索引大大提高了查询速度，同时却会降低更新表的速度。当对表中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度。</li>
</ul>
<h3 id="7-1-MySQL-索引的分类"><a href="#7-1-MySQL-索引的分类" class="headerlink" title="7.1 MySQL 索引的分类"></a>7.1 MySQL 索引的分类</h3><ul>
<li><p><code>普通索引（INDEX）</code>：用于加速查询，不需要唯一。可以在列上创建索引以加速查询性能，没有唯一性要求。只是用于提高查询效率。这类索引可以创建在<code>任何数据类型</code> 中，其值是否唯一和非空，要由字段本身的完整性约束条件决定。建立索引以后，可以通过索引进行查询。例如，在<code>name</code>上建立一个普通索引，查询记录时就可以根据该索引进行查询。</p>
<ul>
<li><pre><code class="sql"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees (
    employee_id <span class="built_in">INT</span>,
    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>),
    <span class="keyword">INDEX</span> idx_name (<span class="keyword">name</span>)
);
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- &#96;唯一索引（UNIQUE）&#96;：在创建唯一性索引时，限制该**索引的值必须是唯一的**，但允许有空(NULL)值。在一张数据表里可以有多个唯一索引。</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;sql</span><br><span class="line">    CREATE TABLE employees (</span><br><span class="line">        employee_id INT,</span><br><span class="line">        name VARCHAR(20) UNIQUE</span><br><span class="line">    );</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ul>
</li>
<li><p><code>主键索引（PRIMARY KEY）</code>：<strong>索引列值必须唯一，不能为NULL。</strong>一个表只能有一个主键索引；不仅确保列中的所有值都是唯一的，还不允许包含 NULL 值。每个表只能有一个主键索引，它主要用于唯一标识表中的每一行，并作为表的主标识符。</p>
<ul>
<li><pre><code class="sql"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees (
    employee_id <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,
    first_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>),
    last_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>)
);
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- &#96;全文索引（FULL TEXT）&#96;：通过建立在文本列上的索引。允许对文本字段中的单词进行快速的搜索和匹配，通常用于处理大型文本数据，如文章内容、博客帖子和产品描述等。全文索引支持基于自然语言的查询，可以显著提高全文搜索的性能。</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;sql</span><br><span class="line">    CREATE TABLE articles (</span><br><span class="line">        id INT AUTO_INCREMENT PRIMARY KEY,</span><br><span class="line">        title VARCHAR(200),</span><br><span class="line">        body TEXT,</span><br><span class="line">        FULLTEXT (title, body) -- 为 title 和 body 列创建全文索引</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="7-2-MySQL-不同类型索引用途和区别"><a href="#7-2-MySQL-不同类型索引用途和区别" class="headerlink" title="7.2 MySQL 不同类型索引用途和区别"></a>7.2 MySQL 不同类型索引用途和区别</h3><ul>
<li>普通索引常用于过滤数据。例如，以商品种类作为索引，检索种类为“手机”的商品。</li>
<li>唯一索引主要用于标识一列数据不允许重复的特性，相比主键索引不常用于检索的场景。</li>
<li>主键索引是行的唯一标识，因而其主要用途是检索特定数据。</li>
<li>全文索引效率低，常用于文本中内容的检索。</li>
</ul>
<h3 id="7-3-MySQL-使用索引"><a href="#7-3-MySQL-使用索引" class="headerlink" title="7.3 MySQL 使用索引"></a>7.3 MySQL 使用索引</h3><h4 id="7-3-1-创建索引"><a href="#7-3-1-创建索引" class="headerlink" title="7.3.1 创建索引"></a>7.3.1 创建索引</h4><p>​        创建索引方式：创建表事定义<code>CREATE TABLE</code>指定需要创建的索引列，使用<code>ALTER TABLE</code>语句在存在的表上创建索引；使用<code>CREATE INDEX</code>语句在已存在的表上添加索引。</p>
<h5 id="1-普通索引（INDEX）"><a href="#1-普通索引（INDEX）" class="headerlink" title="1. 普通索引（INDEX）"></a>1. 普通索引（INDEX）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#&gt;&gt;&gt; 在创建表时指定</span><br><span class="line">create table test06(</span><br><span class="line">    id int not null, </span><br><span class="line">    name varchar(100) not null, </span><br><span class="line">    birthdy date, </span><br><span class="line">    sex char(1) not null, </span><br><span class="line">    index nameindex (name(50))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 基于表结构创建</span><br><span class="line">create table test07(</span><br><span class="line">    id int not null, </span><br><span class="line">    name varchar(100) not null, </span><br><span class="line">    birthday date, </span><br><span class="line">    sex char(1) not null</span><br><span class="line">);</span><br><span class="line">#&gt;&gt;&gt; 创建索引</span><br><span class="line">create index nameindex on test07(name(50));</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 修改表结构创建</span><br><span class="line">create table test08(</span><br><span class="line">    id int not null, </span><br><span class="line">    name varchar(100) not null, </span><br><span class="line">    birthday date, </span><br><span class="line">    sex char(1) not null</span><br><span class="line">);</span><br><span class="line">#&gt;&gt;&gt; 添加普通索引</span><br><span class="line">ALTER TABLE test08 ADD INDEX nameIndex(name(50));</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 查看索引</span><br><span class="line">	#&gt;&gt;&gt; 方式一</span><br><span class="line">show index from test06;</span><br><span class="line">	#&gt;&gt;&gt; 方式二</span><br><span class="line">show create table test06;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407142223293.png" alt="img"></p>
<blockquote>
<p>提示：<code>Non_unique</code>唯一代表。该约束非唯一。 </p>
</blockquote>
<h5 id="2-唯一索引（UNIQUE）"><a href="#2-唯一索引（UNIQUE）" class="headerlink" title="2. 唯一索引（UNIQUE）"></a>2. 唯一索引（UNIQUE）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#&gt;&gt;&gt; 在创建表时指定</span><br><span class="line">create table test09(</span><br><span class="line">    id int not null, </span><br><span class="line">    name varchar(100) not null, </span><br><span class="line">    birthday date, </span><br><span class="line">    sex char(1) not null, </span><br><span class="line">    unique index id_idex(id)</span><br><span class="line">);</span><br><span class="line">#&gt;&gt;&gt; 插入测试数据</span><br><span class="line">INSERT INTO emp01.test09(id,name,sex)</span><br><span class="line">VALUES (1,&quot;赵云&quot;,&quot;男&quot;);</span><br><span class="line">#&gt;&gt;&gt; 再次插入相同数据</span><br><span class="line">INSERT INTO emp01.test09(id,name,sex)</span><br><span class="line">VALUES (1,&quot;赵云&quot;,&quot;男&quot;);</span><br><span class="line">---此时会报：ERROR 1062 (23000): Duplicate entry &#39;1&#39; for key &#39;id_idex&#39;</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 基于表结构创建</span><br><span class="line">create table test10(</span><br><span class="line">    id int not null, </span><br><span class="line">    name varchar(100) not null, </span><br><span class="line">    birthday date, </span><br><span class="line">    sex char(1) not null</span><br><span class="line">);</span><br><span class="line">#&gt;&gt;&gt; 创建索引</span><br><span class="line">CREATE unique INDEX idIndex ON test10(id);</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407142326737.png" alt="img"></p>
<h5 id="3-主键索引（PRIMARY-KEY）"><a href="#3-主键索引（PRIMARY-KEY）" class="headerlink" title="3. 主键索引（PRIMARY KEY）"></a>3. 主键索引（PRIMARY KEY）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#&gt;&gt;&gt; 创建表时时指定</span><br><span class="line">create table test11(</span><br><span class="line">    id int, </span><br><span class="line">    name varchar(100), </span><br><span class="line">    birthday date, </span><br><span class="line">    sex char(1), </span><br><span class="line">    primary key (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 修改表结构创建</span><br><span class="line">create table test12(</span><br><span class="line">    id int not null, </span><br><span class="line">    name varchar(100) not null, </span><br><span class="line">    birthday date,</span><br><span class="line">    sex char(1) not null</span><br><span class="line">);</span><br><span class="line">#&gt;&gt;&gt; 添加索引</span><br><span class="line">ALTER TABLE test12 ADD PRIMARY KEY (id);</span><br></pre></td></tr></table></figure>

<p><strong>主键索引不能使用基于表结构创建的方式创建。</strong></p>
<h4 id="7-3-2-删除索引"><a href="#7-3-2-删除索引" class="headerlink" title="7.3.2 删除索引"></a>7.3.2 删除索引</h4><h5 id="1-普通索引（INDEX）-1"><a href="#1-普通索引（INDEX）-1" class="headerlink" title="1. 普通索引（INDEX）"></a>1. 普通索引（INDEX）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#&gt;&gt;&gt; 直接删除</span><br><span class="line">DROP INDEX nameIndex ON test06;</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 修改表结构删除</span><br><span class="line">ALTER TABLE test06 DROP INDEX nameIndex;</span><br></pre></td></tr></table></figure>

<h5 id="2-唯一索引（UNIQUE）-1"><a href="#2-唯一索引（UNIQUE）-1" class="headerlink" title="2. 唯一索引（UNIQUE）"></a>2. 唯一索引（UNIQUE）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#&gt;&gt;&gt; 直接删除</span><br><span class="line">DROP INDEX idIndex ON test09;</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 修改表结构删除</span><br><span class="line">ALTER TABLE test09 DROP INDEX idIndex;</span><br></pre></td></tr></table></figure>

<h5 id="3-主键索引（PRIMARY-KEY）-1"><a href="#3-主键索引（PRIMARY-KEY）-1" class="headerlink" title="3. 主键索引（PRIMARY KEY）"></a>3. 主键索引（PRIMARY KEY）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE test11 DROP PRIMARY KEY;</span><br></pre></td></tr></table></figure>

<p><strong>主键不能采用直接删除的方式删除。</strong></p>
<h4 id="7-3-3-查看索引"><a href="#7-3-3-查看索引" class="headerlink" title="7.3.3 查看索引"></a>7.3.3 查看索引</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#&gt;&gt;&gt; 方式一</span><br><span class="line">SHOW INDEX FROM test06;</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 方式二</span><br><span class="line">SHOW CREATE TABLE test06;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-设置索引的原则"><a href="#7-4-设置索引的原则" class="headerlink" title="7.4 设置索引的原则"></a>7.4 设置索引的原则</h3><ul>
<li><strong>频繁查询的列</strong>：对经常在 <code>SELECT</code> 语句的 <code>WHERE</code> 子句、<code>JOIN</code> 子句、<code>ORDER BY</code> 子句和 <code>GROUP BY</code> 子句中出现的列创建索引。</li>
<li><strong>唯一性</strong>：对那些需要保持唯一值的列（如主键、唯一键）创建索引，以确保数据的完整性和一致性。</li>
<li><strong>低选择性</strong>：唯一性太差的字段不适合作为索引，例如性别。</li>
<li><strong>频繁增删改的字段不要建立索引</strong>：字段的变化<code>MySQL</code>是需要重新维护索引的，假设某个字段频繁修改，那就意味着需要频繁的重建索引，必然影响MySQL的性能。</li>
<li><strong>不要建立太多的索引</strong>：MySQL维护索引是需要空间和耗费性能的。如果索引过多，这无疑是增加了MySQL的负担。</li>
</ul>
<h3 id="7-5-索引失效的场景？怎么避免设置的索引失效？"><a href="#7-5-索引失效的场景？怎么避免设置的索引失效？" class="headerlink" title="7.5 索引失效的场景？怎么避免设置的索引失效？"></a>7.5 索引失效的场景？怎么避免设置的索引失效？</h3><blockquote>
<p><strong>index(key)每张表可以有很多列做index，必须的起名</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">面试题:</span><br><span class="line">导致SQL执行慢的原因：</span><br><span class="line">1.硬件问题。如网络速度慢，内存不足，I/O吞吐量小，磁盘空间满了等。</span><br><span class="line">2.没有索引或者索引失效。</span><br><span class="line">3.数据过多（分库分表）。</span><br><span class="line">4.服务器调优及各个参数设置（调整my.cnf）。</span><br><span class="line">索引：当查询速度过慢可以通过建立优化查询速度，可以当作调优</span><br></pre></td></tr></table></figure>

<h1 id="八、权限管理"><a href="#八、权限管理" class="headerlink" title="八、权限管理"></a>八、权限管理</h1><h3 id="8-1-用户管理"><a href="#8-1-用户管理" class="headerlink" title="8.1 用户管理"></a>8.1 用户管理</h3><p>​    简介：用户管理涉及<code>用户创建</code>、<code>权限分配</code>、<code>修改和删除</code>，以及用户账户的其他管理任务。</p>
<h4 id="8-1-1-MySQL服务器登录方式"><a href="#8-1-1-MySQL服务器登录方式" class="headerlink" title="8.1.1 MySQL服务器登录方式"></a>8.1.1 MySQL服务器登录方式</h4><p><strong>1. 本地登录MySQL服务器方式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># mysql -u&lt;用户名&gt; -p'&lt;用户密码&gt;'</span></span><br></pre></td></tr></table></figure>

<p><strong>2. 远程登录MySQL服务器方式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># mysql –h &lt;hostname&gt;|&lt;hostIP&gt; –P &lt;port&gt; –u &lt;username&gt; –p  -D &lt;DatabaseName&gt; –e "&lt;SQL语句&gt;"</span></span><br></pre></td></tr></table></figure>

<p>​    下面详细介绍命令中的参数： </p>
<ul>
<li><code>-h参数</code>： 主机名或者主机IP，hostname为主机，hostIP为主机IP。</li>
<li><code>-P参数</code> ：MySQL服务的端口，通过该参数连接到指定的端口。MySQL服务的默认端口是3306， 不使用该参数时自动连接到3306端口，port为连接的端口号。 </li>
<li><code>-u参数</code> ：用户名，username为用户名。 </li>
<li><code>-p参数</code>：提示输入密码。 DatabaseName参数指明登录到哪一个数据库中。如果没有该参数，就会直接登录到MySQL数据库中，然后可以使用USE命令来选择数据库。 </li>
<li><code>-D参数</code>：指定数据库名称。</li>
<li><code>-e参数</code> ：后面可以直接加SQL语句。登录MySQL服务器以后即可执行这个SQL语句，然后退出MySQL服务器。</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># mysql -uroot -p'1' -hlocalhost -P3306 mysql -e "select host,user from user"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407111610547.png" alt="image-20240711161023419"></p>
<p><strong>3. 修改用户主机地址</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 更新字段</span></span><br><span class="line">mysql&gt; update mysql.user set host = '%' where user = 'root';</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 刷新权限</span></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>4. 修改数据库端口</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 修改端口rpm安装方式修改</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">在到[mysql]标签下面添加port=指定端口。重启服务</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="8-2-创建用户"><a href="#8-2-创建用户" class="headerlink" title="8.2 创建用户"></a>8.2 创建用户</h3><h4 id="8-2-1-方式一：CREATE-USER"><a href="#8-2-1-方式一：CREATE-USER" class="headerlink" title="8.2.1 方式一：CREATE USER"></a>8.2.1 方式一：<code>CREATE USER</code></h4><p><code>CREATE USER</code>语句的基本语法形式如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER 用户名 [IDENTIFIED BY '密码'][,用户名 [IDENTIFIED BY '密码']];</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>用户名</code>参数表示新建用户的账户，由用户（User）和主机名（Host） 构成；</li>
<li><code>“[ ]”</code>表示可选，也就是说，可以指定用户登录时需要密码验证，也可以不指定密码验证，这样用户可以直接登录。不过，不指定密码的方式不安全，不推荐使用。如果指定密码值，这里需要使用<code>IDENTIFIED BY</code>指定明文密码值。 <code>CREATE USER</code>语句可以<code>同时创建多个用户</code>。</li>
</ul>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建用户</span></span><br><span class="line">mysql&gt; create user xiaofei identified by '1';  # 默认host是 %</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 刷新权限</span></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看用户表</span></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112032712.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建用户</span></span><br><span class="line">mysql&gt; create user 'xiaohe'@'localhost' identified by '1';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 刷新权限</span></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看用户表</span></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112035009.png" alt="img"></p>
<blockquote>
<p>注意：创建用户时需注意用户的主机地址，常用选项如下：</p>
<ul>
<li><code>localhost</code>：只允许本地用户登录</li>
<li><code>%</code>：所有主机远程登录</li>
<li><code>192.168.246.%</code>：192.168.246.0网段的所有主机</li>
<li><code>192.168.246.252</code>： 指定主机</li>
</ul>
</blockquote>
<h4 id="8-2-2-方式二：GRANT命令"><a href="#8-2-2-方式二：GRANT命令" class="headerlink" title="8.2.2 方式二：GRANT命令"></a>8.2.2 方式二：<code>GRANT命令</code></h4><p>​        简介：<strong>在MySQL 5.7 中GRANT权限分配时，假设用户不存在，同时会创建一个新的用户，MySQL 8.0已废弃。</strong></p>
<p><code>GRANT</code>命令语法格式如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT 权限1,权限2,…权限n ON 数据库名称.表名称 TO 用户名@用户地址 [IDENTIFIED BY ‘密码口令’];</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建用户并赋予权限</span></span><br><span class="line">mysql&gt; grant select,update on mysql.* to maoxiansheng@'%' identified by '1';</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 刷新权限</span></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看用户表</span></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112050318.png" alt="img"></p>
<h3 id="8-3-权限简介"><a href="#8-3-权限简介" class="headerlink" title="8.3 权限简介"></a>8.3 权限简介</h3><p>查看MySQL 5.7 中所有权限：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW  PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112054994.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">权限简介</span><br><span class="line"></span><br><span class="line">| 权限                   | 权限级别                 | 权限说明                    </span><br><span class="line">| :--------------------- | :--------------------- | :------------------------------------</span><br><span class="line">| CREATE                 | 数据库、表或索引          | 创建数据库、表或索引权限                 </span><br><span class="line">| DROP                   | 数据库或表               | 删除数据库或表权限                       </span><br><span class="line">| GRANT OPTION           | 数据库、表或保存的程序     | 赋予权限选项 #小心给予                 </span><br><span class="line">| ALTER                  | 表                     | 更改表，比如添加字段、索引等               </span><br><span class="line">| DELETE                 | 表                     | 删除数据权限                             </span><br><span class="line">| INDEX                  | 表                     | 索引权限                               </span><br><span class="line">| INSERT                 | 表                     | 插入权限                               </span><br><span class="line">| SELECT                 | 表                     | 查询权限                               </span><br><span class="line">| UPDATE                 | 表                     | 更新权限                               </span><br><span class="line">| LOCK TABLES            | 服务器管理              | 锁表权限                               </span><br><span class="line">| CREATE USER            | 服务器管理             | 创建用户权限                             </span><br><span class="line">| REPLICATION SLAVE      | 服务器管理             | 复制权限                                 </span><br><span class="line">| SHOW DATABASES         | 服务器管理             | 查看数据库权限</span><br></pre></td></tr></table></figure>

<ol>
<li><code>CREATE和DROP权限</code>，可以创建新的数据库和表，或删除（移掉）已有的数据库和表。如果将 MySQL数据库中的DROP权限授予某用户，用户就可以删除MySQL访问权限保存的数据库。 </li>
<li><code>SELECT、INSERT、UPDATE和DELETE权限</code>允许在一个数据库现有的表上实施操作。 </li>
<li><code>SELECT权限</code>只有在它们真正从一个表中检索行时才被用到。 </li>
<li><code>INDEX权限</code>允许创建或删除索引，INDEX适用于已有的表。如果具有某个表的CREATE权限，就可以在CREATE TABLE语句中包括索引定义。 </li>
<li><code>ALTER权限</code>可以使用ALTER TABLE来更改表的结构和重新命名表。 </li>
<li><code>CREATE ROUTINE权限</code>用来创建保存的 程序（函数和程序），ALTER ROUTINE权限用来更改和删除保存的程序， EXECUTE权限用来执行保存的程序。 </li>
<li><code>GRANT权限</code>允许授权给其他用户，可用于数据库、表和保存的程序。</li>
<li><code>FILE权限</code>使用户可以使用LOAD DATA INFILE和SELECT … INTO OUTFILE语句读或写服务器上的文件，任何被授予FILE权限的用户都能读或写MySQL服务器上的任何文件（说明用户可以读任何数据库目录下的文件，因为服务器可以访问这些文件）。</li>
</ol>
<h4 id="8-3-1-授予权限原则"><a href="#8-3-1-授予权限原则" class="headerlink" title="8.3.1 授予权限原则"></a>8.3.1 授予权限原则</h4><p>​    权限控制主要是出于安全因素，因此需要遵循以下几个原则： </p>
<ul>
<li>只授予能满足需要的<code>最小权限</code> ，防止用户干坏事。比如用户只是需要查询，那就只给select权限就可以了，不要给用户赋予update、insert或者delete权限。 </li>
<li>创建用户的时候<code>限制用户的登录主机</code> ，一般是<code>限制成指定IP或者内网IP段</code>。</li>
<li>为每个用户设置满足密码复杂度的密码 。</li>
<li>定期清理不需要的用户，回收权限或者删除用户。</li>
</ul>
<h3 id="8-4-查看权限"><a href="#8-4-查看权限" class="headerlink" title="8.4 查看权限"></a>8.4 查看权限</h3><h4 id="8-4-1-查看当前用户权限"><a href="#8-4-1-查看当前用户权限" class="headerlink" title="8.4.1 查看当前用户权限"></a>8.4.1 查看当前用户权限</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show  grants\G</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112101999.png" alt="img"></p>
<h4 id="8-4-2-查看其他用户权限"><a href="#8-4-2-查看其他用户权限" class="headerlink" title="8.4.2 查看其他用户权限"></a>8.4.2 查看其他用户权限</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show grants for maoxiansheng@'%'\G</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112104825.png" alt="img"></p>
<h3 id="8-5-添加权限"><a href="#8-5-添加权限" class="headerlink" title="8.5 添加权限"></a>8.5 添加权限</h3><p>示例一：<code>授予xiaohe用户study库下所有权限</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all PRIVILEGES on study.* to  xiaohe@'%' identified by '1';</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants for xiaohe@'%'\G;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112118437.png" alt="img"></p>
<p>示例二：<code>xiaofei用户所有库所有表权限，但不包括GRANT权限</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all on *.* to xiaofei@'%' identified by '1';</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants for xiaofei@'%'\G;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112121999.png" alt="img"></p>
<p>示例三：<code>授予maoxiansheng用户mysql库user表查看、更新、删除、插入权限</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant select,update,insert,delete on mysql.user to maoxiansheng@'localhost' identified by '1';</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants for maoxiansheng@'localhost'\G;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112125658.png" alt="img"></p>
<h3 id="8-6-回收权限"><a href="#8-6-回收权限" class="headerlink" title="8.6 回收权限"></a>8.6 回收权限</h3><p>​    收回权限就是<code>取消已经赋予用户的某些权限</code>。<strong>收回用户不必要的权限可以在一定程度上保证系统的安全性。</strong>MySQL中使用 <code>REVOKE语句</code>取消用户的某些权限。使用REVOKE收回权限之后，用户账户的记录将从 db、host、tables_priv和columns_priv表中删除，但是用户账户记录仍然在user表中保存（删除user表中的账户记录使用DROP USER语句）。 </p>
<blockquote>
<p> <strong>在将用户账户从user表删除之前，应该收回相应用户的所有权限。</strong></p>
</blockquote>
<p><strong>回收权限语法格式：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> 权限<span class="number">1</span>,权限<span class="number">2</span>,…权限n <span class="keyword">ON</span> 数据库名称.表名称 <span class="keyword">FROM</span> 用户名@<span class="string">'用户地址'</span>;</span><br></pre></td></tr></table></figure>

<p>示例一：<code>回收xaiofei用户所有库、所有表中的所有权限</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; revoke all privileges on *.* from xiaofei@'%';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants for xiaofei@'%'\G;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112132017.png" alt="img"></p>
<p>示例二：<code>回收maoxiansheng用户mysql库user表查看、更新、删除、插入权限</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; revoke delete,insert,select,update on mysql.user from maoxiansheng@'localhost';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants for maoxiansheng@'localhost'\G;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112135068.png" alt="img"></p>
<h3 id="8-7-修改密码"><a href="#8-7-修改密码" class="headerlink" title="8.7 修改密码"></a>8.7 修改密码</h3><h4 id="8-7-1-修改当前用户密码"><a href="#8-7-1-修改当前用户密码" class="headerlink" title="8.7.1 修改当前用户密码"></a>8.7.1 修改当前用户密码</h4><p>方式一：<code>MySQL 5.7 可以使用</code></p>
<p><code>set password = password(&#39;当前用户新密码&#39;);</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set password = password('abc123');</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>方式二：<code>ALTER USER</code></p>
<p>​        使用<code>ALTER USER命令</code>来修改当前用户密码用户可以使用ALTER命令来修改自身密码。</p>
<p><code>alter user user()  identified by &#39;当前用户新密码&#39;;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user user()  identified by 'abcd123';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>方式三：<code>SET</code></p>
<p>​        使用<code>SET语句</code>来修改当前用户密码使用root用户登录MySQL后，可以使用SET语句来修改密码。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set password='abc123';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="8-7-2-修改其他用户密码"><a href="#8-7-2-修改其他用户密码" class="headerlink" title="8.7.2 修改其他用户密码"></a>8.7.2 修改其他用户密码</h4><p>方式一：<code>ALERT语句</code></p>
<p>​         <strong>使用<code>ALTER语句修改普通用户的密码</code>可以使用ALTER USER语句来修改普通用户的密码。</strong></p>
<p><code>ALTER USER user [IDENTIFIED BY &#39;新密码&#39;] [,user[IDENTIFIED BY &#39;新密码&#39;]]…;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user xiaohe@'%' identified by 'abcd123';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>方式二：<code>SET命令</code></p>
<p>​        <strong>使用<code>SET命令来修改普通用户的密码</code>使用root用户登录到MySQL服务器后，可以使用SET语句来修改普通用户的密码。</strong></p>
<p><code>SET PASSWORD FOR &#39;username&#39;@&#39;hostname&#39;=&#39;new_password&#39;;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set password for 'xiaohe'@'%'='abc123';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="8-7-3-MySQL-5-7-密码管理（了解）"><a href="#8-7-3-MySQL-5-7-密码管理（了解）" class="headerlink" title="8.7.3 MySQL 5.7 密码管理（了解）"></a>8.7.3 MySQL 5.7 密码管理（了解）</h4><ol>
<li><strong>密码过期策略</strong></li>
</ol>
<ul>
<li>在MySQL中，数据库管理员可以<code>手动设置</code>账号密码过期，也可以建立一个<code>自动密码</code>过期策略。 </li>
<li>过期策略可以是<code>全局</code>的 ，也可以为<code>每个账号</code>设置单独的过期策略。</li>
</ul>
<p><strong>查看当前密码过期时间</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE 'default_password_lifetime';</span><br><span class="line">+<span class="comment">---------------------------+-------+</span></span><br><span class="line">| Variable_name             | Value |</span><br><span class="line">+<span class="comment">---------------------------+-------+</span></span><br><span class="line">| default_password_lifetime | 0     |</span><br><span class="line">+<span class="comment">---------------------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure>

<p>方式一：<code>使用SQL语句更改该变量的值并持久化</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 设置全局，设置密码每隔90天过期</span></span><br><span class="line">mysql&gt; SET GLOBAL default_password_lifetime = 90;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE 'default_password_lifetime';</span><br><span class="line">+<span class="comment">---------------------------+-------+</span></span><br><span class="line">| Variable_name             | Value |</span><br><span class="line">+<span class="comment">---------------------------+-------+</span></span><br><span class="line">| default_password_lifetime | 90    |</span><br><span class="line">+<span class="comment">---------------------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>方式二：<code>配置文件my.cnf配置密码过期时间</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">default_password_lifetime = 90</span><br><span class="line"></span><br><span class="line">[root@mysql-server ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<p>方式三：<code>单独设置特定用户的密码过期时间</code></p>
<p>​    除了全局设置，你还可以为特定用户设置密码过期时间。使用 <code>ALTER USER</code> 语句可以实现这一点。例如：将 <code>xiaofei</code> 用户的密码过期时间设置为 180 天。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter user 'xiaofei'@'%' password expire interval 180 day;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看xiaofei用户的密码过期时间</span></span><br><span class="line">mysql&gt; SELECT </span><br><span class="line">    User, </span><br><span class="line">    Host, </span><br><span class="line">    Password_last_changed, </span><br><span class="line">    DATE_ADD(Password_last_changed, INTERVAL @@default_password_lifetime DAY) AS Password_expiry_date </span><br><span class="line">FROM </span><br><span class="line">    mysql.user </span><br><span class="line">WHERE </span><br><span class="line">    User='xiaofei' </span><br><span class="line">    AND Host='%';</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112245735.png" alt="img"></p>
<blockquote>
<ul>
<li><code>Password_last_changed</code>：为上次密码修改的时间；</li>
<li><code>Password_expiry_date</code>：密码过期时间</li>
</ul>
</blockquote>
<p>方式四：<code>设置用户密码永不过期，默认</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL default_password_lifetime = 0;</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE 'default_password_lifetime';</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407112256297.png" alt="img"></p>
<h3 id="8-8-删除用户"><a href="#8-8-删除用户" class="headerlink" title="8.8 删除用户"></a>8.8 删除用户</h3><p>方式一：<code>使用DROP方式删除</code></p>
<p>使用<code>DROP USER语句</code>来删除用户时，必须拥有<code>DROP USER权限</code>。</p>
<p><code>DROP USER user[,user]…;</code></p>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop user xiaohe;  # 默认Host为'%'</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; drop user maoxiansheng@'localhost';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| user          | host      |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| maoxiansheng  | %         |</span><br><span class="line">| root          | %         |</span><br><span class="line">| xiaofei       | %         |</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| xiaohe        | localhost |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>方式二：<code>使用DELETE方式删除</code></p>
<p><code>DELETE FROM mysql.user WHERE Host=’&lt;主机地址&gt;’ AND User=’&lt;用户名&gt;’;</code></p>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from mysql.user where host='%' and user='maoxiansheng';</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH  PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| user          | host      |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| root          | %         |</span><br><span class="line">| xiaofei       | %         |</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| xiaohe        | localhost |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：不推荐通过<code>DELETE 方式</code>进行删除，系统会有残留信息保留。而<code>drop user命令会</code>删除用户以及对应的权限，执行命令后你会发现<code>mysql.user表</code>和<code>mysql.db表</code>的相应记录都消失了。</p>
</blockquote>
<h3 id="8-9-查看密码复杂度"><a href="#8-9-查看密码复杂度" class="headerlink" title="8.9 查看密码复杂度"></a>8.9 查看密码复杂度</h3><p>MySQL 默认启用了密码复杂度设置，插件名字叫做 validate_password，初始化之后默认是安装的，如果没有安装执行下面的命令会返回空或者没有值，这时需要安装该插件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 安装插件</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> INSTALL PLUGIN validate_password SONAME <span class="string">'validate_password.so'</span>;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看密码复杂度</span></span><br><span class="line">mysql&gt; show variables like 'validate%';</span><br><span class="line">+<span class="comment">--------------------------------------+--------+</span></span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+<span class="comment">--------------------------------------+--------+</span></span><br><span class="line">| validate_password_check_user_name    | OFF    |</span><br><span class="line">| validate_password_dictionary_file    |        |</span><br><span class="line">| validate_password_length             | 8      |</span><br><span class="line">| validate_password_mixed_case_count   | 1      |</span><br><span class="line">| validate_password_number_count       | 1      |</span><br><span class="line">| validate_password_policy             | MEDIUM |</span><br><span class="line">| validate_password_special_char_count | 1      |</span><br><span class="line">+<span class="comment">--------------------------------------+--------+</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数解释：</p>
<ul>
<li><p><code>validate_password_length</code>：密码最少长度，默认值是8最少是0</p>
</li>
<li><p><code>validate_password_dictionary_file</code>：用于配置密码的字典文件，字典文件中存在的密码不得使用。</p>
</li>
<li><p><code>validate_password_policy</code>： 代表的密码策略，默认是MEDIUM</p>
</li>
<li><p><code>validate_password_number_count</code>：最少数字字符数，默认1最小是0</p>
</li>
<li><p><code>validate_password_mixed_case_count</code> ：最少大写和小写字符数(同时有大写和小写)，默认为1最少是0</p>
</li>
<li><p><code>validate_password_special_char_count</code> ：最少特殊字符数，默认1最小是0</p>
</li>
<li><p>validate_password_length ：#密码最少长度，默认值是8最少是0</p>
</li>
<li><p>validate_password_dictionary_file：#用于配置密码的字典文件，字典文件中存在的密码不得使用。</p>
</li>
<li><p>validate_password_policy： #代表的密码策略，默认是MEDIUM</p>
</li>
<li><p>validate_password_number_count ：#最少数字字符数，默认1最小是0</p>
</li>
<li><p>validate_password_mixed_case_count ：#最少大写和小写字符数(同时有大写和小写)，默认为1最少是0</p>
</li>
<li><p>validate_password_special_char_count ：#最少特殊字符数，默认1最小是0</p>
</li>
<li><p>validate_password_length ：#密码最少长度，默认值是8最少是0</p>
</li>
<li><p>validate_password_dictionary_file：#用于配置密码的字典文件，字典文件中存在的密码不得使用。</p>
</li>
<li><p>validate_password_policy： #代表的密码策略，默认是MEDIUM</p>
</li>
<li><p>validate_password_number_count ：#最少数字字符数，默认1最小是0</p>
</li>
<li><p>validate_password_mixed_case_count ：#最少大写和小写字符数(同时有大写和小写)，默认为1最少是0</p>
</li>
<li><p>validate_password_special_char_count ：#最少特殊字符数，默认1最小是0</p>
</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt;查看密码策略</span></span><br><span class="line">mysql&gt; select @@validate_password_policy;</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| @@validate_password_policy |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| MEDIUM                     |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>LOW策略</code>：对密码的要求最少，仅要求密码的最小长度。</p>
<ul>
<li><p><strong>validate_password_length</strong>: 需要设置密码的最小长度。</p>
</li>
<li><pre><code class="sql"><span class="comment">#&gt;&gt;&gt; 更换LOW级别策略</span>
mysql&gt; SET GLOBAL validate_password_policy = 'LOW';

<span class="comment">#&gt;&gt;&gt; 最小长度设置为8</span>
mysql&gt;SET GLOBAL validate_password_length = 8; 
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- &#96;MEDIUM&#96;策略在&#96;LOW&#96;的基础上增加了对字符类型的要求。</span><br><span class="line"></span><br><span class="line">  - **validate_password_length**: 需要设置密码的最小长度；</span><br><span class="line"></span><br><span class="line">  - **validate_password_mixed_case_count**: 至少包含的大小写字母的数量。</span><br><span class="line"></span><br><span class="line">  - **validate_password_number_count**: 至少包含的数字的数量。</span><br><span class="line"></span><br><span class="line">  - **validate_password_special_char_count**: 至少包含的特殊字符的数量。</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;sql</span><br><span class="line">    #&gt;&gt;&gt; 更换MEDIUM级别策略</span><br><span class="line">    mysql&gt; SET GLOBAL validate_password_policy &#x3D; &#39;MEDIUM&#39;;</span><br><span class="line">    </span><br><span class="line">    #&gt;&gt;&gt; 最小长度设置为8</span><br><span class="line">    mysql&gt; SET GLOBAL validate_password_length &#x3D; 8;</span><br><span class="line">    </span><br><span class="line">    #&gt;&gt;&gt; 至少1个大小写字母</span><br><span class="line">    mysql&gt; SET GLOBAL validate_password_mixed_case_count &#x3D; 1;</span><br><span class="line">    </span><br><span class="line">    #&gt;&gt;&gt; 至少一个数字</span><br><span class="line">    mysql&gt; SET GLOBAL validate_password_number_count &#x3D; 1;</span><br><span class="line">    </span><br><span class="line">    #&gt;&gt;&gt; 至少1个特殊字符</span><br><span class="line">    mysql&gt; SET GLOBAL validate_password_special_char_count &#x3D; 1;</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ul>
</li>
<li><p><code>STRONG</code>策略是最严格的策略，包含了<code>MEDIUM</code>的所有要求，并且可以包括字典文件检查（可选）。</p>
<ul>
<li><p><strong>validate_password_length</strong>: 需要设置密码的最小长度。</p>
</li>
<li><p><strong>validate_password_mixed_case_count</strong>: 至少包含的大小写字母的数量。</p>
</li>
<li><p><strong>validate_password_number_count</strong>: 至少包含的数字的数量。</p>
</li>
<li><p><strong>validate_password_special_char_count</strong>: 至少包含的特殊字符的数量。</p>
</li>
<li><p><strong>validate_password_dictionary_file</strong>（可选）: 字典文件路径，用于检查密码是否包含常见的词汇。</p>
</li>
<li><pre><code class="sql"><span class="comment">#&gt;&gt;&gt; 更换STRONG级别策略</span>
mysql&gt; SET GLOBAL validate_password_policy = 'MEDIUM';

<span class="comment">#&gt;&gt;&gt; 最小长度设置为8</span>
mysql&gt; SET GLOBAL validate_password_length = 8;

<span class="comment">#&gt;&gt;&gt; 至少1个大小写字母</span>
mysql&gt; SET GLOBAL validate_password_mixed_case_count = 1;

<span class="comment">#&gt;&gt;&gt; 至少一个数字</span>
mysql&gt; SET GLOBAL validate_password_number_count = 1;

<span class="comment">#&gt;&gt;&gt; 至少1个特殊字符</span>
mysql&gt; SET GLOBAL validate_password_special_char_count = 1; 

<span class="comment">#&gt;&gt;&gt; 设置字典文件路径</span>
mysql&gt; SET GLOBAL validate_password_dictionary_file = '/opt/study.txt';
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**查看密码的长度**</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;sql</span><br><span class="line"> mysql&gt; select @@validate_password_length; </span><br><span class="line">+----------------------------+</span><br><span class="line">| @@validate_password_length |</span><br><span class="line">+----------------------------+</span><br><span class="line">|                          8 |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>示例一：<code>LOW策略示例</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL validate_password_policy = 'LOW';</span><br><span class="line">mysql&gt; SET GLOBAL validate_password_length = 8;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 能够设置成功案例</span></span><br><span class="line">mysql&gt; CREATE USER 'user_low'@'localhost' IDENTIFIED BY 'abcdefgh';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 无法设置成功案例,因为密码太短</span></span><br><span class="line">mysql&gt; CREATE USER 'user_low_fail'@'localhost' IDENTIFIED BY 'abcd';</span><br></pre></td></tr></table></figure>

<p>示例二：<code>MEDIUM策略示例</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL validate_password_policy = 'MEDIUM';</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 最小长度设置为8</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_length = 8;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 至少1个大小写字母</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_mixed_case_count = 1;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 至少一个数字</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_number_count = 1;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 至少1个特殊字符</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_special_char_count = 1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 能够设置成功案例</span></span><br><span class="line">mysql&gt; CREATE USER 'user_medium'@'localhost' IDENTIFIED BY 'Abcdef1!'; </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 无法设置成功案例,因为密码不符合复杂度要求</span></span><br><span class="line">mysql&gt; CREATE USER 'user_medium_fail'@'localhost' IDENTIFIED BY 'Abcdefgh';</span><br></pre></td></tr></table></figure>

<p>示例三：<code>STRONG策略示例</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL validate_password_policy = 'STRONG';</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 最小长度设置为12</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_length = 12;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 至少1个大小写字母</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_mixed_case_count = 1;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 至少一个数字</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_number_count = 1;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 至少1个特殊字符</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_special_char_count = 1;</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 字典路径</span></span><br><span class="line">mysql&gt; SET GLOBAL validate_password_dictionary_file = '/opt/study.txt';</span><br></pre></td></tr></table></figure>

<h3 id="8-10-权限控制机制"><a href="#8-10-权限控制机制" class="headerlink" title="8.10 权限控制机制"></a>8.10 权限控制机制</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">四张表：user   db    tables_priv  columns_priv</span><br><span class="line">1.用户认证</span><br><span class="line">查看mysql.user表</span><br><span class="line">2.权限认证</span><br><span class="line">以select权限为例：</span><br><span class="line">1.先看 user表里的select_priv权限</span><br><span class="line"> Y:不会接着查看其他的表  拥有查看所有库所有表的权限</span><br><span class="line"> N:接着看db表</span><br><span class="line">2.db表:  #某个用户对一个数据库的权限。</span><br><span class="line"> Y:不会接着查看其他的表  拥有查看所有库所有表的权限</span><br><span class="line"> N:接着看tables_priv表</span><br><span class="line">3.tables_priv表：#针对表的权限</span><br><span class="line"> tables_priv:如果这个字段的值里包括select  拥有查看这张表所有字段的权限，不会再接着往下看了</span><br><span class="line"> tables_priv:如果这个字段的值里不包括select，接着查看下张表还需要有column_priv字段权限</span><br><span class="line">4.columns_priv:针对数据列的权限表</span><br><span class="line"> columns_priv:有select，则只对某一列有select权限</span><br><span class="line">             没有则对所有库所有表没有任何权限</span><br><span class="line"> 注：其他权限设置一样。</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 授权级别排列</span></span><br><span class="line"></span><br><span class="line">- mysql.user #全局授权</span><br><span class="line">- mysql.db #数据库级别授权</span><br><span class="line">- 其他     #表级，列级授权</span><br></pre></td></tr></table></figure>

<h1 id="九、日志管理"><a href="#九、日志管理" class="headerlink" title="九、日志管理"></a>九、<strong><code>日志管理</code></strong></h1><p>​        简介：所谓日志，就是一种将<code>行为动作记录到一个地方</code>，这个地方可以是文件，文本等可存储的载体。Mysql日志就是记录整个mysql从启动、运行、到结束的整个生命周期下的行为</p>
<p>官网链接：<a href="https://dev.mysql.com/doc/refman/5.7/en/server-logs.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/server-logs.html</a></p>
<h3 id="9-1-MySQL-5-7日志分类"><a href="#9-1-MySQL-5-7日志分类" class="headerlink" title="9.1 MySQL 5.7日志分类"></a>9.1 MySQL 5.7日志分类</h3><ul>
<li><code>错误日志</code>：默认开启无法关闭。错误日志包含mysqld启动和关闭时间的记录。它还包含诊断消息，如服务器启动和关闭期间以及服务器运行时发生的错误、警告和注释。</li>
<li><strong>通用查询日志</strong>：通用日志主要是记录所有关于服务器的活动，包括所有客户端的连接和所有执行的SQL语句,mysql的通用日志是关闭的，如果需要设置可以通过<code>general_log</code> 选项开启通用日志。通用查询日志记录了大量的信息，它可能会对数据库服务器的性能产生显著影响，特别在高负载的生产环境中。而且还会占用大量磁盘空间和磁盘 I/O 问题，所以一般调试的时候才会开启通用日志。</li>
<li><strong><code>二进制日志(bin log)</code></strong>：二进制日志（Binary Log）是一种特殊类型的日志文件，它记录了所有<code>修改数据库内容</code>的操作，比如 <strong>INSERT、UPDATE 和 DELETE</strong> 语句，以及数据定义语言（DDL）语句，如 CREATE TABLE、ALTER TABLE 等。MySQL 的二进制日志并不是由纯粹的0和1序列组成的简单文件。实际上，它是一种特殊的二进制格式文件，这种格式旨在高效地存储和记录数据库更改操作。这种专门为 MySQL 优化的格式，既保证了存储和传输的高效性，也便于使用相应的工具进行内容查看和分析。例如mysqlbinlog这个工具就可以查看二进制文件的内容。MySQL的二进制日志不像通用日志、慢查询日志一样耗费性能，二进制日志对性能的影响通常较小。一般在主从复制的架构中才需要开启二进制日志。</li>
<li><strong><code>中继日志(Relay log)</code></strong>：中继日志（Relay Log）是在主从复制环境中使用的一种特殊日志文件，可以理解为二进制日志换一个名字，在主从复制环境中，中继日志是存放在从服务器上的。在 MySQL 的主从复制环境中，中继日志（Relay Log）的作用是暂存从主服务器接收的二进制日志（Binary Log）事件，并在从服务器上执行这些事件以实现数据同步。一旦这些事件在从服务器上成功执行并且数据同步完成，相应的中继日志文件就不再需要了，因此会被自动删除。这是从服务器自动进行的，以确保不会因为长时间累积大量的中继日志而占用过多的磁盘空间。</li>
<li><strong><code>慢查询日志</code></strong>：慢查询日志记录了<code>执行时间超过特定阈值的所有查询</code>，可以根据这些信息监控和诊断数据库性能问题。一般情况下是需要调试时候才开启慢查询日志，如果长期开启可能会对数据库性能产生一定的影响，且在大型或高负载的环境中日志文件可能会快速增长，占用过多磁盘空间。</li>
<li><strong>重做日志（redo log）</strong>：重做日志（Redo Log）是InnoDB存储引擎特有的日志系统，用于保证事务的持久性和恢复能力。重做日志也是以二进制格式存储存储的，并且如果使用的引擎是innodb，默认是开启了重做日志。commit</li>
<li><strong>回滚日志（undo log）</strong>：undo log是mysql中比较重要的事务日志之一，顾名思义，undo log是一种用于撤销回退的日志，在事务没提交之前，MySQL会先记录更新前的数据到 undo log日志文件里面，当事务回滚时或者数据库崩溃时，可以利用 undo log来进行回退。</li>
</ul>
<blockquote>
<p>注意：<br>        日志功能会<code>降低MySQL数据库的性能</code>。例如，在查询非常频繁的MySQL数据库系统中，如果开启了通用查询日志和慢查询日志，MySQL数据库会花费很多时间记录日志。I<br>同时日志会 <code>占用大量的磁盘空间</code>。对于用户量非常大、操作非常频繁的数据库，日志文件需要的存储空间设置比数据库文件需要的存储空间还要大。所以不必要的日志文件尽量就不开启。嘿嘿！</p>
</blockquote>
<h4 id="9-1-1-错误日志"><a href="#9-1-1-错误日志" class="headerlink" title="9.1.1 错误日志"></a>9.1.1 错误日志</h4><p>​        可以使用<code>my.cnf文件中加入--log-error=[file_name]</code>来指定mysqld记录的错误日志文件。</p>
<p><strong>查看错误日志文件路径</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like 'log_error';</span><br><span class="line">+<span class="comment">---------------+---------------------+</span></span><br><span class="line">| Variable_name | Value               |</span><br><span class="line">+<span class="comment">---------------+---------------------+</span></span><br><span class="line">| log_error     | /var/log/mysqld.log |</span><br><span class="line">+<span class="comment">---------------+---------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="9-1-2-通用查询日志（了解）"><a href="#9-1-2-通用查询日志（了解）" class="headerlink" title="9.1.2 通用查询日志（了解）"></a>9.1.2 通用查询日志（了解）</h4><p>​        通用查询日志可以帮助我们了解操作发生的具体时间和操作的细节，对找出异常发生的原因极其关键。配置通用查询日志可以通过<code>my.cnf</code>加入一下配置参数打开：</p>
<ul>
<li><code>general_log</code>：设置是否开启通用日志，默认为关闭（0），1表示开启；</li>
<li><code>general_log_file</code>：设置通用日志的存放位置和文件名。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看通用查询日志</span></span><br><span class="line">mysql&gt; show variables like <span class="string">'%general%'</span>;</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| Variable_name    | Value                           |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| general_log      | OFF                             | <span class="comment"># 默认关闭</span></span><br><span class="line">| general_log_file | /var/lib/mysql/mysql-server.log | <span class="comment"># 日志存放处</span></span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 编辑MySQL配置文件</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">general_log=ON  <span class="comment"># ON表示开启 OFF表示关闭</span></span><br><span class="line">general_log_file=/var/<span class="built_in">log</span>/mysql/general.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建目录和日志文件</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># mkdir /var/log/mysql </span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># touch /var/log/mysql/general.log</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># chmod -R 755  /var/log/mysql</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># chown -R mysql.mysql /var/log/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启MySQL</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看通用日志</span></span><br><span class="line">mysql&gt; show variables like <span class="string">'%general%'</span>;</span><br><span class="line">+------------------+----------------------------+</span><br><span class="line">| Variable_name    | Value                      |</span><br><span class="line">+------------------+----------------------------+</span><br><span class="line">| general_log      | ON                         |</span><br><span class="line">| general_log_file | /var/<span class="built_in">log</span>/mysql/general.log |</span><br><span class="line">+------------------+----------------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">注:如果发现general_log一直为off，可以尝试把general.log文件删除掉，然后重启MySQL让其自动生成general.log文件即可。</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看通用查询日志文件</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># cat /var/log/mysql/general.log</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407121034669.png" alt="img"></p>
<p>重新刷新日志文件，生产环境中随着程序的运行，日志文件会越来越大。此时就需要重新生成文件或者刷新文件。</p>
<p><strong>方式一：重新生成文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># mv /var/log/mysql/&#123;general.log,general.log.old&#125;</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># ll /var/log/mysql/general.log.old </span></span><br><span class="line">-rwxr-xr-x. 1 mysql mysql 512 7月  12 10:36 /var/<span class="built_in">log</span>/mysql/general.log.old</span><br><span class="line">[root@mysql-server mysql]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此方法效率较低，将文件名称修改后，会重新成功一个新的日志文件。在实际生产环境中需要考虑日志是否归档处理，如果不需要则直接删除就行。释放磁盘空间。</p>
</blockquote>
<p><strong>方式二：刷新文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]<span class="comment"># mysqladmin  -uroot -p'abc123' flush-logs</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<br>        <strong>第二种通过刷新的方式，会导致旧数据清空。如果旧数据需要保留还是建议归档或者提前备份。</strong></p>
</blockquote>
<h4 id="9-1-3-二进制日志"><a href="#9-1-3-二进制日志" class="headerlink" title="9.1.3 二进制日志"></a>9.1.3 二进制日志</h4><p>​        在MySQL 5.7中二进制(bin log)默认是<code>关闭状态</code>，MySQL 8.0默认<code>开启状态</code>，可以通过添加<code>my.cnf</code>配置参数开启二进制日志。binlog可以说是MySQL中比较重要的日志了，在日常开发及运维过程中，经常会遇到。 </p>
<p>​        <code>binlog</code>即<code>binary log</code>，二进制日志文件，也叫作<code>变更日志</code>（update log）。它记录了数据库所有执行的 <code>DDL</code> 和 <code>DML</code>等数据库更新事件的语句，但是不包含没有修改任何数据的语句（如数据查询语句select、show等）。 </p>
<p><code>binlog</code>主要应用场景： </p>
<ol>
<li>一是用于<code>数据恢复</code> </li>
<li>二是用于<code>数据复制</code></li>
</ol>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407121301866.png" alt="img"></p>
<h5 id="1-查看二进制日志是否开启"><a href="#1-查看二进制日志是否开启" class="headerlink" title="1. 查看二进制日志是否开启"></a><strong>1. 查看二进制日志是否开启</strong></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@global.log_bin;</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">| @@global.log_bin |</span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">|                0 |  <span class="comment"># 0为未开启</span></span><br><span class="line">+<span class="comment">------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%log_bin%'</span>;</span><br><span class="line">+<span class="comment">---------------------------------+-------+</span></span><br><span class="line">| Variable_name                   | Value |</span><br><span class="line">+<span class="comment">---------------------------------+-------+</span></span><br><span class="line">| log_bin                         | OFF   |</span><br><span class="line">| log_bin_basename                |       |</span><br><span class="line">| log_bin_index                   |       |</span><br><span class="line">| log_bin_trust_function_creators | OFF   |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF   |</span><br><span class="line">| sql_log_bin                     | ON    |</span><br><span class="line">+<span class="comment">---------------------------------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="2-开启二进制日志"><a href="#2-开启二进制日志" class="headerlink" title="2. 开启二进制日志"></a><strong>2. 开启二进制日志</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 修改MySQL配置文件</span></span><br><span class="line">[root@mysql-server mysql]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="comment"># 开启二进制日志，binlog为二进制日志文件前缀</span></span><br><span class="line"><span class="built_in">log</span>-bin=/var/<span class="built_in">log</span>/mysql/binlog</span><br><span class="line"><span class="comment"># AB复制的时候使用，为了防止相互复制，会设置一个ID，来标识谁产生的日志</span></span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启MySQL服务</span></span><br><span class="line">[root@mysql-server mysql]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看是否生成二进制日志文件</span></span><br><span class="line">[root@mysql-server mysql]<span class="comment"># ll /var/log/mysql/binlog.000001 </span></span><br><span class="line">-rw-r-----. 1 mysql mysql 154 7月  12 12:43 /var/<span class="built_in">log</span>/mysql/binlog.000001</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>新建的文件夹需要更改为mysql属主和属组，且需要具有755权限</strong></p>
</blockquote>
<h5 id="3-查看二进制日志"><a href="#3-查看二进制日志" class="headerlink" title="3. 查看二进制日志"></a><strong>3. 查看二进制日志</strong></h5><p>​        当MySQL创建二进制日志文件时，先创建一个以<code>“mylog”</code>为名称、以<code>“.index”</code>为后缀的文件，再创建一 个以<code>“mylog”</code>为名称、以<code>“.000001”</code>为后缀的文件。 MySQL服务 <code>重新启动一次</code> ，以<code>“.000001”</code>为后缀的文件就会增加一个，并且后缀名按1递增。即日志文件的 个数与MySQL服务启动的次数相同；</p>
<p>​        如果日志长度超过了 <code>max_binlog_size</code> 的上限（默认是1GB），就会创建一个新的日志文件。 查看当前的二进制日志文件列表及大小。指令如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binary logs;</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| Log_name      | File_size |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| binlog.000001 |       154 |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>查看二进制日志</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@l66 mysql]# mysqlbinlog mylog.000001 -v</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407121254264.png" alt="img"></p>
<blockquote>
<ul>
<li><code>at 4</code>：事件开始位置</li>
<li><code>end_log_pos 123</code>：事件结束的位置</li>
<li><code>240712 12:43:46</code>：产生事件的时间戳</li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server mysql]<span class="comment"># mysqlbinlog  -v --base64-output=decode-rows "/var/log/mysql/binlog.000001"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407121312314.png" alt="img"></p>
<h5 id="4-二进制日志三种格式"><a href="#4-二进制日志三种格式" class="headerlink" title="4. 二进制日志三种格式"></a>4. 二进制日志三种格式</h5><p><strong>查看二进制日志格式</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like 'binlog_format';</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| binlog_format | ROW   |  <span class="comment"># MySQL 默认格式</span></span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h6 id="4-1-Statement格式"><a href="#4-1-Statement格式" class="headerlink" title="4.1 Statement格式"></a>4.1 <code>Statement</code>格式</h6><p>​        <strong>STATEMENT 格式（语句模式，出现在 MySQL 5.1 之前）</strong>：在这种格式下，binlog 记录的是执行的 SQL 语句的文本。</p>
<ol>
<li><ol>
<li>优点：日志文件通常较小，复制效率较高。</li>
<li>缺点：在某些情况下，由于数据库环境的差异（如表结构、字符集等），在从服务器上重放这些 SQL 语句可能会导致不一致的结果。例如，获取当前时间的函数或存储过程等，可能会导致数据不一致。</li>
</ol>
</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">binlog_format</span> = STATEMENT</span><br></pre></td></tr></table></figure>

<h6 id="4-2-ROW格式"><a href="#4-2-ROW格式" class="headerlink" title="4.2 ROW格式"></a>4.2 <code>ROW</code>格式</h6><ol>
<li><p><strong>ROW 格式（行模式，诞生于 MySQL 5.1）</strong>：在这种格式下，binlog 记录的是每一行数据更改的具体内容。</p>
</li>
<li><ol>
<li>优点：能够精确地记录数据的变化，避免了 STATEMENT 格式中的环境依赖问题，提供了更强的一致性保证。</li>
<li>缺点：日志文件可能会比 STATEMENT 格式大，因为记录了每一行的详细变化。此外，ROW 格式的日志在进行大量数据更新时可能会导致更高的 I/O 开销。</li>
</ol>
</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">binlog_format</span> = ROW</span><br></pre></td></tr></table></figure>

<h6 id="4-3-MIXED格式"><a href="#4-3-MIXED格式" class="headerlink" title="4.3 MIXED格式"></a>4.3 <code>MIXED</code>格式</h6><ol>
<li><p><strong>MIXED 格式（混合模式）</strong>：在这种格式下，binlog 可以根据具体的 SQL 语句和操作自动选择使用 STATEMENT 或 ROW 格式。</p>
</li>
<li><ol>
<li>优点：结合了 STATEMENT 和 ROW 格式的优点，能够在保证一致性的同时尽可能地优化日志大小和复制性能。</li>
<li>缺点：由于混合使用了两种格式，可能需要更复杂的管理和监控。在某些特定情况下，MIXED 格式可能无法达到最优的性能或一致性。</li>
</ol>
</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">binlog_format</span> = MIXED</span><br></pre></td></tr></table></figure>

<h6 id="4-4-MySQL-5-7-运行时修改"><a href="#4-4-MySQL-5-7-运行时修改" class="headerlink" title="4.4 MySQL 5.7 运行时修改"></a>4.4 MySQL 5.7 运行时修改</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL binlog_format = 'STATEMENT';</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：修改二进制日志格式需要具有超级用户权限（<code>SUPER</code> 权限），并且只对新的会话生效，已有会话不受影响。</p>
</blockquote>
<h5 id="5-MySQL-5-7二进制日常管理事项"><a href="#5-MySQL-5-7二进制日常管理事项" class="headerlink" title="5. MySQL 5.7二进制日常管理事项"></a>5. MySQL 5.7二进制日常管理事项</h5><ul>
<li><p>每次重启MySQL实例，都会重新生成新的二进制文件</p>
</li>
<li><p>执行<code>flush logs;</code>会重新生成新的二进制日志文件</p>
</li>
<li><p><strong>执行<code>reset master;</code>会删除所有的<code>binlog</code>日志文件。危险操作</strong></p>
</li>
<li><p>可以通过<code>purge binary logs to &#39;binlog.000002&#39;</code>删除<code>binlog.000002</code>之前的二进制文件。</p>
</li>
<li><p>可以通过<code>set sql_log_bin=0</code>关闭当前会话的执行操作记录至二进制日志文件，需要具有 <code>SUPER</code> 权限。在复制环境中使用 <code>sql_log_bin = 0</code> 时要小心，以避免主从数据不一致。</p>
<ul>
<li><pre><code class="sql"><span class="comment">#&gt;&gt;&gt; 查看sql_log_bin状态信息</span>
mysql&gt; SHOW VARIABLES LIKE 'SQL_LOG_BIN';
+<span class="comment">---------------+-------+</span>
| Variable_name | Value |
+<span class="comment">---------------+-------+</span>
| sql_log_bin   | ON    | <span class="comment"># 默认关闭</span>
+<span class="comment">---------------+-------+</span>
1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)
&lt;!<span class="comment">--￼191--&gt;</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<h5 id="2-查看慢查询日志参数"><a href="#2-查看慢查询日志参数" class="headerlink" title="2. 查看慢查询日志参数"></a>2. 查看慢查询日志参数</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE '%slow_query%';</span><br><span class="line">+<span class="comment">---------------------+-------------------------------+</span></span><br><span class="line">| Variable_name       | Value                         |</span><br><span class="line">+<span class="comment">---------------------+-------------------------------+</span></span><br><span class="line">| slow_query_log      | ON                            |</span><br><span class="line">| slow_query_log_file | /var/log/mysql/slow_query.log |</span><br><span class="line">+<span class="comment">---------------------+-------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="3-验证"><a href="#3-验证" class="headerlink" title="3.  验证"></a>3.  验证</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 测试SQL语句</span></span><br><span class="line">mysql&gt; select sleep(6);</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| sleep(6) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|        0 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">6.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看慢查询日志文件</span></span><br><span class="line">[root@mysql-<span class="keyword">server</span> ~]<span class="comment"># cat  /var/log/mysql/slow_query.log</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407121344436.png" alt="img"></p>
<h4 id="9-1-5-中继日志"><a href="#9-1-5-中继日志" class="headerlink" title="9.1.5 中继日志"></a>9.1.5 中继日志</h4><p>​        中继日志（Relay Log）是从服务器（Slave）用于记录从主服务器（Master）接收到的二进制日志事件的日志文件。这些事件在从服务器上被重新执行以保持主从数据的一致性。中继日志的主要作用是存储从主服务器复制过来的二进制日志事件。在复制过程中，从服务器上的 I/O 线程从主服务器读取二进制日志事件，并将其写入中继日志文件。从服务器上的 SQL 线程读取中继日志，并执行其中的事件，从而更新从服务器上的数据。</p>
<p><strong>扩展</strong></p>
<p>UNIX Socket连接方式其实不是一个网络协议，所以只能在MySQL客户端和数据库实例在同一台服务器上的情况下使用。<strong>本地进程间通信的一种方式</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过socket方式登录</span><br><span class="line">查看sock的存放路径</span><br><span class="line">[root@l66 ~]# cat /etc/my.cnf | grep sock</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">[root@l66 ~]# mysql -uroot -p'1!' -S /var/lib/mysql/mysql.sock</span><br></pre></td></tr></table></figure>

<h1 id="Day04"><a href="#Day04" class="headerlink" title="Day04"></a>Day04</h1><h1 id="十、数据备份与恢复"><a href="#十、数据备份与恢复" class="headerlink" title="十、数据备份与恢复"></a>十、数据备份与恢复</h1><h2 id="10-1-为什么要备份"><a href="#10-1-为什么要备份" class="headerlink" title="10.1 为什么要备份"></a>10.1 为什么要备份</h2><p>MySQL 备份在<code>保护数据完整性</code>、防止各种<code>不可预见的灾难</code>、<code>硬件故障</code>、<code>数据丢失</code>、<code>损坏</code>和<code>意外删除</code>方面发挥着关键作用。如果没有可靠的备份，数据丢失的后果可能会很严重。<strong>企业面临运营中断、财务损失、声誉受损甚至合规违规的风险。</strong>学习MySQL 备份的重要性以及它们如何降低这些风险将有助于组织保证数据一致性、业务连续性，并确保数据在需要时安全且可恢复。</p>
<ul>
<li><strong>主机故障</strong>：我们可能会因磁盘停滞或磁盘损坏而遇到多种问题。同样，在云服务中，我们的数据库实例可能会损坏并且无法访问。</li>
<li><strong>数据损坏</strong>：这可能发生在断电时，MySQL 无法正确写入并关闭文件，有时当 MySQL 再次启动时，由于数据损坏而无法启动，并且崩溃恢复过程无法修复它。</li>
<li><strong>备份</strong>：能够防止由于机械故障以及人为误操作带来的数据丢失，例如将数据库文件保存在了其它地方。</li>
<li><strong>冗余</strong>： 数据有多份冗余，但不等备份，只能防止机械故障带来的数据丢失，例如主备模式、数据库集群。</li>
</ul>
<h3 id="10-1-1-MySQL备份的专业名词"><a href="#10-1-1-MySQL备份的专业名词" class="headerlink" title="10.1.1 MySQL备份的专业名词"></a>10.1.1 MySQL备份的专业名词</h3><ul>
<li><strong>RTO</strong>：RTO（RecoveryTimeObjective，恢复时间目标）是故障发生到业务恢复能时间点的最大长度。与之相关的问题是：<strong>多久可以恢复？</strong></li>
<li><strong>RPO</strong>：RPO（RecoveryPointObjective，恢复点目标）是故障发生后业务系统可容忍的数据丢失量。与之相关的问题是：<strong>会丢失多少数据？</strong></li>
</ul>
<h2 id="10-2-MySQL数据备份需要重视的内容"><a href="#10-2-MySQL数据备份需要重视的内容" class="headerlink" title="10.2 MySQL数据备份需要重视的内容"></a>10.2 <strong>MySQL数据备份需要重视的内容</strong></h2><ol>
<li><strong>选择合适的备份方式</strong>：根据具体需求和数据量大小，选择适合的逻辑备份或物理备份方式。逻辑备份通常生成可读的文件，便于编辑和审查，而物理备份适用于大型数据库，恢复时间较短。</li>
<li><strong>备份数据文件和日志文件</strong>：在备份时，需要同时备份数据库的数据文件和日志文件，以确保数据的完整性。如果备份文件不完整，可能无法正确恢复数据。</li>
<li><strong>定期备份</strong>：为了确保数据的安全性，需要定期进行备份操作。备份的频率可以根据具体情况进行设置，通常建议每天备份一次。</li>
<li><strong>存储备份文件</strong>：备份文件应该存储在可靠的介质上，如<code>硬盘</code>；以防止数据丢失。此外，备份文件尽量存储在不同的地点，以避免因某一地点的灾害导致备份文件的损失。</li>
<li><strong>备份文件的安全性和完整性</strong>：备份文件需要受到<code>保护</code>，以防止<code>未经授权</code>的<code>访问</code>和<code>篡改</code>。同时，需要定期验证备份文件的<code>完整</code>和<code>可恢复性</code>，以确保在需要时能够成功恢复数据。</li>
<li><strong>备份的自动化和监控</strong>：可以使用自动化备份工具来定期执行备份操作，并监控备份过程，确保备份顺利完成。此外，还可以设置备份失败的告警通知，以便及时处理备份问题。</li>
<li><strong>备份策略的灵活性</strong>：备份策略应该具有一定的灵活性，以适应业务发展和数据增长的变化。需要定期评估备份策略的有效性，并根据实际情况进行调整和优化。</li>
</ol>
<h2 id="10-3-MySQL-备份类型"><a href="#10-3-MySQL-备份类型" class="headerlink" title="10.3 MySQL 备份类型"></a>10.3 MySQL 备份类型</h2><ul>
<li><strong>物理备份：</strong> <strong>备份数据文件，转储数据库物理文件到某一目录。 直接复制数据库文件，适用于大型数据库环境，不受存储引擎的限制，但不能恢复到不同的MySQL版本。</strong>备份文件相对较大(备份表空间,包含数据与索引)。物理备份恢复速度比较快，但占用空间比较大，MySQL中可以用<code>xtrabackup</code>工具来进行物理备份。 </li>
<li><strong>逻辑备份：</strong> 对数据库对象利用工具进行导出工作，汇总入备份文件内。逻辑备份恢复速度慢，需要重建索引,存储过程等。但占用空间小，更灵活。MySQL 中常用的逻辑备份工具为<code>mysqldump</code> 。逻辑备份就是 <code>备份sql语句</code> ，在恢复的时候执行备份的sql语句实现数据库数据的重现。</li>
</ul>
<hr>
<ol>
<li><p><strong>热备(hot backup)</strong>：在线备份，数据库处于运行状态，这种备份方法依赖于数据库的日志文件。对应用基本无影响(但是性能还是会有下降,所以尽量不要在主上做备份,在从库上做)</p>
<ul>
<li>优点：不中断服务。高可用性。</li>
<li>缺点：对性能有一定影响，备份的时间较长时，备份文件可能不一致。</li>
</ul>
</li>
<li><p><strong>冷备(cold backup)</strong>：需要完全停止数据库服务来进行备份。备份过程中数据库服务完全停止，没有任何运行的数据库操作。确保备份文件的一致性和完整性。<code>copy/tar/unzip</code></p>
<ul>
<li>优点：备份文件的一致性和完整性最高。不会影响数据库性能。</li>
<li>缺点：完全停机，服务不可用。不适用于需要高可用性的系统。</li>
</ul>
</li>
<li><p><strong>温备(warm backup)</strong>：针对myisam的备份(myisam不支持热备),备份时候实例只读不可写，数据库锁定表格（不可写入但可读）的状态下进行的。对应用影响很大。通常加一个读锁，备份时候实例只读不可写，数据库锁定表格（不可写入但可读）的状态下进行的</p>
</li>
</ol>
<blockquote>
<p>合适的备份策略取决于系统的可用性要求、备份窗口和数据一致性需求。在实际操作中，可能会结合使用多种备份策略以实现最佳的备份效果和数据保护。</p>
</blockquote>
<h2 id="10-4-MySQL-备份工具"><a href="#10-4-MySQL-备份工具" class="headerlink" title="10.4 MySQL 备份工具"></a>10.4 MySQL 备份工具</h2><ol>
<li><code>Percona XtraBackup</code> 是一个开源的 MySQL 数据库备份工具，它由 Percona 开发，支持 MySQL、MariaDB 和 Percona Server。XtraBackup 提供了热备份功能，可以在数据库运行过程中执行备份，不会中断数据库服务。<ol>
<li><strong>热备份</strong>：在不停止数据库服务的情况下执行备份，确保数据库在备份期间仍然可用。</li>
<li><strong>增量备份</strong>：只备份自上次完整备份以来发生变化的数据，节省存储空间和备份时间。</li>
<li><strong>快速恢复</strong>：可以快速恢复备份，减少数据库停机时间。</li>
<li><strong>数据压缩</strong>：支持压缩备份数据，节省存储空间。</li>
</ol>
</li>
<li><code>ibbackup</code> 是 InnoDB Hot Backup 的命令行工具，它是 MySQL 的商业备份工具，可以进行热备份。这意味着可以在不停止数据库的情况下进行备份。ibbackup 工具已经被 Percona XtraBackup 所取代，因为 XtraBackup 提供了更多功能并且是开源的。<ol>
<li><strong>热备份</strong>：支持对运行中的数据库进行备份，而不会中断数据库的正常运行。</li>
<li><strong>完全备份和增量备份</strong>：支持完整备份和增量备份。</li>
<li><strong>一致性备份</strong>：确保备份数据的一致性，即使在备份期间有数据写入操作。</li>
<li><strong>支持多种存储引擎</strong>：主要支持 InnoDB 引擎，但也可以备份 MyISAM 表。</li>
</ol>
</li>
<li><code>mysqldump</code> 是 MySQL 数据库管理系统自带的一个用于生成数据库备份的命令行工具。它可以将数据库内容导出为 SQL 语句或其他格式，方便数据库的备份和恢复。<ol>
<li><strong>备份数据库</strong>：将数据库导出为 SQL 文件或其他格式，方便备份。</li>
<li><strong>迁移数据库</strong>：将导出的数据库文件导入到另一个数据库实例，实现数据库迁移。</li>
<li><strong>生成数据定义语句</strong>：导出数据库表的结构（CREATE TABLE 语句）。</li>
<li><strong>生成数据操作语句</strong>：导出数据库表中的数据（INSERT 语句）。</li>
<li><strong>支持多种格式</strong>：支持 SQL、CSV 等格式的导出。</li>
<li><strong>选择性备份</strong>：可以指定备份整个数据库、某些表或特定的行。</li>
</ol>
</li>
<li><code>mysqlbackup</code> 是 MySQL Enterprise Backup 工具的一部分，专为企业用户提供，提供了热备份、增量备份、压缩、加密等高级备份和恢复功能。它支持 MySQL 的所有存储引擎，包括 InnoDB 和 MyISAM，并且能够在数据库运行期间执行备份，确保最小的停机时间。<ol>
<li><strong>热备份</strong>：支持在数据库运行期间进行备份，无需停机。</li>
<li><strong>增量备份</strong>：只备份自上次完整备份以来发生变化的数据，节省存储空间和备份时间。</li>
<li><strong>差异备份</strong>：只备份自上次增量或完整备份以来发生变化的数据。</li>
<li><strong>压缩备份</strong>：对备份数据进行压缩，节省存储空间。</li>
<li><strong>加密备份</strong>：对备份数据进行加密，确保数据安全。</li>
<li><strong>自动验证备份</strong>：在备份过程中和之后验证备份数据的完整性。</li>
</ol>
</li>
</ol>
<h2 id="10-5-物理备份的方式"><a href="#10-5-物理备份的方式" class="headerlink" title="10.5 物理备份的方式"></a>10.5 物理备份的方式</h2><h3 id="10-5-1-完全备份（完整备份）"><a href="#10-5-1-完全备份（完整备份）" class="headerlink" title="10.5.1 完全备份（完整备份）"></a>10.5.1 完全备份（完整备份）</h3><p>​        <strong>每次对数据进行完整的备份，即对整个数据库的备份、数据库结构和文件结构的备份，保存的是备份完成时刻的数据库，是差异备份与增量备份的基础。</strong></p>
<ul>
<li><strong>优点：</strong>备份与恢复操作简单方便，恢复时一次恢复到位，恢复速度快</li>
<li><strong>缺点：</strong>占用空间大，备份速度慢</li>
</ul>
<h3 id="10-5-2-增量备份"><a href="#10-5-2-增量备份" class="headerlink" title="10.5.2 增量备份"></a>10.5.2 增量备份</h3><p>​        <strong><code>每次备份上一次备份到现在产生的新数据</code>。只有那些在上次完全备份或者增量备份后被修改的文件才会被备份。以上次完整备份或上次的增量备份的时间为时间点，仅备份这之间的数据变化。</strong></p>
<ul>
<li><strong>特点：</strong>因而备份的数据量小，占用空间小，备份速度快。但恢复时，需要从上一次的完整备份起按备份时间顺序，逐个备份版本进行恢复，恢复时间长，如中间某次的备份数据损坏，将导致数据的丢失。</li>
</ul>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407152140729.png" alt="1566269843796"></p>
<h3 id="10-5-3-差异备份"><a href="#10-5-3-差异备份" class="headerlink" title="10.5.3 差异备份"></a>10.5.3 差异备份</h3><p>​        只备份跟完整备份不一样的。备份那些自从第一次次完全备份之后被修改过的所有文件，备份的时间起点是从第一次次完整备份起，且以后每次备份都是和第一次完整备份进行比较（注意是第一次，不是上一次），备份自第一次完整备份以来所有的修改过的文件。备份数据量会越来越大。</p>
<ul>
<li><strong>特点：</strong>占用空间比增量备份大，比完整备份小，恢复时仅需要恢复第一个完整版本和最后一次的差异版本，恢复速度介于完整备份和增量备份之间。</li>
</ul>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407152141039.png" alt="1566269915833"></p>
<blockquote>
<p><strong>简单的讲，完整备份就是不管三七二十一，每次都把指定的备份目录完整的复制一遍，不管目录下的文件有没有变化；增量备份就是每次将之前（第一次、第二次、直到前一次）做过备份之后有变化的文件进行备份；差异备份就是每次都将第一次完整备份以来有变化的文件进行备份。</strong></p>
</blockquote>
<h3 id="10-5-4-percona-xtrabackup-物理备份"><a href="#10-5-4-percona-xtrabackup-物理备份" class="headerlink" title="*10.5.4 percona-xtrabackup 物理备份 *"></a>*<em>10.5.4 percona-xtrabackup 物理备份 *</em></h3><p>​    <code>Xtrabackup</code>是开源免费的支持MySQL数据库<code>热备份</code>的软件，在 Xtrabackup 包中主要有 <code>Xtrabackup</code>和<code>innobackupex</code>两个工具。其中<code>Xtrabackup</code>只能备份<code>InnoDB</code>和 <code>XtraDB</code> 两种引擎;<code>innobackupex</code>则是封装了<code>Xtrabackup</code>，同时<strong>增加了备份MyISAM引擎的功能</strong>。<strong>它不暂停服务创建Innodb热备份。</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407152143789.png" alt="1566914979584"></p>
<h5 id="1-安装xtrabackup"><a href="#1-安装xtrabackup" class="headerlink" title="1. 安装xtrabackup"></a>1. 安装xtrabackup</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 安装xtrabackup</span></span><br><span class="line">[root@mysql-server ~]# wget http://www.percona.com/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@mysql-server ~]# rpm -ivh percona-release-latest.noarch.rpm </span><br><span class="line"></span><br><span class="line">[root@mysql-server yum.repos.d]# vim percona-original-release.repo</span><br></pre></td></tr></table></figure>

<p><strong>修改如下内容：将原来的1改为0，关闭校验</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407162312336.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server yum.repos.d]<span class="comment"># vim percona-prel-release.repo</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407162313743.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server yum.repos.d]# yum -y install percona-xtrabackup-24.x86_64</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果安装不上报错：</span></span><br><span class="line">Transaction check error:</span><br><span class="line">  file /etc/my.cnf from install of Percona-Server-shared-56-5.6.46-rel86.2.1.el7.x86_64 conflicts with file from package mysql-community-server-5.7.28-1.el7.x86_64</span><br><span class="line">Error Summary  #说是冲突</span><br><span class="line">解决方式如下：</span><br><span class="line">1.先安装yum install mysql-community-libs-compat -y #安装包</span><br><span class="line">2.在安装yum -y install percona-xtrabackup-24.x86_64</span><br><span class="line"></span><br><span class="line">参考：https://www.cnblogs.com/EikiXu/p/10217931.html</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line">1.先安装percona-xtrabackup</span><br><span class="line">2.在安装mysql</span><br><span class="line">或者先将mysql源back了，重新建立yum缓存。在安装percona-xtrabackup。</span><br></pre></td></tr></table></figure>

<p>以上安装方式如果失效，请用youngfit提供的方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">======第一种========</span><br><span class="line">[root@mysql-server ~]# vim /etc/yum.repos.d/Percona.repo </span><br><span class="line">[percona] </span><br><span class="line">name = CentOS $releasever - Percona </span><br><span class="line">baseurl=http://repo.percona.com/centos/$releasever/os/$basearch/ </span><br><span class="line">enabled = 1 </span><br><span class="line">gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-percona </span><br><span class="line">gpgcheck = 1</span><br><span class="line"></span><br><span class="line">[root@mysql-server yum.repos.d]# vim /etc/pki/rpm-gpg/RPM-GPG-KEY-percona</span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line">Version: GnuPG v1.4.9 (GNU/Linux)</span><br><span class="line"></span><br><span class="line">mQGiBEsm3aERBACyB1E9ixebIMRGtmD45c6c/wi2IVIa6O3G1f6cyHH4ump6ejOi</span><br><span class="line">AX63hhEs4MUCGO7KnON1hpjuNN7MQZtGTJC0iX97X2Mk+IwB1KmBYN9sS/OqhA5C</span><br><span class="line">itj2RAkug4PFHR9dy21v0flj66KjBS3GpuOadpcrZ/k0g7Zi6t7kDWV0hwCgxCa2</span><br><span class="line">f/ESC2MN3q3j9hfMTBhhDCsD/3+iOxtDAUlPMIH50MdK5yqagdj8V/sxaHJ5u/zw</span><br><span class="line">YQunRlhB9f9QUFfhfnjRn8wjeYasMARDctCde5nbx3Pc+nRIXoB4D1Z1ZxRzR/lb</span><br><span class="line">7S4i8KRr9xhommFnDv/egkx+7X1aFp1f2wN2DQ4ecGF4EAAVHwFz8H4eQgsbLsa6</span><br><span class="line">7DV3BACj1cBwCf8tckWsvFtldqCP4CiBB50Ku49MU2Nfwq7durfIiePF4IIYRDZgg</span><br><span class="line">kHKSfP3oUZBGJx00BujtTobERraaV7lIRIwETZao76MqGt9K1uIqw4NT/jAbi9ce</span><br><span class="line">rFaOmAkaujbcB11HYIyjtkAGq9mXxaVqCC3RPWGr+fqAx/akBLQ2UGVyY29uYSBN</span><br><span class="line">eVNRTCBEZXZlbG9wbWVudCBUZWFtIDxteXNxbC1kZXZAcGVyY29uYS5jb20+iGAE</span><br><span class="line">ExECACAFAksm3aECGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIXgAAKCRAcTL3NzS79</span><br><span class="line">Kpk/AKCQKSEgwX9r8jR+6tAnCVpzyUFOQwCfX+fw3OAoYeFZB3eu2oT8OBTiVYu5</span><br><span class="line">Ag0ESybdoRAIAKKUV8rbqlB8qwZdWlmrwQqg3o7OpoAJ53/QOIySDmqy5TmNEPLm</span><br><span class="line">lHkwGqEldqbFYoTbOCEEJi2yFLg9UJCSBM/sfPaqb2jGP7fc0nZBgUBnFuA9USX72</span><br><span class="line">O0PzVAF7rCnWaIz76iY+AMI6xKeRy91TxYo/yenF1nRSJ+rExwlPcHgI685GNuFG</span><br><span class="line">chAExMTgbnoPx1ka1Vqbe6iza+FnJq3f4p9luGbZdSParGdlKhGqvVUJ3FLeLTqt</span><br><span class="line">caOn5cN2ZsdakE07GzdSktVtdYPT5BNMKgOAxhXKy11IPLj2Z5C33iVYSXjpTelJ</span><br><span class="line">b2qHvcg9XDMhmYJyE3O4AWFh2no3Jf4ypIcABA0IAJO8ms9ov6bFldqTqA0UW2gWQ</span><br><span class="line">cKFN4Q6NPV6IW0rV61ONLUc0VFXvYDtwsRbUmUYkB/L/R9fHj4lRUDbGEQrLCoE+</span><br><span class="line">/HyYvr2rxP94PT6Bkjk/aiCCPAKZRj5CFUKRpShfDIiow9qxtqv7yVd514Qqmjb4</span><br><span class="line">eEihtcjltGAoS54+6C3lbjrHUQhLwPGqlAh8uZKzfSZq0C06kTxiEqsG6VDDYWy6</span><br><span class="line">L7qaMwOqWdQtdekKiCk8w/FoovsMYED2qlWEt0i52G+0CjoRFx2zNsN3v4dWiIhk</span><br><span class="line">ZSL00Mx+g3NA7pQ1Yo5Vhok034mP8L2fBLhhWaK3LG63jYvd0HLkUFhNG+xjkpeI</span><br><span class="line">SQQYEQIACQUCSybdoQIbDAAKCRAcTL3NzS79KlacAJ0aAkBQapIaHNvmAhtVjLPN</span><br><span class="line">wke4ZgCePe3sPPF49lBal7QaYPdjqapa1SQ=</span><br><span class="line">=qcCk</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br><span class="line"></span><br><span class="line">[root@mysql-server yum.repos.d]# yum -y install percona-xtrabackup</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407152157491.png" alt="image-20201207135955516"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server yum.repos.d]# innobackupex --version</span><br><span class="line">xtrabackup: recognized server arguments: --datadir=/var/lib/mysql </span><br><span class="line">innobackupex version 2.4.29 Linux (x86_64) (revision id: 2e6c0951)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">======第二种========</span><br><span class="line">百度搜吧，飞哥这边就是用的这种方式</span><br><span class="line"></span><br><span class="line">访问以下链接：</span><br><span class="line">https://zhuanlan.zhihu.com/p/140414143</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407152158166.png" alt="image-20201207142906812"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407152158490.png" alt="image-20201207142930658"></p>
<p>下载完成，把包上传至服务器</p>
<h5 id="2-完全备份流程"><a href="#2-完全备份流程" class="headerlink" title="2.完全备份流程:"></a>2.完全备份流程:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 创建备份目录：</span></span><br><span class="line">[root@mysql-server ~]# mkdir /backup/full/  -p</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 备份之前，进入数据库，存入些数据</span></span><br><span class="line">[root@mysql-server ~]# mysql -uroot -p'1'</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database youngfit;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use youngfit;</span></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table t1(id int);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 进行完整备份</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --user=root --password='1'  /backup/full/</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407182306320.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看完整备份文件</span></span><br><span class="line">[root@mysql-server ~]# ll /backup/full/</span><br><span class="line">drwxr-x--- 11 root root 304 7月  18 23:05 2024-07-18_23-05-47</span><br><span class="line">========================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 完全备份恢复流程</span></span><br><span class="line">		1. 停止数据库</span><br><span class="line">		2. 清理环境</span><br><span class="line">		3. 重演回滚－－&gt; 恢复数据</span><br><span class="line">		4. 修改权限</span><br><span class="line">		5. 启动数据库</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 1.关闭数据库：</span></span><br><span class="line">[root@mysql-server ~]# systemctl stop mysqld</span><br><span class="line"><span class="meta">	#</span><span class="bash">&gt;&gt;&gt; 删除所有数据</span></span><br><span class="line">[root@mysql-server ~]# rm -rf /var/lib/mysql/*</span><br><span class="line">[root@mysql-server ~]# rm -rf /var/log/mysqld.log</span><br><span class="line">[root@mysql-server ~]# rm -rf /var/log/mysql-slow/slow.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 2.重演恢复:</span></span><br><span class="line">[root@mysql-server ~]# innobackupex --apply-log /xtrabackup/full/2024-07-16_23-16-31/</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>innobackupex</code></strong>：<ul>
<li><code>Percona XtraBackup</code> 工具脚本，提供了更高级别的备份和恢复操作。<code>innobackupex</code> 脚本实际上是一个对 <code>xtrabackup</code> 工具的包装，使得它更易于使用。</li>
</ul>
</li>
<li><strong><code>--apply-log</code></strong>：<ul>
<li>这个选项用于准备备份目录，使其可以被恢复。这个过程也被称为“应用日志”。在备份过程中，XtraBackup 会复制数据文件和事务日志。为了确保数据一致性，必须在数据恢复之前应用这些日志。此步骤会合并所有未完成的事务，从而使数据文件处于一致状态。</li>
</ul>
</li>
<li><strong><code>/xtrabackup/full/2024-07-16_23-16-31/</code></strong>：<ul>
<li>指定包含备份数据的目录，该目录通常包含由 XtraBackup 生成的数据文件、日志文件和其他相关文件。</li>
</ul>
</li>
</ul>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407162323638.png" alt="image-20240716232340566"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 3.确认数据库目录：</span></span><br><span class="line">恢复之前需要确认配置文件内有数据库目录指定，不然xtrabackup不知道恢复到哪里</span><br><span class="line">[root@mysql-server ~]# cat /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 4.恢复数据：</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --copy-back  /backup/full/2024-07-18_23-05-47/</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407162324038.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 5.修改权限：</span></span><br><span class="line">[root@mysql-server ~]# chown mysql.mysql  /var/lib/mysql  -R</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 启动数据库:</span></span><br><span class="line">[root@mysql-server ~]# systemctl start mysqld</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">6.确认数据是否恢复</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">use</span> emp01;</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">| Tables_in_emp01 |</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">| emp             |</span><br><span class="line">| employees       |</span><br><span class="line">| t3              |</span><br><span class="line">| test            |</span><br><span class="line">| test01          |</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">===可以看到数据已恢复===</span><br></pre></td></tr></table></figure>



<h5 id="3-增量备份流程"><a href="#3-增量备份流程" class="headerlink" title="3. 增量备份流程"></a>3. 增量备份流程</h5><p>  <strong>原理：每次备份上一次备份到现在产生的新数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 1.在数据库上面创建一个测试的库</span></span><br><span class="line">mysql&gt; create database test01;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table test01(id int);</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test01(1);</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test01;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407162330840.png" alt="1566283686794"></p>
<p><strong>1. 完整备份:周一</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 学习环境删除备份目录</span></span><br><span class="line">[root@mysql-server ~]# rm -rf /backup/*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 第一次进行完整备份</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --user=root --password='1'  /backup/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看备份数据</span></span><br><span class="line">[root@mysql-server ~]# ll /backup/2024-07-18_23-17-58/</span><br><span class="line">总用量 12344</span><br><span class="line">-rw-r----- 1 root root      487 7月  18 23:18 backup-my.cnf</span><br><span class="line">drwxr-x--- 2 root root       78 7月  18 23:17 emp01</span><br><span class="line">-rw-r----- 1 root root      453 7月  18 23:18 ib_buffer_pool</span><br><span class="line">. . . . . .</span><br></pre></td></tr></table></figure>

<p><strong>2、增量备份：周二　——　周三</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 在数据库中插入周二的数据:</span></span><br><span class="line">mysql&gt; use test01;</span><br><span class="line">mysql&gt; select * from test01;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test01(<span class="keyword">id</span>) <span class="keyword">values</span>(<span class="number">2</span>); <span class="comment"># 模拟周二</span></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test01;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 第一次增量备份</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># innobackupex  --user=root --password='1'  --incremental /backup/ --incremental-basedir=/backup/2024-07-18_23-17-58/</span></span><br><span class="line">--incremental-basedir:基于哪个备份文件进行增量</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看备份文件目录</span></span><br><span class="line">[root@mysql-server ~]<span class="comment"># ll /backup/</span></span><br><span class="line">总用量 4</span><br><span class="line">drwxr-x--- 11 root root  304 7月  18 23:18 2024-07-18_23-17-58</span><br><span class="line">drwxr-x--- 12 root root 4096 7月  18 23:23 2024-07-18_23-23-14 <span class="comment"># 相当于周二的增量备份</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 在数据库中插入周三的数据:</span></span><br><span class="line">mysql&gt; use test01;</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test01(id) values(3);   # 模拟周三</span><br><span class="line">Query OK, 1 row affected (0.00 sec) </span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test01;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 第二次增量备份(基于第二天增量备份实现)</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --user=root --password='1' --incremental /backup/ --incremental-basedir=/backup/2024-07-18_23-23-14/      # 基于前一天的备份为目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看备份目录</span></span><br><span class="line">[root@mysql-server ~]# ll /backup/</span><br><span class="line">2024-07-18_23-17-58</span><br><span class="line">2024-07-18_23-23-14</span><br><span class="line">2024-07-18_23-28-43  # 相当于周三的增量备份</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看一下备份目录:</span></span><br><span class="line">[root@mysql-server ~]# ls /xtrabackup/</span><br><span class="line">2024-07-18_23-17-58  2024-07-18_23-23-14  2024-07-18_23-28-43</span><br><span class="line">    全备周一             增量周二               增量周三</span><br></pre></td></tr></table></figure>

<p><strong>数据恢复流程</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">增量备份恢复流程</span><br><span class="line">1. 停止数据库</span><br><span class="line">2. 清理环境</span><br><span class="line">3. 依次重演回滚redo log－－&gt; 恢复数据</span><br><span class="line">4. 修改权限</span><br><span class="line">5. 启动数据库</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 关闭MySQL</span></span><br><span class="line">[root@mysql-server ~]# systemctl stop mysqld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 清除脏数据</span></span><br><span class="line">[root@mysql-server ~]# rm -rf /var/lib/mysql/*  /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 依次重演回滚redo <span class="built_in">log</span>:（第一次回滚完整备份日志）</span></span><br><span class="line">[root@mysql-server ~]# innobackupex --apply-log --redo-only /xtrabackup/2024-07-16_23-31-20/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 回滚第一次增量备份日志（基于完整备份还原）</span></span><br><span class="line">[root@mysql-server ~]# innobackupex --apply-log --redo-only /xtrabackup/2024-07-16_23-31-20/  --incremental-dir=/xtrabackup/2024-07-16_23-35-21/</span><br><span class="line">--incremental-dir：增量目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 回滚第二次增量备份日志（基于完整备份还原）</span></span><br><span class="line">[root@mysql-server ~]# innobackupex --apply-log --redo-only /xtrabackup/2024-07-16_23-31-20/  --incremental-dir=/xtrabackup/2024-07-16_23-38-36/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 恢复数据:（基于MySQL完整备份）</span></span><br><span class="line">[root@mysql-server ~]# innobackupex --copy-back /xtrabackup/2024-07-16_23-31-20/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 修改权限（属主属组）</span></span><br><span class="line">[root@mysql-server ~]# chown -R mysql.mysql /var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 启动MySQL服务</span></span><br><span class="line">[root@mysql-server ~]# systemctl start mysqld</span><br><span class="line">登陆上去看一下:</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407162352052.png" alt="img"></p>
<hr>
<h5 id="4、差异备份流程"><a href="#4、差异备份流程" class="headerlink" title="4、差异备份流程"></a>4、差异备份流程</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 清理备份的环境</span></span><br><span class="line">[root@mysql-server ~]# rm -rf /xtrabackup/*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 登陆数据库，准备环境</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> delete from test01.t1;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into test01.t1(id) values(1);  <span class="comment">#插入数据1，模拟周一</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看当前系统时间</span></span><br><span class="line">[root@mysql-server ~]# date</span><br><span class="line">2024年 07月 16日 星期二 23:54:54 CST</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 第一步：完整备份：周一</span></span><br><span class="line">[root@mysql-server ~]# innobackupex --user=root --password='1' /xtrabackup/</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 差异备份：周二</span></span><br><span class="line">语法: # innobackupex --user=root --password=888 --incremental /xtrabackup --incremental-basedir=/xtrabackup/完全备份目录（周二）</span><br><span class="line"><span class="meta">	#</span><span class="bash">&gt;&gt;&gt; 3.修改当前系统时间：</span></span><br><span class="line">[root@mysql-server ~]# date 07172358</span><br><span class="line">2024年 07月 17日 星期三 23:58:00 CST</span><br><span class="line"><span class="meta">	#</span><span class="bash">&gt;&gt;&gt; 4.在登陆MySQL服务器，插入测试数据</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert <span class="keyword">in</span> to test01.t1(id) values(2);  <span class="comment">#插入数据2，模拟周二</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from test01.t1;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 差异备份周二（基于周一完整备份实现）</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --user=root --password='1' --incremental /xtrabackup/ --incremental-basedir=/xtrabackup/2024-07-16_23-56-32/  #备份目录基于周一完整的备份</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看备份目录</span></span><br><span class="line">[root@mysql-server ~]# ll /xtrabackup/</span><br><span class="line">2024-07-16_23-56-32</span><br><span class="line">2024-07-18_00-02-09</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 5.再次登陆mysql,插入测试数据</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into test01.t1(id) values(3); <span class="comment">#插入数据，模拟周四</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from test01.test01;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 6.在次修改时间</span></span><br><span class="line">[root@mysql-server ~]# date 07192358</span><br><span class="line">2024年 07月 19日 星期五 23:58:00 CST</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 7.再次差异备份（基于周一完整备份）</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --user=root --password='1' --incremental /xtrabackup/ --incremental-basedir=/xtrabackup/2024-07-16_23-56-32/  #还是基于周一的备份</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 8.延申到周三</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> insert into test01.t1(id) values(4);</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from test01.t1;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 9.修改当前系统时间</span></span><br><span class="line">[root@mysql-server ~]# date 07202358</span><br><span class="line">2024年 07月 20日 星期六 23:58:00 CST</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 10.差异备份三</span></span><br><span class="line">[root@mysql-server ~]# innobackupex  --user=root --password='1' --incremental /xtrabackup/ --incremental-basedir=/xtrabackup/2024-07-16_23-56-32/  #还是基于周一的备份</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 11.查看一下备份目录</span></span><br><span class="line">[root@mysql-server ~]# ll /xtrabackup/</span><br><span class="line">drwxr-x--- 8 root root 233 7月  16 23:56 2024-07-16_23-56-32  周一</span><br><span class="line">drwxr-x--- 8 root root 259 7月  18 00:02 2024-07-18_00-02-09  周二</span><br><span class="line">drwxr-x--- 8 root root 259 7月  19 23:59 2024-07-19_23-58-59  周三</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">差异备份恢复流程</span><br><span class="line">1. 停止数据库</span><br><span class="line">2. 清理环境</span><br><span class="line">3. 重演回滚redo log（周一，某次差异）－－&gt; 恢复数据</span><br><span class="line">4. 修改权限</span><br><span class="line">5. 启动数据库</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 停止数据库</span></span><br><span class="line">[root@mysql-server ~]# systemctl stop mysqld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 删除脏数据</span></span><br><span class="line">[root@mysql-server ~]# rm -rf /var/lib/mysql/* /var/log/mysqld.log </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 1.恢复全量的redo <span class="built_in">log</span></span></span><br><span class="line">语法: # innobackupex --apply-log --redo-only /xtrabackup/完全备份目录(周一)</span><br><span class="line">[root@mysql-server ~]# innobackupex  --apply-log --redo-only /xtrabackup/2024-07-16_23-56-32/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 2.恢复差异的redo <span class="built_in">log</span></span></span><br><span class="line">语法:# innobackupex --apply-log --redo-only /xtrabackup/完全备份目录（周一）--incremental-dir=/xtrabacku/某个差异备份</span><br><span class="line">这里我们恢复周三的差异备份</span><br><span class="line">[root@mysql-server ~]# innobackupex --apply-log --redo-only /xtrabackup/2024-07-16_23-56-32/  --incremental-dir=/xtrabackup/2024-07-20_23-58-20/    #我们恢复周三的差异备份</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 3.恢复数据</span></span><br><span class="line">语法:# innobackupex --copy-back /xtrabackup/完全备份目录（周一）</span><br><span class="line">[root@mysql-server ~]# innobackupex  --copy-back /xtrabackup/2024-07-16_23-56-32/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 修改权限（属主和属组）：</span></span><br><span class="line">[root@mysql-server ~]# chown -R mysql.mysql /var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 启动MySQL服务</span></span><br><span class="line">[root@mysql-server ~]# systemctl start mysqld</span><br></pre></td></tr></table></figure>

<p>登陆mysql查看一下:</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407170019354.png" alt="img"></p>
<hr>
<h3 id="10-5-5-mysqldump逻辑备份-—-推荐优先使用"><a href="#10-5-5-mysqldump逻辑备份-—-推荐优先使用" class="headerlink" title="10.5.5 mysqldump逻辑备份   —- 推荐优先使用"></a>10.5.5 mysqldump逻辑备份   —- 推荐优先使用</h3><p>mysqldump 是 MySQL 自带的逻辑备份工具。可以保证数据的一致性和服务的可用性。</p>
<p>如何保证数据一致?在备份的时候进行锁表会自动锁表。锁住之后在备份。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">本身为客户端工具:</span><br><span class="line">远程备份语法: # mysqldump  -h 服务器  -u用户名  -p密码   数据库名  &gt; 备份文件.sql</span><br><span class="line">本地备份语法: # mysqldump  -u用户名  -p密码   数据库名  &gt; 备份文件.sql</span><br></pre></td></tr></table></figure>

<h5 id="1-常用备份选项"><a href="#1-常用备份选项" class="headerlink" title="1.常用备份选项"></a><strong>1.常用备份选项</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-A, --all-databases #备份所有库</span><br><span class="line"></span><br><span class="line">-B, --databases  #备份多个数据库</span><br><span class="line"></span><br><span class="line">-F, --flush-logs #备份之前刷新binlog日志</span><br><span class="line"></span><br><span class="line">--default-character-set #指定导出数据时采用何种字符集，如果数据表不是采用默认的latin1字符集的话，那么导出时必须指定该选项，否则再次导入数据后将产生乱码问题。</span><br><span class="line"></span><br><span class="line">--no-data，-d #不导出任何数据，只导出数据库表结构。</span><br><span class="line"></span><br><span class="line">--lock-tables #备份前，锁定所有数据库表</span><br><span class="line"></span><br><span class="line">--single-transaction #保证数据的一致性和服务的可用性</span><br><span class="line"></span><br><span class="line">-f, --force #即使在一个表导出期间得到一个SQL错误，继续。</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用 mysqldump 备份数据库时避免锁表:</span></span><br><span class="line">对一个正在运行的数据库进行备份请慎重！！ 如果一定要在服务运行期间备份，可以选择添加 --single-transaction选项，</span><br><span class="line"></span><br><span class="line">类似执行： mysqldump --single-transaction -u root -p123456 dbname &gt; mysql.sql</span><br></pre></td></tr></table></figure>

<h5 id="2-备份表"><a href="#2-备份表" class="headerlink" title="2.备份表"></a>2.备份表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 语法: <span class="comment"># mysqldump -u root -p1 数据库  表1 &gt; /db1.t1.bak</span></span></span><br><span class="line">[root@mysql-server ~]# mkdir /home/back  #创建备份目录</span><br><span class="line">[root@mysql-server ~]# mysqldump -uroot -p'1' company employee5 &gt; /home/back/company.employee5.bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 备份多个表：</span></span><br><span class="line">语法格式: mysqldump -u root -p1 数据库 表一 表二 &gt; /db1.t1_t2.bak</span><br><span class="line">[root@mysql-server ~]# mysqldump -uroot -p'1' company new_t1 new_t2  &gt; /home/back/company.new_t1_t2.bak</span><br></pre></td></tr></table></figure>

<h5 id="3、备份库"><a href="#3、备份库" class="headerlink" title="3、备份库"></a>3、备份库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 备份一个库：相当于将这个库里面的所有表全部备份。</span></span><br><span class="line">语法: # mysqldump -u root -p1 数据库1 &gt; /db1.bak</span><br><span class="line">[root@mysql-server ~]# mysqldump -uroot -p'1' company &gt; /home/back/company.bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 备份多个库：</span></span><br><span class="line">语法：mysqldump  -u root -p1 -B  数据库1 数据库2 数据库3 &gt; /db123.bak</span><br><span class="line">[root@mysql-server ~]# mysqldump -uroot -p'1' -B company testdb &gt; /home/back/company_testdb.bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 备份所有的库：</span></span><br><span class="line">语法：# mysqldump  -u root -p1 -A &gt; /alldb.bak</span><br><span class="line">[root@mysql-server ~]# mysqldump -uroot -p'1' -A &gt; /home/back/allbase.bak</span><br></pre></td></tr></table></figure>

<p>到目录下面查看一下：</p>
<p><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/1566293795577.png" alt="1566293795577"></p>
<h5 id="4、恢复数据库和表"><a href="#4、恢复数据库和表" class="headerlink" title="4、恢复数据库和表"></a>4、恢复数据库和表</h5><p>​        为保证数据一致性，应在恢复数据之前停止数据库对外的服务,停止binlog日志 因为binlog使用binlog日志恢复数据时也会产生binlog日志。</p>
<p><strong>为实验效果先将刚才备份的数据库和表删除了。登陆数据库：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# mysql -uroot -p1</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show databases;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/1566294122629.png" alt="1566294122629"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database company;</span><br><span class="line">mysql&gt; exit;</span><br></pre></td></tr></table></figure>

<h5 id="5、恢复库"><a href="#5、恢复库" class="headerlink" title="5、恢复库"></a>5、恢复库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 登陆mysql创建一个库</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database company;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 恢复数据</span></span><br><span class="line">[root@mysql-server ~]# mysql -uroot -p'1' company &lt; /home/back/company.bak</span><br></pre></td></tr></table></figure>

<h5 id="6、恢复表"><a href="#6、恢复表" class="headerlink" title="6、恢复表"></a>6、恢复表</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 登陆到刚才恢复的库中将其中的一个表删除掉</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show databases;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use company</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show tables;</span></span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_company |</span><br><span class="line">+-------------------+</span><br><span class="line">| employee5         |</span><br><span class="line">| new_t1            |</span><br><span class="line">| new_t2            |</span><br><span class="line">+-------------------+</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> drop table employee5;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 开始恢复:</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> sql_log_bin=0;   <span class="comment">#停止binlog日志</span></span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">source</span> /home/back/company.employee5.bak;  -------加路径和备份的文件 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 恢复方式二：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql -u root -p1  db1  &lt; db1.t1.bak</span></span><br><span class="line">                     库名    备份的文件路径</span><br></pre></td></tr></table></figure>

<h5 id="7、备份及恢复表结构"><a href="#7、备份及恢复表结构" class="headerlink" title="7、备份及恢复表结构"></a>7、备份及恢复表结构</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 1.备份表结构：</span></span><br><span class="line">语法：mysqldump  -uroot -p123456 -d 数据库 表名 &gt; dump.sql</span><br><span class="line">[root@mysql-server ~]# mysqldump -uroot -p'1' -d company employee5 &gt; /home/back/emp.bak</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 恢复表结构：登陆数据库创建一个库</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database t1;</span></span><br><span class="line">语法：# mysql -u root -p1 -D 数据库  &lt; db1.t1.bak</span><br><span class="line">[root@mysql-server ~]# mysql -uroot -p'1' -D t1 &lt; /home/back/emp.bak</span><br></pre></td></tr></table></figure>

<p><strong>登陆数据查看：</strong></p>
<p><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/1566295893236.png" alt="1566295893236"></p>
<h5 id="8、数据的导入导出-没有表结构。"><a href="#8、数据的导入导出-没有表结构。" class="headerlink" title="8、数据的导入导出,没有表结构。"></a>8、数据的导入导出,没有表结构。</h5><p>​        表的导出和导入只备份表内记录，不会备份表结构，需要通过mysqldump备份表结构，恢复时先恢复表结构，再导入数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">"secure_file_priv"</span>;  ----查询导入导出的目录。</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/1566299268619.png" alt="1566299268619"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">修改安全文件目录：</span><br><span class="line">1.创建一个目录：mkdir  路径目录</span><br><span class="line">[root@mysql-server ~]# mkdir /sql</span><br><span class="line">2.修改权限</span><br><span class="line">[root@mysql-server ~]# chown mysql.mysql /sql</span><br><span class="line">3.编辑配置文件：</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">在[mysqld]里追加</span><br><span class="line">secure_file_priv=/sql</span><br><span class="line">4.重新启动mysql.</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.导出数据</span><br><span class="line">登陆数据查看数据</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show databases;    <span class="comment">#找到test库</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> use <span class="built_in">test</span>   <span class="comment">#进入test库</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show tables;  <span class="comment">#找到它t3表</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from t3 into outfile <span class="string">'/sql/test.t3.bak'</span>;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2.数据的导入</span><br><span class="line">先将原来表里面的数据清除掉，只保留表结构</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> delete from t3;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> load data infile <span class="string">'/sql/test.t3.bak'</span> into table t3;</span></span><br><span class="line">如果将数据导入别的表，需要创建这个表并创建相应的表结构。</span><br></pre></td></tr></table></figure>

<h4 id="5、通过binlog恢复"><a href="#5、通过binlog恢复" class="headerlink" title="5、通过binlog恢复"></a>5、通过binlog恢复</h4><p>开启binlog日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# vim /etc/my.cnf</span><br><span class="line">log-bin=/var/log/sql-bin/mylog</span><br><span class="line">server-id=1</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172205457.png" alt="1566533393301"></p>
<p>创建目录并修改权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# mkdir /var/log/sql-bin</span><br><span class="line">[root@mysql-server ~]# chown mysql.mysql /var/log/sql-bin</span><br><span class="line">[root@mysql-server ~]# systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172205280.png" alt="1566533482923"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush logs; <span class="comment">#刷新binlog日志会截断产生新的日志文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table testdb.t3(id int);   <span class="comment">#创建一个表</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172205413.png" alt="1566533650005"></p>
<p>根据位置恢复</p>
<p>找到要恢复的sql语句的起始位置、结束位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server sql-bin]# mysqlbinlog mylog.000002</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172205246.png" alt="1566533960687"></p>
<p>测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-server ~]# mysql -uroot -p'1'</span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 将这个表删除</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> drop table testdb.t3;  </span></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 恢复：</span></span><br><span class="line">[root@mysql-server ~]# cd /var/log/sql-bin/</span><br><span class="line">[root@mysql-server sql-bin]# mysqlbinlog --start-position 219 --stop-position 321 mylog.000002 | mysql -uroot -p'1'</span><br></pre></td></tr></table></figure>

<p>查看：</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172205992.png" alt="1566534248132"></p>
<h1 id="Day05"><a href="#Day05" class="headerlink" title="Day05"></a>Day05</h1><h1 id="十一、mysql优化"><a href="#十一、mysql优化" class="headerlink" title="十一、mysql优化"></a>十一、mysql优化</h1><ul>
<li><strong>选择合适的数据类型及字符集</strong>：使用合适的数据类型可以减少存储空间和提高查询速度。这个可不能小看，数据量到达一个量级，这个就能看出明显差异。</li>
<li><strong>避免使用SELECT *</strong>：仅选择必要的列，减少数据传输量。</li>
<li><strong>合理使用JOIN、避免子查询</strong>：避免过多的 JOIN 操作，尽量减少数据集的大小。</li>
<li><strong>使用UNION代替OR、优化ORDER BY和GROUP BY</strong>：确保 <code>ORDER BY</code> 和 <code>GROUP BY</code> 的列上有索引。</li>
<li><strong>避免使用%开头的LIKE查询</strong>：避免使用 <code>%</code> 开头的 <code>LIKE</code> 查询，因为不能使用索引。</li>
<li><strong>使用批量插入、优化INSERT操作</strong>：使用批量插入减少插入操作的开销。</li>
<li><strong>使用查询缓存</strong>：使用查询缓存，减少重复查询的开销。</li>
<li><strong>调整innodb_buffer_pool_size</strong>：<code>innodb_buffer_pool_size</code> 是 InnoDB 存储引擎最重要的配置参数之一，用于指定 InnoDB 缓冲池的大小。缓冲池用于缓存数据页、索引页和 InnoDB 表的其它信息。合理设置这个参数对数据库性能有很大影响。</li>
<li><strong>调整query_cache_size</strong>：<code>query_cache_size</code> 是用于指定查询缓存的大小。查询缓存可以缓存 SELECT 查询的结果，避免重复执行相同的查询，从而提高性能。</li>
<li><strong>调整thread_cache_size</strong>：增大线程缓存大小，减少线程创建开销。</li>
<li><strong>调整table_open_cache</strong>：增大表缓存大小，减少表打开的开销。</li>
<li><strong>调整tmp_table_size和max_heap_table_size</strong>：增大临时表和堆表的最大大小，减少磁盘 I/O。</li>
<li><strong>调整innodb_flush_log_at_trx_commit</strong>：根据需求调整日志刷新策略，权衡性能和数据安全性。</li>
<li><strong>调整innodb_log_file_size</strong>：增大日志文件大小，减少日志文件切换的开销。</li>
<li><strong>调整innodb_log_buffer_size</strong>：增大日志缓冲区大小，提高写入性能。</li>
<li><strong>调整innodb_io_capacity</strong>：根据磁盘 I/O 性能调整 InnoDB I/O 容量。</li>
<li><strong>调整max_connections</strong>：增大最大连接数，支持更多并发连接。</li>
<li><strong>调整sort_buffer_size</strong>：增大排序缓冲区大小，提高排序操作的性能。</li>
<li><strong>调整read_buffer_size</strong>：增大读缓冲区大小，提高顺序扫描性能。</li>
<li><strong>在常用查询条件和连接条件的列上建立索引</strong>：只要发现查询较慢，优先检查where条件后面，有没有被创建索引。</li>
<li><strong>避免在索引列上进行计算</strong></li>
<li><strong>避免重复索引</strong>：检查并删除重复的索引，减少维护开销。了解mysql底层的都知道，创建索引，就会增加一个页，重复索引无疑是给增加负担。</li>
<li><strong>更新频繁的列慎用索引</strong>：对于更新频繁的列，索引会增加写操作的开销，需要慎重使用。</li>
<li><strong>避免过多的列使用复合索引</strong>：复合索引的列数不要太多，列数过多会增加索引的维护开销，并且可能导致索引文件过大。对此可以拆分为较少复合索引和单个索引</li>
<li><strong>使用覆盖索引</strong>：如果查询的所有列都在索引中，那么可以避免回表，提高性能。</li>
<li><strong>避免使用SELECT DISTINCT</strong>：在没有必要的情况下避免使用 <code>SELECT DISTINCT</code>，因为它会导致额外的排序操作，增加查询的开销。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">引擎：</span><br><span class="line">查看引擎：</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show engines;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> SHOW VARIABLES LIKE <span class="string">'%storage_engine%'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show create table t1;   ---查看建表信息</span></span><br><span class="line"></span><br><span class="line">临时指定引擎：</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create table innodb1(id int)engine=innodb;</span></span><br><span class="line">修改默认引擎： </span><br><span class="line">/etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">default-storage-engine=INNODB  ----引擎</span><br><span class="line">修改已经存在的表的引擎：</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> alter table t2 engine=myisam;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">优化：</span><br><span class="line"></span><br><span class="line">调优思路：</span><br><span class="line">    1.数据库设计与规划--以后再修该很麻烦，估计数据量，使用什么存储引擎</span><br><span class="line">    2.数据的应用--怎样取数据，sql语句的优化</span><br><span class="line">    3.mysql服务优化--内存的使用，磁盘的使用</span><br><span class="line">    4.操作系统的优化--内核</span><br><span class="line">    5.升级硬件设备</span><br><span class="line">    6.创建索引提升查询速度</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql常用命令：</span><br><span class="line">    mysql&gt; show warnings    查看最近一个sql语句产生的错误警告，看其他的需要看.err日志</span><br><span class="line">    mysql&gt; show processlist 显示系统中正在运行的所有进程。</span><br><span class="line">    mysql&gt; show errors   查看最近一个sql语句产生的错误信息</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">字符集设置</span><br><span class="line">    临时：</span><br><span class="line">        mysql&gt; create database db1 CHARACTER SET = utf8;</span><br><span class="line">        mysql&gt; create table t1(id int(10)) CHARACTER SET = utf8;      </span><br><span class="line">        </span><br><span class="line">          5.7/ 5.5版本设置：</span><br><span class="line">            [mysqld]</span><br><span class="line">            character_set_server = utf8</span><br><span class="line">===========================================================================================</span><br><span class="line">慢查询：  </span><br><span class="line">  查看是否设置成功：</span><br><span class="line">    mysql&gt; show variables like '%query%';</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">当连接数的数值过小会经常出现ERROR 1040: Too many connections错误。</span><br><span class="line">这是是查询数据库当前设置的最大连接数</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show variables like <span class="string">'%max_connections%'</span>;</span></span><br><span class="line"></span><br><span class="line">强制限制mysql资源设置:</span><br><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/my.cnf</span></span><br><span class="line">max_connections = 1024  并发连接数，根据实际情况设置连接数。</span><br><span class="line">connect_timeout= 5   单位秒 ----超时时间，默认30秒</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">innodb引擎：       </span><br><span class="line">   innodb-buffer-pool-size   //缓存 InnoDB 数据和索引的内存缓冲区的大小</span><br><span class="line">innodb-buffer-pool-size=#   ----值     </span><br><span class="line">        这个值设得越高,访问表中数据需要得磁盘 I/O 越少。在一个专用的数据库服务器上,你可以设置这个参数达机器物理内存大小的 80%。</span><br><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/my.cnf</span></span><br><span class="line">innodb-buffer-pool-size=2G</span><br></pre></td></tr></table></figure>



<h1 id="十二、AB复制"><a href="#十二、AB复制" class="headerlink" title="十二、AB复制"></a>十二、AB复制</h1><h2 id="12-1-什么是主从复制"><a href="#12-1-什么是主从复制" class="headerlink" title="12.1 什么是主从复制?"></a>12.1 什么是主从复制?</h2><p>​    <strong>主从复制，是用来建立一个和主数据库完全一样的数据库环境，称为从数据库；主数据库一般是准实时的业务数据库。</strong></p>
<p>​    MySQL 主从复制（Master-Slave Replication）是一种数据复制技术，用于在多个数据库服务器之间的数据同步。在主从复制架构中，一个服务器被设置为主服务器（Master），充当数据源，其他服务器被设置为从服务器（Slave），用来复制主服务器的数据。</p>
<p><strong>主从复制的作用</strong></p>
<ol>
<li><strong>高可用性</strong>：通过将主数据库的数据复制到一个或多个从数据库，可以在<strong>主数据库故障时快速切换到从数据库</strong>，以实现系统的高可用性和容错能力，从而保证系统的持续可用性。 </li>
<li><strong>提高整体性能和吞吐量</strong>：通过将读请求分散到多个从服务器上进行处理，从而减轻了主服务器的负载压力，提高数据库系统的整体性能和吞吐量。主服务器主要负责写操作，而从服务器主要负责读操作，从而分担了主服务器的压力。</li>
<li><strong>数据备份和恢复</strong>：通过主从同步，可以将主服务器上的数据异步复制到从服务器上，从而实现数据备份和灾难恢复的需求。在应对意外数据丢失、灾难恢复或误操作时，可以使用从服务器作为数据的备份源来进行数据恢复。</li>
</ol>
<p>总结：</p>
<ul>
<li><strong>解决数据可靠性的问题需要用到主从同步；</strong></li>
<li><strong>解决 MySQL 服务高可用要用到主从同步；</strong></li>
<li><strong>应对高并发的时候，还是要用到主从同步。</strong></li>
</ul>
<h2 id="12-2-主从复制原理"><a href="#12-2-主从复制原理" class="headerlink" title="12.2 主从复制原理"></a>12.2 主从复制原理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">原理：</span><br><span class="line">实现整个主从复制，需要由slave服务器上的IO进程和Sql进程共同完成.</span><br><span class="line">要实现主从复制，首先必须打开Master端的binary log（bin-log）功能，因为整个MySQL复制过程实际上就是Slave从Master端获取相应的二进制日志，然后再在自己slave端完全顺序的执行日志中所记录的各种操作。</span><br><span class="line">===========================================</span><br><span class="line">1. 在主库上把数据更改（DDL DML DCL）记录到二进制日志（Binary Log）中。</span><br><span class="line">2. 备库I/O线程将主库上的日志复制到自己的中继日志（Relay Log）中。</span><br><span class="line">3. 备库SQL线程读取中继日志中的事件，将其重放到备库数据库之上。</span><br><span class="line">===========================================</span><br><span class="line">master   负责写      -----A</span><br><span class="line">slave    relay-log  -----B</span><br><span class="line">I/O      负责通信读取binlog日志</span><br><span class="line">SQL      负责写数据</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172216952.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">步骤一：主库db的更新事件(update、insert、delete)被写到binlog</span><br><span class="line">步骤二：从库发起连接，连接到主库</span><br><span class="line">步骤三：此时主库创建一个binlog dump thread线程，把binlog的内容发送到从库</span><br><span class="line">步骤四：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log.</span><br><span class="line">步骤五：还会创建一个SQL线程，从relay log里面读取内容，将更新内容写入到slave的db.</span><br></pre></td></tr></table></figure>

<h2 id="12-3-主从同步的模式"><a href="#12-3-主从同步的模式" class="headerlink" title="12.3 主从同步的模式"></a>12.3 主从同步的模式</h2><p>MySQL 中主要有以下三种主从复制的模式，分别是全同步复制、异步复制和半同步复制。</p>
<ol>
<li><p><strong>全同步复制</strong>：在全同步复制模式中，主服务器将数据修改操作记录到二进制日志，并等待全部从服务器确认已接收到并应用了这些日志后才继续执行后续操作。</p>
<ol>
<li>优点：数据一致性和可靠性，全部从服务器与主服务器保持同步。如果主服务器故障，应用到从服务器的数据不会丢失。</li>
<li>缺点：由于全同步复制需要等待从服务器的确认，因此相对于其他复制方式，延迟很大。严重影响主服务器的性能。</li>
</ol>
</li>
<li><p><strong>异步复制</strong>：MySQL 主从复制中最常见和默认的模式。在异步复制模式中，主服务器将数据修改操作记录到二进制日志（Binary Log）中，并将日志传输给从服务器。从服务器接收到二进制日志后，会异步地应用这些日志进行数据复制。</p>
</li>
<li><ol>
<li>优点：它的优点是及时响应给使用者，主服务器不会受到从服务器的影响而等待确认，可以提高主服务器的性能。</li>
<li>缺点：由于是异步复制，可能存在数据传输的延迟，且从服务器上的复制过程是不可靠的。如果主服务器故障，尚未应用到从服务器的数据可能会丢失。</li>
</ol>
</li>
<li><p><strong>半同步复制</strong>：半同步复制是 MySQL 主从复制中的一种增强模式。在半同步复制模式中，主服务器将数据修改操作记录到二进制日志，并等待至少一个从服务器确认已接收到并应用了这些日志后才继续执行后续操作。</p>
</li>
<li><ol>
<li>优点：可以提供更高的数据一致性和可靠性，确保至少一个从服务器与主服务器保持同步。如果主服务器故障，已经确认接收并应用到从服务器的数据不会丢失。</li>
<li>缺点：由于半同步复制需要等待从服务器的确认，因此相对于异步复制，会增加一定的延迟，可能会影响主服务器的性能。</li>
</ol>
</li>
</ol>
<p>如果对数据一致性和可靠性要求较高，可以考虑使用半同步复制或者全同步；如果对延迟和主服务器性能要求较高，可以继续使用异步复制，根据实际需求调整复制模式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">面试：</span><br><span class="line">1.主从复制延迟大比较慢原因：</span><br><span class="line">主服务器配置高，从服务器的配置低。</span><br><span class="line">并发量大导致主服务器读的慢。从服务器写的慢</span><br><span class="line">网络延迟比较高</span><br><span class="line">从服务器的读写速度慢</span><br><span class="line">2.从数据库的读的延迟问题了解吗？如何解决？</span><br><span class="line">解决方法：</span><br><span class="line">半同步复制—解决数据丢失的问题</span><br><span class="line">并行复制—-解决从库复制延迟的问题</span><br></pre></td></tr></table></figure>

<h2 id="12-4-M-S-架构GTID-基于事务ID复制"><a href="#12-4-M-S-架构GTID-基于事务ID复制" class="headerlink" title="12.4 M-S 架构GTID 基于事务ID复制"></a>12.4 M-S 架构GTID 基于事务ID复制</h2><h5 id="12-4-1-什么是GTID？"><a href="#12-4-1-什么是GTID？" class="headerlink" title="12.4.1 什么是GTID？"></a>12.4.1 什么是GTID？</h5><p>GTID 的全称是 Global Transaction Identifier，全局事务 ID，当一个事务提交时，就会生成一个 GTID，相当于事务的唯一标识。<br>GTID是用来代替传统复制的方法，GTID复制与普通复制模式的最大不同就是不需要指定二进制文件名和位置。</p>
<h5 id="12-4-2-GTID工作原理"><a href="#12-4-2-GTID工作原理" class="headerlink" title="12.4.2 GTID工作原理"></a>12.4.2 GTID工作原理</h5><ol>
<li>master更新数据时，会在事务前产生GTID，一同记录到binlog日志中。</li>
<li>slave端的i/o 线程将变更的binlog，写入到本地的relay log中。</li>
<li>sql线程从relay log中获取GTID，然后对比slave端的binlog是否有记录。</li>
<li>如果有记录，说明该GTID的事务已经执行，slave会忽略。</li>
<li>如果没有记录，slave就会从relay log中执行该GTID的事务，并记录到binlog。</li>
</ol>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172254813.png" alt="img"></p>
<p>流程：</p>
<ul>
<li>从库 B 指定主库 A，基于主备协议建立连接。</li>
<li>从库 B 把集合 y 发给主库 A。</li>
<li>主库 A 计算出集合 x 和集合 y 的差集，也就是集合 x 中存在，集合 y 中不存在的 GTID 集合。比如集合 x 是 1<del>100，集合 y 是 1</del>90，那么这个差集就是 91~100。这里会判断集合 x 是不是包含有集合 y 的所有 GTID，如果不是则说明主库 A 删除了从库 B 需要的 binlog，主库 A 直接返回错误。</li>
<li>主库 A 从自己的 binlog 文件里面，找到第一个不在集合 y 中的事务 GTID，也就是找到了 91。</li>
<li>主库 A 从 GTID = 91 的事务开始，往后读 binlog 文件，按顺序取 binlog，然后发给 B。</li>
<li>从库 B 的 I/O 线程读取 binlog 文件生成 relay log，SQL 线程解析 relay log，然后执行 SQL 语句。</li>
</ul>
<blockquote>
<p><strong>GTID 方案是通过主库来自动计算位点的，不需要人工去设置位点，对运维人员友好。</strong></p>
</blockquote>
<hr>
<h5 id="12-4-3-部署主从复制（一主一从）"><a href="#12-4-3-部署主从复制（一主一从）" class="headerlink" title="12.4.3 部署主从复制（一主一从）"></a>12.4.3 部署主从复制（一主一从）</h5><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172208619.png" alt="1566361672882"></p>
<ol>
<li><strong>MySQL-master和MySQL-slave所有主机都操作</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 准备环境两台机器，关闭防火墙和selinux。两台机器环境必须一致。时间也得一致</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">disable</span> --now firewalld</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">  vim /etc/hosts</span></span><br><span class="line">192.168.174.210  mysql-master</span><br><span class="line">192.168.174.211  mysql-slave</span><br><span class="line"></span><br><span class="line">[root@mysql-server ~]# scp /etc/hosts mysql-slave:/etc/hosts</span><br><span class="line">[root@mysql-server ~]# ping mysql-slave</span><br><span class="line">PING mysql-slave (192.168.174.211) 56(84) bytes of data.</span><br><span class="line">64 bytes from mysql-slave (192.168.174.211): icmp_seq=1 ttl=64 time=0.524 ms</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 两台机器安装mysql5.7</span></span><br><span class="line">[root@mysql-master ~]# wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">[root@mysql-master ~]# yum -y install mysql-community-server</span><br><span class="line">安装略...</span><br><span class="line">[root@mysql-master ~]# systemctl start mysqld</span><br><span class="line">[root@mysql-master ~]# systemctl enable mysqld</span><br><span class="line">[root@mysql-master ~]# netstat -lntp | grep 3306</span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      11669/mysqld</span><br><span class="line">[root@mysql-slave ~]# netstat -lntp | grep 3306</span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      11804/mysqld</span><br><span class="line">配置并修改密码</span><br><span class="line">略....</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>MySQL-master01配置操作</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; master操作：</span></span><br><span class="line">[root@mysql-master ~]# vim /etc/my.cnf   #在[mysqld]下添加如下内容</span><br><span class="line">server-id=1   #定义server id master必写 </span><br><span class="line">log-bin=mylog #开启binlog日志，master必写</span><br><span class="line">gtid_mode=ON    #开启gtid</span><br><span class="line">enforce_gtid_consistency=1   #强制gtid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 重启MySQL实例</span></span><br><span class="line">[root@mysql-master ~]# systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数解释：</p>
<ul>
<li><code>server-id</code>：指定了当前 MySQL 服务器的唯一标识符（Server ID）。每个 MySQL 服务器都必须有一个唯一的 Server ID。在主从复制中，Slave 服务器根据 Master 的 Server ID 来识别来自不同 Master 的数据变更。这个值在整个复制拓扑结构中必须是唯一的。</li>
<li><code>gtid_mode</code>：启用 GTID 模式。GTID 是用于在分布式数据库系统中唯一标识事务的全局事务标识符。它可以确保主从服务器之间数据一致性，简化配置和管理复制拓扑结构。</li>
<li><code>enforce_gtid_consistency</code>：开启强制 GTID 一致性。强制所有事务必须使用 GTID 标识，以确保主从服务器之间的数据一致性。如果某个事务没有 GTID 标识，MySQL 将不会执行该事务，并且会记录错误。</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 主服务器创建账户：</span></span><br><span class="line">mysql&gt; grant replication  slave,reload,super on *.*  to 'slave'@'%' identified by '1';</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><code>注意：如果不成功删除以前的binlog日志</code></strong></p>
<ul>
<li><code>replication slave</code>：拥有此权限可以查看从服务器，从主服务器读取二进制日志。</li>
<li><code>super权限</code>：允许用户使用修改全局变量的SET语句以及CHANGE  MASTER语句</li>
<li><code>reload权限</code>：必须拥有reload权限，才可以执行flush  [tables | logs | privileges]</li>
</ul>
</blockquote>
<ol start="3">
<li><strong>MySQL-slave01服务器配置</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 修改从服务器配置</span></span><br><span class="line">[root@mysql-slave ~]# vim /etc/my.cnf  #添加如下配置</span><br><span class="line">server-id=2</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 重启MySQL实例</span></span><br><span class="line">[root@mysql-slave ~]# systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数解释：</p>
<ul>
<li><strong><code>master-info-repository=TABLE</code></strong>：将主服务器信息存储在一个表中，而不是传统的文件中。配置 MySQL 将复制过程中的主服务器信息（如复制位置、主服务器的连接信息等）存储在一个表中（<code>mysql.slave_master_info</code> 表）。这种方式比存储在文件中更加可靠和可管理，尤其是在需要备份和恢复时。</li>
<li><strong><code>relay-log-info-repository=TABLE</code></strong>：将中继日志信息存储在一个表中，而不是传统的文件中。 配置 MySQL 将复制过程中的中继日志信息（如当前正在处理的中继日志位置等）存储在一个表中（<code>mysql.slave_relay_log_info</code> 表）。与存储在文件中相比，这种方式可以更容易地进行管理和恢复。</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-slave ~]<span class="comment"># mysql -uroot -p'1'   #登陆mysql</span></span><br><span class="line">mysql&gt; \e</span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span></span><br><span class="line">master_host=<span class="string">'192.168.174.210'</span>,      <span class="comment"># 主ip 地址  最好用域名</span></span><br><span class="line">master_user=<span class="string">'slave'</span>,     <span class="comment"># 主服务上面创建的用户</span></span><br><span class="line">master_password=<span class="string">'1'</span>,  <span class="comment"># 授权密码</span></span><br><span class="line">master_auto_position=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.02 sec)</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172323035.png" alt></p>
<blockquote>
<p>注意：如果使用的克隆机，slave服务器需要先执行<code>mysq&gt; stop slave;</code>，然后删除<code>/var/lib/mysql/auto.cnf</code>UUID文件，然后重启MySQL服务会胜场新的UUID，登录MySQL服务后在执行<code>start slave;</code></p>
</blockquote>
<ol start="4">
<li><strong>MySQL-slave01主机配置</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;   <span class="comment">#启动slave角色</span></span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G  <span class="comment">#查看状态，验证sql和IO是不是yes。</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407172323578.png" alt="1566370807822"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.174.210</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mylog.000001</span><br><span class="line">          Read_Master_Log_Pos: 597</span><br><span class="line">               Relay_Log_File: mysql-slave01-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 802</span><br><span class="line">        Relay_Master_Log_File: mylog.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 597</span><br><span class="line">              Relay_Log_Space: 1017</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: c5552e0d-3ecc-11ef-a940-0050562892cb</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: c5552e0d-3ecc-11ef-a940-0050562892cb:1-2</span><br><span class="line">            Executed_Gtid_Set: c5552e0d-3ecc-11ef-a940-0050562892cb:1-2</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数解释：</p>
<ul>
<li><strong><code>Slave_IO_State</code></strong>：从服务器 I/O 线程的当前状态。<ul>
<li><strong>值</strong>: “Waiting for master to send event” 表示从服务器正在等待主服务器发送新的事件。</li>
</ul>
</li>
<li><strong><code>Master_Host</code></strong>：主服务器的主机名或 IP 地址。<ul>
<li><strong>值</strong>: <code>192.168.174.210</code> 表示主服务器的 IP 地址。</li>
</ul>
</li>
<li><strong><code>Master_User</code></strong>：从服务器用于连接主服务器的用户名。<ul>
<li><strong>值</strong>: <code>slave</code> 表示用于复制连接的用户。</li>
</ul>
</li>
<li><strong><code>Master_Port</code></strong>：主服务器监听的端口。<ul>
<li><strong>值</strong>: <code>3306</code> 是 MySQL 的默认端口。</li>
</ul>
</li>
<li><strong><code>Connect_Retry</code></strong>：从服务器重新尝试连接主服务器的时间间隔（以秒为单位）。<ul>
<li><strong>值</strong>: <code>60</code> 表示每隔 60 秒重新尝试连接。</li>
</ul>
</li>
<li><strong><code>Master_Log_File</code></strong>：从服务器正在读取的主服务器的二进制日志文件。<ul>
<li><strong>值</strong>: <code>mylog.000001</code> 表示当前正在读取的二进制日志文件。</li>
</ul>
</li>
<li><strong><code>Read_Master_Log_Pos</code></strong>：从服务器在主服务器的二进制日志中的读取位置。<ul>
<li><strong>值</strong>: <code>597</code> 表示读取到的二进制日志位置。</li>
</ul>
</li>
<li><strong><code>Relay_Log_File</code></strong>：当前正在处理的中继日志文件。<ul>
<li><strong>值</strong>: <code>mysql-slave01-relay-bin.000002</code> 表示当前的中继日志文件。</li>
</ul>
</li>
<li><strong><code>Relay_Log_Pos</code></strong>：从服务器在中继日志中的当前处理位置。<ul>
<li><strong>值</strong>: <code>802</code> 表示处理到的中继日志位置。</li>
</ul>
</li>
<li><strong><code>Relay_Master_Log_File</code></strong>：从服务器当前正在处理的主服务器的二进制日志文件。<ul>
<li><strong>值</strong>: <code>mylog.000001</code> 表示主服务器的二进制日志文件。</li>
</ul>
</li>
<li><strong><code>Slave_IO_Running</code></strong>：从服务器的 I/O 线程状态。<ul>
<li><strong>值</strong>: <code>Yes</code> 表示 I/O 线程正在运行。</li>
</ul>
</li>
<li><strong><code>Slave_SQL_Running</code></strong>：从服务器的 SQL 线程状态。<ul>
<li><strong>值</strong>: <code>Yes</code> 表示 SQL 线程正在运行。</li>
</ul>
</li>
<li><strong><code>Last_Errno</code></strong>：SQL 线程遇到的最后一个错误的错误号。<ul>
<li><strong>值</strong>: <code>0</code> 表示没有错误。</li>
</ul>
</li>
<li><strong><code>Last_Error</code></strong>：SQL 线程遇到的最后一个错误的错误信息。<ul>
<li><strong>值</strong>: 空白，表示没有错误信息。</li>
</ul>
</li>
<li><strong><code>Exec_Master_Log_Pos</code></strong>：从服务器已执行的主服务器二进制日志的位置。<ul>
<li><strong>值</strong>: <code>597</code> 表示已执行的位置。</li>
</ul>
</li>
<li><strong><code>Relay_Log_Space</code></strong>：中继日志文件的总大小（以字节为单位）。<ul>
<li><strong>值</strong>: <code>1017</code> 表示中继日志的大小。</li>
</ul>
</li>
<li><strong><code>Until_Condition</code></strong>： 复制停止的条件。<ul>
<li><strong>值</strong>: <code>None</code> 表示没有设置停止条件。</li>
</ul>
</li>
<li><strong><code>Seconds_Behind_Master</code></strong>：从服务器落后主服务器的时间（以秒为单位）。<ul>
<li><strong>值</strong>: <code>0</code> 表示从服务器与主服务器同步。</li>
</ul>
</li>
<li><strong><code>Master_SSL_Allowed</code></strong>：是否允许使用 SSL 连接主服务器。<ul>
<li><strong>值</strong>: <code>No</code> 表示不使用 SSL。</li>
</ul>
</li>
<li><strong><code>Last_IO_Errno</code></strong>： I/O 线程遇到的最后一个错误的错误号。<ul>
<li><strong>值</strong>: <code>0</code> 表示没有错误。</li>
</ul>
</li>
<li><strong><code>Last_IO_Error</code></strong>： I/O 线程遇到的最后一个错误的错误信息。<ul>
<li><strong>值</strong>: 空白，表示没有错误信息。</li>
</ul>
</li>
<li><strong><code>Master_Server_Id</code></strong>：主服务器的 Server ID。<ul>
<li><strong>值</strong>: <code>1</code> 表示主服务器的唯一标识符。</li>
</ul>
</li>
<li><strong><code>Master_UUID</code></strong>： 主服务器的 UUID（唯一标识符）。<ul>
<li><strong>值</strong>: <code>c5552e0d-3ecc-11ef-a940-0050562892cb</code> 表示主服务器的 UUID。</li>
</ul>
</li>
<li><strong><code>Master_Info_File</code></strong>：存储主服务器信息的文件或表。<ul>
<li><strong>值</strong>: <code>mysql.slave_master_info</code> 表示使用表存储主服务器信息。</li>
</ul>
</li>
<li><strong><code>Retrieved_Gtid_Set</code></strong>：从主服务器检索到的 GTID 集合。<ul>
<li><strong>值</strong>: <code>c5552e0d-3ecc-11ef-a940-0050562892cb:1-2</code> 表示检索到的 GTID 集合。</li>
</ul>
</li>
<li><strong><code>Executed_Gtid_Set</code></strong>： 从服务器已执行的 GTID 集合。<ul>
<li><strong>值</strong>: <code>c5552e0d-3ecc-11ef-a940-0050562892cb:1-2</code> 表示已执行的 GTID 集合。</li>
</ul>
</li>
<li><strong><code>Auto_Position</code></strong>： 是否启用了自动位置（基于 GTID 的复制）。<ul>
<li><strong>值</strong>: <code>1</code> 表示启用了 GTID 自动位置。</li>
</ul>
</li>
<li><strong><code>SQL_Delay</code></strong>： SQL 线程的延迟时间。<ul>
<li><strong>值</strong>: <code>0</code> 表示没有延迟。</li>
</ul>
</li>
<li><strong><code>SQL_Remaining_Delay</code></strong>：SQL 线程的剩余延迟时间。<ul>
<li><strong>值</strong>: <code>NULL</code> 表示没有延迟。</li>
</ul>
</li>
<li><strong><code>Slave_SQL_Running_State</code></strong>：SQL 线程的当前状态。<ul>
<li><strong>值</strong>: “Slave has read all relay log; waiting for more updates” 表示从服务器已读取所有中继日志，正在等待更多更新。</li>
</ul>
</li>
<li><strong><code>Master_Retry_Count</code></strong>：主服务器重试连接次数。<ul>
<li><strong>值</strong>: <code>86400</code> 表示最大重试次数。</li>
</ul>
</li>
</ul>
</blockquote>
<ol start="5">
<li><strong>MySQL-master01 写入数据测试</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-mater01 mysql]<span class="comment"># mysql -uroot -p'1' -e 'create database test12;'</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>MySQL-slave01查看数据是否同步</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-slave01 ~]# mysql -uroot -p'1'  -e 'show databases;'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">| test10             |</span><br><span class="line">| test11             |</span><br><span class="line">| test12             |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>

<p><strong>主从同步完成。</strong></p>
<blockquote>
<p> 注意: </p>
<p>​        在关闭和启动mysql服务的时候按顺序先启动master。可以测试，先将slave库停掉，再停止master库。启动先启动master库，再启动slave库，如果数据没发生改变，也就意味着binlog日志位置没有变化，主从理论上不会失效。</p>
</blockquote>
<p><strong>面试题</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql主从，master宕机，如何进行切换？</span><br><span class="line">主机故障或者宕机：</span><br><span class="line"></span><br><span class="line">1)在salve执行：</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> stop slave；</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> reset master；</span></span><br><span class="line">2)查看是否只读模式：show variables like 'read_only';</span><br><span class="line">只读模式需要修改my.cnf文件，注释read-only=1并重启mysql服务。</span><br><span class="line">或者不重启使用命令关闭只读，但下次重启后失效：set global read_only=off;</span><br><span class="line">3)查看show slave status \G;</span><br><span class="line">4)在程序中将原来主库IP地址改为现在的从库IP地址，测试应用连接是否正常</span><br></pre></td></tr></table></figure>



<h2 id="12-5-主从复制binlog日志方式"><a href="#12-5-主从复制binlog日志方式" class="headerlink" title="12.5 主从复制binlog日志方式"></a>12.5 主从复制binlog日志方式</h2><ol>
<li><strong>MySQL-master01和MySQL-slave01所有主机配置</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 添加本地解析</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.246.135    mysql-master</span><br><span class="line">192.168.246.136    mysql-slave</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 两台主机都安装MySQL服务</span></span><br><span class="line">略</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>开始配置主服务</strong></p>
<p>主服务器上，必须启用二进制日志记录并配置唯一的服务器ID。需要重启服务器。</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-master01 ~]# vim /etc/my.cnf</span><br><span class="line">log-bin=mysql</span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 重启MySQL</span></span><br><span class="line">[root@mysql-master01 ~]# systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>MySQL-master01创建主从同步用户</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.*  TO  &#39;repl&#39;@&#39;%&#39;  identified by &#39;1&#39;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>MySQL-master01查看二进制日志偏移量</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status\G</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407211428585.png" alt="img"></p>
<ol start="5">
<li><strong>MySQL-slave01配置server-id</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 修改MySQL主配置文件</span></span><br><span class="line">[root@mysql-slave01 ~]# vim /etc/my.cnf</span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 重启服务</span></span><br><span class="line">[root@mysql-slave ~]# systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 添加主从同步用户</span></span><br><span class="line">[root@mysql-slave ~]# mysql -uroot -p'1'</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> \e</span></span><br><span class="line">CHANGE MASTER TO</span><br><span class="line">MASTER_HOST='mysql-master01',   # MySQL-master01主机地址</span><br><span class="line">MASTER_USER='repl',           # 主动同步用户</span><br><span class="line">MASTER_PASSWORD='1',  # 密码</span><br><span class="line">MASTER_LOG_FILE='mysql.000001',  # 二进制文件名称</span><br><span class="line">MASTER_LOG_POS=581;           # 二进制日志文件偏移量</span><br><span class="line">    -&gt; ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 启动从服务器</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> start slave;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看主从同步状态</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407211437630.png" alt="img"></p>
<ol start="6">
<li><strong>MySQL-master01创建测试数据</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database testdb;   <span class="comment">#创建一个库</span></span></span><br><span class="line">Query OK, 1 row affected (0.10 sec)</span><br></pre></td></tr></table></figure>

<p>故障排错</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### UUID一致，导致主从复制I/O线程不是yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different <span class="keyword">for</span> replication to work</span></span><br><span class="line"></span><br><span class="line">致命错误：由于master和slave具有相同的mysql服务器uuid，导致I/O线程不进行；这些uuid必须不同才能使复制工作。</span><br><span class="line"></span><br><span class="line">问题提示主从使用了相同的server UUID，一个个的检查：</span><br><span class="line"></span><br><span class="line">检查主从server_id</span><br><span class="line"></span><br><span class="line">主库：</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">  show variables like <span class="string">'server_id'</span>;</span></span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| server_id     | 1     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">从库：</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">  show variables like <span class="string">'server_id'</span>;</span></span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| server_id     | 2     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">server_id不一样，排除。</span><br><span class="line"></span><br><span class="line">检查主从状态：</span><br><span class="line"></span><br><span class="line">主库：</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show master status;</span></span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000001 |      154 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">从库：</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show master status;</span></span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000001 |      306 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">File一样，排除。</span><br><span class="line"></span><br><span class="line">最后检查发现他们的auto.cnf中的server-uuid是一样的。。。</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# vim /var/lib/mysql/auto.cnf</span><br><span class="line"></span><br><span class="line">[auto]</span><br><span class="line"></span><br><span class="line">server-uuid=4f37a731-9b79-11e8-8013-000c29f0700f</span><br><span class="line"></span><br><span class="line">修改uuid并重启服务</span><br></pre></td></tr></table></figure>

<h2 id="12-6-基于Gtid日志方式实现互为主从"><a href="#12-6-基于Gtid日志方式实现互为主从" class="headerlink" title="12.6 基于Gtid日志方式实现互为主从"></a>12.6 基于Gtid日志方式实现互为主从</h2><ol>
<li>MySQL-master01和MySQL-slave01操作</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 修改MySQL-slave01主机名</span></span><br><span class="line">[root@mysql-slave01 ~]<span class="comment"># hostnamectl  set-hostname mysql-master02</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 两台主机修改本地解析</span></span><br><span class="line">$ vim /etc/hosts</span><br><span class="line">192.168.174.210  mysql-master01</span><br><span class="line">192.168.174.211  mysql-master02</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>MySQL-master01 配置文件修改</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; MySQL配置文件修改</span></span><br><span class="line">[root@mysql-master01 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">server-id=1   <span class="comment">#定义server id master必写 </span></span><br><span class="line"><span class="built_in">log</span>-bin=mylog <span class="comment">#开启binlog日志，master必写</span></span><br><span class="line">gtid_mode=ON    <span class="comment">#开启gtid</span></span><br><span class="line">enforce_gtid_consistency=1   <span class="comment">#强制gtid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启MySQL实例</span></span><br><span class="line">[root@mysql-master01 ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>MySQL-master01 创建主从复制用户</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建同步用户</span></span><br><span class="line">mysql&gt; grant replication  slave,reload,super on *.*  to 'slave'@'%' identified by '1';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 刷新权限</span></span><br><span class="line">mysql&gt;  flush privileges;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>MySQL-master01备份数据（可选）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-master01 ~]<span class="comment"># mysqldump -p'1' --all-databases --single-transaction --master-data=2 --flush-logs &gt; `date +%F-%H`-mysql-all.sql</span></span><br><span class="line"></span><br><span class="line">[root@mysql-master01 ~]<span class="comment"># scp 2024-07-21-21-mysql-all.sql  mysql-master02:~</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>MySQL-master02 配置文件修改</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; MySQL配置文件修改</span></span><br><span class="line">[root@mysql-master02 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">server-id=2   <span class="comment">#定义server id master必写 </span></span><br><span class="line"><span class="built_in">log</span>-bin=mylog <span class="comment">#开启binlog日志，master必写</span></span><br><span class="line">gtid_mode=ON    <span class="comment">#开启gtid</span></span><br><span class="line">enforce_gtid_consistency=1   <span class="comment">#强制gtid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启MySQL实例</span></span><br><span class="line">[root@mysql-master02 ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>MySQL-master02配置同步用户</strong></li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; \e</span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span></span><br><span class="line">master_host=<span class="string">'192.168.174.210'</span>,      <span class="comment"># 主ip 地址  最好用域名</span></span><br><span class="line">master_user=<span class="string">'slave'</span>,     <span class="comment"># 主服务上面创建的用户</span></span><br><span class="line">master_password=<span class="string">'1'</span>,  <span class="comment"># 授权密码</span></span><br><span class="line">master_auto_position=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动slave</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看复制状态</span></span><br><span class="line">mysql&gt; show slave status;</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407212152795.png" alt="img"></p>
<ol start="7">
<li><strong>MySQL-master01 插入测试数据</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 测试</span></span><br><span class="line">mysql&gt; create database test20;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="8">
<li><strong>MySQL-master02 查看是否同步</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">| test20             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>同步完成，一主一从搭建完成</p>
</blockquote>
<hr>
<ol>
<li><strong>MySQL-master02操作</strong></li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建同步用户</span></span><br><span class="line">mysql&gt; grant replication  slave,reload,super on *.*  to 'slave'@'%' identified by '1';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 刷新权限</span></span><br><span class="line">mysql&gt;  flush privileges;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>MySQL-master01操作</strong></li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; \e</span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span></span><br><span class="line">master_host=<span class="string">'192.168.174.211'</span>,</span><br><span class="line">master_user=<span class="string">'slave'</span>,</span><br><span class="line">master_password=<span class="string">'1'</span>,</span><br><span class="line">master_auto_position=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动slave</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看slave状态</span></span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407212200417.png" alt="img"></p>
<ol start="3">
<li><strong>MySQL-master02 插入测试数据</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test30;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>MySQL-master01 查看是否同步</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| test30             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>MySQL-master01 插入测试数据</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test31;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>MySQL-master02 查看是否同步数据</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| test30             |</span><br><span class="line">| test31             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示：如果MySQL-master01同步状态不佳，重启一下MySQL-master02的mysqld，再去master2上。启动和停止从属状态。<br>start slave;<br>stop slave;</p>
</blockquote>
<h2 id="12-7-基于GTID实现双主双从"><a href="#12-7-基于GTID实现双主双从" class="headerlink" title="12.7 基于GTID实现双主双从"></a>12.7 基于GTID实现双主双从</h2><p><strong><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/1.png" class></strong></p>
<ol>
<li>所有主机修改本地解析</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br><span class="line">192.168.174.210 mysql-master01</span><br><span class="line">192.168.174.211 mysql-master02</span><br><span class="line">192.168.174.212 mysql-slave01</span><br><span class="line">192.168.174.213 mysql-slave02</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>MySQL-master01配置文件配置</li>
</ol>
<p>​        略</p>
<ol start="3">
<li>MySQL-master01 创建同步用户</li>
</ol>
<p>​        略</p>
<ol start="4">
<li>MySQL-master02 配置文件修改</li>
</ol>
<p>​        略</p>
<ol start="5">
<li>MySQL-master02 创建同步用户</li>
</ol>
<p>​        略</p>
<ol start="6">
<li>MySQL-master01和MySQL-master02实现互为主从</li>
</ol>
<p>​        略</p>
<ol start="7">
<li>MySQL-slave01配置文件修改</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-slave01 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">server-id=3</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启mysql实例</span></span><br><span class="line">[root@mysql-slave01 ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>MySQL-slave02配置文件修改</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-slave01 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">server-id=4</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency=1</span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启mysql实例</span></span><br><span class="line">[root@mysql-slave01 ~]<span class="comment"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>

<ol start="9">
<li>MySQL-master01 备份所有数据</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -p<span class="string">'1'</span> --all-databases --single-transaction --master-data=2  --flush-logs &gt; `date +%F`-mysql-all.sql</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>MySQL-master01将备份数据传输至MySQL-slave01和MySQL-slave02</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-master01 ~]<span class="comment"># scp 2024-07-21-mysql-all.sql  mysql-slave01:~</span></span><br><span class="line"></span><br><span class="line">[root@mysql-master01 ~]<span class="comment"># scp 2024-07-21-mysql-all.sql  mysql-slave02:~</span></span><br></pre></td></tr></table></figure>

<ol start="11">
<li>MySQL-slave导入数据</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql-slave01 ~]<span class="comment"># mysql -p'1' &lt; 2024-07-21-mysql-all.sql </span></span><br><span class="line"></span><br><span class="line">[root@mysql-slave02 ~]<span class="comment"># mysql -p'1' &lt; 2024-07-21-mysql-all.sql</span></span><br></pre></td></tr></table></figure>

<ol start="12">
<li>MySQL-slave01 配置同步用户信息</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 将MySQL-master01设为主节点</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host='mysql-master01',</span><br><span class="line">master_user='slave',</span><br><span class="line">master_password='1',</span><br><span class="line">master_auto_position=1 for channel 'mysql-master01';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 将MySQL-master02设为主节点</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host='mysql-master02',</span><br><span class="line">master_user='slave',</span><br><span class="line">master_password='1',</span><br><span class="line">master_auto_position=1 for channel 'mysql-master02';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动slave</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看slave状态</span></span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407212234050.png" alt="img"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407212234774.png" alt="img"></p>
<blockquote>
<p>提示：<code>FOR CHANNEL &#39;mysql-master01&#39;</code>：指定复制通道的名称。</p>
<p><code>&#39;mysql-master1&#39;</code>：通道名称。MySQL 支持多源复制（即一个从服务器可以从多个主服务器复制数据），每个通道可以用于不同的主服务器。此选项用于多源复制环境中，标识具体的复制通道。</p>
</blockquote>
<ol start="13">
<li>MySQL-slave02 配置同步用户信息</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 将MySQL-master01设为主节点</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host='mysql-master01',</span><br><span class="line">master_user='slave',</span><br><span class="line">master_password='1',</span><br><span class="line">master_auto_position=1 for channel 'mysql-master01';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 将MySQL-master02设为主节点</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host='mysql-master02',</span><br><span class="line">master_user='slave',</span><br><span class="line">master_password='1',</span><br><span class="line">master_auto_position=1 for channel 'mysql-master02';</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动slave</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看slave状态</span></span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407212239073.png" alt="img"></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407212239236.png" alt="img"></p>
<ol start="14">
<li>MySQL-mater01插入测试数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test32;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="15">
<li>MySQL-master02 查看同步数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">| test30             |</span><br><span class="line">| test31             |</span><br><span class="line">| test32             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">13 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ol start="16">
<li>MySQL-slave01 查看同步数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">| test30             |</span><br><span class="line">| test31             |</span><br><span class="line">| test32             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ol start="17">
<li>MySQL-slave02 查看同步数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| emp01              |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| study              |</span><br><span class="line">| sys                |</span><br><span class="line">| test30             |</span><br><span class="line">| test31             |</span><br><span class="line">| test32             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="17-8-MySQL主从复制面试题"><a href="#17-8-MySQL主从复制面试题" class="headerlink" title="17.8 MySQL主从复制面试题"></a>17.8 MySQL主从复制面试题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 如何查看MySQL主从之间的数据延迟多大？</span><br><span class="line">答： 使用`SHOW SLAVE STATUS\G`查看`Seconds_Behind_Master`延迟时间。</span><br><span class="line"></span><br><span class="line">2. 如何解决主从数据没有一致的问题？</span><br><span class="line">答：首先，使用 SHOW SLAVE STATUS\G 命令检查从服务器的复制状态，关注以下关键字段：</span><br><span class="line">`Slave_IO_Running` 和 `Slave_SQL_Running：`都应为 Yes。`Last_IO_Error `和 `Last_SQL_Error`：应为空。`Seconds_Behind_Master：`应尽量接近于 0。如果主从数据延迟过大，推荐主机进行备份，从机导入数据。采用GTID模式（全局事务标识符）。可以使用 pt-table-checksum 和 pt-table-sync 工具查找主库和从库的不一致数据，并恢复。</span><br></pre></td></tr></table></figure>



<h1 id="十三、读写分离"><a href="#十三、读写分离" class="headerlink" title="十三、读写分离"></a>十三、读写分离</h1><h2 id="13-1-什么是读写分离"><a href="#13-1-什么是读写分离" class="headerlink" title="13.1 什么是读写分离"></a><strong>13.1 什么是读写分离</strong></h2><p>​    <strong>在数据库集群架构中，让主库负责处理写入操作，而从库只负责处理select查询，让两者分工明确达到提高数据库整体读写性能。</strong>当然，主数据库另外一个功能就是负责将数据变更同步到从库中，也就是写操作。</p>
<h2 id="13-2-读写分离的好处"><a href="#13-2-读写分离的好处" class="headerlink" title="13.2 读写分离的好处"></a>13.2 读写分离的好处</h2><ol>
<li>分摊服务器压力，提高机器的系统处理效率</li>
<li>在写入不变，大大分摊了读取，提高了系统性能。另外，当读取被分摊后，又间接提高了写入的性能。所以，总体性能提高了。</li>
<li>增加冗余，提高服务可用性，当一台数据库服务器宕机后可以调整另外一台从库以最快速度恢复服务</li>
</ol>
<h2 id="13-3-MySQL中间件"><a href="#13-3-MySQL中间件" class="headerlink" title="13.3 MySQL中间件"></a>13.3 MySQL中间件</h2><p>Mycat 是“一个开源的数据库系统”，但是由于真正的数据库需要存储引擎，而 Mycat 并没有存 储引擎，所以并不是完全意义的数据库系统。 那么 Mycat 是什么？<strong>Mycat 是数据库中间件，就是介于数据库与应用之间，进行数据处理与交互的中间服务；是实现对主从数据库的读写分离、读的负载均衡。</strong></p>
<p><strong>常见的数据库中间件:</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407222206699.png" alt="1566542554311"></p>
<h2 id="13-4-Mycat部署"><a href="#13-4-Mycat部署" class="headerlink" title="13.4 Mycat部署"></a>13.4 Mycat部署</h2><p>MyCAT 是使用 JAVA 语言进行编写开发，使用前需要先安装 JAVA 运行环境(JRE),由于 MyCAT 中使用了 JDK7 中的一些特性，所以要求必须在 JDK7 以上的版本上运行。</p>
<ol>
<li><strong>所有主机本地解析</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]# vim /etc/hosts</span><br><span class="line">192.168.174.210  mysql-master01</span><br><span class="line">192.168.174.211  mysql-slave01</span><br><span class="line">192.168.174.215  mycat</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>架构</strong></li>
</ol>
<p>这里是在mysql主从复制实现的基础上，利用mycat做读写分离，架构图如下</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407222206470.png" alt="image-20200820164322240"></p>
<p><strong><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/2.png" class></strong></p>
<ol start="3">
<li><strong>安装jdk</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 解压安装包</span></span><br><span class="line">[root@mycat ~]# tar xzf jdk-8u221-linux-x64.tar.gz -C /usr/local/ &amp;&amp; cd /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 更改目录名称</span></span><br><span class="line">[root@mycat local]# mv jdk1.8.0_221/ java </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 设置全局环境变量</span></span><br><span class="line">[root@mycat local]# vim /etc/profile.d/jdk.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">JAVA_HOME=/usr/local/java</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export JAVA_HOME  PATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 重新加载</span></span><br><span class="line">[root@mycat local]# source /etc/profile.d/jdk.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 测试服务</span></span><br><span class="line">[root@mycat local]# java -version</span><br><span class="line">java version "1.8.0_211"</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br><span class="line"></span><br><span class="line">[root@mycat local]# echo $PATH</span><br><span class="line">/usr/local/java/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>



<ol start="4">
<li><strong>部署MyCat</strong></li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/MOHJlLCIdeMhUMIrHyFh7twcAQppt0hSSvpicaU51nib3iaiato5libwsFPgfmhibHqcx1x2lwaxncCwq8cIMcpw9jxg/640?wx_fmt=png&wxfrom=13&tp=wxpic" alt="图片"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 下载</span></span><br><span class="line">[root@mycat ~]# wget http://dl.mycat.io/1.6.5/Mycat-server-1.6.5-release-20180122220033-linux.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 解压</span></span><br><span class="line">[root@mycat ~]# tar xf Mycat-server-1.6.5-release-20180122220033-linux.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>



<ol start="5">
<li><strong>配置mycat前端</strong><code>server.xml</code><br><strong><img src="/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/3.png" class></strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyCAT 目前主要通过配置文件的方式来定义逻辑库和相关配置:</span><br><span class="line"></span><br><span class="line">[root@mycat conf]# vim  /usr/local/mycat/conf/server.xml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该文件定义用户以及系统相关变量，如端口等。其中用户信息是前端应用程序连接 mycat 的用户信息</p>
</blockquote>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407211609013.png" alt="img"></p>
<p><strong>将此5行配置注释：Mycat提供两个账号，一个管理员，一个普通用户，将普通用户配置信息注释</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407211610848.png" alt="img"></p>
<p><strong>配置MyCat超级管理员用户</strong></p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407211619119.png" alt="image-20240721161923051"></p>
<blockquote>
<p><code>name=&quot;root&quot;</code> : Mycat超级管理员用户名<br><code>name=&quot;password&quot;&gt;123456&lt;</code>：MyCat超级管理员密码。默认：123456<br><code>name=&quot;schemas&quot;&gt;maoxiansheng&lt;</code>：默认前端展示数据库 ,<strong>当用户访问时默认展示的库；但不代表后端数据库真正有这个数据库。</strong></p>
</blockquote>
<ol start="6">
<li><p><strong>MyCat后端配置</strong><code>schema.xml</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 备份数据文件</span></span><br><span class="line">[root@mycat conf]<span class="comment"># cp /usr/local/mycat/conf/schema.xml /root </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改后端配置文件</span></span><br><span class="line">[root@mycat ~]<span class="comment"># vim /usr/local/mycat/conf/schema.xml</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407211703353.png" alt="image-20240721170303264"></p>
</li>
</ol>
<p><strong>两主两从从配置文件如下：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mycat</span>:schema <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"schema.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">"http://io.mycat/"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"maoxiansheng"</span> <span class="attr">checkSQLschema</span>=<span class="string">"false"</span> <span class="attr">sqlMaxLimit</span>=<span class="string">"100"</span> <span class="attr">dataNode</span>=<span class="string">"dn1"</span> &gt;</span><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">"dn1"</span> <span class="attr">dataHost</span>=<span class="string">"localhost1"</span> <span class="attr">database</span>=<span class="string">"maoxiansheng"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">"localhost1"</span> <span class="attr">maxCon</span>=<span class="string">"1000"</span> <span class="attr">minCon</span>=<span class="string">"10"</span> <span class="attr">balance</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">writeType</span>=<span class="string">"0"</span> <span class="attr">dbType</span>=<span class="string">"mysql"</span> <span class="attr">dbDriver</span>=<span class="string">"native"</span> <span class="attr">switchType</span>=<span class="string">"1"</span>  <span class="attr">slaveThreshold</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"mysql-master01"</span> <span class="attr">url</span>=<span class="string">"192.168.174.210:3306"</span> <span class="attr">user</span>=<span class="string">"mycatproxy"</span> <span class="attr">password</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">"mysql-slave01"</span> <span class="attr">url</span>=<span class="string">"192.168.174.212:3306"</span> <span class="attr">user</span>=<span class="string">"mycatproxy"</span> <span class="attr">password</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">"mysql-slave02"</span> <span class="attr">url</span>=<span class="string">"192.168.174.213:3306"</span> <span class="attr">user</span>=<span class="string">"mycatproxy"</span> <span class="attr">password</span>=<span class="string">"1"</span> /&gt;</span>                       <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">"mysql-master02"</span> <span class="attr">url</span>=<span class="string">"192.168.174.211:3306"</span> <span class="attr">user</span>=<span class="string">"mycatproxy"</span> <span class="attr">password</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">"mysql-slave01"</span> <span class="attr">url</span>=<span class="string">"192.168.174.212:3306"</span> <span class="attr">user</span>=<span class="string">"mycatproxy"</span> <span class="attr">password</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">"mysql-slave02"</span> <span class="attr">url</span>=<span class="string">"192.168.174.213:3306"</span> <span class="attr">user</span>=<span class="string">"mycatproxy"</span> <span class="attr">password</span>=<span class="string">"1"</span> /&gt;</span>                       <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以下是配置文件中的每个部分的配置块儿</p>
<p><strong>逻辑库和分表设置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;schema name&#x3D;&quot;maoxiansheng&quot;           &#x2F;&#x2F; 逻辑库名称,与server.xml的一致</span><br><span class="line">        checkSQLschema&#x3D;&quot;false&quot;    &#x2F;&#x2F; 不检查sql</span><br><span class="line">        sqlMaxLimit&#x3D;&quot;100&quot;         &#x2F;&#x2F; 最大连接数</span><br><span class="line">        dataNode&#x3D;&quot;dn1&quot;&gt;        &#x2F;&#x2F;  数据节点名称       </span><br><span class="line">&lt;&#x2F;schema&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>name=&quot;maoxiansheng&quot;</code>：定义了 MyCAT 中的逻辑库名为 <code>maoxiansheng</code>。</p>
<p><code>checkSQLschema=&quot;false&quot;</code>：禁用 SQL 语句中的 schema 校验。关闭后端MySQL库的校验，不需要。</p>
<p><code>sqlMaxLimit=&quot;100&quot;</code>：限制单次查询返回的最大行数为 100。俗称最大连接数。</p>
<p><code>dataNode=&quot;dn1&quot;</code>：指定该逻辑库的数据节点为 <code>dn1</code>。</p>
</blockquote>
<p><strong>数据节点</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataNode name&#x3D;&quot;dn1&quot;             &#x2F;&#x2F; 此数据节点的名称</span><br><span class="line">          dataHost&#x3D;&quot;localhost1&quot;     &#x2F;&#x2F; 主机组虚拟的</span><br><span class="line">          database&#x3D;&quot;maoxiansheng&quot; &#x2F;&gt;  &#x2F;&#x2F; 真实的数据库名称</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>name=&quot;dn1&quot;</code>：定义数据节点的名称为 <code>dn1</code>。和前端的数据架构中的<code>dataNode=&quot;dn1&quot;</code>进行关联。</p>
<p><code>dataHost=&quot;localhost1&quot;</code>：指定虚拟数据节点组为 <code>localhost1</code>。</p>
<p><code>database=&quot;maoxiansheng&quot;</code>：指定在 <code>localhost1</code> 主机上的实际数据库名为 <code>maoxiansheng</code>。</p>
</blockquote>
<p><strong>主机组</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataHost name&#x3D;&quot;localhost1&quot;                       &#x2F;&#x2F; 主机组</span><br><span class="line">          maxCon&#x3D;&quot;1000&quot; minCon&#x3D;&quot;10&quot;               &#x2F;&#x2F; 连接</span><br><span class="line">          balance&#x3D;&quot;1&quot;                             &#x2F;&#x2F; 负载均衡</span><br><span class="line">          writeType&#x3D;&quot;0&quot;                           &#x2F;&#x2F; 写模式配置</span><br><span class="line">          dbType&#x3D;&quot;mysql&quot; dbDriver&#x3D;&quot;native&quot;        &#x2F;&#x2F; 数据库配置</span><br><span class="line">          switchType&#x3D;&quot;1&quot;  slaveThreshold&#x3D;&quot;100&quot;&gt;</span><br><span class="line">&lt;!--这里可以配置关于这个主机组的成员信息，和针对这些主机的健康检查语句--&gt;</span><br><span class="line">&lt;&#x2F;dataHost&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>name=&quot;localhost1&quot;</code>：定义数据主机的名称为 <code>localhost1</code>。需要和<code>dataNode中的dataHost名称保持一致，与之关联。</code></p>
<p><code>maxCon=&quot;1000&quot;</code>：指定该后端数据主机的最大连接数为 1000。</p>
<p><code>minCon=&quot;10&quot;</code>：指定该数据主机的最小连接数为 10。</p>
<p><code>balance=&quot;0&quot;</code>：负载均衡策略，<code>0</code> 表示不启用。</p>
<p><code>writeType=&quot;0&quot;</code>：写操作的类型，<code>0</code> 表示主库写入。</p>
<p><code>dbType=&quot;mysql&quot;</code>：数据库类型为 MySQL。</p>
<p><code>dbDriver=&quot;native&quot;</code>：使用 MySQL 原生驱动。</p>
<p><code>switchType=&quot;1&quot;</code>：主从切换策略（切换类型），<code>1</code> 表示自动切换。根据延迟时间自动切换。</p>
<p><code>slaveThreshold=&quot;100&quot;</code>：从库的负载阈值100毫秒，超过这个时间范围则自动切换。</p>
</blockquote>
<p><code>balance 属性</code>负载均衡类型,目前的取值有 3 种:</p>
<ol>
<li><strong>balance=”0”：</strong> 不开启读写分离机制,所有读操作都发送到当前可用的 writeHost 上。</li>
<li><strong>balance=”1”</strong>：全部的 readHost 与  writeHost 参与 select 语句的负载均衡,简单的说,当双主双从模式(M1-&gt;S1,M2-&gt;S2,并且 M1 与 M2 互为主备),正常情况下,M2,S1,S2 都参与 select 语句的负载均衡。</li>
<li><strong>balance=”2”：</strong> 所有读操作都随机的在 writeHost、readhost 上分发。</li>
<li><strong>balance=”3”：</strong> 所有读请求随机的分发到 wiriterHost 对应的 readhost 执行,writerHost 不负担读压力, 注意 balance=3 只在 1.4 及其以后版本有,1.3 没有。</li>
</ol>
<p><code>writeType 属性</code>负载均衡类型</p>
<ol>
<li><strong>writeType=”0”：</strong> 所有写操作发送到配置的第一个 writeHost,第一个挂了切换到还生存的第二个writeHost,重新启动后已切换后的为准.</li>
<li><strong>writeType=”1”：</strong>所有写操作都随机的发送到配置的 writeHost,版本1.5 以后废弃不推荐。</li>
</ol>
<p><strong>健康检查</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;heartbeat&gt;select user()&lt;&#x2F;heartbeat&gt;	#对后端数据进行检测，执行一个sql语句，user()内部函数</span><br></pre></td></tr></table></figure>

<p><strong>读写配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;writeHost host&#x3D;&quot;hostM1&quot; url&#x3D;&quot;192.168.246.135:3306&quot; user&#x3D;&quot;mycat&quot; password&#x3D;&quot;ldq@12345!&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">&lt;readHost host&#x3D;&quot;hostS2&quot; url&#x3D;&quot;192.168.246.136:3306&quot; user&#x3D;&quot;mycat&quot; password&#x3D;&quot;ldq@12345!&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;writeHost&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&lt;writeHost&gt;</code></p>
<p><code>host=&quot;mysql-master01&quot;</code>：定义主库的名称为 <code>mysql-master01</code>。</p>
<p><code>url=&quot;192.168.174.210:3306&quot;</code>：主库的连接地址。</p>
<p><code>user=&quot;mycat&quot;</code>：用于连接主库的用户名。</p>
<p><code>password=&quot;1&quot;</code>：用于连接主库的密码。</p>
<hr>
<p><code>&lt;readHost&gt;</code></p>
<p><code>host=&quot;mysql-slave01&quot;</code>：定义从库的名称为 <code>mysql-slave01</code>。</p>
<p><code>url=&quot;192.168.174.211:3306&quot;</code>：从库的连接地址。</p>
<p><code>user=&quot;mycat&quot;</code>：用于连接从库的用户名。</p>
<p><code>password=&quot;1&quot;</code>：用于连接从库的密码。</p>
</blockquote>
<ol start="7">
<li><strong>在真实的MySQL-master01 数据库上给用户授权</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all on *.* to &#39;mycatproxy&#39;@&#39;%&#39; identified by &#39;1&#39;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li><strong>在mycat的机器上面测试mycatproxy用户登录：</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 安装mysql的客户端：</span></span><br><span class="line">[root@mycat ~]# yum install -y mysql</span><br><span class="line">[root@mycat ~]# mysql -umycatproxy -p'1' -h mysql-master</span><br></pre></td></tr></table></figure>

<ol start="9">
<li><strong>启动Mycat</strong>：启动之前需要调整JVM</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; jvm调优</span></span><br><span class="line">[root@mycat mycat]# cd conf/</span><br><span class="line">[root@mycat conf]# vim wrapper.conf  #在设置JVM哪里添加如下内容</span><br><span class="line">wrapper.startup.timeout=300 //超时时间300秒 </span><br><span class="line">wrapper.ping.timeout=120</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 启动mycat</span></span><br><span class="line">[root@mycat conf]# /usr/local/mycat/bin/mycat start     #需要稍微等待一会</span><br><span class="line">Starting Mycat-server...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看mycat是否启动</span></span><br><span class="line">[root@mycat ~]# jps   </span><br><span class="line">13377 WrapperSimpleApp</span><br><span class="line">13431 Jps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看mycat端口</span></span><br><span class="line">[root@mycat ~]# netstat -lntp | grep java</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407230043071.png" alt="1566551127109"></p>
<ol start="10">
<li>MySQL-master01 创建测试数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database maoxiansheng;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>测试mycat<code>（mysql-master01节点测试）</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 将master当做mycat的客户端</span></span><br><span class="line">[root@mysql-master01 ~]# mysql -uroot -p123456 -P 8066 -h mycat</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202407230046635.png" alt="img"></p>
<ol start="12">
<li><strong>连接mycat输入测试语句</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use maoxiansheng;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> t1(<span class="keyword">id</span> <span class="built_in">int</span>);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1(id) values(1);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ol start="13">
<li>MySQL-slave01 查看数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from maoxiansheng.t1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试成功</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果在show table报错：</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show tables;</span></span><br><span class="line">ERROR 3009 (HY000): java.lang.IllegalArgumentException: Invalid DataSource:0</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">解决方式：</span><br><span class="line">登录master服务将mycat的登录修改为%</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> update user <span class="built_in">set</span> Host = <span class="string">'%'</span> <span class="built_in">where</span> User = <span class="string">'mycat'</span> and Host = <span class="string">'localhost'</span>;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line">或者在授权用户mycat权限为*.*</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/">https://l66stbz.github.io/2024/07/23/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fmysql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://l66stbz.github.io" target="_blank">L66</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/07/05/WEB服务器/4.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2024/07/05/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8/"><img class="next_cover" src="https://l66stbz.github.io/2024/07/05/WEB服务器/4.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WEB服务器</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/05/23/基础测试脚本题/" title="基础测试脚本题"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/23/基础测试脚本题/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-23</div><div class="relatedPosts_title">基础测试脚本题</div></div></a></div><div class="relatedPosts_item"><a href="/2024/07/05/WEB服务器/" title="WEB服务器"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/07/05/WEB服务器/4.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-07-05</div><div class="relatedPosts_title">WEB服务器</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/18/Zabbix监控Nginx指标/" title="Zabbix监控Nginx指标"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/18/Zabbix监控Nginx指标/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-18</div><div class="relatedPosts_title">Zabbix监控Nginx指标</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/21/Keepalived/" title="Keepalived"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/21/Keepalived/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-21</div><div class="relatedPosts_title">Keepalived</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/25/shell脚本相关问题/" title="shell脚本相关问题总结"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/25/shell脚本相关问题/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-25</div><div class="relatedPosts_title">shell脚本相关问题总结</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/17/zabbix部署/" title="zabbix部署"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/17/zabbix部署/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-17</div><div class="relatedPosts_title">zabbix部署</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>