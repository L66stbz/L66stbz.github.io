<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kubernetes服务发布 | L66</title><meta name="description" content="kubernetes服务发布[TOC] 前言​        每个Pod都会获取到它自己的IP地址，但是这些IP地址不总是稳定和可依赖的，这样就会导致一个问题：在Kubernetes集群中,如果一组Pod(比如后端的Pod）为其他Pod(比如前端的Pod提供服务，那么如果它们之间使用Pod的IP地址进行通信，在Pod重建后，将无法再进行连接。 ​    于是Kubernetes引用了Service"><meta name="keywords" content="Linux,Kubernetes"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Kubernetes服务发布"><meta name="twitter:description" content="kubernetes服务发布[TOC] 前言​        每个Pod都会获取到它自己的IP地址，但是这些IP地址不总是稳定和可依赖的，这样就会导致一个问题：在Kubernetes集群中,如果一组Pod(比如后端的Pod）为其他Pod(比如前端的Pod提供服务，那么如果它们之间使用Pod的IP地址进行通信，在Pod重建后，将无法再进行连接。 ​    于是Kubernetes引用了Service"><meta name="twitter:image" content="https://l66stbz.github.io/2024/09/17/kubernetes服务发布/04-kubernetes服务发布/1.png"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes服务发布"><meta property="og:url" content="https://l66stbz.github.io/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/"><meta property="og:site_name" content="L66"><meta property="og:description" content="kubernetes服务发布[TOC] 前言​        每个Pod都会获取到它自己的IP地址，但是这些IP地址不总是稳定和可依赖的，这样就会导致一个问题：在Kubernetes集群中,如果一组Pod(比如后端的Pod）为其他Pod(比如前端的Pod提供服务，那么如果它们之间使用Pod的IP地址进行通信，在Pod重建后，将无法再进行连接。 ​    于是Kubernetes引用了Service"><meta property="og:image" content="https://l66stbz.github.io/2024/09/17/kubernetes服务发布/04-kubernetes服务发布/1.png"><meta property="article:published_time" content="2024-09-17T13:50:00.000Z"><meta property="article:modified_time" content="2024-09-26T13:02:57.042Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/"><link rel="prev" title="Kubernetes HPA自动扩缩" href="https://l66stbz.github.io/2024/09/17/kubernetes%20HPA%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9/05-kubernetes%20HPA%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9/"><link rel="next" title="Kubernetes基础资源调度" href="https://l66stbz.github.io/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">67</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">37</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#kubernetes服务发布"><span class="toc-number">1.</span> <span class="toc-text">kubernetes服务发布</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">1.0.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、Service-集群内部通讯流量成为东西流量-svc有ns隔离性"><span class="toc-number">1.0.2.</span> <span class="toc-text">1、Service:集群内部通讯流量成为东西流量(svc有ns隔离性)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-简介"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">1.1 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Kubernetes的服务发现机制"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">1.2 Kubernetes的服务发现机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-环境变量方式"><span class="toc-number">1.0.2.2.1.</span> <span class="toc-text">1.2.1 环境变量方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-DNS方式"><span class="toc-number">1.0.2.2.2.</span> <span class="toc-text">1.2.2 DNS方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-Label和Selector"><span class="toc-number">1.0.2.3.</span> <span class="toc-text">1.3 Label和Selector</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-简介"><span class="toc-number">1.0.2.3.1.</span> <span class="toc-text">1.3.1 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-Label简介"><span class="toc-number">1.0.2.3.1.1.</span> <span class="toc-text">1. Label简介</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-Selector简介"><span class="toc-number">1.0.2.3.1.2.</span> <span class="toc-text">2. Selector简介</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-示例"><span class="toc-number">1.0.2.3.1.3.</span> <span class="toc-text">3. 示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-Service资源创建"><span class="toc-number">1.0.2.4.</span> <span class="toc-text">1.4 Service资源创建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、Service的负载均衡机制"><span class="toc-number">1.0.3.</span> <span class="toc-text">2、Service的负载均衡机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-kube-proxy的代理模式"><span class="toc-number">1.0.3.1.</span> <span class="toc-text">2.1 kube-proxy的代理模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、-Service发布类型"><span class="toc-number">1.0.4.</span> <span class="toc-text">3、 Service发布类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-NodePort类型使用"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">3.1 NodePort类型使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-ExternalName-Service"><span class="toc-number">1.0.4.2.</span> <span class="toc-text">3.2 ExternalName Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Service代理Kubernetes集群之外的服务（重点）"><span class="toc-number">1.0.4.3.</span> <span class="toc-text">3.3 Service代理Kubernetes集群之外的服务（重点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-多端口Service"><span class="toc-number">1.0.4.4.</span> <span class="toc-text">3.4 多端口Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-LoadBalancer类型（公有云使用）"><span class="toc-number">1.0.4.5.</span> <span class="toc-text">3.5 LoadBalancer类型（公有云使用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-Service支持的网络协议"><span class="toc-number">1.0.4.6.</span> <span class="toc-text">3.6 Service支持的网络协议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、Headless-Service的概念和应用"><span class="toc-number">1.0.5.</span> <span class="toc-text">4、Headless Service的概念和应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-Headless-Service设置了Label-Selector"><span class="toc-number">1.0.5.1.</span> <span class="toc-text">4.1 Headless Service设置了Label Selector</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、Ingress：-ingress控制器没有ns隔离性，Ingress有ns隔离性"><span class="toc-number">1.0.6.</span> <span class="toc-text">5、Ingress：(ingress控制器没有ns隔离性，Ingress有ns隔离性)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-前言"><span class="toc-number">1.0.6.1.</span> <span class="toc-text">5.1 前言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-创建Ingress-Controller"><span class="toc-number">1.0.6.2.</span> <span class="toc-text">5.2 创建Ingress Controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-域名发布服务"><span class="toc-number">1.0.6.3.</span> <span class="toc-text">5.3 域名发布服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-1-创建web服务"><span class="toc-number">1.0.6.3.1.</span> <span class="toc-text">5.3.1 创建web服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-2-创建Ingress"><span class="toc-number">1.0.6.3.2.</span> <span class="toc-text">5.3.2 创建Ingress</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-3-路由的匹配方式"><span class="toc-number">1.0.6.3.3.</span> <span class="toc-text">5.3.3 路由的匹配方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-4-不配置域名发布服务-了解"><span class="toc-number">1.0.6.3.4.</span> <span class="toc-text">5.3.4  不配置域名发布服务(了解)</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/09/17/kubernetes服务发布/04-kubernetes服务发布/1.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Kubernetes服务发布</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2024-09-17 21:50:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2024-09-17</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2024-09-26 21:02:57"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2024-09-26</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="kubernetes服务发布"><a href="#kubernetes服务发布" class="headerlink" title="kubernetes服务发布"></a>kubernetes服务发布</h1><p>[TOC]</p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>​        <strong>每个Pod都会获取到它自己的IP地址，但是这些IP地址不总是稳定和可依赖的</strong>，这样就会导致一个问题：在Kubernetes集群中,如果一组Pod(比如后端的Pod）为其他Pod(比如前端的Pod提供服务，那么如果它们之间使用Pod的IP地址进行通信，在Pod重建后，将无法再进行连接。</p>
<p>​    于是Kubernetes引用了Service这样一种抽象概念：逻辑上的一组Pod，即一种可以访问Pod的策略。这一组Pod能够被Service通过<strong>标签选择器</strong>访问到，之后就可以使用Service进行通信，集群内部服务之间的访问通Service的名称来进行通信的，因为service的名称是亘古不变的。Kubernetes的Service定义了一个服务的访问入口地址，前端的应用（Pod）通过这个入口地址访问其背后的一组由Pod副本组成的集群实例，Service 与其后端Pod副本集群之间则是通过Label Selector来实现无缝对接的。</p>
<p>​    既然每个Pod都会被分配一个单独的IP地址，而且每个Pod都提供了一个独立的Endpoint（PodIP+ContainerPort）以被客户端访问，现在多个Pod副本组成了一个集群来提供服务。</p>
<p>​    那么客户端如何来访问它们呢？一般的做法是部署一个负载均衡器（软件或硬件）， 为这组Pod开启一个对外的服务端口，如80端口，并且将这些Pod的Endpoint列表加入80端口的转发列表，客户端就可以通过负载均衡器的对外IP地址+服务端口来访问此服务。 客户端的请求最后会被转发到哪个Pod，由负载均衡器的算法所决定。</p>
<p>​    Kubernetes也遵循上述常规做法，运行在每个Node上的kube-proxy进程其实就是一个智能的软件负载均衡器，负责把对Service的请求转发到后端的某个Pod实例上，并在内部实现服务的负载均衡与会话保持机制。但Kubernetes发明了一种很巧妙又影响深远的设计： Service没有共用一个负载均衡器的IP地址，每个Service都被分配了一个全局唯一的虚拟IP地址，这个虚拟IP被称为Cluster IP。这样一来，每个服务就变成了具备唯一IP地址的通信节点，服务调用就变成了最基础的TCP网络通信问题。</p>
<p>​    Pod的Endpoint地址会随着Pod的销毁和重新创建而发生改变，因为新Pod的IP地址与之前旧Pod的不同。而Service一旦被创建，Kubernetes就会自动为它分配一个可用的Cluster IP，而且在Service的整个生命周期内，它的Cluster IP一般不会发生改变。 于是，服务发现这个棘手的问题在Kubernetes的架构里也得以轻松解决：只要用Service的Name与Service的Cluster IP地址做一个DNS域名映射即可完美解决问题。</p>
<h3 id="1、Service-集群内部通讯流量成为东西流量-svc有ns隔离性"><a href="#1、Service-集群内部通讯流量成为东西流量-svc有ns隔离性" class="headerlink" title="1、Service:集群内部通讯流量成为东西流量(svc有ns隔离性)"></a><strong>1、Service:集群内部通讯流量成为东西流量(svc有ns隔离性)</strong></h3><h4 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h4><p>​    Service是Kubernetes实现微服务架构的核心概念，通过创建Service，可以为一组具有相同功能的容器应用提供一个统一的入口地址，并且将请求负载分发到后端的各个容器应用上。</p>
<p>​    Service用于为一组提供服务的Pod抽象一个稳定的网络访问地址，通过Service的定义设置的访问地址是DNS域名格式的服务名称，对于客户端应用来说，网络访问方式并没有改变（DNS域名的作用等价于主机名、互联网域名或IP地址）。 Service还提供了负载均衡器功能，将客户端请求负载分发到后端提供具体服务的各个Pod上。</p>
<h4 id="1-2-Kubernetes的服务发现机制"><a href="#1-2-Kubernetes的服务发现机制" class="headerlink" title="1.2 Kubernetes的服务发现机制"></a>1.2 Kubernetes的服务发现机制</h4><p>​    服务发现机制指客户端应用在一个Kubernetes集群中如何获知后端服务的访问地址。Kubernetes提供了两种机制供客户端应用以固定的方式获取后端服务的访问地址：环境变量方式和DNS方式</p>
<h5 id="1-2-1-环境变量方式"><a href="#1-2-1-环境变量方式" class="headerlink" title="1.2.1 环境变量方式"></a>1.2.1 环境变量方式</h5><p>​            在一个Pod运行起来的时候，系统会自动为其容器运行环境注入所有集群中有效Service的信息。Service的相关信息包括服务IP、服务端口号、各端口号相关的协议等，通过<strong><code>{SVCNAME}_SERVICE_HOST和 {SVCNAME}_SERVICE_PORT</code></strong>格式进行设置。其中，SVCNAME的命名规则为：将Service的name字符串转换为全大写字母，将中横线“-”替 换为下画线“_”。</p>
<p>假设已经创建一个SVC，进去SVC后端的任意一个Pod中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl exec -it nginx-6dc8dbb669-nf5lm -- sh</span></span><br><span class="line">/ <span class="comment"># env</span></span><br><span class="line"></span><br><span class="line">NGINX_PORT_80_TCP=tcp://10.96.11.64:80</span><br><span class="line">NGINX_SERVICE_HOST=10.96.11.64 <span class="comment"># service的IP地址</span></span><br><span class="line">NGINX_SERVICE_PORT=80		<span class="comment"># service的端口</span></span><br><span class="line">NGINX_PORT=tcp://10.96.11.64:80</span><br><span class="line">NGINX_PORT_80_TCP_ADDR=10.96.11.64</span><br><span class="line">NGINX_PORT_80_TCP_PORT=80</span><br><span class="line">NGINX_PORT_80_TCP_PROTO=tcp</span><br><span class="line"></span><br><span class="line">/ <span class="comment"># curl $NGINX_SERVICE_HOST:$NGINX_SERVICE_PORT</span></span><br></pre></td></tr></table></figure>



<h5 id="1-2-2-DNS方式"><a href="#1-2-2-DNS方式" class="headerlink" title="1.2.2 DNS方式"></a>1.2.2 DNS方式</h5><p>​            DNS方式Service在Kubernetes系统中遵循DNS命名规范，Service的DNS域名表示方法为<code>&lt;servicename&gt;.&lt;namespace&gt;.svc.&lt;clusterdomain&gt;</code>，其中servicename为服务的名称，namespace为其所在namespace的名称， clusterdomain为Kubernetes集群设置的域名后缀（例如cluster.local），服务名称的命名规则遵循gRFC 1123规范的要求。</p>
<p>​            对于客户端应用来说，DNS域名格式的Service名称提供的是稳定、 不变的访问地址，可以大大简化客户端应用的配置，是Kubernetes集群中推荐的使用方式。 当Service以DNS域名形式进行访问时，就需要在Kubernetes集群中存在一个DNS服务器来完成域名到ClusterIP地址的解析工作了，目前由CoreDNS作为Kubernetes集群的默认DNS服务器提供域名解析服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl exec -it nginx-6dc8dbb669-nf5lm -- sh</span></span><br><span class="line"><span class="comment"># 跨命名空间访问</span></span><br><span class="line">/ <span class="comment"># nslookup  metrics-server.kube-system.svc.cluster.local</span></span><br><span class="line">Server:		10.96.0.10</span><br><span class="line">Address:	10.96.0.10:53</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name:	metrics-server.kube-system.svc.cluster.local</span><br><span class="line">Address: 10.96.135.159</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前命名空间访问</span></span><br><span class="line">/ <span class="comment"># nslookup  kubernetes.default.svc.cluster.local</span></span><br><span class="line">Server:		10.96.0.10</span><br><span class="line">Address:	10.96.0.10:53</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name:	kubernetes.default.svc.cluster.local</span><br><span class="line">Address: 10.96.0.1</span><br></pre></td></tr></table></figure>

<h4 id="1-3-Label和Selector"><a href="#1-3-Label和Selector" class="headerlink" title="1.3 Label和Selector"></a>1.3 Label和Selector</h4><h5 id="1-3-1-简介"><a href="#1-3-1-简介" class="headerlink" title="1.3.1 简介"></a>1.3.1 简介</h5><h6 id="1-Label简介"><a href="#1-Label简介" class="headerlink" title="1. Label简介"></a>1. Label简介</h6><p>​    Label（标签）是Kubernetes系统中的另一个核心概念，相当于我们熟悉的“标签”。一个Label是一个<code>key=value键值对</code>，其中的key与value由用户自己指定。Label可以被附加到各种资源对象上，例如Node、 Pod、Service、Deployment等，一个资源对象可以定义任意数量的 Label，同一个Label也可以被添加到任意数量的资源对象上。Label通常在资源对象定义时确定，也可以在对象创建后动态添加或者删除。我们可以通过给指定的资源对象捆绑一个或多个不同的Label来实现多维度的资源分组管理功能，以便灵活、方便地进行资源分配、调度、配置、 部署等管理工作。</p>
<h6 id="2-Selector简介"><a href="#2-Selector简介" class="headerlink" title="2. Selector简介"></a>2. Selector简介</h6><p>​    Label Selector（标签选择器）查询和筛选拥有某些Label的资源对象，Kubernetes通过这种方式实现了类似SQL的简单又通用的对象查询机制。Label Selector可以被类比为SQL语句中的where查询条件，例 如，“name=redis-slave”这个Label  Selector作用于Pod时，可以被类比 为<code>select * from pod where name=&#39;redis-slave&#39;</code>这样的语句。当前有两种Label Selector表达式：基于等式的（Equality-based）Selector表达式和基于集合的（Set-based）Selector表达式。</p>
<p><strong>基于等式的Selector表达式采用等式类表达式匹配标签：</strong></p>
<ul>
<li><p><code>name=redis-slave</code>：匹配所有具有name=redis-slave标签的资源对象。</p>
</li>
<li><p><code>env ！= production</code>：匹配所有不具有env=production标签的资源对象，比如“env=test”就是满足此条件的标签之一。 </p>
</li>
</ul>
<p><strong>基于集合的Selector表达式则使用集合操作类表达式匹配标签：</strong></p>
<ul>
<li><code>name  in (redis-master,redis-slave)</code>：匹配所有具有 name=redis-master标签或者name=redis-slave标签的资源对象。 </li>
<li><code>name not in (php-frontend)</code>：匹配所有不具有name=php-frontend标签的资源对象。</li>
</ul>
<h6 id="3-示例"><a href="#3-示例" class="headerlink" title="3. 示例"></a>3. 示例</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看节点标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get nodes --show-labels</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/2.png" alt="image-20240623121700265"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看符合标签的Pod</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get po -l app=nginx</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/3.png" alt="image-20240623121754690"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 给固定节点打上标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  label  node k8s-node01  k8s-node02 role=node node=work</span></span><br><span class="line">node/k8s-node01 labeled</span><br><span class="line">node/k8s-node02 labeled</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  label  node k8s-master01   role=master</span></span><br><span class="line">node/k8s-master01 labeled</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 过滤节点标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get node --show-labels | grep -i node=work</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 集合查看</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get nodes -l 'role in (master,node)'</span></span><br><span class="line">NAME           STATUS   ROLES    AGE    VERSION</span><br><span class="line">k8s-master01   Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-node01     Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-node02     Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 取反</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get node -l 'role!=master'</span></span><br><span class="line">NAME           STATUS   ROLES    AGE    VERSION</span><br><span class="line">k8s-master02   Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-master03   Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-node01     Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-node02     Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  get node -l 'node!=work,role=master'</span></span><br><span class="line">NAME           STATUS   ROLES    AGE    VERSION</span><br><span class="line">k8s-master01   Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  get node -l 'node!=work,role in (master)'</span></span><br><span class="line">NAME           STATUS   ROLES    AGE    VERSION</span><br><span class="line">k8s-master01   Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  get nodes -l role</span></span><br><span class="line">NAME           STATUS   ROLES    AGE    VERSION</span><br><span class="line">k8s-master01   Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-node01     Ready    &lt;none&gt;   5d1h   v1.23.16</span><br><span class="line">k8s-node02     Ready    &lt;none&gt;   5d1h   v1.23.16</span><br></pre></td></tr></table></figure>

<p><strong>修改标签</strong></p>
<p>​    未修改之前标签</p>
<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/4.png" alt="image-20240623123217515"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 修改指定标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl label node k8s-node01 k8s-node02 node=ssd --overwrite </span></span><br><span class="line">node/k8s-node01 unlabeled</span><br><span class="line">node/k8s-node02 unlabeled</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl label node -l node node=arm --overwrite</span></span><br><span class="line">node/k8s-node01 labeled</span><br><span class="line">node/k8s-node02 labeled</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看新标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get node --show-labels  | grep -i -w node=ssd</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/5.png" alt="image-20240623123405535"></p>
<p><strong>删除标签</strong></p>
<p>​    未删除之前截图</p>
<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/6.png" alt="image-20240623123405535"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 删除标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl label node k8s-node01 k8s-node02 node-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看节点标签</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get node --show-labels</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/7.png" alt="image-20240623123838478"></p>
<h4 id="1-4-Service资源创建"><a href="#1-4-Service资源创建" class="headerlink" title="1.4 Service资源创建"></a>1.4 Service资源创建</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建资源清单</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">cat</span> <span class="string">&gt;&gt;</span> <span class="string">nginx-svc.yaml</span> <span class="string">&lt;&lt;-EOF</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">webapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>       <span class="comment"># pod标签</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span>  <span class="comment"># 协议 </span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span>       <span class="comment"># service的端口</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span>  <span class="comment"># 容器端口号（代理的后端服务对外暴露的端口号）</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>     <span class="comment"># deploy的标签</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span>      <span class="comment"># 副本数</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>   <span class="comment"># pod的标签</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span>  <span class="comment"># pod的标签</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建Service</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">nginx-svc.yaml</span> </span><br><span class="line"><span class="string">service/webapp</span> <span class="string">created</span></span><br><span class="line"><span class="string">deployment.apps/nginx</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看资源</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">-f</span> <span class="string">nginx-svc.yaml</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/8.png" alt="image-20240623002412004"></p>
<p>​      <strong>该示例为<code>webapp:80</code>即可访问到具有<code>app=nginx</code>标签的pod的80端口上</strong></p>
<p>​        需要注意的是，Service能够将一个接收端口映射到任意的targetPort，如果targetPort为空，targetPort将被设置为与Port字段相同的值。targetPort可以设置为一个字符串，引用backendPod的一个端口的名称，这样的话即使更改了Pod的端口，也不会对service的访问造成影响。</p>
<p>​        <strong>Kubernetes Service 能够支持TCP,UDP,SCTP等协议，默认TCP协议</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看携带相同标签的Pod</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get po -l app=nginx</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/9.png" alt="image-20240623002713313"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 访问Service</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># curl 10.96.151.135</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/10.png" alt="image-20240623002843495"></p>
<p>​    <strong>在提供服务的Pod副本集运行过程中，如果Pod列表发生了变化，则Kubernetes的Service控制器会持续监控后端Pod列表的变化，实时更新Service对应的后端Pod列表。一个Service对应的<code>后端</code>由<code>Pod的IP和容器端口号</code>组成，即一个完整的<code>PodIP:ConrainerPort</code>访问地址，这在Kubernetes系统中叫作Endpoint。通过查看Service的详细信息，可以看到其后端Endpoint列表</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master <span class="built_in">test</span>]<span class="comment"># kubectl  describe svc webapp</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/11.png" alt="image-20240623003053059"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看当前命名空间下的endpoints</span></span><br><span class="line">[root@k8s-master <span class="built_in">test</span>]<span class="comment"># kubectl get endpoints</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/12.png" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看其他命名空间下的svc</span></span><br><span class="line">$ kubectl get svc -n kube-system</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/13.png" alt="image-20240623003524545"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 访问其他命令空间下的svc（进入一个其他命名空间下的容器中访问）</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl exec -it nginx-6784b87845-7wbwx -- sh</span></span><br><span class="line">/ <span class="comment"># nslookup metrics-server.kube-system.svc.cluster.local</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/14.png" alt="image-20240623003639887"></p>
<h3 id="2、Service的负载均衡机制"><a href="#2、Service的负载均衡机制" class="headerlink" title="2、Service的负载均衡机制"></a><strong>2、Service的负载均衡机制</strong></h3><p>​        简介：当一个Service对象在Kubernetes集群中被定义出来时，集群内的客户端应用就可以通过服务IP访问到具体的Pod容器提供的服务了。从服务IP到后端Pod的负载均衡机制，则是由每个Node上的kube-proxy负责实现的。对kube-proxy的代理模式、会话保持机制和基于拓扑感知的服务路由机制（EndpointSlices）。</p>
<h4 id="2-1-kube-proxy的代理模式"><a href="#2-1-kube-proxy的代理模式" class="headerlink" title="2.1 kube-proxy的代理模式"></a><strong>2.1 kube-proxy的代理模式</strong></h4><p>​        目前kube-proxy提供了以下代理模式（通过启动参数–proxy-mode设置）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 二进制安装方式查看proxy-mode设置</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># vim /etc/kubernetes/kube-proxy.yaml</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/15.png" alt="image-20240623004009244"></p>
<ul>
<li><strong>iptables模式</strong>：kube-proxy通过设置Linux Kernel的iptables规则， 实现从Service到后端Endpoint列表的负载分发规则，效率很高。但是， 如果某个后端Endpoint在转发时不可用，此次客户端请求就会得到失败的响应，此时应该通过为Pod设置 readinessprobe（服务可用性健康检查）来保证只有达到ready状态的Endpoint才会被设置为Service的后端Endpoint。</li>
<li><strong>ipvs模式</strong>：在Kubernetes 1.11版本中达到Stable阶段，kube-proxy通过设置Linux Kernel的netlink接口设置IPVS规则，转发效率和支持的吞吐率都是最高的。ipvs模式要求Linux Kernel启用IPVS模块，如果操作系统未启用IPVS内核模块，kube-proxy则会自动切换至iptables模式。同时，ipvs模式支持更多的负载均衡策略：<ul>
<li><strong>rr</strong>：round-robin，轮询。</li>
<li><strong>lc</strong>：least connection，最小连接数。</li>
<li><strong>dh</strong>：destination hashing，目的地址哈希。 </li>
<li><strong>sh</strong>：source hashing，源地址哈希。 </li>
<li><strong>sed</strong>：shortest expected delay，最短期望延时。</li>
<li><strong>nq</strong>：never queue，永不排队。</li>
</ul>
</li>
</ul>
<h3 id="3、-Service发布类型"><a href="#3、-Service发布类型" class="headerlink" title="3、 Service发布类型"></a>3、 Service发布类型</h3><ul>
<li><p><code>ClusterIP</code>：Kubernetes默认会自动设置Service的虚拟IP地址,仅可被集群内部的客户端应用访问。</p>
</li>
<li><p><code>NodePort</code>：在所有安装了Kube-Proxy的节点上打开一个端口，此端口可以代理至后端Pod，可以通过NodePort从集群外部访问集群内的服务。</p>
</li>
<li><p><code>LoadBalancer</code>：将Service映射到一个已存在的负载均衡器的IP地址上，通常在公有云环境中使用。</p>
</li>
<li><p><code>ExternalName</code>:将Service映射为一个外部域名地址，通过 externalName字段进行设置。</p>
</li>
</ul>
<p><strong>Service对集群之外暴露服务的主要方式有两种：<code>NodePort</code>和<code>LoadBalancer</code></strong></p>
<ul>
<li><code>NodePort</code>方式的缺点是会占用很多集群机器的端口，那么当集群服务变多的时候，这个缺点就愈发明显</li>
<li>LB方式的缺点是每个service需要一个LB，浪费、麻烦，并且需要kubernetes之外设备的支持</li>
</ul>
<h4 id="3-1-NodePort类型使用"><a href="#3-1-NodePort类型使用" class="headerlink" title="3.1 NodePort类型使用"></a><strong>3.1 NodePort类型使用</strong></h4><p>​    如果将Service的 type字段设置为NodePort，则Kubernetes将从<code>--service-node-port-range</code>参数指定的范围(默认为30000-32767)中自动分配端口，也可以手动指定NodePort，创建该Service后，集群每个节点都将暴露一个端口，通过某个宿主机的IP+端口即可访问到后端的应用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 二进制安装查看service的NodePort网段地址</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># grep "service-node-port-range" /usr/lib/systemd/system/kube-apiserver.service</span></span><br><span class="line">      --service-node-port-range=30000-32767  \</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 更改Service类型</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># vim nginx-svc.yaml </span></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: webapp</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx       <span class="comment"># pod的标签</span></span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP  <span class="comment"># 协议</span></span><br><span class="line">      port: 80       <span class="comment"># service的端口</span></span><br><span class="line">      targetPort: 80  <span class="comment"># pod的端口号（代理的后端服务对外暴露的端口号）</span></span><br><span class="line">      name: nginx</span><br><span class="line">  <span class="built_in">type</span>: NodePort <span class="comment"># svc发布类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 更新svc</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl replace -f nginx-svc.yaml </span></span><br><span class="line">service/webapp replaced</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看svc资源</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  get svc</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/16.png" alt="image-20240623133925243"></p>
<h4 id="3-2-ExternalName-Service"><a href="#3-2-ExternalName-Service" class="headerlink" title="3.2 ExternalName Service"></a>3.2 ExternalName Service</h4><p>​        ExternalName Service是Service的特例,它没有Selector，也没有定义任何端口和Endpoint,它通过返回该外部服务的别名来提供服务。比如可以定义一个Service，后端设置为一个外部域名，这样通过Service的名称即可访问到该域名。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">vim</span> <span class="string">external-service.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">external-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ExternalName</span></span><br><span class="line">  <span class="attr">externalName:</span> <span class="string">www.baidu.com</span>  <span class="comment"># 外部服务的地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建service资源</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">create</span> <span class="string">-f</span> <span class="string">external-service.yaml</span> </span><br><span class="line"><span class="string">service/external-service</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看service资源</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">svc</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/17.png" alt="image-20240623142413602"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 访问service (进入Pod中访问svc)</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl exec -it nginx-6784b87845-7wbwx   -- sh</span></span><br><span class="line">/ <span class="comment"># wget http://external-service</span></span><br><span class="line">Connecting to external-service (110.242.68.3:80)</span><br><span class="line">wget: server returned error: HTTP/1.1 403 Forbidden</span><br></pre></td></tr></table></figure>



<h4 id="3-3-Service代理Kubernetes集群之外的服务（重点）"><a href="#3-3-Service代理Kubernetes集群之外的服务（重点）" class="headerlink" title="3.3 Service代理Kubernetes集群之外的服务（重点）"></a>3.3 Service代理Kubernetes集群之外的服务（重点）</h4><p>​        普通的Service通过Label Selector对后端Endpoint列表进行了一次抽象，如果后端的Endpoint不是由Pod副本集提供的，则Service还可以抽象定义任意其他服务，<code>将一个Kubernetes集群外部的已知服务定义为Kubernetes内的一个Service</code>，供集群内的其他应用访问，常见的应用场景包括：</p>
<ul>
<li>希望在生产环境中使用外部的数据库集群，但测试环境使用自己的数据库。</li>
<li>已部署的一个集群外服务，例如数据库服务、缓存服务等。</li>
<li>你正在将工作负载迁移到 Kubernetes。在评估该方法时，你仅在 Kubernetes 中运行一部分后端。</li>
<li>迁移过程中对某个服务进行Kubernetes内的服务名访问机制的验证。</li>
</ul>
<p><strong>对于这种应用场景，用户在创建Service资源对象时不设置Label Selector（后端Pod也不存在），同时再定义一个与Service关联的Endpoint资源对象，在Endpoint中设置外部服务的IP地址和端口号</strong></p>
<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/18.png" alt="image-20240623140121396"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">vim</span> <span class="string">nginx-svc-external.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-svc-external</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-svc-external</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span> <span class="comment"># Service端口名称</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span> <span class="comment"># Service端口</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>  <span class="comment"># 代理后端应用的端口</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span> </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Endpoints</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-svc-external</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-svc-external</span></span><br><span class="line"><span class="attr">subsets:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">addresses:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">192.168</span><span class="number">.174</span><span class="number">.30</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">192.168</span><span class="number">.174</span><span class="number">.31</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建资源</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl create -f nginx-svc-external.yaml</span></span><br><span class="line">service/nginx-svc-external created</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看service</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl  get svc</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/19.png" alt="image-20240623141046804"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看service详细信息</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl describe svc nginx-svc-external</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/20.png" alt="image-20240623141148220"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看endpoints详细信息</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl describe ep nginx-svc-external</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/21.png" alt="image-20240623141310073"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 测试访问svc</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># curl 10.96.151.135</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 进入同ns下任意一个Pod测试</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl exec -it nginx-6784b87845-7wbwx   -- sh </span></span><br><span class="line">/ <span class="comment"># curl 10.96.119.119</span></span><br></pre></td></tr></table></figure>



<h4 id="3-4-多端口Service"><a href="#3-4-多端口Service" class="headerlink" title="3.4 多端口Service"></a><strong>3.4 多端口Service</strong></h4><p>​            使用场景：某些服务对外暴露的端口不只有一个，所以此时需要用到多端口Service(rabbitmq,zookeeper)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 同一个端口号使用的协议不同，如TCP和UDP，也需要设置为多个端口号来提供不同的服务</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kube-dns</span></span><br><span class="line">    <span class="attr">kubernetes.io/cluster-service:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="attr">kubernetes.io/name:</span> <span class="string">CoreDNS</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-dns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dns</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">53</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">UDP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">53</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dns-tcp</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">53</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">53</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metrics</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9153</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9153</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">kube-dns</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果使用相同的协议，名称不能一样</p>
</blockquote>
<h4 id="3-5-LoadBalancer类型（公有云使用）"><a href="#3-5-LoadBalancer类型（公有云使用）" class="headerlink" title="3.5 LoadBalancer类型（公有云使用）"></a>3.5 LoadBalancer类型（公有云使用）</h4><p>​                简介：通常在公有云环境中设置Service的类型为“LoadBalancer”，可以将 Service映射到公有云提供的某个负载均衡器的IP地址上，客户端通过负载均衡器的IP和Service的端口号就可以访问到具体的服务，无须再通过kube-proxy提供的负载均衡机制进行流量转发。公有云提供的LoadBalancer可以直接将流量转发到后端Pod上，而负载分发机制依赖于公有云服务商的具体实现。</p>
<h4 id="3-6-Service支持的网络协议"><a href="#3-6-Service支持的网络协议" class="headerlink" title="3.6 Service支持的网络协议"></a><strong>3.6 Service支持的网络协议</strong></h4><ul>
<li><strong>TCP</strong>：Service的默认网络协议，可用于所有类型的Service。</li>
<li><strong>UDP</strong>：可用于大多数类型的Service，LoadBalancer类型取决于云服务商对UDP的支持。</li>
<li><strong>HTTP</strong>：取决于云服务商是否支持HTTP和实现机制。</li>
<li><strong>PROXY</strong>：取决于云服务商是否支持HTTP和实现机制。</li>
<li><strong>SCTP</strong>：从Kubernetes 1.12版本引入，到1.19版本时达到Beta阶段，默认启用。</li>
</ul>
<h3 id="4、Headless-Service的概念和应用"><a href="#4、Headless-Service的概念和应用" class="headerlink" title="4、Headless Service的概念和应用"></a>4、Headless Service的概念和应用</h3><p>​        简介：在某些应用场景中，客户端应用不需要通过Kubernetes内置Service实现的负载均衡功能，或者需要自行完成对服务后端各实例的服务发现机制，或者需要自行实现负载均衡功能，此时可以通过创建一种特殊的名为“Headless”的服务来实现。<br>​        Headless Service的概念是这种服务没有入口访问地址（无ClusterIP 地址），kube-proxy不会为其创建负载转发规则，而服务名（DNS域名）的解析机制取决于该Headless Service是否设置了Label Selector。</p>
<h4 id="4-1-Headless-Service设置了Label-Selector"><a href="#4-1-Headless-Service设置了Label-Selector" class="headerlink" title="4.1 Headless Service设置了Label Selector"></a>4.1 Headless Service设置了Label Selector</h4><p>​            如果Headless Service设置了Label Selector，Kubernetes则将根据 Label Selector查询后端Pod列表，自动创建Endpoint列表，将服务名（DNS域名）的解析机制设置为：<code>当客户端访问该服务名时，得到的是全部Endpoint列表</code>（而不是一个确定的IP地址）。</p>
<p>​            以下面的Headless Service为例，其设置了Label Selector：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">vim</span> <span class="string">nginx-headless.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建Headless Service</span></span><br><span class="line"><span class="string">[root@k8s-master</span> <span class="string">test]#</span> <span class="string">kubectl</span>  <span class="string">apply</span> <span class="string">-f</span> <span class="string">nginx-headless.yaml</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看svc</span></span><br><span class="line"><span class="string">[root@k8s-master</span> <span class="string">test]#</span> <span class="string">kubectl</span>  <span class="string">get</span> <span class="string">svc</span></span><br><span class="line"><span class="string">NAME</span>         <span class="string">TYPE</span>        <span class="string">CLUSTER-IP</span>       <span class="string">EXTERNAL-IP</span>   <span class="string">PORT(S)</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">kubernetes</span>   <span class="string">ClusterIP</span>   <span class="number">10.96</span><span class="number">.0</span><span class="number">.1</span>        <span class="string">&lt;none&gt;</span>        <span class="number">443</span><span class="string">/TCP</span>   <span class="string">9d</span></span><br><span class="line"><span class="string">nginx</span>        <span class="string">ClusterIP</span>   <span class="string">None</span>             <span class="string">&lt;none&gt;</span>        <span class="number">80</span><span class="string">/TCP</span>    <span class="string">85s</span></span><br><span class="line"><span class="string">webapp</span>       <span class="string">ClusterIP</span>   <span class="number">10.106</span><span class="number">.192</span><span class="number">.111</span>   <span class="string">&lt;none&gt;</span>        <span class="number">80</span><span class="string">/TCP</span>    <span class="string">4h36m</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看endpoints</span></span><br><span class="line"><span class="string">[root@k8s-master</span> <span class="string">test]#</span> <span class="string">kubectl</span>  <span class="string">get</span> <span class="string">endpoints</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/22.png" alt="image-20240626110138161"></p>
<p>==注意：在解析service的时候，应在容器中解析，因为宿主机的DNS和集群内部属于隔离的，在宿主机的命令行中无法解析成功==</p>
<h3 id="5、Ingress：-ingress控制器没有ns隔离性，Ingress有ns隔离性"><a href="#5、Ingress：-ingress控制器没有ns隔离性，Ingress有ns隔离性" class="headerlink" title="5、Ingress：(ingress控制器没有ns隔离性，Ingress有ns隔离性)"></a><strong>5、Ingress：(ingress控制器没有ns隔离性，Ingress有ns隔离性)</strong></h3><h4 id="5-1-前言"><a href="#5-1-前言" class="headerlink" title="5.1 前言"></a>5.1 前言</h4><p>​    根据前面对Service概念的说明，我们知道Service的表现形式为IP地址和端口号（ClusterIP:Port），即工作在TCP/IP层。而对于基于HTTP 的服务来说，不同的URL地址经常对应到不同的后端服务或者虚拟服务器（Virtual Host），这些应用层的转发机制仅通过Kubernetes的Service机制是无法实现的。</p>
<p>​    Kubernetes从1.1版本开始引入Ingress资源对象，用于将Kubernetes集群外的客户端请求路由到集群内部的服务上，同时提供7层（HTTP和HTTPS）路由功能。Ingress在Kubernetes 1.19版本时达到v1稳定版本。 Kubernetes使用了一个Ingress策略定义和一个具体提供转发服务的Ingress Controller，两者结合，实现了基于灵活Ingress策略定义的服务路由功能。如果是对Kubernetes集群外部的客户端提供服务，那么Ingress Controller实现的是类似于边缘路由器的功能。需要注意的是，Ingress只能以HTTP和HTTPS提供服务，对于使用其他网络协议的服务，可以通过设置Service的类型（type）为NodePort或LoadBalancer 对集群外部的客户端提供服务。 <code>使用Ingress进行服务路由时，Ingress Controller基于Ingress规则将客户端请求直接转发到Service对应的后端Endpoint（Pod）上，这样会跳过kube-proxy设置的路由转发规则，以提高网络转发效率。</code><br>​    Ingress为Kubernetes集群中的服务提供了入口，可以提供负载均衡、SSL终止和基于名称的虚拟主机，应用的灰度发布等功能；在生产环境中常用的Ingress有Nginx、HAProxy、Istio等。<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#ingress-v1beta1-networking-k8s-io" target="_blank" rel="noopener">Ingress</a> 公开从集群外部到集群内<a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener">服务</a>的 HTTP 和 HTTPS 路由。 流量路由由 Ingress 资源上定义的规则控制。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream api &#123;</span><br><span class="line">	server 192.168.1.1;</span><br><span class="line">	server 192.168.1.2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen  80;</span><br><span class="line">  server_name www.kengni.com;</span><br><span class="line">  location /api &#123;</span><br><span class="line">  	proxy_pass http://api;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/23.png" alt="image-20240623144722857"></p>
<ul>
<li>对<a href="http://mywebsite.com/api的访问将被路由到后端名为api的Service上；" target="_blank" rel="noopener">http://mywebsite.com/api的访问将被路由到后端名为api的Service上；</a></li>
<li>对<a href="http://mywebsite.com/web的访问将被路由到后端名为web的Service上；" target="_blank" rel="noopener">http://mywebsite.com/web的访问将被路由到后端名为web的Service上；</a></li>
<li>对<a href="http://mywebsite.com/docs的访问将被路由到后端名为doc的Service上。" target="_blank" rel="noopener">http://mywebsite.com/docs的访问将被路由到后端名为doc的Service上。</a></li>
</ul>
<h4 id="5-2-创建Ingress-Controller"><a href="#5-2-创建Ingress-Controller" class="headerlink" title="5.2 创建Ingress Controller"></a>5.2 创建Ingress Controller</h4><p>​    官网链接：<a href="https://kubernetes.github.io/ingress-nginx/deploy/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/deploy/</a></p>
<p>​    简介：Ingress Controller需要<strong>实现基于不同HTTP URL向后转发的负载分发规则，并可以灵活设置7层负载分发策略</strong>。目前Ingress Controller已经有许多实现方案，包括Nginx、HAProxy、Kong、Traefik、Istio 等开源软件的实现，以及公有云GCE、Azure、AWS等提供的Ingress应用网关，在Kubernetes中，Ingress Controller会持续监控API Server的/ingress 接口（即用户定义的到后端服务的转发规则）的变化。当/ingress接口后端的服务信息发生变化时，Ingress Controller会自动更新其转发规则。 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># cat nginx-ingress.yaml </span></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">automountServiceAccountToken: <span class="literal">true</span></span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - namespaces</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - configmaps</span><br><span class="line">  - pods</span><br><span class="line">  - secrets</span><br><span class="line">  - endpoints</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - services</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses/status</span><br><span class="line">  verbs:</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingressclasses</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - coordination.k8s.io</span><br><span class="line">  resourceNames:</span><br><span class="line">  - ingress-nginx-leader</span><br><span class="line">  resources:</span><br><span class="line">  - leases</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - coordination.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - leases</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - events</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - patch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - discovery.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - endpointslices</span><br><span class="line">  verbs:</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">  - get</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - secrets</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - create</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - configmaps</span><br><span class="line">  - endpoints</span><br><span class="line">  - nodes</span><br><span class="line">  - pods</span><br><span class="line">  - secrets</span><br><span class="line">  - namespaces</span><br><span class="line">  verbs:</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - coordination.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - leases</span><br><span class="line">  verbs:</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - nodes</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - services</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - events</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - patch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses/status</span><br><span class="line">  verbs:</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingressclasses</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - discovery.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - endpointslices</span><br><span class="line">  verbs:</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">  - get</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - admissionregistration.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - validatingwebhookconfigurations</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - update</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Role</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Role</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  allow-snippet-annotations: <span class="string">"true"</span></span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-controller</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-controller</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment"># externalTrafficPolicy: Local</span></span><br><span class="line">  ipFamilies:</span><br><span class="line">  - IPv4</span><br><span class="line">  ipFamilyPolicy: SingleStack</span><br><span class="line">  ports:</span><br><span class="line">  - appProtocol: http</span><br><span class="line">    name: http</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: http</span><br><span class="line">  - appProtocol: https</span><br><span class="line">    name: https</span><br><span class="line">    port: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: https</span><br><span class="line">  selector:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-controller-admission</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - appProtocol: https</span><br><span class="line">    name: https-webhook</span><br><span class="line">    port: 443</span><br><span class="line">    targetPort: webhook</span><br><span class="line">  selector:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-controller</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  minReadySeconds: 0</span><br><span class="line">  revisionHistoryLimit: 10</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app.kubernetes.io/component: controller</span><br><span class="line">      app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">      app.kubernetes.io/name: ingress-nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app.kubernetes.io/component: controller</span><br><span class="line">        app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">        app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - /nginx-ingress-controller</span><br><span class="line">        - --publish-service=$(POD_NAMESPACE)/ingress-nginx-controller</span><br><span class="line">        - --election-id=ingress-nginx-leader</span><br><span class="line">        - --controller-class=k8s.io/ingress-nginx</span><br><span class="line">        - --ingress-class=nginx</span><br><span class="line">        - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span><br><span class="line">        - --validating-webhook=:8443</span><br><span class="line">        - --validating-webhook-certificate=/usr/<span class="built_in">local</span>/certificates/cert</span><br><span class="line">        - --validating-webhook-key=/usr/<span class="built_in">local</span>/certificates/key</span><br><span class="line">        env:</span><br><span class="line">        - name: POD_NAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.name</span><br><span class="line">        - name: POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">        - name: LD_PRELOAD</span><br><span class="line">          value: /usr/<span class="built_in">local</span>/lib/libmimalloc.so</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com/hujiaming/nginx-ingress-controller:v1.6.4</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        lifecycle:</span><br><span class="line">          preStop:</span><br><span class="line">            <span class="built_in">exec</span>:</span><br><span class="line">              <span class="built_in">command</span>:</span><br><span class="line">              - /<span class="built_in">wait</span>-shutdown</span><br><span class="line">        livenessProbe:</span><br><span class="line">          failureThreshold: 5</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /healthz</span><br><span class="line">            port: 10254</span><br><span class="line">            scheme: HTTP</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 10</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">        name: controller</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          name: http</span><br><span class="line">          protocol: TCP</span><br><span class="line">        - containerPort: 443</span><br><span class="line">          name: https</span><br><span class="line">          protocol: TCP</span><br><span class="line">        - containerPort: 8443</span><br><span class="line">          name: webhook</span><br><span class="line">          protocol: TCP</span><br><span class="line">        readinessProbe:</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /healthz</span><br><span class="line">            port: 10254</span><br><span class="line">            scheme: HTTP</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 10</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 90Mi</span><br><span class="line">        securityContext:</span><br><span class="line">          allowPrivilegeEscalation: <span class="literal">true</span></span><br><span class="line">          capabilities:</span><br><span class="line">            add:</span><br><span class="line">            - NET_BIND_SERVICE</span><br><span class="line">            drop:</span><br><span class="line">            - ALL</span><br><span class="line">          runAsUser: 101</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /usr/<span class="built_in">local</span>/certificates/</span><br><span class="line">          name: webhook-cert</span><br><span class="line">          readOnly: <span class="literal">true</span></span><br><span class="line">      dnsPolicy: ClusterFirst</span><br><span class="line">      nodeSelector:</span><br><span class="line">        kubernetes.io/os: linux</span><br><span class="line">      serviceAccountName: ingress-nginx</span><br><span class="line">      terminationGracePeriodSeconds: 300</span><br><span class="line">      volumes:</span><br><span class="line">      - name: webhook-cert</span><br><span class="line">        secret:</span><br><span class="line">          secretName: ingress-nginx-admission</span><br><span class="line">---</span><br><span class="line">apiVersion: batch/v1</span><br><span class="line">kind: Job</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission-create</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app.kubernetes.io/component: admission-webhook</span><br><span class="line">        app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">        app.kubernetes.io/name: ingress-nginx</span><br><span class="line">        app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">        app.kubernetes.io/version: 1.6.4</span><br><span class="line">      name: ingress-nginx-admission-create</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - create</span><br><span class="line">        - --host=ingress-nginx-controller-admission,ingress-nginx-controller-admission.$(POD_NAMESPACE).svc</span><br><span class="line">        - --namespace=$(POD_NAMESPACE)</span><br><span class="line">        - --secret-name=ingress-nginx-admission</span><br><span class="line">        env:</span><br><span class="line">        - name: POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">        image: registry.cn-beijing.aliyuncs.com/dotbalo/kube-webhook-certgen:v20220916-gd32f8c343</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: create</span><br><span class="line">        securityContext:</span><br><span class="line">          allowPrivilegeEscalation: <span class="literal">false</span></span><br><span class="line">      nodeSelector:</span><br><span class="line">        kubernetes.io/os: linux</span><br><span class="line">      restartPolicy: OnFailure</span><br><span class="line">      securityContext:</span><br><span class="line">        fsGroup: 2000</span><br><span class="line">        runAsNonRoot: <span class="literal">true</span></span><br><span class="line">        runAsUser: 2000</span><br><span class="line">      serviceAccountName: ingress-nginx-admission</span><br><span class="line">---</span><br><span class="line">apiVersion: batch/v1</span><br><span class="line">kind: Job</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission-patch</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app.kubernetes.io/component: admission-webhook</span><br><span class="line">        app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">        app.kubernetes.io/name: ingress-nginx</span><br><span class="line">        app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">        app.kubernetes.io/version: 1.6.4</span><br><span class="line">      name: ingress-nginx-admission-patch</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - patch</span><br><span class="line">        - --webhook-name=ingress-nginx-admission</span><br><span class="line">        - --namespace=$(POD_NAMESPACE)</span><br><span class="line">        - --patch-mutating=<span class="literal">false</span></span><br><span class="line">        - --secret-name=ingress-nginx-admission</span><br><span class="line">        - --patch-failure-policy=Fail</span><br><span class="line">        env:</span><br><span class="line">        - name: POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com/hujiaming/kube-webhook-certgen:v20220916-gd32f8c343</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: patch</span><br><span class="line">        securityContext:</span><br><span class="line">          allowPrivilegeEscalation: <span class="literal">false</span></span><br><span class="line">      nodeSelector:</span><br><span class="line">        kubernetes.io/os: linux</span><br><span class="line">      restartPolicy: OnFailure</span><br><span class="line">      securityContext:</span><br><span class="line">        fsGroup: 2000</span><br><span class="line">        runAsNonRoot: <span class="literal">true</span></span><br><span class="line">        runAsUser: 2000</span><br><span class="line">      serviceAccountName: ingress-nginx-admission</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: IngressClass</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: controller</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: nginx</span><br><span class="line">spec:</span><br><span class="line">  controller: k8s.io/ingress-nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: admissionregistration.k8s.io/v1</span><br><span class="line">kind: ValidatingWebhookConfiguration</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/component: admission-webhook</span><br><span class="line">    app.kubernetes.io/instance: ingress-nginx</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">    app.kubernetes.io/version: 1.6.4</span><br><span class="line">  name: ingress-nginx-admission</span><br><span class="line">webhooks:</span><br><span class="line">- admissionReviewVersions:</span><br><span class="line">  - v1</span><br><span class="line">  clientConfig:</span><br><span class="line">    service:</span><br><span class="line">      name: ingress-nginx-controller-admission</span><br><span class="line">      namespace: ingress-nginx</span><br><span class="line">      path: /networking/v1/ingresses</span><br><span class="line">  failurePolicy: Fail</span><br><span class="line">  matchPolicy: Equivalent</span><br><span class="line">  name: validate.nginx.ingress.kubernetes.io</span><br><span class="line">  rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">    - networking.k8s.io</span><br><span class="line">    apiVersions:</span><br><span class="line">    - v1</span><br><span class="line">    operations:</span><br><span class="line">    - CREATE</span><br><span class="line">    - UPDATE</span><br><span class="line">    resources:</span><br><span class="line">    - ingresses</span><br><span class="line">  sideEffects: None</span><br><span class="line">  </span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建资源</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl create -f nginx-ingress.yaml </span></span><br><span class="line">namespace/ingress-nginx created</span><br><span class="line">serviceaccount/ingress-nginx created</span><br><span class="line">serviceaccount/ingress-nginx-admission created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">configmap/ingress-nginx-controller created</span><br><span class="line">service/ingress-nginx-controller created</span><br><span class="line">service/ingress-nginx-controller-admission created</span><br><span class="line">deployment.apps/ingress-nginx-controller created</span><br><span class="line">job.batch/ingress-nginx-admission-create created</span><br><span class="line">job.batch/ingress-nginx-admission-patch created</span><br><span class="line">ingressclass.networking.k8s.io/nginx created</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看Ingress-container的Pod</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get po -n ingress-nginx</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/24.png" alt="image-20240623212749607"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看ingress-nginx-controller的svc</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get svc -n ingress-nginx</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/25.png" alt="image-20240623212637439"></p>
<p><strong>测试访问ingress-nginx的svc</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># curl 10.96.158.32</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h4 id="5-3-域名发布服务"><a href="#5-3-域名发布服务" class="headerlink" title="5.3 域名发布服务"></a>5.3 域名发布服务</h4><h5 id="5-3-1-创建web服务"><a href="#5-3-1-创建web服务" class="headerlink" title="5.3.1 创建web服务"></a>5.3.1 创建web服务</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">vim</span> <span class="string">nginx-deploy.yaml</span> </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>  </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">webapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>       <span class="comment"># pod的标签</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span>  <span class="comment"># 协议</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span>       <span class="comment"># service的端口</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span>  <span class="comment"># pod的端口号（代理的后端服务对外暴露的端口号）</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>     <span class="comment"># deploy的标签</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span>      <span class="comment"># 副本数</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>   <span class="comment"># pod的标签</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span>  <span class="comment"># pod的标签</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建资源</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">create</span> <span class="string">-f</span> <span class="string">nginx-deploy.yaml</span> </span><br><span class="line"><span class="string">deployment.apps/nginx</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看svc</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">svc</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/26.png" alt="image-20240623191535233"></p>
<h5 id="5-3-2-创建Ingress"><a href="#5-3-2-创建Ingress" class="headerlink" title="5.3.2 创建Ingress"></a>5.3.2 创建Ingress</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">vim</span> <span class="string">nginx-ingress-file.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span>  <span class="comment"># Ingress资源的API版本</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span>  <span class="comment"># Ingress 名称</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span>   <span class="comment"># 指定IngressController的类型（haproxy等）</span></span><br><span class="line">  <span class="attr">rules:</span>    <span class="comment">#  路由转发规则，可以写多个</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">ingress.tanke.love</span>  <span class="comment"># Ingress 规则应用的域名</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">webapp</span>   <span class="comment"># service名称</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span> <span class="comment">#路由的匹配方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建资源</span></span><br><span class="line"><span class="string">[root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">create</span> <span class="string">-f</span> <span class="string">nginx-ingress-file.yaml</span></span><br><span class="line"><span class="string">ingress.networking.k8s.io/nginx-ingress</span> <span class="string">created</span></span><br></pre></td></tr></table></figure>

<h5 id="5-3-3-路由的匹配方式"><a href="#5-3-3-路由的匹配方式" class="headerlink" title="5.3.3 路由的匹配方式"></a>5.3.3 路由的匹配方式</h5><p>​    Ingress中的每个路径都需要有对应的路径类型（Path Type）。未明确设置 <code>pathType</code> 的路径无法通过合法性检查。当前支持的路径类型有三种：</p>
<ul>
<li><p><strong><code>ImplementationSpecific</code></strong>：该类型行为取决于所使用的Ingress Controller。大多数情况下，它等同于前缀匹配。</p>
<ul>
<li><pre><code class="bash">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: implementation-specific-ingress
spec:
  rules:
  - host: <span class="string">"example.com"</span>
    http:
      paths:
      - path: /foo/[a-z]+
        pathType: ImplementationSpecific
        backend:
          service:
            name: foo-service
            port:
              number: 80
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    &gt; 在这个例子中，假设所用的Ingress Controller支持正则表达式匹配，那么路径如&#96;&#x2F;foo&#x2F;bar&#96;（但不是&#96;&#x2F;foo&#x2F;123&#96;）会被路由到&#96;foo-service&#96;服务。</span><br><span class="line"></span><br><span class="line">- **&#96;Exact&#96;**：精确匹配要求请求路径与指定的路径完全相同。</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96;bash</span><br><span class="line">    apiVersion: networking.k8s.io&#x2F;v1</span><br><span class="line">    kind: Ingress</span><br><span class="line">    metadata:</span><br><span class="line">      name: exact-ingress</span><br><span class="line">    spec:</span><br><span class="line">      rules:</span><br><span class="line">      - host: &quot;example.com&quot;</span><br><span class="line">        http:</span><br><span class="line">          paths:</span><br><span class="line">          - path: &#x2F;foo</span><br><span class="line">            pathType: Exact</span><br><span class="line">            backend:</span><br><span class="line">              service:</span><br><span class="line">                name: foo-service</span><br><span class="line">                port:</span><br><span class="line">                  number: 80</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<blockquote>
<p>在这个例子中，只有路径严格等于<code>/foo</code>的请求会被路由到<code>foo-service</code>服务，路径如<code>/foo/bar</code>不会匹配。</p>
</blockquote>
</li>
</ul>
<ul>
<li><p><strong><code>Prefix</code></strong>：前缀匹配是最常见的路径匹配方式，前缀匹配表示请求路径以指定的前缀开始。</p>
<ul>
<li><pre><code class="bash">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: prefix-ingress
spec:
  rules:
  - host: <span class="string">"example.com"</span>
    http:
      paths:
      - path: /foo/fsfgas
        pathType: Prefix
        backend:
          service:
            name: foo-service
            port:
              number: 80
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">  &gt; 在这个例子中，所有以&#96;&#x2F;foo&#96;开头的请求（如&#96;&#x2F;foo&#96;、&#96;&#x2F;foo&#x2F;bar&#96;、&#96;&#x2F;foo&#x2F;bar&#x2F;baz&#96;）都会被路由到&#96;foo-service&#96;服务。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">#&gt;&gt;&gt; 查看Ingress</span><br><span class="line">[root@k8s-master01 ~]# kubectl get ingress</span><br><span class="line">NAME            CLASS   HOSTS                ADDRESS         PORTS   AGE</span><br><span class="line">nginx-ingress   nginx   ingress.tanke.love   10.96.110.188   80      55s</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 查看Ingressclass</span><br><span class="line">[root@k8s-master01 ~]# kubectl get ingressclass</span><br><span class="line">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class="line">nginx   k8s.io&#x2F;ingress-nginx   &lt;none&gt;       39m</span><br><span class="line"></span><br><span class="line">#&gt;&gt;&gt; 查看nginx-ingress svc</span><br><span class="line">[root@k8s-master01 ~]# kubectl get svc -n ingress-nginx</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/27.png" alt="image-20240623212637439"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># curl ingress.tanke.love:30999</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Tue, 20 Dec 2022 08:13:34 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 612</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Last-Modified: Sat, 11 May 2019 00:35:53 GMT</span><br><span class="line">ETag: <span class="string">"5cd618e9-264"</span></span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>

<p>​    <strong>一旦Ingress资源成功创建，Ingress Controller就会监控到其配置的路由策略，并更新到Nginx的配置文件中生效。以本例中的Nginx Controller为例，它将更新其配置文件的内容为在Ingress中设定的路由策略。登录一个nginx-ingress-controller Pod，在/etc/nginx/nginx.conf可以看到对<code>ingress.tanke.love</code>的转发规则的正确配置</strong>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 进入ingress容器中</span></span><br><span class="line">[root@k8s-master ingress]<span class="comment"># kubectl  get po -n ingress-nginx</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/28.png" alt="image-20240623213742460"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl exec -it ingress-nginx-controller-8556b74844-s9fwk -n ingress-nginx  -- bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看nginx-ingress-controller配置文件</span></span><br><span class="line">ingress-nginx-controller-8556b74844-s9fwk:/etc/nginx$ grep -A 20 <span class="string">"ingress.tanke.love"</span> nginx.conf</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/29.png" alt="image-20240623213943935"></p>
<h5 id="5-3-4-不配置域名发布服务-了解"><a href="#5-3-4-不配置域名发布服务-了解" class="headerlink" title="5.3.4  不配置域名发布服务(了解)"></a>5.3.4  不配置域名发布服务(了解)</h5><p>​    在Kubernetes Ingress中，通常需要配置域名（Host）来指定外部请求的路由目标，但在某些情况下，您可能不想或不需要配置域名。您可以通过配置一个没有域名的Ingress资源来发布服务，这样所有请求都会匹配该Ingress规则，不论其Host头部是什么。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ~]<span class="comment"># vim no-host.yaml</span></span><br><span class="line">---</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: no-host-ingress  <span class="comment">#Ingress名称</span></span><br><span class="line">spec:</span><br><span class="line">  ingressClassName: nginx</span><br><span class="line">  rules:</span><br><span class="line">  - http:</span><br><span class="line">      paths:</span><br><span class="line">      - backend:</span><br><span class="line">          service:</span><br><span class="line">            name: webapp</span><br><span class="line">            port:</span><br><span class="line">              number: 80</span><br><span class="line">        path: /no-host</span><br><span class="line">        pathType: prefix</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建ingress资源</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl create -f no-host.yaml</span></span><br><span class="line">ingress.networking.k8s.io/no-host created</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看ingress资源</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get ingress</span></span><br><span class="line">执行结果：</span><br><span class="line">	NAME            CLASS   HOSTS            ADDRESS        PORTS   AGE</span><br><span class="line">    nginx-ingress   nginx   nginx.test.com   10.96.121.23   80      109m</span><br><span class="line">    no-host         nginx   *                10.96.121.23   80      115s</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看ingress container Pod</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># kubectl get po -n ingress-nginx</span></span><br><span class="line">执行结果：</span><br><span class="line">NAME                                        READY   STATUS      RESTARTS   AGE</span><br><span class="line">ingress-nginx-admission-create-dl2rg        0/1     Completed   0          51m</span><br><span class="line">ingress-nginx-admission-patch-svpd4         0/1     Completed   1          51m</span><br><span class="line">ingress-nginx-controller-84c544699d-bb9xm   1/1     Running     0          51m</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试访问</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># curl -I 172.16.32.180/no-host</span></span><br><span class="line">HTTP/1.1 404 Not Found</span><br><span class="line">Date: Tue, 20 Dec 2022 08:59:16 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 154</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/">https://l66stbz.github.io/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://l66stbz.github.io" target="_blank">L66</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Kubernetes/">Kubernetes</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/09/23/spring cloud k8s容器化部署/spring cloud k8s容器化部署若依/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2024/09/17/kubernetes%20HPA%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9/05-kubernetes%20HPA%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9/"><img class="prev_cover" src="https://l66stbz.github.io/2024/09/17/kubernetes HPA自动扩缩/05-kubernetes HPA自动扩缩/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kubernetes HPA自动扩缩</div></div></a></div><div class="next-post pull_right"><a href="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/"><img class="next_cover" src="https://l66stbz.github.io/2024/09/16/Kubernetes基础资源调度/03-Kubernetes基础资源调度/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Kubernetes基础资源调度</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/09/23/spring cloud k8s容器化部署/spring cloud k8s容器化部署若依/" title="spring cloud k8s容器化部署"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/23/spring cloud k8s容器化部署/spring cloud k8s容器化部署若依/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-23</div><div class="relatedPosts_title">spring cloud k8s容器化部署</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/13/Kubernetes基础概念/01-Kubernetes基础概念/" title="Kubernetes基础概念"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/13/Kubernetes基础概念/01-Kubernetes基础概念/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-13</div><div class="relatedPosts_title">Kubernetes基础概念</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/14/Kubernetes容器编排工具部署（adm）/02-Kubernetes容器编排工具部署（adm）/" title="Kubernetes容器编排工具部署（adm）"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/14/Kubernetes容器编排工具部署（adm）/02-Kubernetes容器编排工具部署（adm）/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-14</div><div class="relatedPosts_title">Kubernetes容器编排工具部署（adm）</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/15/kubernetes 二进制高可用安装部署（v1.23+）/kubernetes 二进制高可用安装部署（v1.23+）/" title="kubernetes 二进制高可用安装部署（v1.23+）"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/15/kubernetes 二进制高可用安装部署（v1.23+）/kubernetes 二进制高可用安装部署（v1.23+）/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-15</div><div class="relatedPosts_title">kubernetes 二进制高可用安装部署（v1.23+）</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/19/Kubernetes RBAC细粒度权限划分/07-Kubernetes RBAC细粒度权限划分/" title="Kubernetes RBAC细粒度权限划分"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/19/Kubernetes RBAC细粒度权限划分/07-Kubernetes RBAC细粒度权限划分/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-19</div><div class="relatedPosts_title">Kubernetes RBAC细粒度权限划分</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/20/Kubernetes持久化文件存储/08-Kubernetes持久化文件存储/" title="Kubernetes持久化文件存储"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/20/Kubernetes持久化文件存储/08-Kubernetes持久化文件存储/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-20</div><div class="relatedPosts_title">Kubernetes持久化文件存储</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>