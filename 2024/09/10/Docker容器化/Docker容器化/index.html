<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker容器化 | L66</title><meta name="description" content="1. 容器简介1.1 什么是Linux容器​    容器其实是一种沙盒技术。沙盒像一个集装箱一样把你的应用“装”起来的技术。这样应用与应用之间就因为有了边界而不至于相互干扰；而被装进了集装箱的应用，也可以被方便地搬来搬去。​    Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生"><meta name="keywords" content="Linux,Docker"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker容器化"><meta name="twitter:description" content="1. 容器简介1.1 什么是Linux容器​    容器其实是一种沙盒技术。沙盒像一个集装箱一样把你的应用“装”起来的技术。这样应用与应用之间就因为有了边界而不至于相互干扰；而被装进了集装箱的应用，也可以被方便地搬来搬去。​    Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生"><meta name="twitter:image" content="https://l66stbz.github.io/2024/09/10/Docker容器化/Docker容器化/bg.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Docker容器化"><meta property="og:url" content="https://l66stbz.github.io/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/"><meta property="og:site_name" content="L66"><meta property="og:description" content="1. 容器简介1.1 什么是Linux容器​    容器其实是一种沙盒技术。沙盒像一个集装箱一样把你的应用“装”起来的技术。这样应用与应用之间就因为有了边界而不至于相互干扰；而被装进了集装箱的应用，也可以被方便地搬来搬去。​    Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生"><meta property="og:image" content="https://l66stbz.github.io/2024/09/10/Docker容器化/Docker容器化/bg.jpg"><meta property="article:published_time" content="2024-09-10T13:50:00.000Z"><meta property="article:modified_time" content="2024-09-13T03:29:17.518Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/"><link rel="prev" title="Docker基本操作命令" href="https://l66stbz.github.io/2024/09/11/Docker%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/Docker%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/"><link rel="next" title="若依项目动静分离" href="https://l66stbz.github.io/2024/09/09/%E8%8B%A5%E4%BE%9D%E9%A1%B9%E7%9B%AE%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/%E8%8B%A5%E4%BE%9D%E9%A1%B9%E7%9B%AE%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">68</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">37</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-容器简介"><span class="toc-number">1.</span> <span class="toc-text">1. 容器简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-什么是Linux容器"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 什么是Linux容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-容器的基本概念-namespace-cgroups"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 容器的基本概念(namespace cgroups)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-容器的核心技术实现"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 容器的核心技术实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-容器和虚拟机的区别？"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 容器和虚拟机的区别？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Docker简介"><span class="toc-number">2.</span> <span class="toc-text">2. Docker简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-Docker是什么"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Docker是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Docker的目标"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Docker的目标</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Docker熟识"><span class="toc-number">3.</span> <span class="toc-text">3. Docker熟识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Docker部署及配置"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Docker部署及配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Docker架构"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Docker架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Docker基本指令"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Docker基本指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Docker镜像管理"><span class="toc-number">4.</span> <span class="toc-text">4. Docker镜像管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-登录官方镜像仓库"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 登录官方镜像仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-搜索官方仓库镜像-docker-search-lt-image-name-gt"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 搜索官方仓库镜像 docker search &lt;image_name&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-获取镜像-docker-pull-lt-image-name-gt-lt-tag-gt"><span class="toc-number">4.3.</span> <span class="toc-text">4.2 获取镜像 docker pull &lt;image_name&gt;:&lt;tag&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-导出镜像-docker-image-save-lt-image-name-gt-lt-tag-gt-gt-to-path-lt-image-name-gt-tar-gz"><span class="toc-number">4.4.</span> <span class="toc-text">4.3 导出镜像 docker image save &lt;image_name&gt;:&lt;tag&gt; &gt;&#x2F;to&#x2F;path&#x2F;&lt;image_name&gt;.tar.gz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-导入镜像-docker-image-load-i-to-path-lt-image-name-gt-tar-gz"><span class="toc-number">4.5.</span> <span class="toc-text">4.4 导入镜像: docker image load -i &#x2F;to&#x2F;path&#x2F;&lt;image_name&gt;.tar.gz</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-删除镜像"><span class="toc-number">4.6.</span> <span class="toc-text">4.5 删除镜像</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#删除镜像-删除镜像需要保证没有基于此镜像运行容器，否则需要先删除容器"><span class="toc-number"></span> <span class="toc-text">删除镜像(删除镜像需要保证没有基于此镜像运行容器，否则需要先删除容器)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-查看镜像详细信息"><span class="toc-number">0.1.</span> <span class="toc-text">4.6 查看镜像详细信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-镜像的拉取策略（了解：Kubernetes-Pod章节细讲）"><span class="toc-number">0.2.</span> <span class="toc-text">4.7 镜像的拉取策略（了解：Kubernetes Pod章节细讲）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-阿里云镜像仓库使用"><span class="toc-number">0.3.</span> <span class="toc-text">4.8 阿里云镜像仓库使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-容器的日常管理"><span class="toc-number">1.</span> <span class="toc-text">5. 容器的日常管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-查看容器的日志"><span class="toc-number">1.1.</span> <span class="toc-text">5.2 查看容器的日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-查看容器的IP地址"><span class="toc-number">1.2.</span> <span class="toc-text">5.3 查看容器的IP地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-进入容器的方法"><span class="toc-number">1.3.</span> <span class="toc-text">5.4 进入容器的方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-容器与宿主机间传输文件"><span class="toc-number">1.4.</span> <span class="toc-text">5.5 容器与宿主机间传输文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-容器的状态（了解，Kubernetes细讲Pod的状态）"><span class="toc-number">1.5.</span> <span class="toc-text">5.6 容器的状态（了解，Kubernetes细讲Pod的状态）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-7-容器的重启策略"><span class="toc-number">1.6.</span> <span class="toc-text">5.7 容器的重启策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-容器重命名-慎用"><span class="toc-number">1.7.</span> <span class="toc-text">5.8 容器重命名(慎用)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Docker数据卷的管理"><span class="toc-number">2.</span> <span class="toc-text">6. Docker数据卷的管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-挂载时创建卷（数据卷-临时卷）"><span class="toc-number">2.1.</span> <span class="toc-text">6.1 挂载时创建卷（数据卷&#x2F;临时卷）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-挂载指定volume（数据卷容器）"><span class="toc-number">2.2.</span> <span class="toc-text">6.2 挂载指定volume（数据卷容器）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-Bind-Mounts持久化（绑定挂载）"><span class="toc-number">2.3.</span> <span class="toc-text">6.2  Bind Mounts持久化（绑定挂载）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-1-bind-mount注意事项"><span class="toc-number">2.3.1.</span> <span class="toc-text">6.2.1 bind mount注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-tmpfs-mount持久化"><span class="toc-number">2.4.</span> <span class="toc-text">6.3 tmpfs mount持久化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-网络存储（Network-Storage）"><span class="toc-number">2.5.</span> <span class="toc-text">6.4 网络存储（Network Storage）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-存储卷的生命周期管理"><span class="toc-number">2.6.</span> <span class="toc-text">6.4 存储卷的生命周期管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Docker网络"><span class="toc-number">3.</span> <span class="toc-text">7. Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-Docker网络简介"><span class="toc-number">3.1.</span> <span class="toc-text">7.1 Docker网络简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-host网络模式配置"><span class="toc-number">3.2.</span> <span class="toc-text">7.2 host网络模式配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-container网络模式配置"><span class="toc-number">3.3.</span> <span class="toc-text">7.3 container网络模式配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-null网络模式配置"><span class="toc-number">3.4.</span> <span class="toc-text">7.4 null网络模式配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Dockerfile自动构建docker镜像"><span class="toc-number">4.</span> <span class="toc-text">8. Dockerfile自动构建docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-Dockerfile指令集"><span class="toc-number">4.1.</span> <span class="toc-text">8.1 Dockerfile指令集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-单阶段构建镜像"><span class="toc-number">4.2.</span> <span class="toc-text">8.2 单阶段构建镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-多阶段构建镜像"><span class="toc-number">4.3.</span> <span class="toc-text">8.3 多阶段构建镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-Dockerfile优化"><span class="toc-number">4.4.</span> <span class="toc-text">8.4 Dockerfile优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-HarBor私有镜像仓库"><span class="toc-number">5.</span> <span class="toc-text">9. HarBor私有镜像仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-安装docker-compose"><span class="toc-number">5.1.</span> <span class="toc-text">9.1 安装docker-compose</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-安装Harbor"><span class="toc-number">5.2.</span> <span class="toc-text">9.2 安装Harbor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-docker-compose介绍"><span class="toc-number">5.3.</span> <span class="toc-text">9.3 docker-compose介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-编排启动镜像"><span class="toc-number">5.4.</span> <span class="toc-text">9.2 编排启动镜像</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/09/10/Docker容器化/Docker容器化/bg.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Docker容器化</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2024-09-10 21:50:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2024-09-10</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2024-09-13 11:29:17"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2024-09-13</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="1-容器简介"><a href="#1-容器简介" class="headerlink" title="1. 容器简介"></a>1. 容器简介</h3><h4 id="1-1-什么是Linux容器"><a href="#1-1-什么是Linux容器" class="headerlink" title="1.1 什么是Linux容器"></a>1.1 什么是Linux容器</h4><p>​    容器其实是一种<strong>沙盒</strong>技术。<strong>沙盒像一个集装箱一样把你的应用“装”起来的技术</strong>。这样应用与应用之间就因为有了边界而不至于相互干扰；而被装进了集装箱的应用，也可以被方便地搬来搬去。<br>​    Linux容器是与系统其他部分隔离开的一系列进程，从另一个<strong>镜像</strong>运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。<br><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/1.jpg" alt="image.png"></p>
<h4 id="1-2-容器的基本概念-namespace-cgroups"><a href="#1-2-容器的基本概念-namespace-cgroups" class="headerlink" title="1.2 容器的基本概念(namespace cgroups)"></a>1.2 容器的基本概念(namespace cgroups)</h4><p><strong>隔离性</strong>：容器在操作系统层面提供了进程、文件系统、网络等资源的隔离，确保每个容器内部的操作不会影响到其他容器或主机系统。<br><strong>轻量级</strong>：与虚拟机不同，容器不需要包含整个操作系统，而是共享主机操作系统的内核。因此，容器的启动速度快，占用的资源少。一般容器以毫秒级启动，而虚拟机是分钟级启动。<br><strong>可移植性</strong>：容器镜像包含应用程序及其依赖的所有软件和库，使得容器可以在任何支持容器运行的环境中运行（例如，开发者的本地机器、测试环境、生产环境等）。</p>
<h4 id="1-3-容器的核心技术实现"><a href="#1-3-容器的核心技术实现" class="headerlink" title="1.3 容器的核心技术实现"></a>1.3 容器的核心技术实现</h4><p><strong>Namespaces</strong>  veth pair</p>
<ul>
<li>提供进程、网络、文件系统等资源的隔离，确保每个容器内的进程只能看到并操作属于该容器的资源。比如：命名空间可以提供一个进程相互隔离的独立网络空间，不同的容器间进程pid可以相同，进程并不冲突影响，但可以共享底层的计算和存储资源。</li>
</ul>
<p><strong>Cgroups</strong></p>
<ul>
<li>管理和限制容器使用的资源（如 CPU、内存、磁盘 I/O 等），确保容器不会超出分配的资源。比如给容器A分配4颗CPU，8G 内存，那这个容器最多用这么多的资源。如果内存超过8G ，会启动swap，效率降低，也可能会被调度系统给kill掉。</li>
</ul>
<p>白话文：Namespace的作用是“隔离”，他让应用进程只能“看到”该Namespace内的“世界”；而Cgroups的作用是“限制”，它给这个“世界”围了一圈看不见的“墙”。如此一来，进程就真的被“装”在了一个与世隔绝的“房间”里。这就是所谓的沙盒！</p>
<h4 id="1-4-容器和虚拟机的区别？"><a href="#1-4-容器和虚拟机的区别？" class="headerlink" title="1.4 容器和虚拟机的区别？"></a>1.4 容器和虚拟机的区别？</h4><p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/2.jpg" alt></p>
<p><strong>传统虚拟技术</strong><br>    <strong>虚拟机（virtual machine）就是带环境安装的一种解决方案。</strong><br>    它可以在一种操作系统里面运行另一种操作系统，比如在Windows 系统里面运行Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序，操作系统和硬件三者之间的逻辑不变。<br>虚拟机的缺点：1 资源占用多 2 冗余步骤多 3 启动慢</p>
<p><strong>容器技术</strong><br>    Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。有了容器，就可以将软件运行所需的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和设置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一地运行。</p>
<p><strong>Docker和传统虚拟化方式的不同之处：</strong><br>    传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。每个容器之间互相隔离，每个容器有自己的文件系统 ，容器之间进程不会相互影响，能区分计算资源。</p>
<p><strong>为什么docker 容器比VM快？</strong><br>    docker有着比虚拟机更少的抽象层。由于docker不需要Hypervisor实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。<br>    docker利用的是宿主机的内核,而不需要Guest OS。因此,当新建一个容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。避免引寻、加载操作系统内核比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载Guest OS,这个新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了这个过程,因此新建一个docker容器只需要几秒钟。</p>
<h3 id="2-Docker简介"><a href="#2-Docker简介" class="headerlink" title="2. Docker简介"></a>2. Docker简介</h3><h4 id="2-1-Docker是什么"><a href="#2-1-Docker是什么" class="headerlink" title="2.1 Docker是什么"></a>2.1 Docker是什么</h4><p>​    开发人员通过Docker将他们的想法变为现实将软件打包为标准化单元，<strong><code>用于开发、装运和部署容器是一个标准的软件单元</code></strong>，它封装代码及其所有依赖项，以便应用程序从一个计算环境快速可靠地运行到另一个环境。        </p>
<p>​    Docker容器镜像是一个轻量级、独立的可执行软件包，包括运行应用程序所需的一切：代码、运行时、系统工具、系统库和设置。<br>​    容器镜像在运行时会变成容器，在Docker容器的情况下，镜像在Docker引擎上运行时会成为容器。容器化软件可用于基于Linux和Windows的应用程序，无论基础结构如何，都将始终运行相同的软件。容器将软件与其环境隔离开来，并确保它统一工作，尽管存在差异，例如开发和阶段之间的差异。<br>​    2013年，Docker推出了集装箱行业标准。容器是一个标准化的软件单元，允许开发人员将应用程序与其环境隔离，解决“它在我的机器上工作”的难题。对于今天数以百万计的开发人员来说，Docker是构建和共享容器化应用程序的事实标准——从桌面到云。我们正在为开发人员和开发团队构建从代码到云的独特连接体验。</p>
<h4 id="2-2-Docker的目标"><a href="#2-2-Docker的目标" class="headerlink" title="2.2 Docker的目标"></a>2.2 Docker的目标</h4><p>docker的主要目标是”Build,Ship and Run any App,Angwhere”, 构建，运输，处处运行</p>
<ul>
<li>构建：做一个docker镜像</li>
<li>运输：docker pull or push</li>
<li>运行：启动一个容器</li>
</ul>
<p>每一个容器，他都有自己的文件系统<strong>rootfs</strong>。</p>
<h3 id="3-Docker熟识"><a href="#3-Docker熟识" class="headerlink" title="3. Docker熟识"></a>3. Docker熟识</h3><h4 id="3-1-Docker部署及配置"><a href="#3-1-Docker部署及配置" class="headerlink" title="3.1 Docker部署及配置"></a>3.1 Docker部署及配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">$ yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line">$ yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3</span></span><br><span class="line">$ sed -i <span class="string">'s+download.docker.com+mirrors.aliyun.com/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 4: 更新并安装Docker-CE</span></span><br><span class="line">$ yum makecache fast</span><br><span class="line">$ yum -y install docker-ce</span><br><span class="line"><span class="comment"># Step 4: 开启Docker服务</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span>  --now docker </span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，您可以通过以下方式开启。同理可以开启各种测试版本等。</span></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="comment">#   将[docker-ce-test]下方的enabled=0修改为enabled=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span></span><br><span class="line"><span class="comment">#   Loading mirror speeds from cached hostfile</span></span><br><span class="line"><span class="comment">#   Loaded plugins: branch, fastestmirror, langpacks</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   Available Packages</span></span><br><span class="line"><span class="comment"># Step2: 安装指定版本的Docker-CE: (VERSION例如上面的17.03.0.ce.1-1.el7.centos)</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-[VERSION]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 配置镜像加速器</span></span><br><span class="line">$ mkdir -p /etc/docker</span><br><span class="line">$ tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123; </span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [ <span class="string">"http://hub-mirror.c.163.com"</span>, </span><br><span class="line">  <span class="string">"https://docker.m.daocloud.io"</span>, </span><br><span class="line">  <span class="string">"https://dockerproxy.com"</span>, </span><br><span class="line">  <span class="string">"https://docker.mirrors.ustc.edu.cn"</span>, </span><br><span class="line">  <span class="string">"https://docker.nju.edu.cn"</span> ] </span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看是否生效</span></span><br><span class="line">$ docker info |grep -A 5 <span class="string">'Registry Mirrors'</span></span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  http://hub-mirror.c.163.com/</span><br><span class="line">  https://docker.m.daocloud.io/</span><br><span class="line">  https://dockerproxy.com/</span><br><span class="line">  https://docker.mirrors.ustc.edu.cn/</span><br><span class="line">  https://docker.nju.edu.cn/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动nginx:1.21容器，并且后台运行</span></span><br><span class="line">$ docker container run \</span><br><span class="line">	-itd  \</span><br><span class="line">	--name webserver01 \</span><br><span class="line">    -p 8080:80 \</span><br><span class="line">    nginx:1.21</span><br><span class="line">	<span class="comment"># 参数解释</span></span><br><span class="line">		-i：让容器的标准输入打开</span><br><span class="line">		-t：分配一个伪终端</span><br><span class="line">		-d：后台启动</span><br><span class="line">		-p: 将宿主机的8080端口映照至容器的80端口</span><br><span class="line">	<span class="comment"># 执行命令终端部分回显如下：</span></span><br><span class="line">Unable to find image <span class="string">'nginx:1.21'</span> locally</span><br><span class="line">1.21: Pulling from library/nginx</span><br><span class="line">1fe172e4850f: Pull complete</span><br><span class="line">35c195f487df: Pull complete</span><br><span class="line">213b9b16f495: Pull complete</span><br><span class="line">a8172d9e19b9: Pull complete</span><br><span class="line">f5eee2cb2150: Pull complete</span><br><span class="line">93e404ba8667: Pull complete</span><br><span class="line">Digest: sha256:859ab6768a6f26a79bc42b231664111317d095a4f04e4b6fe79ce37b3d199097</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:1.21</span><br><span class="line">28a074f14de734d565b61d49f8dd1fd005a7da696b381ec3514fe89449ae96b3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前台运行nginx容器，退出时删除</span></span><br><span class="line">$ docker container run -it nginx:1.21</span><br></pre></td></tr></table></figure>

<p>测试访问：宿主机IP+8080<br><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/3.jpg" alt></p>
<h4 id="3-2-Docker架构"><a href="#3-2-Docker架构" class="headerlink" title="3.2 Docker架构"></a>3.2 Docker架构</h4><p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/4.jpg" alt></p>
<ol>
<li><strong>Docker Client（Docker 客户端）</strong></li>
</ol>
<p>Docker 客户端是用户与 Docker 系统交互的接口。用户通过 CLI 命令（如 <code>docker run</code>、<code>docker build</code>）与 Docker 守护进程通信，发出管理容器的各种指令。</p>
<ol start="2">
<li><strong>Dockerd（Docker 守护进程）</strong></li>
</ol>
<p>Dockerd 是 Docker 的核心守护进程，负责处理来自 Docker 客户端的请求。它管理 Docker 容器、镜像、网络和数据卷，并将请求传递给下一级组件（如 Containerd）。通过 gRPC 与 Containerd 通信。</p>
<ol start="3">
<li><strong>Containerd</strong></li>
</ol>
<p>Containerd 是一个高级容器运行时，负责管理容器的整个生命周期。它处理容器的创建、执行、挂载存储和网络管理。通过 gRPC 接收 Dockerd 的指令，并进一步传递给 Runc 和 Shim。</p>
<ol start="4">
<li><strong>Runc</strong></li>
</ol>
<p>Runc 是一个 CLI 工具，用于根据 Open Container Initiative (OCI) 规范创建和运行容器。Runc 实际上负责执行容器的启动、停止等底层操作。它通过 <code>fork</code> 进程来创建容器。</p>
<ol start="5">
<li><strong>Shim</strong></li>
</ol>
<p>Shim 是一个中介程序，在容器与 Containerd 之间提供隔离。当 Runc 启动容器后，Shim 保持容器运行并将 Runc 从系统进程中分离。这样，如果 Containerd 需要重启或崩溃，容器仍然可以继续运行。<strong>充当父进程，当容器的应用进程结束时，Shim负责接收容器的退出状态并清理资源。</strong></p>
<h4 id="3-3-Docker基本指令"><a href="#3-3-Docker基本指令" class="headerlink" title="3.3 Docker基本指令"></a>3.3 Docker基本指令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker version</span></span><br><span class="line"></span><br><span class="line">Client: Docker Engine - Community	<span class="comment"># 这是社区版本的 Docker 引擎。</span></span><br><span class="line"> Version:           26.1.1		<span class="comment"># Docker 客户端的版本号。</span></span><br><span class="line"> API version:       1.45		<span class="comment"># Docker API 的版本号。Docker引擎通信的接口。</span></span><br><span class="line"> Go version:        go1.21.9	<span class="comment"># Go 版本</span></span><br><span class="line"> Git commit:        4cf5afa	<span class="comment"># 编译客户端时使用的 Git 提交哈希值。这是特定构建的唯一标识符。</span></span><br><span class="line"> Built:             Tue Apr 30 11:51:00 2024	<span class="comment"># 客户端的构建时间。</span></span><br><span class="line"> OS/Arch:           linux/amd64		<span class="comment"># 客户端运行的操作系统和架构</span></span><br><span class="line"> Context:           default		<span class="comment"># Docker Context 是 Docker CLI 的配置，允许用户在多个 Docker 主机之间轻松切换。</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          26.1.1</span><br><span class="line">  API version:      1.45 (minimum version 1.24)</span><br><span class="line">  Go version:       go1.21.9</span><br><span class="line">  Git commit:       ac2de55</span><br><span class="line">  Built:            Tue Apr 30 11:49:57 2024</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> </span><br><span class="line"> containerd:	<span class="comment"># containerd 是一个容器运行时，负责在宿主机上管理容器的生命周期。</span></span><br><span class="line">  Version:          1.6.31</span><br><span class="line">  GitCommit:        e377cd56a71523140ca6ae87e30244719194a521</span><br><span class="line"> </span><br><span class="line"> runc:	<span class="comment"># runc 是一个 CLI 工具，用于根据 OCI 规范运行容器。</span></span><br><span class="line">  Version:          1.1.12</span><br><span class="line">  GitCommit:        v1.1.12-0-g51d5e94</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br><span class="line">  </span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker info </span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:    26.1.1</span><br><span class="line"> Context:    default</span><br><span class="line"> Debug Mode: <span class="literal">false</span></span><br><span class="line"> Plugins:</span><br><span class="line">  buildx: Docker Buildx (Docker Inc.)</span><br><span class="line">    Version:  v0.14.0</span><br><span class="line">    Path:     /usr/libexec/docker/cli-plugins/docker-buildx</span><br><span class="line">  compose: Docker Compose (Docker Inc.)</span><br><span class="line">    Version:  v2.27.0</span><br><span class="line">    Path:     /usr/libexec/docker/cli-plugins/docker-compose</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 2</span><br><span class="line">  Running: 2	<span class="comment"># 正在运行的容器数量，这里是 2。</span></span><br><span class="line">  Paused: 0	 	<span class="comment"># 暂停的容器数量，这里是 0。</span></span><br><span class="line">  Stopped: 0	<span class="comment"># 停止的容器数量，这里是 0。</span></span><br><span class="line"> Images: 2		<span class="comment">#  Docker 镜像的数量，这里是 2。</span></span><br><span class="line"> Server Version: 26.1.1		<span class="comment"># Docker 服务器的版本号，这里是 26.1.1。</span></span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: xfs	<span class="comment"># 底层文件系统，这里是 xfs。</span></span><br><span class="line">  Supports d_type: <span class="literal">true</span></span><br><span class="line">  Using metacopy: <span class="literal">false</span></span><br><span class="line">  Native Overlay Diff: <span class="literal">true</span></span><br><span class="line">  userxattr: <span class="literal">false</span></span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Cgroup Version: 1</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: <span class="built_in">local</span></span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file <span class="built_in">local</span> splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: io.containerd.runc.v2 runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: e377cd56a71523140ca6ae87e30244719194a521</span><br><span class="line"> runc version: v1.1.12-0-g51d5e94</span><br><span class="line"> init version: de40ad0</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: <span class="built_in">builtin</span></span><br><span class="line"> Kernel Version: 3.10.0-1160.el7.x86_64</span><br><span class="line"> Operating System: CentOS Linux 7 (Core)</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 2</span><br><span class="line"> Total Memory: 3.84GiB</span><br><span class="line"> Name: docker-ce</span><br><span class="line"> ID: f0bf43f3-cec5-41dd-8c3d-673a340c7237</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: <span class="literal">false</span></span><br><span class="line"> Experimental: <span class="literal">false</span></span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https://kr1xs9ba.mirror.aliyuncs.com/	</span><br><span class="line"> Live Restore Enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>


<h3 id="4-Docker镜像管理"><a href="#4-Docker镜像管理" class="headerlink" title="4. Docker镜像管理"></a>4. Docker镜像管理</h3><h4 id="4-1-登录官方镜像仓库"><a href="#4-1-登录官方镜像仓库" class="headerlink" title="4.1 登录官方镜像仓库"></a>4.1 登录官方镜像仓库</h4><p>链接：<a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker login</span></span><br><span class="line">Log <span class="keyword">in</span> with your Docker ID or email address to push and pull images from Docker Hub. If you don<span class="string">'t have a Docker ID, head over to https://hub.docker.com/ to create one.</span></span><br><span class="line"><span class="string">You can log in with your password or a Personal Access Token (PAT). Using a limited-scope PAT grants better security and is required for organizations using SSO. Learn more at https://docs.docker.com/go/access-tokens/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Username: 2364736365@qq.com      </span></span><br><span class="line"><span class="string">Password: </span></span><br><span class="line"><span class="string">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span><br><span class="line"><span class="string">Configure a credential helper to remove this warning. See</span></span><br><span class="line"><span class="string">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Login Succeeded</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 退出</span></span><br><span class="line"><span class="string">[root@docker-ce ~]# docker logout</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-搜索官方仓库镜像-docker-search-lt-image-name-gt"><a href="#4-2-搜索官方仓库镜像-docker-search-lt-image-name-gt" class="headerlink" title="4.2 搜索官方仓库镜像 docker search &lt;image_name&gt;"></a>4.2 搜索官方仓库镜像 <code>docker search &lt;image_name&gt;</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker search nginx | head -3</span></span><br><span class="line">NAME                        DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                       Official build of Nginx.                        16723     [OK]</span><br><span class="line">bitnami/nginx               Bitnami nginx Docker Image                      124                  [OK]</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/5.jpg" alt="image-20240908142046077"></p>
<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/6.jpg" alt></p>
<h4 id="4-2-获取镜像-docker-pull-lt-image-name-gt-lt-tag-gt"><a href="#4-2-获取镜像-docker-pull-lt-image-name-gt-lt-tag-gt" class="headerlink" title="4.2 获取镜像 docker pull &lt;image_name&gt;:&lt;tag&gt;"></a>4.2 获取镜像 <code>docker pull &lt;image_name&gt;:&lt;tag&gt;</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker pull tomcat:8-jdk8-corretto</span></span><br><span class="line">8-jdk8-corretto: Pulling from library/tomcat</span><br><span class="line">8de5b65bd171: Pull complete</span><br><span class="line">00e9707b9594: Pull complete</span><br><span class="line">a4d7141ce82b: Pull complete</span><br><span class="line">683f96ff9142: Pull complete</span><br><span class="line">021d0aeb9b5a: Pull complete</span><br><span class="line">Digest: sha256:5519094808b33f320cb8821e6789ae813d1c71ee3dd03ecc35035fb94be37a3e</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> tomcat:8-jdk8-corretto</span><br><span class="line">docker.io/library/tomcat:8-jdk8-corretto</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看本地所有镜像</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY   TAG               IMAGE ID       CREATED                  SIZE</span><br><span class="line">tomcat       8-jdk8-corretto   6aa794aeaf2e   Less than a second ago   379MB</span><br><span class="line">nginx        1.21              fa5269854a5e   12 days ago              142MB</span><br></pre></td></tr></table></figure>

<h4 id="4-3-导出镜像-docker-image-save-lt-image-name-gt-lt-tag-gt-gt-to-path-lt-image-name-gt-tar-gz"><a href="#4-3-导出镜像-docker-image-save-lt-image-name-gt-lt-tag-gt-gt-to-path-lt-image-name-gt-tar-gz" class="headerlink" title="4.3 导出镜像 docker image save &lt;image_name&gt;:&lt;tag&gt; &gt;/to/path/&lt;image_name&gt;.tar.gz"></a>4.3 导出镜像 <code>docker image save &lt;image_name&gt;:&lt;tag&gt; &gt;/to/path/&lt;image_name&gt;.tar.gz</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker image \</span><br><span class="line">	save tomcat:8-jdk8-corretto &gt;/opt/docker-images-tar/tomcat-8-jdk-corretto.tar.gz</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 提示：导出时需要指定镜像的名称和版本，否则再次导入时镜像名称为空</p>
</blockquote>
<h4 id="4-4-导入镜像-docker-image-load-i-to-path-lt-image-name-gt-tar-gz"><a href="#4-4-导入镜像-docker-image-load-i-to-path-lt-image-name-gt-tar-gz" class="headerlink" title="4.4 导入镜像: docker image load -i /to/path/&lt;image_name&gt;.tar.gz"></a>4.4 导入镜像: <code>docker image load -i /to/path/&lt;image_name&gt;.tar.gz</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ docker image load -i /opt/docker-images-tar/tomcat-8-jdk-corretto.tar.gz</span><br><span class="line">2ce46c79ab58: Loading layer [==================================================&gt;]  171.1MB/171.1MB</span><br><span class="line">adfbec3e67f4: Loading layer [==================================================&gt;]  184.6MB/184.6MB</span><br><span class="line">62ad8969b17a: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">693367907f2b: Loading layer [==================================================&gt;]  31.19MB/31.19MB</span><br><span class="line">21dcce1be3e6: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">Loaded image: tomcat:8-jdk8-corretto</span><br><span class="line"></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY   TAG               IMAGE ID       CREATED                  SIZE</span><br><span class="line">tomcat       8-jdk8-corretto   6aa794aeaf2e   Less than a second ago   379MB</span><br><span class="line">nginx        1.21              fa5269854a5e   12 days ago              142MB</span><br></pre></td></tr></table></figure>

<h4 id="4-5-删除镜像"><a href="#4-5-删除镜像" class="headerlink" title="4.5 删除镜像"></a>4.5 删除镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY   TAG               IMAGE ID       CREATED                  SIZE</span><br><span class="line">tomcat       8-jdk8-corretto   6aa794aeaf2e   Less than a second ago   379MB</span><br><span class="line">nginx        1.21              fa5269854a5e   12 days ago              142MB</span><br><span class="line"></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker image rmi tomcat:8-jdk8-corretto</span></span><br><span class="line">Untagged: tomcat:8-jdk8-corretto</span><br><span class="line">Untagged: tomcat@sha256:5519094808b33f320cb8821e6789ae813d1c71ee3dd03ecc35035fb94be37a3e</span><br><span class="line">Deleted: sha256:6aa794aeaf2e3b423640cb6c28c62735c517b5cf0ac2067f1a6ebc4b826adf35</span><br><span class="line">Deleted: sha256:377575e0dcdd8ca0c48ad4bb750fdef5671d7422e5dfac0aa1056afb3ac0391b</span><br><span class="line">Deleted: sha256:cd150b0a9540259ba404d900d5a4decefb51d5d64f912edf71fc4fbdf1b275b6</span><br><span class="line">Deleted: sha256:e18b666124eab8f055392a4bc8dc0dd3f861963b7c872d535a4ad103192b9def</span><br><span class="line">Deleted: sha256:e3469860a4508d511a68fd1d5ed754565b5c922cc3b283d195a56e42b97d7192</span><br><span class="line">Deleted: sha256:2ce46c79ab58cf3d6f9556e9141c0564407a50028040a94bb8a82ab6e33331c2</span><br><span class="line"></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY   TAG               IMAGE ID       CREATED                  SIZE</span><br><span class="line">nginx        1.21              fa5269854a5e   12 days ago              142MB</span><br></pre></td></tr></table></figure>

<blockquote>
<h1 id="删除镜像-删除镜像需要保证没有基于此镜像运行容器，否则需要先删除容器"><a href="#删除镜像-删除镜像需要保证没有基于此镜像运行容器，否则需要先删除容器" class="headerlink" title="删除镜像(删除镜像需要保证没有基于此镜像运行容器，否则需要先删除容器)"></a>删除镜像(删除镜像需要保证没有基于此镜像运行容器，否则需要先删除容器)</h1></blockquote>
<h4 id="4-6-查看镜像详细信息"><a href="#4-6-查看镜像详细信息" class="headerlink" title="4.6 查看镜像详细信息"></a>4.6 查看镜像详细信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker image inspect nginx:1.21</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"sha256:fa5269854a5e615e51a72b17ad3fd1e01268f278a6684c8ed3c5f0cdce3f230b"</span>,</span><br><span class="line">        <span class="string">"RepoTags"</span>: [</span><br><span class="line">            <span class="string">"nginx:1.21"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"RepoDigests"</span>: [</span><br><span class="line">            <span class="string">"nginx@sha256:859ab6768a6f26a79bc42b231664111317d095a4f04e4b6fe79ce37b3d199097"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Parent"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Comment"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2022-04-20T10:43:12.055940177Z"</span>,</span><br><span class="line">        <span class="string">"Container"</span>: <span class="string">"3c8758320eb6a5293e75ce1ff5afe91584a72b4ee400792f34985a27673ffbc2"</span>,</span><br><span class="line">        <span class="string">"ContainerConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"3c8758320eb6"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ExposedPorts"</span>: &#123;</span><br><span class="line">                <span class="string">"80/tcp"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [	<span class="comment"># 容器加载的环境变量</span></span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/lo cal/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>,</span><br><span class="line">                <span class="string">"NGINX_VERSION=1.21.6"</span>,</span><br><span class="line">                <span class="string">"NJS_VERSION=0.7.2"</span>,</span><br><span class="line">                <span class="string">"PKG_RELEASE=1~bullseye"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [	<span class="comment"># 容器的启动命令</span></span><br><span class="line">                <span class="string">"/bin/sh"</span>,</span><br><span class="line">                <span class="string">"-c"</span>,</span><br><span class="line">                <span class="string">"#(nop) "</span>,</span><br><span class="line">                <span class="string">"CMD [\"nginx\" \"-g\" \"daemon off;\"]"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Image"</span>: 	<span class="comment"># 镜像ID	"sha256:e158bbfdf1201dbc8876232cef4465c5f69c1fd0986f05ee48291a92debc21a0",</span></span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: [</span><br><span class="line">                <span class="string">"/docker-entrypoint.sh"</span></span><br><span class="line">            ],</span><br><span class="line">   ......</span><br><span class="line">   ......</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="4-7-镜像的拉取策略（了解：Kubernetes-Pod章节细讲）"><a href="#4-7-镜像的拉取策略（了解：Kubernetes-Pod章节细讲）" class="headerlink" title="4.7 镜像的拉取策略（了解：Kubernetes Pod章节细讲）"></a>4.7 镜像的拉取策略（了解：Kubernetes Pod章节细讲）</h4><p>在 Docker 中，镜像拉取策略（Image Pull Policy）决定了在启动容器时如何拉取镜像。指定镜像拉取策略可以控制 Docker 是否从注册表中拉取最新的镜像，或者使用本地缓存的镜像。</p>
<ol>
<li><p><strong>IfNotPresent</strong>（默认策略）： </p>
<ul>
<li>仅当本地不存在指定的镜像时才从注册表中拉取镜像。如果本地已有该镜像，则使用本地镜像。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker run --pull=ifnotpresent &lt;image_name&gt;:&lt;image_id&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>Always</strong>： </p>
<ul>
<li>每次启动容器时总是从注册表中拉取镜像，无论本地是否已有该镜像。</li>
<li>适用于需要确保总是使用最新版本镜像的情况，确保容器总是基于最新的镜像版本启动。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker run --pull=always &lt;image_name&gt;:&lt;image_id&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>Never</strong>： </p>
<ul>
<li>仅使用本地已有的镜像，从不从注册表中拉取镜像。如果本地不存在指定的镜像，则启动容器会失败。</li>
<li>适用于不希望或无法访问镜像注册表的情况，确保使用本地镜像缓存。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-ce ~]<span class="comment"># docker run --pull=never &lt;image_name&gt;:&lt;image_id&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h4 id="4-8-阿里云镜像仓库使用"><a href="#4-8-阿里云镜像仓库使用" class="headerlink" title="4.8 阿里云镜像仓库使用"></a>4.8 阿里云镜像仓库使用</h4><p>官网：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 退出Docker官方镜像仓库</span></span><br><span class="line">$ docker <span class="built_in">logout</span></span><br><span class="line">Removing login credentials <span class="keyword">for</span> https://index.docker.io/v1/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录阿里云Docker Registry</span></span><br><span class="line">$ docker login --username=aliyun6412327368 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从Registry中拉取镜像</span></span><br><span class="line">$ docker pull registry.cn-hangzhou.aliyuncs.com/hujiaming/jiaming:[镜像版本号]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将镜像推送到Registry</span></span><br><span class="line">$ docker login --username=aliyun6412327368 registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">$ docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/hujiaming/jiaming:[镜像版本号]</span><br><span class="line">$ docker push registry.cn-hangzhou.aliyuncs.com/hujiaming/jiaming:[镜像版本号]</span><br></pre></td></tr></table></figure>

<h3 id="5-容器的日常管理"><a href="#5-容器的日常管理" class="headerlink" title="5. 容器的日常管理"></a>5. 容器的日常管理</h3><p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/7.jpg" alt="aa"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看本地所有容器</span></span><br><span class="line">$ docker container ls</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动一个容器</span></span><br><span class="line">$ docker run -itd --name webserver -p 80:80 nginx:1.21</span><br><span class="line">1257c74b96d9ebebb34e23844838debb1873d5cec7ae5206551dc2463ca8f94a</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看正在运行的容器</span></span><br><span class="line">$ docker ps </span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                   CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">1257c74b96d9   nginx:1.21   <span class="string">"/docker-entrypoint.…"</span>   12 seconds ago   Up 11 seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   webserver</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看所有的容器包括退出</span></span><br><span class="line">$ docker ps -a </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看所有的容器ID包括退出</span></span><br><span class="line">$ docker ps -aq</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 停止/杀死/重启容器</span></span><br><span class="line">$ docker container stop/<span class="built_in">kill</span>/restart webserver</span><br><span class="line">webserver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                   CREATED              STATUS                     PORTS     NAMES</span><br><span class="line">1257c74b96d9   nginx:1.21   <span class="string">"/docker-entrypoint.…"</span>   About a minute ago   Exited (0) 8 seconds ago             webserver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定容器</span></span><br><span class="line">$ docker container rm webserver</span><br><span class="line">webserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止所有的容器（慎用）</span></span><br><span class="line">$ docker stop `docker ps -q`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除已经退出的容器（慎用）</span></span><br><span class="line">$ docker rm `docker ps -a |grep Exited | awk <span class="string">'&#123;print $1&#125;'</span>`</span><br></pre></td></tr></table></figure>
<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/8.jpg" alt></p>
<ol>
<li><strong>CONTAINER ID</strong>: <ul>
<li>容器的唯一标识符（ID）。</li>
</ul>
</li>
<li><strong>IMAGE</strong>: <ul>
<li>容器所使用的 Docker 镜像。</li>
</ul>
</li>
<li><strong>COMMAND</strong>: <ul>
<li>容器启动时运行的命令。</li>
</ul>
</li>
<li><strong>CREATED</strong>: <ul>
<li>容器创建的时间。容器是在 <code>35 minutes ago</code>（35 分钟前）创建的。</li>
</ul>
</li>
<li><strong>STATUS</strong>: <ul>
<li>容器的当前状态和运行时间。状态是 <code>Up 25 minutes</code>，表示容器已经运行了 25 分钟。</li>
</ul>
</li>
<li><strong>PORTS</strong>: <ul>
<li>容器的端口映射信息。 <ul>
<li><code>0.0.0.0:80-&gt;80/tcp</code> 表示宿主机的 <code>80</code> 端口映射到容器的 <code>80</code> 端口，使用 TCP 协议。</li>
<li><code>:::80-&gt;80/tcp</code> 表示在所有 IPv6 地址上，宿主机的 <code>80</code> 端口映射到容器的 <code>80</code> 端口，使用 TCP 协议。</li>
</ul>
</li>
</ul>
</li>
<li><strong>NAMES</strong>: <ul>
<li>容器的名称。</li>
</ul>
</li>
</ol>
<p>这个 Docker 容器使用 <code>nginx:1.21</code> 镜像，在 35 分钟前创建，并已经运行了 25 分钟。它将宿主机的 <code>80</code> 端口映射到容器的 <code>80</code> 端口，容器名称是 <code>webserver</code>。</p>
<h4 id="5-2-查看容器的日志"><a href="#5-2-查看容器的日志" class="headerlink" title="5.2 查看容器的日志"></a>5.2 查看容器的日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器的日志</span></span><br><span class="line">$ docker logs -f &lt;容器名称/容器ID&gt;  --tail 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者：</span></span><br><span class="line">$ <span class="built_in">cd</span> /var/lib/docker/containers/&lt;容器id&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/9.jpg" alt></p>
<h4 id="5-3-查看容器的IP地址"><a href="#5-3-查看容器的IP地址" class="headerlink" title="5.3 查看容器的IP地址"></a>5.3 查看容器的IP地址</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect &lt;容器名称/容器ID&gt; | grep -i -w <span class="string">"ipaddress"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ docker inspect --format <span class="string">'&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;'</span> &lt;容器ID/容器名称&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/10.jpg" alt></p>
<h4 id="5-4-进入容器的方法"><a href="#5-4-进入容器的方法" class="headerlink" title="5.4 进入容器的方法"></a>5.4 进入容器的方法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker container run -itd --name webserver -p 8080:80 nginx:1.21</span><br><span class="line">da5151566915f5acce7cf8cb75e475b1ca69860e7a0b64e33600b9aba2eeda1b</span><br><span class="line"></span><br><span class="line">$ docker container <span class="built_in">exec</span> -it webserver bash</span><br><span class="line">root@da5151566915:/<span class="comment"># ls /etc/nginx/conf.d/</span></span><br><span class="line">default.conf</span><br><span class="line">root@da5151566915:/<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h4 id="5-5-容器与宿主机间传输文件"><a href="#5-5-容器与宿主机间传输文件" class="headerlink" title="5.5 容器与宿主机间传输文件"></a>5.5 容器与宿主机间传输文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将容器的文件拷贝至宿主机中</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker cp webserver:/usr/share/nginx/html/index.html  /tmp/</span></span><br><span class="line">Successfully copied 2.05kB to /tmp/</span><br><span class="line"></span><br><span class="line">[root@docker-ce ~]<span class="comment"># echo "2401" &gt;  /tmp/index.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 宿主机的文件拷贝至容器中</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker cp /tmp/index.html webserver:/usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure>

<h4 id="5-6-容器的状态（了解，Kubernetes细讲Pod的状态）"><a href="#5-6-容器的状态（了解，Kubernetes细讲Pod的状态）" class="headerlink" title="5.6 容器的状态（了解，Kubernetes细讲Pod的状态）"></a>5.6 容器的状态（了解，<code>Kubernetes细讲Pod的状态</code>）</h4><p><strong>Created</strong>:</p>
<ul>
<li>容器已经被创建，但尚未启动。此时，容器处于一种待机状态，等待进一步的操作。</li>
</ul>
<p><strong>Running</strong>:</p>
<ul>
<li>容器正在运行并执行其主要进程。处于此状态的容器可以处理请求和数据。</li>
<li><code>docker ps</code> 可以显示所有正在运行的容器。</li>
</ul>
<p><strong>Paused</strong>:</p>
<ul>
<li>容器的所有进程被暂停（挂起）。此时，容器的 CPU 资源被释放，但内存等其他资源仍然占用。</li>
<li>你可以通过 <code>docker pause &lt;container_id&gt;</code> 暂停一个容器，并通过 <code>docker unpause &lt;container_id&gt;</code> 恢复它。</li>
</ul>
<p><strong>Restarting</strong>:</p>
<ul>
<li>容器正在重新启动。通常，这种情况发生在容器配置了自动重启策略时，其进程由于某种原因终止并触发重启。</li>
</ul>
<p><strong>Exited</strong>:</p>
<ul>
<li>容器的主进程已经停止运行，并且没有自动重启策略，或者重启策略未能触发。容器退出状态码可以通过 <code>docker inspect</code> 命令查看。</li>
<li><code>docker ps -a</code> 可以显示所有包含已退出容器的列表。</li>
</ul>
<p><strong>Dead</strong>:</p>
<ul>
<li>容器遇到严重问题，无法恢复。通常，这是 Docker 容器处于崩溃状态的标志，需要人工干预来处理这个容器。</li>
</ul>
<h4 id="5-7-容器的重启策略"><a href="#5-7-容器的重启策略" class="headerlink" title="5.7 容器的重启策略"></a>5.7 容器的重启策略</h4><p>略，<code>Kubernetes细讲</code></p>
<h4 id="5-8-容器重命名-慎用"><a href="#5-8-容器重命名-慎用" class="headerlink" title="5.8 容器重命名(慎用)"></a>5.8 容器重命名(慎用)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看正在运行的容器</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker ps </span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                   CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">804a660194cc   nginx     <span class="string">"/docker-entrypoint.…"</span>   43 seconds ago   Up 41 seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   webserver02</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改容器的名称</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker rename webserver02 webserver01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看正在运行的容器名称</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                   CREATED              STATUS              PORTS                               NAMES</span><br><span class="line">804a660194cc   nginx     <span class="string">"/docker-entrypoint.…"</span>   About a minute ago   Up About a minute   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   webserver01</span><br></pre></td></tr></table></figure>



<h3 id="6-Docker数据卷的管理"><a href="#6-Docker数据卷的管理" class="headerlink" title="6. Docker数据卷的管理"></a>6. Docker数据卷的管理</h3><p>​    Docker 存储卷（Volume）是用于将数据从容器持久化到宿主机中的一种机制。存储卷可以在容器之间共享和重用，即使容器被删除，卷中的数据仍然会保留。这样容器就算重启数据依然存在！数据卷是经过特殊设计的目录，同一个数据卷可以只支持多个容器的访问。可以对数据卷里的内容直接进行修改。数据卷的变化不会影像镜像的更新。数据卷会一直存在，即使挂载数据卷的容器已经被删除。</p>
<p><strong>数据卷的特点</strong></p>
<ul>
<li>数据卷在容器启动时初始化，如果容器使用的镜像在挂载点包含了数据，这些数据会被拷贝到新初始化的数据卷中。</li>
<li>数据卷可以在容器之间共享和重用。</li>
<li>可以对数据卷里的内容直接进行修改。</li>
<li>数据卷的变化不会影像镜像的更新。</li>
<li>卷会一直存在，即使挂载数据卷的容器已经被删除。</li>
</ul>
<p><strong>Docker数据卷的三种方式</strong></p>
<ul>
<li><strong>Volumes</strong>: <ul>
<li>Docker 管理宿主机文件系统的一部分（/var/lib/docker/volumes）。保存数据的最佳方式。</li>
</ul>
</li>
<li><strong>Bind mounts</strong>: <ul>
<li>将宿主机的任意位置的文件或者目录挂载到容器中。</li>
</ul>
</li>
<li><strong>tmpfs</strong>：<ul>
<li>挂载存储在主机系统的内存中，而不会写入主机的文件系统。如果不希望将数据持久存储在任何位置，可以使用tmpfs，同时避免写入容器可写层提高性能。</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/11.jpg" alt></p>
<h4 id="6-1-挂载时创建卷（数据卷-临时卷）"><a href="#6-1-挂载时创建卷（数据卷-临时卷）" class="headerlink" title="6.1 挂载时创建卷（数据卷/临时卷）"></a>6.1 挂载时创建卷（数据卷/临时卷）</h4><p>自己指定目录，不管目录有无内容都会覆盖容器目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /opt/docker-volumes		</span><br><span class="line"></span><br><span class="line">$ docker rm -f $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line">$ docker container run \</span><br><span class="line">	-itd --name webserver \</span><br><span class="line">	-p 8080:80 \</span><br><span class="line">	-v /opt/docker-volumes/webserver:/usr/share/nginx/html \</span><br><span class="line">	nginx:1.21</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ curl http://localhost:8080</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.21.6&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello docker volume"</span> &gt;/opt/docker-volumes/webserver/index.html</span><br><span class="line"></span><br><span class="line">$ curl http://localhost:8080</span><br><span class="line">hello docker volume</span><br></pre></td></tr></table></figure>



<h4 id="6-2-挂载指定volume（数据卷容器）"><a href="#6-2-挂载指定volume（数据卷容器）" class="headerlink" title="6.2 挂载指定volume（数据卷容器）"></a>6.2 挂载指定volume（数据卷容器）</h4><p>​    volume是Docker官方推荐的持久化方案，默认情况下，volume的存储空间来自于宿主机文件系统中的某个目录，如<strong>/var/lib/docker/volumes/</strong>，docker系统外的程序无权限修改其中的数据。一个volume可以同时供多个container使用，如果没有container使用volume，其不会自动删除，用户需运行<strong>docker volume prune</strong>明确删除。</p>
<p>​    <strong>如果容器中的目录不存在，docker会自动创建目录；如果容器中的目录已有内容，docker会使用宿主机上目录的内容覆盖容器目录的内容。宿主机目录为空的话，容器目录不为空，容器目录会覆盖宿主机目录。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建卷</span></span><br><span class="line">$ docker volume create nginx-test01</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看卷</span></span><br><span class="line">$ docker volume ls </span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     nginx-test01</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看卷的详细信息</span></span><br><span class="line">$ docker volume inspect nginx-test01</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"CreatedAt"</span>: <span class="string">"2024-06-11T20:58:55+08:00"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Labels"</span>: null,</span><br><span class="line">        <span class="string">"Mountpoint"</span>: <span class="string">"/var/lib/docker/volumes/nginx-test01/_data"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"nginx-test01"</span>,</span><br><span class="line">        <span class="string">"Options"</span>: null,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看nginx-test01持久卷的存放位置</span></span><br><span class="line">$ ll /var/lib/docker/volumes/nginx-test01/_data/</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 挂载测试卷</span></span><br><span class="line">$ docker run -itd \</span><br><span class="line">	--name webserver03 \</span><br><span class="line">	-p 81:80  \</span><br><span class="line">	-v nginx-test01:/usr/share/nginx/html  \</span><br><span class="line">	nginx:v1.24.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看容器的详细信息</span></span><br><span class="line">$ docker inspect webserver03</span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"nginx-test01"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/var/lib/docker/volumes/nginx-test01/_data"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/usr/share/nginx/html"</span>,</span><br><span class="line">                <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">"z"</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次查看nginx-test01的数据卷目录</span></span><br><span class="line">$ ll /var/lib/docker/volumes/nginx-test01/_data/</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r-- 1 root root 497 4月  11 2023 50x.html</span><br><span class="line">-rw-r--r-- 1 root root 615 4月  11 2023 index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问容器</span></span><br><span class="line">$ curl 172.17.0.3</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">"http://nginx.org/"</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=<span class="string">"http://nginx.com/"</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改index.html文件内容</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello volume nginx-test01"</span> &gt;  /var/lib/docker/volumes/nginx-test01/_data/index.html </span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次测试</span></span><br><span class="line">$ curl 172.17.0.3</span><br><span class="line">hello volume nginx-test01</span><br></pre></td></tr></table></figure>



<h4 id="6-2-Bind-Mounts持久化（绑定挂载）"><a href="#6-2-Bind-Mounts持久化（绑定挂载）" class="headerlink" title="6.2  Bind Mounts持久化（绑定挂载）"></a>6.2  Bind Mounts持久化（绑定挂载）</h4><p>需要自己创建目录</p>
<p>​    bind mount持久化方式将宿主机中的文件、目录挂载到容器上，相应文件、目录可以被宿主机读写，也可以被容器读写。绑定挂载将主机文件系统中的一个目录挂载到容器中，允许容器直接访问和修改主机上的文件。</p>
<p><strong>使用场景：</strong></p>
<ul>
<li>container共享宿主机配置文件，如docker将宿主机文件/etc/resolv.conf文件bind mount到容器上，两者会使用相同的DNS服务器。</li>
<li>将宿主机开发环境中的源代码或实验结果共享给容器。例如：你在宿主机上进行一个项目Maven的测试，每次你在宿主机上对Maven项目进行了更改后，容器就可以直接获取更改后的结果（最新的代码）。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建数据目录</span></span><br><span class="line">$ mkdir /app/html -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建容器并且指定挂载Bind Mounts的卷</span></span><br><span class="line">$ docker run -itd \</span><br><span class="line">	--name webserver04 \</span><br><span class="line">	-p 82:80  \</span><br><span class="line">	--mount <span class="built_in">type</span>=<span class="built_in">bind</span>,src=/app/html/,dst=/usr/share/nginx/html \</span><br><span class="line">	nginx:v1.24.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看容器guai'z详细信息</span></span><br><span class="line">$ docker inspect webserver04</span><br><span class="line">            <span class="string">"Mounts"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">                    <span class="string">"Source"</span>: <span class="string">"/app/html/"</span>,</span><br><span class="line">                    <span class="string">"Target"</span>: <span class="string">"/usr/share/nginx/html"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 或者</span></span><br><span class="line">$ docker inspect --format=<span class="string">'&#123;&#123;.Mounts&#125;&#125;'</span> &lt;容器id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试访问容器</span></span><br><span class="line">$ curl 172.17.0.3</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.24.0&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建发布文件</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello nginx world"</span> &gt; /app/html/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次测试</span></span><br><span class="line">$ curl 172.17.0.3</span><br><span class="line">hello nginx world</span><br></pre></td></tr></table></figure>
<h5 id="6-2-1-bind-mount注意事项"><a href="#6-2-1-bind-mount注意事项" class="headerlink" title="6.2.1 bind mount注意事项"></a>6.2.1 bind mount注意事项</h5></li>
</ul>
<ul>
<li>宿主机目录路径必须以/或~/开头，否则docker会将其当成是volume 而不是bind mount。</li>
<li>如果宿主机上的目录不存在，docker会自动创建目录（多级的绝对路径好像不行）。</li>
<li>如果容器中的目录不存在，docker会自动创建目录。</li>
<li>如果容器中目录已有内容，那么docker会使用宿主机上目录的内容覆盖容器目录的内容。</li>
</ul>
<h4 id="6-3-tmpfs-mount持久化"><a href="#6-3-tmpfs-mount持久化" class="headerlink" title="6.3 tmpfs mount持久化"></a>6.3 tmpfs mount持久化</h4><p>tmpfs mount只在Linux主机内存中持久化，是临时性的。当容器停止，tmpfs mount会被移除。只能在Linux主机内存中，不会持久化到磁盘。</p>
<p>场景：<br>当启动需要访问这些敏感数据的container或者service时，docker会在宿主机上创建一个tmpfs，然后将敏感数据读出写到tmpfs中，再将tmpfs mount到container中，这样能保证数据安全。当容器停止运行时，则相应的tmpfs也从系统中删除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建容器并且指定他的卷为tmpfs类型</span></span><br><span class="line">$ docker run -itd  \</span><br><span class="line">	--name webserver05  \</span><br><span class="line">	--mount <span class="built_in">type</span>=tmpfs,dst=/usr/share/nginx/html  \</span><br><span class="line">	nginx:v1.24.0</span><br><span class="line">d8a8122c5eb77e4873866ea33406b7e1ec12eb1ed0ec596bcf6761b78afeacce</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看容器的相关信息</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker inspect webserver05</span></span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"tmpfs"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/usr/share/nginx/html"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>


<h4 id="6-4-网络存储（Network-Storage）"><a href="#6-4-网络存储（Network-Storage）" class="headerlink" title="6.4 网络存储（Network Storage）"></a>6.4 网络存储（Network Storage）</h4><p>​    使用网络文件系统（如 NFS等）将远程存储挂载到容器中，适用于需要跨多个主机共享数据的场景。</p>
<ol>
<li><strong>nfs服务器配置</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 修改主机名</span></span><br><span class="line">$ hostnamectl  <span class="built_in">set</span>-hostname nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 关闭防火墙及selinux</span></span><br><span class="line">$ systemctl <span class="built_in">disable</span> --now firewalld &amp;&amp; setenforce 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建共享目录</span></span><br><span class="line">$ mkdir /data</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 安装nfs</span></span><br><span class="line">$ yum -y install nfs-utils rpcbind -y </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 配置nfs</span></span><br><span class="line">$ cat &gt;&gt; cat /etc/exports &lt;&lt;-EOF</span><br><span class="line">/data  *(rw,sync,no_root_squash)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动nfs</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> --now rpcbind nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试挂载</span></span><br><span class="line">$ showmount  -e</span><br><span class="line">Export list <span class="keyword">for</span> nfs-server:</span><br><span class="line">/data *</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>docker服务器配置</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 安装nfs</span></span><br><span class="line">$ yum -y install nfs-utils.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建目录</span></span><br><span class="line">$ mkdir /nfs</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试挂载</span></span><br><span class="line">$ showmount  -e 192.168.174.9</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.174.9:</span><br><span class="line">/data *</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 远程挂载</span></span><br><span class="line">$ mount -t nfs 192.168.174.9:/data /nfs</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看磁盘分区</span></span><br><span class="line">$ df -Th </span><br><span class="line">文件系统                类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                devtmpfs  2.0G     0  2.0G    0% /dev</span><br><span class="line">tmpfs                   tmpfs     2.0G     0  2.0G    0% /dev/shm</span><br><span class="line">tmpfs                   tmpfs     2.0G   12M  2.0G    1% /run</span><br><span class="line">tmpfs                   tmpfs     2.0G     0  2.0G    0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root xfs        17G  3.1G   14G   18% /</span><br><span class="line">/dev/sda1               xfs      1014M  137M  878M   14% /boot</span><br><span class="line">tmpfs                   tmpfs     394M     0  394M    0% /run/user/0</span><br><span class="line">192.168.174.9:/data     nfs4       50G  1.4G   49G    3% /nfs</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>docker测试</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 启动docker</span></span><br><span class="line">$ docker run \</span><br><span class="line">	-itd \</span><br><span class="line">	--name webserver03 \</span><br><span class="line">	-v /nfs/webserver03:/usr/share/nginx/html/  \</span><br><span class="line">	nginx:1.27.1</span><br><span class="line">	</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试</span></span><br><span class="line">$ curl 172.17.0.2</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.27.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 编写测试文件</span></span><br><span class="line">$ <span class="built_in">echo</span> hello,world &gt; /nfs/webserver03/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 再次测试</span></span><br><span class="line">$ curl 172.17.0.2</span><br><span class="line">hello,world</span><br></pre></td></tr></table></figure>



<h4 id="6-4-存储卷的生命周期管理"><a href="#6-4-存储卷的生命周期管理" class="headerlink" title="6.4 存储卷的生命周期管理"></a>6.4 存储卷的生命周期管理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看所有volume</span></span><br><span class="line">$ docker volume ls</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看单个volume详细信息</span></span><br><span class="line">$ docker volume inspect nginx-test01/volume的名称</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"CreatedAt"</span>: <span class="string">"2024-06-11T20:58:55+08:00"</span>,		<span class="comment"># 创建时间</span></span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"local"</span>,		<span class="comment"># 卷的驱动类型。local 是默认驱动，表示卷存储在本地宿主机文件系统中。</span></span><br><span class="line">        <span class="string">"Labels"</span>: null,				<span class="comment"># 卷的标签，用于标记或组织卷。可以为空或包含键值对。</span></span><br><span class="line">        <span class="string">"Mountpoint"</span>: <span class="string">"/var/lib/docker/volumes/nginx-test01/_data"</span>,		<span class="comment"># 卷在宿主机上的挂载点，即卷数据存储的路径。</span></span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"nginx-test01"</span>,		<span class="comment"># 卷的名称，是在 Docker 中标识这个卷的唯一名称。</span></span><br><span class="line">        <span class="string">"Options"</span>: null,			<span class="comment"># 卷的选项，可以用于配置卷的特定行为。可以为空或包含键值对。</span></span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>			<span class="comment"># 卷的作用范围。local 表示该卷仅在创建它的宿主机上可用。</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看volume是否挂载</span></span><br><span class="line">$ docker ps -q | xargs docker inspect --format <span class="string">'&#123;&#123; .Id &#125;&#125;: &#123;&#123; .Mounts &#125;&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 删除未使用的volume(慎用)</span></span><br><span class="line">$ docker volume  prune</span><br><span class="line">WARNING! This will remove anonymous <span class="built_in">local</span> volumes not used by at least one container.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] y</span><br><span class="line">Total reclaimed space: 0B</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 删除单个或多个volume</span></span><br><span class="line">$ docker volume rm &lt;VOLUME_NAME&gt; &lt;VOLUME_NAME&gt;</span><br></pre></td></tr></table></figure>



<h3 id="7-Docker网络"><a href="#7-Docker网络" class="headerlink" title="7. Docker网络"></a>7. Docker网络</h3><h4 id="7-1-Docker网络简介"><a href="#7-1-Docker网络简介" class="headerlink" title="7.1 Docker网络简介"></a>7.1 Docker网络简介</h4><p>​    Docker默认使用<strong>桥接模式</strong>，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的 Container-IP 直接通信。<br>Docker网桥是宿主机虚拟出来的，并不是真实存在的网络设备，外部网络是无法寻址到的，这也意味着外部网络无法直接通过 Container-IP 访问到容器。</p>
<p>​    如果容器希望外部访问能够访问到，可以通过映射容器端口到宿主主机（端口映射），即docker run创建容器时候通过-p参数来启用，访问容器的时候就通过[宿主机IP]:[端口]访问容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网络列表</span></span><br><span class="line">[root@docker-ce ~]<span class="comment"># docker network list</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">6ea2847e7566   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">6dc3b646ecc7   host      host      <span class="built_in">local</span></span><br><span class="line">8017dbee2836   none      null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>bridge</strong>:<ul>
<li>Docker默认的容器网络驱动。此模式会为每一个容器分配、设置IP等，并将容器连接到一个docker0虚拟网桥，通过docker0网桥以及iptables nat 表配置与宿主机通信。</li>
</ul>
</li>
<li><strong>host</strong>:<ul>
<li>容器与主机共享同一Network Namespace，共享同一套网络协议栈、路由表及iptables规则等。容器与主机看到的是相同的网络视图。</li>
</ul>
</li>
<li><strong>Container</strong>：<ul>
<li>创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口。</li>
</ul>
</li>
<li><strong>None</strong>：<ul>
<li>容器没有任何网络配置， 完全隔离的网络环境。  </li>
</ul>
</li>
</ul>
<h4 id="7-2-host网络模式配置"><a href="#7-2-host网络模式配置" class="headerlink" title="7.2 host网络模式配置"></a>7.2 host网络模式配置</h4><p>​    相当于Vmware中的桥接模式，与宿主机在同一个网络中，但没有独立IP地址。</p>
<p>​    Docker使用了Linux的Namespaces技术来进行资源隔离，如PID Namespace隔离进程，Mount Namespace隔离文件系统，Network Namespace隔离网络等。</p>
<p>​    一个Network Namespace提供了一份独立的网络环境，包括网卡、路由、iptable规则等都与其他的Network Namespace隔离。 一个Docker容器一般会分配一个独立的Network Namespace。 但如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network Namespace， 而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡、配置自己的IP等，而是使用宿主机的IP和端口。<br><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/12.jpg" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -itd --name webserver01 --net=host nginx:v1.24.0</span><br><span class="line"></span><br><span class="line">$ docker <span class="built_in">exec</span> -it webserver01 bash</span><br><span class="line"></span><br><span class="line">root@docker-ce:/<span class="comment"># hostname  -I</span></span><br><span class="line">192.168.174.110 172.17.0.1</span><br></pre></td></tr></table></figure>


<h4 id="7-3-container网络模式配置"><a href="#7-3-container网络模式配置" class="headerlink" title="7.3 container网络模式配置"></a>7.3 container网络模式配置</h4><p>​    该模式指定新创建的容器和已经存在的一个容器共享一个Network Namespace，而不是和宿主机共享。 新创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过<strong>lo网卡</strong>设备通信。<br><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/13.jpg" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -id --name webserver03 nginx:v1.24.0</span><br><span class="line">6f9927ffd0090d95be1c4d93f278b40dfa8f0319fa4e8105c42a6446c0eba3c6</span><br><span class="line"></span><br><span class="line">$ docker run -itd --name webserver04 --net container:webserver03  registry.cn-hangzhou.aliyuncs.com/hujiaming/tomcat:9.0.89-jdk8</span><br><span class="line"></span><br><span class="line">$ docker <span class="built_in">exec</span> -it webserver03 bash</span><br><span class="line">root@6f9927ffd009:/<span class="comment"># curl  localhost:8080</span></span><br><span class="line">&lt;!doctype html&gt;&lt;html lang=<span class="string">"en"</span>&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 – Not Found&lt;/title&gt;&lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404 – Not Found&lt;/h1&gt;&lt;hr class="line" /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Status Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The origin server did not find a current representation for the target resource or is not willing to disclose that one exists.&lt;/p&gt;&lt;hr class="line" /&gt;&lt;h3&gt;Apache Tomcat/9.0.89&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="7-4-null网络模式配置"><a href="#7-4-null网络模式配置" class="headerlink" title="7.4 null网络模式配置"></a>7.4 null网络模式配置</h4><p>none模式，Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。 也就是说，这个Docker容器没有网卡、IP、路由等信息。这种网络模式下容器只有lo回环网络，没有其他网卡。这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性。</p>
<h3 id="8-Dockerfile自动构建docker镜像"><a href="#8-Dockerfile自动构建docker镜像" class="headerlink" title="8. Dockerfile自动构建docker镜像"></a>8. Dockerfile自动构建docker镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@e05ec18da21c:/<span class="comment"># ls /</span></span><br><span class="line">bin   dev		   docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  docker-entrypoint.d  etc			 lib   media  opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>
<p>​    这些挂载在容器根目录上、用来<strong>为容器进程提供隔离后执行环境的文件系统</strong>，就是所谓的“容器镜像”。它还有一个更为专业的名字，叫作：rootfs（根文件系统）。以上是一个最常见的 rootfs，或者说容器镜像，会包括如下所示的一些目录和文件，比如 /bin，/etc，/proc 等等；而你进入容器之后执行的 /bin/bash，就是 /bin 目录下的可执行文件，与宿主机的 /bin/bash 完全不同。<strong>正是由于 rootfs 的存在，容器才有了一个被反复宣传至今的重要特性：一致性。</strong></p>
<p><strong>什么是容器的“一致性”呢？</strong><br>由于云端与本地服务器环境不同，应用的打包过程，一直是最“痛苦”的一个步骤。但有了容器之后，更准确地说，有了容器镜像（即 rootfs）之后，这个问题被非常优雅地解决了。<strong>由于 rootfs 里打包的不只是应用，而是整个操作系统的文件和目录，也就意味着，应用以及它运行所需要的所有依赖，都被封装在了一起。</strong>但实际上，一个一直以来很容易被忽视的事实是，<strong>对一个应用来说，操作系统本身才是它运行所需要的最完整的“依赖库”。</strong>有了容器镜像“打包操作系统”的能力，这个最基础的依赖环境也终于变成了应用沙盒的一部分。这就赋予了容器所谓的一致性：无论在本地、云端，还是在一台任何地方的机器上，用户只需要解压打包好的容器镜像，那么这个应用运行所需要的完整的执行环境就被重现出来了。<strong>这种深入到操作系统级别的运行环境一致性，打通了应用在本地开发和远端执行环境之间难以逾越的鸿沟。</strong><br>不过，这时你可能已经发现了另一个非常棘手的问题：难道我每开发一个应用，或者升级一下现有的应用，都要重复制作一次 rootfs 吗？<br>比如，我现在用Centos操作系统的 ISO 做了一个 rootfs，然后又在里面安装了 Java 环境，用来部署我的 Java 应用。那么，我的另一个同事在发布他的 Java 应用时，显然希望能够直接使用我安装过 Java 环境的 rootfs，而不是重复这个流程。一种比较直观的解决办法是，我在制作 rootfs 的时候，每做一步“有意义”的操作，就保存一个 rootfs 出来，这样其他同事就可以按需求去用他需要的 rootfs 了。但是，这个解决办法并不具备推广性。原因在于，一旦你的同事们修改了这个 rootfs，新旧两个 rootfs 之间就没有任何关系了。这样做的结果就是极度的碎片化。那么，既然这些修改都基于一个旧的 rootfs，我们能不能以增量的方式去做这些修改呢？这样做的好处是，所有人都只需要维护相对于 base rootfs 修改的增量内容，而不是每次修改都制造一个“fork”。</p>
<p><strong>Docker 在镜像的设计中，引入了层（layer）的概念。也就是说，用户制作镜像的每一步操作，都会生成一个层，也就是一个增量rootfs。</strong><br><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/14.jpg" alt></p>
<p><strong>第一部分：只读层。</strong><br>它是这个容器的 rootfs 最下面的五层，对应的正是 ubuntu:latest 镜像的五层。可以看到，它们的挂载方式都是只读的。</p>
<p><strong>第二部分：可读写层。</strong><br>    它是这个容器的 rootfs 最上面的一层,它的挂载方式为：rw，即 read write。在没有写入文件之前，这个目录是空的。而一旦在容器里做了写操作，你修改产生的内容就会以增量的方式出现在这个层中。<br>这个可读写层的作用，就是专门用来存放你修改 rootfs 后产生的增量，无论是增、删、改，都发生在这里。而当我们使用完了这个被修改过的容器之后，还可以使用 docker commit 和 push 指令，保存这个被修改过的可读写层，并上传到 Docker Hub 上，供其他人使用；而与此同时，原先的只读层里的内容则不会有任何变化。这，就是增量rootfs 的好处。</p>
<p><strong>第三部分：Init 层。</strong><br>它是一个以“-init”结尾的层，夹在只读层和读写层之间。Init 层是 Docker 项目单独生成的一个内部层，专门用来存放 /etc/hosts、/etc/resolv.conf 等信息。<br>需要这样一层的原因是，这些文件本来属于只读的 Ubuntu 镜像的一部分，但是用户往往需要在启动容器时写入一些指定的值比如 hostname，所以就需要在可读写层对它们进行修改。<br>可是，这些修改往往只对当前的容器有效，我们并不希望执行 docker commit 时，把这些信息连同可读写层一起提交掉。所以，Docker 做法是，在修改了这些文件之后，以一个单独的层挂载了出来。而用户执行 docker commit 只会提交可读写层，所以是不包含这些内容的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect eeb6ee3f44bd | grep -i workdir</span><br><span class="line">                <span class="string">"WorkDir"</span>: <span class="string">"/var/lib/docker/overlay2/a98f64963021b19fb2703798c7016f35d15d8f4dcf127f732eb0e38d27ca1583/work"</span></span><br><span class="line"></span><br><span class="line">$ ls /var/lib/docker/overlay2/a98f64963021b19fb2703798c7016f35d15d8f4dcf127f732eb0e38d27ca1583/diff</span><br></pre></td></tr></table></figure>
<p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和操作命令;每一条指令构建一层镜像，因此每一条指令的内容，就是描述该层镜像应当如何构建（也就是你要执行的操作命令）。</p>
<h4 id="8-1-Dockerfile指令集"><a href="#8-1-Dockerfile指令集" class="headerlink" title="8.1 Dockerfile指令集"></a>8.1 Dockerfile指令集</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> 这个镜像的妈妈是谁？（指定基础镜像） yes</span><br><span class="line">如:</span><br><span class="line"><span class="keyword">FROM</span> centos:centos7.<span class="number">9.2009</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> 告诉别人，谁负责养它？（指定维护者信息，可以没有）LABLE key=values</span><br><span class="line">如:</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> name=<span class="string">"l66"</span>\</span></span><br><span class="line"><span class="bash">      age=<span class="string">"18"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> 你想让它干啥（在命令前面加上RUN即可） yes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash">/COPY 给它点创业资金（ADD文件，会自动解压） yes</span></span><br><span class="line"></span><br><span class="line">例如:<span class="keyword">COPY</span><span class="bash"> --from=builder /app/dist /app</span></span><br><span class="line">复制行为</span><br><span class="line">复制目录中的内容: <span class="keyword">COPY</span><span class="bash"> 指令将 /app/dist 目录中的所有文件和子目录复制到目标路径 /app 下。这意味着，/app/dist 目录内的所有文件和目录将被直接放置在 /app 目录中。</span></span><br><span class="line">不复制源目录本身: 如果你希望 /app/dist 目录本身被复制到目标镜像中，你需要在目标路径中包含 dist 目录。例如：<span class="keyword">COPY</span><span class="bash"> --from=builder /app/dist /app/dist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> 我是<span class="built_in">cd</span>,今天刚化了妆（设置当前工作目录，不存在会创建） no</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> 给它一个存放行李的地方（设置卷，挂载主机目录） no</span></span><br><span class="line">如:创建一个<span class="keyword">volume</span><span class="bash">数据卷(默认在/var/lib/docker/volumes/下)，挂载到容器的/app下</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/app"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> 它要打开的门是啥（指定对外的端口）no</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcp</span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> 奔跑吧，兄弟！（指定容器启动后的要干的事情,执行完会关闭容器，除非指定在前台运行） no</span></span><br><span class="line">如:</span><br><span class="line">启动编译安装好的nginx,让其在前台运行。</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/usr/local/nginx/sbin/nginx"</span>, <span class="string">"-g"</span>, <span class="string">"daemon off;"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash">  容器启动命名  no</span></span><br><span class="line">如:启动编译安装好的nginx,让其在前台运行。</span><br><span class="line"><span class="keyword">ENV</span> PATH /usr/local/nginx/sbin:$PATH</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"nginx"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"-g"</span>,<span class="string">"daemon off;"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> 环境变量   yes</span><br><span class="line">如:声明编译安装好的nginx环境变量方便启动</span><br><span class="line"><span class="keyword">ENV</span> PATH /usr/local/nginx/sbin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> 切换用户  no</span><br><span class="line">如:新建一个用户ldq并切换</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> useradd ldq</span></span><br><span class="line"><span class="keyword">ENV</span> age <span class="number">18</span></span><br><span class="line"><span class="keyword">USER</span> ldq</span><br></pre></td></tr></table></figure>
<h4 id="8-2-单阶段构建镜像"><a href="#8-2-单阶段构建镜像" class="headerlink" title="8.2 单阶段构建镜像"></a>8.2 单阶段构建镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载基础镜像</span></span><br><span class="line">$ docker pull registry.cn-hangzhou.aliyuncs.com/hujiaming/node:16.15.0</span><br><span class="line">16.15.0: Pulling from library/node</span><br><span class="line">85bed84afb9a: Already exists</span><br><span class="line">5fdd409f4b2b: Already exists</span><br><span class="line">fa3069e6cecf: Already exists</span><br><span class="line">4ee16f45eff9: Already exists</span><br><span class="line">2cee68386155: Already exists</span><br><span class="line">0aa7befa4a1b: Already exists</span><br><span class="line">d89fa2ee2a9e: Already exists</span><br><span class="line">fea81c9d708c: Already exists</span><br><span class="line">69c8c6687712: Already exists</span><br><span class="line">Digest: sha256:a6c217d7c8f001dc6fc081d55c2dd7fb3fefe871d5aa7be9c0c16bd62bea8e0c</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> node:16.15.0</span><br><span class="line">docker.io/library/node:16.15.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建存放目录</span></span><br><span class="line">$ mkdir /opt/docker-images/webserver-vue -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编写Dockerfile</span></span><br><span class="line">$ vim /opt/docker-images/webserver/Dockerfile</span><br><span class="line">FROM registry.cn-hangzhou.aliyuncs.com/hujiaming/node:16.15.0</span><br><span class="line"></span><br><span class="line">RUN git <span class="built_in">clone</span> https://gitee.com/mirschao/webserver-vue.git</span><br><span class="line"></span><br><span class="line">WORKDIR webserver-vue</span><br><span class="line"></span><br><span class="line">RUN npm install</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD [<span class="string">"npm"</span>, <span class="string">"run"</span>, <span class="string">"serve"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换目录</span></span><br><span class="line">$ <span class="built_in">cd</span> /opt/docker-images/webserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">$ docker build -t webserver:v1.0 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">$ docker images | grep  -i -w webserver</span><br><span class="line">webserver                                              v1.0              60f727ab4ebe   5 minutes ago   1.05GB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行镜像</span></span><br><span class="line">$ docker run -itd --name webserver10 -p 8080:8080  webserver:v1.0</span><br><span class="line"></span><br><span class="line">$ docker ps  | grep  -w webserver10</span><br><span class="line">97e8ab5a7cfb   webserver:v1.0                                                   <span class="string">"docker-entrypoint.s…"</span>   4 minutes ago       Up 4 minutes       0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp   webserver10</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/15.jpg" alt="image.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取基础镜像</span></span><br><span class="line">$ docker pull registry.cn-hangzhou.aliyuncs.com/hujiaming/jre:8u211-data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取项目</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://gitee.com/rulaipo/java-test.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换目录</span></span><br><span class="line">$ <span class="built_in">cd</span> java-test/</span><br><span class="line">$ ls</span><br><span class="line">Dockerfile  spring-cloud-eureka-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Dockerfile</span></span><br><span class="line"><span class="variable">$cat</span> Dockerfile </span><br><span class="line"><span class="comment"># 基础镜像可以按需修改，可以更改为公司自有镜像</span></span><br><span class="line">FROM registry.cn-hangzhou.aliyuncs.com/hujiaming/jre:8u211-data</span><br><span class="line"><span class="comment"># 切换工作目录</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"><span class="comment"># jar 包名称改成实际的名称，本示例为 spring-cloud-eureka-0.0.1-SNAPSHOT.jar</span></span><br><span class="line">COPY spring-cloud-eureka-0.0.1-SNAPSHOT.jar /app</span><br><span class="line"><span class="comment"># 端口</span></span><br><span class="line">EXPOSE 8761</span><br><span class="line"><span class="comment"># 启动 Jar 包(前台运行，这样容器就不会关闭了)</span></span><br><span class="line">CMD [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"spring-cloud-eureka-0.0.1-SNAPSHOT.jar"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">$ docker build -t java-test:v1.0 .</span><br><span class="line">[+] Building 0.1s (8/8) FINISHED                                                                  docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                        0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 446B                                                                        0.0s</span><br><span class="line"> =&gt; [internal] load metadata <span class="keyword">for</span> registry.cn-hangzhou.aliyuncs.com/hujiaming/jre:8u211-data                 0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                           0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                             0.0s</span><br><span class="line"> =&gt; [1/3] FROM registry.cn-hangzhou.aliyuncs.com/hujiaming/jre:8u211-data                                   0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                           0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 62B                                                                            0.0s</span><br><span class="line"> =&gt; CACHED [2/3] WORKDIR /app                                                                               0.0s</span><br><span class="line"> =&gt; CACHED [3/3] COPY spring-cloud-eureka-0.0.1-SNAPSHOT.jar /app                                           0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                     0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:8975f4ec6299fa9f5679551075aa4235144020ce5826bbd2a5ce5dca63b98a7f                0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/java-test:v1.0                                                           0.0s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">$ docker images | grep java</span><br><span class="line">java-test                                              v1.0              8975f4ec6299   11 minutes ago   174MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">$ docker run -itd --name java-test -p 8761:8761 java-test:v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看容器</span></span><br><span class="line">$ docker ps | grep java </span><br><span class="line">8dcb97455b5d   java-test:v1.0                                                 <span class="string">"java -jar spring-cl…"</span>   9 minutes ago   Up 9 minutes   0.0.0.0:8761-&gt;8761/tcp, :::8761-&gt;8761/tcp   java-test</span><br></pre></td></tr></table></figure>
<p>测试访问<br><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/16.jpg" alt="image.png"></p>
<h4 id="8-3-多阶段构建镜像"><a href="#8-3-多阶段构建镜像" class="headerlink" title="8.3 多阶段构建镜像"></a>8.3 多阶段构建镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取代码</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/hlions/webserver-vue.git</span><br><span class="line">$ <span class="built_in">cd</span> webserver-vue</span><br><span class="line">$ cat Dockerfile</span><br><span class="line">FROM registry.cn-hangzhou.aliyuncs.com/hujiaming/node:16.15.0   AS builder</span><br><span class="line">COPY ./ /app</span><br><span class="line">WORKDIR /app</span><br><span class="line">RUN npm install &amp;&amp; npm run build</span><br><span class="line"></span><br><span class="line">FROM registry.cn-hangzhou.aliyuncs.com/hujiaming/nginx:v1.24.0</span><br><span class="line">RUN mkdir /app</span><br><span class="line">COPY --from=builder /app/dist /app</span><br><span class="line">COPY nginx.conf /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">$ cat nginx.conf</span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log  /var/<span class="built_in">log</span>/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">  include       /etc/nginx/mime.types;</span><br><span class="line">  default_type  application/octet-stream;</span><br><span class="line">  log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                    <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                    <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/access.log  main;</span><br><span class="line">  sendfile        on;</span><br><span class="line">  keepalive_timeout  65;</span><br><span class="line">  server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">      root   /app;</span><br><span class="line">      index  index.html;</span><br><span class="line">      try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">      root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ docker build -t webserver:v1.1 .</span><br></pre></td></tr></table></figure>
<h4 id="8-4-Dockerfile优化"><a href="#8-4-Dockerfile优化" class="headerlink" title="8.4 Dockerfile优化"></a>8.4 Dockerfile优化</h4><ol>
<li><p><strong>多阶段构建镜像</strong></p>
<p>使用多个FROM指令,将构建过程分为多个阶段；每个阶段生成一个独立的镜像,后续阶段可以使用前面阶段生成的镜像作为基础镜像。多阶段构建可以有效减小最终镜像的体积,分离构建环境和运行环境多阶段构建。它允许在一个Dockerfile中使用多个FROM指令,每个FROM指令都可以使用不同的基础镜像,并且每个FROM指令都开始一个新的构建阶段。多阶段构建的主要目的是<strong>将构建过程分为多个独立的阶段</strong>,<strong>每个阶段生成一个独立的镜像</strong>。后续阶段可以使用前面阶段生成的镜像作为基础镜像,从而实现构建环境和运行环境的分离,有效减小最终镜像的体积。</p>
</li>
<li><p><strong>把不需要的命令输出丢入/dev/null</strong></p>
</li>
</ol>
<p>对于某些命令的标准输出和错误输出,如果不需要,可以重定向到/dev/null，避免不必要的输出写入镜像层,减小镜像体积。使用command &gt; /dev/null 2&gt;&amp;1的形式进行重定向</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:latest</span><br><span class="line"> </span><br><span class="line">RUN apt-get update &gt; /dev/null 2&gt;&amp;1 &amp;&amp; \</span><br><span class="line">    apt-get install -y nginx &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>使用普通用户运行</strong></li>
</ol>
<p>在Dockerfile中使用USER指令切换到非root用户，以最小权限原则运行应用,提高安全性。确保应用程序有足够权限访问所需资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM node:14</span><br><span class="line"></span><br><span class="line">RUN useradd zhangsan</span><br><span class="line">USER zhangsan</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>选择合适的基础镜像</strong></li>
</ol>
<ul>
<li>Alpine Linux是一个面向安全的轻型Linux发行版,镜像体积小，相比Ubuntu、CentOS等,Alpine Linux更适合作为基础镜像，务必评估Alpine Linux与应用程序的兼容性。</li>
</ul>
<ol start="5">
<li><strong>减少镜像层数</strong></li>
</ol>
<ul>
<li><p>一次RUN指令形成新的一层，尽量Shell命令都写在一行，减少镜像层。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:latest</span><br><span class="line"> </span><br><span class="line">RUN apt-get update &amp;&amp; \</span><br><span class="line">    apt-get install -y nginx &amp;&gt;/dev/null</span><br></pre></td></tr></table></figure>
<h3 id="9-HarBor私有镜像仓库"><a href="#9-HarBor私有镜像仓库" class="headerlink" title="9. HarBor私有镜像仓库"></a>9. HarBor私有镜像仓库</h3><p>Harbor 是一个开源的企业级容器镜像仓库，由 VMware 开发并捐赠给 CNCF（Cloud Native Computing Foundation）。它不仅提供了存储和分发 Docker 镜像的基本功能，还增加了很多企业级功能，使得它在安全性、管理性和可扩展性方面表现优异。Docker容器应用的开发和运行离不开可靠的镜像管理。</p>
<h4 id="9-1-安装docker-compose"><a href="#9-1-安装docker-compose" class="headerlink" title="9.1 安装docker-compose"></a>9.1 安装docker-compose</h4></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64</span><br><span class="line">$ mv docker-compose-linux-x86_64 /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ chmod a+x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">$ docker-compose version</span><br><span class="line">Docker Compose version v2.15.1</span><br></pre></td></tr></table></figure>
<h4 id="9-2-安装Harbor"><a href="#9-2-安装Harbor" class="headerlink" title="9.2 安装Harbor"></a>9.2 安装Harbor</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传安装包</span></span><br><span class="line">[root@docker-ce opt]<span class="comment"># ls</span></span><br><span class="line">harbor-offline-installer-v2.7.1.tgz  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压安装包</span></span><br><span class="line">[root@docker-ce opt]<span class="comment"># tar xf harbor-offline-installer-v2.7.1.tgz </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换目录</span></span><br><span class="line">[root@docker-ce opt]<span class="comment"># cd harbor</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取harbor所需的镜像</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># docker load -i harbor.v2.7.1.tar.gz </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># cp harbor.yml.tmpl  harbor.yml</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># vim harbor.yml</span></span><br><span class="line">...</span><br><span class="line">hostname: harbor.tanke.love</span><br><span class="line">http:</span><br><span class="line">  port: 80</span><br><span class="line">https:</span><br><span class="line">  port: 443</span><br><span class="line">  certificate: /tmp/fullchain.pem</span><br><span class="line">  private_key: /tmp/privkey.pem</span><br><span class="line">harbor_admin_password: 12345</span><br><span class="line">data_volume: /data/harbor</span><br><span class="line">location: /var/<span class="built_in">log</span>/harbor</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据存放目录</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># mkdir /data/harbor -p</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加权限</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># chmod 777 -R /data/  /var/log/harbor/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成和检查Harbor的配置文件，并确保所有必要的依赖项和环境都已准备就绪。</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># ./prepare </span></span><br><span class="line">prepare base dir is <span class="built_in">set</span> to /opt/harbor</span><br><span class="line">Generated configuration file: /config/portal/nginx.conf</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/rsyslog_docker.conf</span><br><span class="line">Generated configuration file: /config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: /config/core/env</span><br><span class="line">Generated configuration file: /config/core/app.conf</span><br><span class="line">Generated configuration file: /config/registry/config.yml</span><br><span class="line">Generated configuration file: /config/registryctl/env</span><br><span class="line">Generated configuration file: /config/registryctl/config.yml</span><br><span class="line">Generated configuration file: /config/db/env</span><br><span class="line">Generated configuration file: /config/jobservice/env</span><br><span class="line">Generated configuration file: /config/jobservice/config.yml</span><br><span class="line">Generated and saved secret to file: /data/secret/keys/secretkey</span><br><span class="line">Successfully called func: create_root_cert</span><br><span class="line">Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">Clean up the input dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># docker-compose images</span></span><br><span class="line">CONTAINER           REPOSITORY                    TAG                 IMAGE ID            SIZE</span><br><span class="line">harbor-core         goharbor/harbor-core          v2.7.1              49d6c8a15d6c        215MB</span><br><span class="line">harbor-db           goharbor/harbor-db            v2.7.1              b3f8d9d6c213        174MB</span><br><span class="line">harbor-jobservice   goharbor/harbor-jobservice    v2.7.1              829d13e6aae7        252MB</span><br><span class="line">harbor-log          goharbor/harbor-log           v2.7.1              eeb93d98a358        133MB</span><br><span class="line">harbor-portal       goharbor/harbor-portal        v2.7.1              fe05b1b0bcfd        135MB</span><br><span class="line">nginx               goharbor/nginx-photon         v2.7.1              e98018335c0d        126MB</span><br><span class="line">redis               goharbor/redis-photon         v2.7.1              229dd1844a26        127MB</span><br><span class="line">registry            goharbor/registry-photon      v2.7.1              9d50b10d3700        78.1MB</span><br><span class="line">registryctl         goharbor/harbor-registryctl   v2.7.1              9b2219d529c8        140MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装和启动 Harbor 的主要安装脚本</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># ./install.sh </span></span><br><span class="line">[Step 5]: starting Harbor ...</span><br><span class="line">WARN[0000] /opt/harbor/docker-compose.yml: `version` is obsolete </span><br><span class="line">[+] Running 10/10</span><br><span class="line"> ✔ Network harbor_harbor        Created                                                                     0.1s </span><br><span class="line"> ✔ Container harbor-log         Started                                                                     0.9s </span><br><span class="line"> ✔ Container registry           Started                                                                     2.3s </span><br><span class="line"> ✔ Container registryctl        Started                                                                     1.9s </span><br><span class="line"> ✔ Container redis              Started                                                                     2.0s </span><br><span class="line"> ✔ Container harbor-portal      Started                                                                     2.3s </span><br><span class="line"> ✔ Container harbor-db          Started                                                                     2.3s </span><br><span class="line"> ✔ Container harbor-core        Started                                                                     2.9s </span><br><span class="line"> ✔ Container nginx              Started                                                                     4.1s </span><br><span class="line"> ✔ Container harbor-jobservice  Started                                                                     4.0s </span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看启动的容器</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># docker-compose ps</span></span><br><span class="line">NAME                IMAGE                                COMMAND                  SERVICE             CREATED             STATUS                    PORTS</span><br><span class="line">harbor-core         goharbor/harbor-core:v2.7.1          <span class="string">"/harbor/entrypoint.…"</span>   core                11 minutes ago      Up 11 minutes (healthy)   </span><br><span class="line">harbor-db           goharbor/harbor-db:v2.7.1            <span class="string">"/docker-entrypoint.…"</span>   postgresql          11 minutes ago      Up 11 minutes (healthy)   </span><br><span class="line">harbor-jobservice   goharbor/harbor-jobservice:v2.7.1    <span class="string">"/harbor/entrypoint.…"</span>   jobservice          11 minutes ago      Up 11 minutes (healthy)   </span><br><span class="line">harbor-log          goharbor/harbor-log:v2.7.1           <span class="string">"/bin/sh -c /usr/loc…"</span>   <span class="built_in">log</span>                 11 minutes ago      Up 11 minutes (healthy)   127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal       goharbor/harbor-portal:v2.7.1        <span class="string">"nginx -g 'daemon of…"</span>   portal              11 minutes ago      Up 11 minutes (healthy)   </span><br><span class="line">nginx               goharbor/nginx-photon:v2.7.1         <span class="string">"nginx -g 'daemon of…"</span>   proxy               11 minutes ago      Up 11 minutes (healthy)   0.0.0.0:80-&gt;8080/tcp, :::80-&gt;8080/tcp, 0.0.0.0:443-&gt;8443/tcp, :::443-&gt;8443/tcp</span><br><span class="line">redis               goharbor/redis-photon:v2.7.1         <span class="string">"redis-server /etc/r…"</span>   redis               11 minutes ago      Up 11 minutes (healthy)   </span><br><span class="line">registry            goharbor/registry-photon:v2.7.1      <span class="string">"/home/harbor/entryp…"</span>   registry            11 minutes ago      Up 11 minutes (healthy)   </span><br><span class="line">registryctl         goharbor/harbor-registryctl:v2.7.1   <span class="string">"/home/harbor/start.…"</span>   registryctl         11 minutes ago      Up 11 minutes (healthy) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录镜像仓库</span></span><br><span class="line">[root@docker-ce harbor]<span class="comment"># docker login https://harbor.tanke.love</span></span><br></pre></td></tr></table></figure>
<p><img src="/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/17.jpg" alt="image.png"></p>
<h4 id="9-3-docker-compose介绍"><a href="#9-3-docker-compose介绍" class="headerlink" title="9.3 docker-compose介绍"></a>9.3 docker-compose介绍</h4><p> Docker Compose 是一个用于定义和运行多容器 Docker 应用的工具。通过使用 YAML 文件，你可以配置应用需要的所有服务，然后使用一个命令就能创建并启动这些服务。Docker Compose 非常适合用来管理复杂的应用程序，其中包含多个相互依赖的服务。  </p>
<h4 id="9-2-编排启动镜像"><a href="#9-2-编排启动镜像" class="headerlink" title="9.2 编排启动镜像"></a>9.2 编排启动镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">$ vim /opt/docker-compose/wordpress/docker-compose.yaml</span><br><span class="line">services:</span><br><span class="line">   db:</span><br><span class="line">     image: registry.cn-hangzhou.aliyuncs.com/hujiaming/mysql:5.7.44</span><br><span class="line">     volumes:</span><br><span class="line">       - /data/db_data:/var/lib/mysql</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">       MYSQL_DATABASE: wordpress</span><br><span class="line">       MYSQL_USER: wordpress</span><br><span class="line">       MYSQL_PASSWORD: wordpress</span><br><span class="line">   wordpress:</span><br><span class="line">     depends_on:</span><br><span class="line">       - db</span><br><span class="line">     image: registry.cn-hangzhou.aliyuncs.com/hujiaming/mysql:5.7.44</span><br><span class="line">     volumes:</span><br><span class="line">       - /data/web_data:/var/www/html</span><br><span class="line">     ports: </span><br><span class="line">       - <span class="string">"8000:80"</span></span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       WORDPRESS_DB_HOST: db:3306</span><br><span class="line">       WORDPRESS_DB_USER: wordpress</span><br><span class="line">       WORDPRESS_DB_PASSWORD: wordpress</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /opt/docker-compose/wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">    $ docker-compose up -d</span><br><span class="line">[+] Running 34/34</span><br><span class="line"> ⠿ wordpress Pulled                                                          181.8s</span><br><span class="line">   ⠿ 1fe172e4850f Already exists                                             0.0s</span><br><span class="line">   ⠿ 012a3732d045 Pull complete                                              37.3s</span><br><span class="line">   ⠿ 43092314d50d Pull complete                                              71.3s</span><br><span class="line">   ⠿ 4f615e42d863 Pull complete                                              71.4s</span><br><span class="line">   ⠿ cd39010a4efc Pull complete                                              72.2s</span><br><span class="line">   ⠿ d983c9ce24de Pull complete                                              72.3s</span><br><span class="line">   ⠿ ecbdd59ae430 Pull complete                                              75.8s</span><br><span class="line">   ⠿ 9d02b88c8618 Pull complete                                              79.5s</span><br><span class="line">   ⠿ 50a246031d43 Pull complete                                              79.6s</span><br><span class="line">   ⠿ a6c0267e6c34 Pull complete                                              84.0s</span><br><span class="line">   ⠿ 787ca6348cef Pull complete                                              91.5s</span><br><span class="line">   ⠿ da8ad43595e2 Pull complete                                              97.4s</span><br><span class="line">   ⠿ e191f9e80e29 Pull complete                                              97.4s</span><br><span class="line">   ⠿ fed8d3fd90f9 Pull complete                                              106.6s</span><br><span class="line">   ⠿ 9ffdaa9000ed Pull complete                                              129.4s</span><br><span class="line">   ⠿ 5774aeca6412 Pull complete                                              129.5s</span><br><span class="line">   ⠿ 6978431bb9e2 Pull complete                                              129.6s</span><br><span class="line">   ⠿ fb4d3fb05351 Pull complete                                              129.7s</span><br><span class="line">   ⠿ 23d3af42839e Pull complete                                              133.6s</span><br><span class="line">   ⠿ a5b33728e4a6 Pull complete                                              133.7s</span><br><span class="line">   ⠿ 766e2b674cd0 Pull complete                                              136.9s</span><br><span class="line"> ⠿ db Pulled                                                                 175.8s</span><br><span class="line">   ⠿ 4be315f6562f Pull complete                                              18.4s</span><br><span class="line">   ⠿ 96e2eb237a1b Pull complete                                              18.5s</span><br><span class="line">   ⠿ 8aa3ac85066b Pull complete                                              18.8s</span><br><span class="line">   ⠿ ac7e524f6c89 Pull complete                                              18.9s</span><br><span class="line">   ⠿ f6a88631064f Pull complete                                              19.0s</span><br><span class="line">   ⠿ 15bb3ec3ff50 Pull complete                                              35.7s</span><br><span class="line">   ⠿ ae65dc337dcb Pull complete                                              35.8s</span><br><span class="line">   ⠿ a4c4c43adf52 Pull complete                                              35.9s</span><br><span class="line">   ⠿ c6cab33e8f91 Pull complete                                              140.1s</span><br><span class="line">   ⠿ 2e1c4f2c43f6 Pull complete                                              140.2s</span><br><span class="line">   ⠿ 2e5ee322af48 Pull complete                                              140.2s</span><br><span class="line">[+] Running 3/3</span><br><span class="line"> ⠿ Network root_default        Created                                       0.1s</span><br><span class="line"> ⠿ Container root-db-1         Started                                       0.8s</span><br><span class="line"> ⠿ Container root-wordpress-1  Started                                       1.1s</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/">https://l66stbz.github.io/2024/09/10/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/Docker%E5%AE%B9%E5%99%A8%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://l66stbz.github.io" target="_blank">L66</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/09/24/kubernetes容忍及污点/09-kubernetes容忍及污点/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2024/09/11/Docker%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/Docker%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4/"><img class="prev_cover" src="https://l66stbz.github.io/2024/09/11/Docker基本操作命令/Docker基本操作命令/bg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Docker基本操作命令</div></div></a></div><div class="next-post pull_right"><a href="/2024/09/09/%E8%8B%A5%E4%BE%9D%E9%A1%B9%E7%9B%AE%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/%E8%8B%A5%E4%BE%9D%E9%A1%B9%E7%9B%AE%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0/"><img class="next_cover" src="https://l66stbz.github.io/2024/09/09/若依项目动静分离/若依项目动静分离项目实现/6.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">若依项目动静分离</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/09/11/Docker基础操作命令/Docker基本操作命令/" title="Docker基本操作命令"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/11/Docker基本操作命令/Docker基本操作命令/bg.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-11</div><div class="relatedPosts_title">Docker基本操作命令</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/12/Docker容器化部署若依项目/Docker容器化部署若依项目/" title="Docker容器化部署若依项目"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/12/Docker容器化部署若依项目/Docker容器化部署若依项目/bg.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-12</div><div class="relatedPosts_title">Docker容器化部署若依项目</div></div></a></div><div class="relatedPosts_item"><a href="/2024/06/28/文件查找与打包压缩和链接文件/" title="Linux文件查找、打包压缩和链接文件"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/06/28/文件查找与打包压缩和链接文件/1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-06-28</div><div class="relatedPosts_title">Linux文件查找、打包压缩和链接文件</div></div></a></div><div class="relatedPosts_item"><a href="/2024/07/31/Linux内核升级/" title="Linux内核升级"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/07/31/Linux内核升级/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-07-31</div><div class="relatedPosts_title">Linux内核升级</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/14/NoSQL-Redis/" title="NoSQL-Redis"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/14/NoSQL-Redis/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-14</div><div class="relatedPosts_title">NoSQL-Redis</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/16/RabbitMQ消息队列/" title="RabbitMQ消息队列"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/16/RabbitMQ消息队列/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-16</div><div class="relatedPosts_title">RabbitMQ消息队列</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>