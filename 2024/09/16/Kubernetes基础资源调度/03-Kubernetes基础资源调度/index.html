<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kubernetes基础资源调度 | L66</title><meta name="description" content="[TOC] 前言1、无状态应用（文件共享存储）​    无状态应用指的是那些不需要持久存储数据、请求之间没有上下文关联的应用。每个请求都是独立的，应用的所有实例都可以处理任意请求，无需依赖其他实例或持久化存储的数据。  无需持久化存储：应用运行时不依赖磁盘上的数据存储，即使应用实例重启或迁移到另一个节点，也不会影响其正常运行。 实例间无依赖：应用的不同实例之间没有状态依赖，它们是完全独立的，任何实"><meta name="keywords" content="Linux,Kubernetes"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Kubernetes基础资源调度"><meta name="twitter:description" content="[TOC] 前言1、无状态应用（文件共享存储）​    无状态应用指的是那些不需要持久存储数据、请求之间没有上下文关联的应用。每个请求都是独立的，应用的所有实例都可以处理任意请求，无需依赖其他实例或持久化存储的数据。  无需持久化存储：应用运行时不依赖磁盘上的数据存储，即使应用实例重启或迁移到另一个节点，也不会影响其正常运行。 实例间无依赖：应用的不同实例之间没有状态依赖，它们是完全独立的，任何实"><meta name="twitter:image" content="https://l66stbz.github.io/2024/09/16/Kubernetes基础资源调度/03-Kubernetes基础资源调度/1.png"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes基础资源调度"><meta property="og:url" content="https://l66stbz.github.io/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/"><meta property="og:site_name" content="L66"><meta property="og:description" content="[TOC] 前言1、无状态应用（文件共享存储）​    无状态应用指的是那些不需要持久存储数据、请求之间没有上下文关联的应用。每个请求都是独立的，应用的所有实例都可以处理任意请求，无需依赖其他实例或持久化存储的数据。  无需持久化存储：应用运行时不依赖磁盘上的数据存储，即使应用实例重启或迁移到另一个节点，也不会影响其正常运行。 实例间无依赖：应用的不同实例之间没有状态依赖，它们是完全独立的，任何实"><meta property="og:image" content="https://l66stbz.github.io/2024/09/16/Kubernetes基础资源调度/03-Kubernetes基础资源调度/1.png"><meta property="article:published_time" content="2024-09-16T13:50:00.000Z"><meta property="article:modified_time" content="2024-09-26T13:00:26.067Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/"><link rel="prev" title="Kubernetes服务发布" href="https://l66stbz.github.io/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/"><link rel="next" title="kubernetes 二进制高可用安装部署（v1.23+）" href="https://l66stbz.github.io/2024/09/15/kubernetes%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%EF%BC%88v1.23+%EF%BC%89/kubernetes%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%EF%BC%88v1.23+%EF%BC%89/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">67</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">37</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、无状态应用（文件共享存储）"><span class="toc-number">1.1.</span> <span class="toc-text">1、无状态应用（文件共享存储）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、有状态服务（块存储）"><span class="toc-number">1.2.</span> <span class="toc-text">2、有状态服务（块存储）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、ReplicaSet（简称RS）"><span class="toc-number">1.3.</span> <span class="toc-text">3、ReplicaSet（简称RS）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1、Deployment：无状态资源管理"><span class="toc-number">2.</span> <span class="toc-text">1、Deployment：无状态资源管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-简介"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Deployment部署方式"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 Deployment部署方式:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Deployment资源更新"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 Deployment资源更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-使用场景"><span class="toc-number">2.3.1.</span> <span class="toc-text">1.3.1 使用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-更新配置"><span class="toc-number">2.3.2.</span> <span class="toc-text">1.3.2 更新配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-deployment更新过程"><span class="toc-number">2.3.3.</span> <span class="toc-text">1.3.3 deployment更新过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-Deployment回滚（生产环境用的较多）"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 Deployment回滚（生产环境用的较多）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-Deployment扩容和缩容"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 Deployment扩容和缩容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-Deployment更新策略"><span class="toc-number">2.6.</span> <span class="toc-text">1.6 Deployment更新策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、StatefulSet-有状态资源调度"><span class="toc-number">3.</span> <span class="toc-text">2、StatefulSet 有状态资源调度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-前言"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-简介"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-StatefulSet特性"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 StatefulSet特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Headless-Service-无头服务"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 Headless Service 无头服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-前言"><span class="toc-number">3.4.1.</span> <span class="toc-text">2.4.1 前言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-介绍"><span class="toc-number">3.4.2.</span> <span class="toc-text">2.5.2 介绍</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-StatefulSet的yaml创建"><span class="toc-number">3.5.</span> <span class="toc-text">2.5 StatefulSet的yaml创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-StatefulSet创建和删除"><span class="toc-number">3.6.</span> <span class="toc-text">2.6 StatefulSet创建和删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、DaemonSet-守护进程集"><span class="toc-number">4.</span> <span class="toc-text">3、DaemonSet 守护进程集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-DaemonSet守护进程集yaml文件编写"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 DaemonSet守护进程集yaml文件编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-DaemonSet指定节点部署Pod（只部署在ssd硬盘标签的节点上）"><span class="toc-number">4.2.</span> <span class="toc-text">3.3 DaemonSet指定节点部署Pod（只部署在ssd硬盘标签的节点上）</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/09/16/Kubernetes基础资源调度/03-Kubernetes基础资源调度/1.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Kubernetes基础资源调度</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2024-09-16 21:50:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2024-09-16</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2024-09-26 21:00:26"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2024-09-26</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>[TOC]</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="1、无状态应用（文件共享存储）"><a href="#1、无状态应用（文件共享存储）" class="headerlink" title="1、无状态应用（文件共享存储）"></a>1、无状态应用（文件共享存储）</h3><p>​    无状态应用指的是那些<strong>不需要持久存储</strong>数据、请求之间<strong>没有上下文关联</strong>的应用。每个请求都是独立的，应用的所有实例都可以处理任意请求，无需依赖其他实例或持久化存储的数据。</p>
<ul>
<li><strong>无需持久化存储</strong>：应用运行时不依赖磁盘上的数据存储，即使应用实例重启或迁移到另一个节点，也不会影响其正常运行。</li>
<li><strong>实例间无依赖</strong>：应用的不同实例之间没有状态依赖，它们是完全独立的，任何实例可以处理用户的请求。</li>
<li><strong>水平扩展简单</strong>：无状态应用非常适合水平扩展，多个实例可以随时被创建、销毁，Kubernetes 可以轻松进行自动扩缩容。</li>
</ul>
<h3 id="2、有状态服务（块存储）"><a href="#2、有状态服务（块存储）" class="headerlink" title="2、有状态服务（块存储）"></a>2、有状态服务（块存储）</h3><p>​    状态应用是那些<strong>需要持久化存储</strong>数据并且实例之间存在<strong>状态依赖</strong>的应用。它们的请求与先前的请求有关联，应用实例通常需要记住某些数据，即使在实例重启、重新调度或迁移时，数据仍需保持不变。</p>
<ul>
<li><strong>需要持久化存储</strong>：有状态应用需要某种形式的持久化存储，比如数据库，确保实例重启时数据不丢失。</li>
<li><strong>实例间存在状态依赖</strong>：有些有状态应用的实例不能随意替换，因为每个实例可能存储了特定的数据，或依赖某些特定的存储卷。</li>
<li><strong>有序部署和终止</strong>：有状态应用通常要求实例的创建、删除是有顺序的，因为实例的状态需要依赖之前的状态。Kubernetes 需要保证这些应用实例按照顺序进行部署或关闭。</li>
</ul>
<h3 id="3、ReplicaSet（简称RS）"><a href="#3、ReplicaSet（简称RS）" class="headerlink" title="3、ReplicaSet（简称RS）"></a>3、ReplicaSet（简称RS）</h3><p>​    <strong>用来确保指定数量的Pod副本始终在集群中运行的资源对象。</strong>ReplicaSet是Kubernetes中一个较低层次的控制器，是Deployment等更高层次控制器的基础。<strong>ReplicaSet的主要作用是确保在任何时间点，始终有指定数量的Pod副本在集群中运行。ReplicaSet会自动创建和删除Pod，以达到和维持所需的Pod副本数量。</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">rs-nginx.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-replicaset</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span>  <span class="comment"># 定义3个副本</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>  <span class="comment"># 选择器匹配标签</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span>  <span class="comment"># Pod 模板的标签</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/hujiaming/nginx:1.24.0</span>  <span class="comment"># 使用 Nginx 镜像</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 创建资源</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl  apply -f rs-nginx.yaml </span></span><br><span class="line">replicaset.apps/nginx-replicaset created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看RS</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl get rs</span></span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-replicaset   3         3         0       6s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看指定标签的Pod</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl get po  -l app=nginx</span></span><br><span class="line">NAME                     READY   STATUS        RESTARTS   AGE</span><br><span class="line">nginx-replicaset-6m2cq   1/1     Running       0          25s</span><br><span class="line">nginx-replicaset-pg9jf   1/1     Running       0          25s</span><br><span class="line">nginx-replicaset-rvw6b   1/1     Running       0          25s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 扩充RS副本数</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl scale rs nginx-replicaset  --replicas=5</span></span><br><span class="line">replicaset.apps/nginx-replicaset scaled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看RS</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> kubectl get rs</span></span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-replicaset   5         5         5       4m2s</span><br></pre></td></tr></table></figure>



<h2 id="1、Deployment：无状态资源管理"><a href="#1、Deployment：无状态资源管理" class="headerlink" title="1、Deployment：无状态资源管理"></a>1、Deployment：无状态资源管理</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/2.png" alt="image-20240916152152851"></p>
<p>​    <strong>Deployment</strong> 是一种用于管理和部署容器化应用程序的资源。它提供了一种声明式的方法来管理应用程序的副本，支持<strong>滚动更新</strong>、<strong>回滚</strong>、<strong>扩展</strong>和<strong>自动修复</strong>等功能。</p>
<p>​    一般用于部署公司的<strong>无状态服务</strong>，也是最常用的控制器，企业内部现在以微服务为主，而<strong>微服务实现无状态化也是最佳实践</strong>，可以利用<strong>Deployment</strong>的高级功能做到无缝迁移、自动扩容缩容、自动灾难恢复、一键回滚等功能。通过定义<strong>Deployment</strong>，你可以描述应用的期望状态，Kubernetes会负责将实际状态调整为期望状态。</p>
<h3 id="1-2-Deployment部署方式"><a href="#1-2-Deployment部署方式" class="headerlink" title="1.2 Deployment部署方式:"></a>1.2 Deployment部署方式:</h3><p>​      首先在控制端定义了一个3副本的kind为<strong>Deployment</strong>的yaml文件时，在执行kubectl create 是会提交给apiserver；然后持久化实例到etcd，在yaml中指定的命名空间下，可以看到有个nginx Deployment资源，然后会先创建一个名为nginx-xxx（随机字符串）的RS复制集，然后由复制集会选出最优节点部署Pod（有可能一台节点，有可能多台节点；没有固定的节点）。</p>
<ol>
<li><p>kubectl向apiserver发送创建请求；</p>
</li>
<li><p>apiserver将 Deployment 持久化到etcd，etcd与apiserver进行一次http通信。</p>
</li>
<li><p>controller manager通过watch api监听 apiserver ，deployment controller看到了一个新创建的deplayment对象更后，将其从队列中拉出，根据deployment的描述创建一个ReplicaSet并将 ReplicaSet 对象返回apiserver并持久化回etcd。以此类推，当replicaset控制器看到新创建的replicaset对象，将其从队列中拉出，根据描述创建pod对象。</p>
</li>
<li><p>接着scheduler调度器看到未调度的pod对象，根据调度规则选择一个可调度的节点，加载到pod描述中nodeName字段，并将pod对象返回apiserver并写入etcd。kubelet在看到有pod对象中nodeName字段属于本节点，将其从队列中拉出，通过控制容器运行时创建pod中描述的容器。</p>
</li>
</ol>
<p><strong>创建一个Deployment的yaml文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create \</span><br><span class="line">    deploy nginx \</span><br><span class="line">    --image=registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine \</span><br><span class="line">    --replicas=3 \</span><br><span class="line">    -oyaml \</span><br><span class="line">    --dry-run=client &gt; nginx-deploy.yaml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数解释：<br>        <code>--replicas=3</code>   Pod的副本数为3。<br>        <code>--dry-run=client</code>    输出给apiserver但不创建Pod。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$ vim nginx-deploy.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1   <span class="comment"># 资源的 API 版本</span></span><br><span class="line">kind: Deployment      <span class="comment"># 资源的类型</span></span><br><span class="line">metadata:    <span class="comment"># 资源的元数据信息</span></span><br><span class="line">  name: nginx-deployment  <span class="comment"># 资源的名称</span></span><br><span class="line">  labels:    <span class="comment"># 资源的标签，为这个Deployment资源打上标签，以便将来选择和过滤。</span></span><br><span class="line">    app: nginx</span><br><span class="line">spec:  <span class="comment"># 定义Deployment的详细规格</span></span><br><span class="line">  replicas: 3  <span class="comment"># 定义Pod的副本</span></span><br><span class="line">  selector:   <span class="comment"># 标签选择器，</span></span><br><span class="line">    matchLabels:  <span class="comment"># 只有带有指定标签的Pod才会被这个Deployment管理。</span></span><br><span class="line">      app: nginx  <span class="comment"># 指定需要管理的Pod的标签</span></span><br><span class="line">  template:    <span class="comment"># 定义 Pod 模板，用于创建 Pod。</span></span><br><span class="line">    metadata:  <span class="comment"># Pod元数据</span></span><br><span class="line">      labels:  <span class="comment"># 定义Pod的标签，以供deploy的selector选择，输入该deploy管理</span></span><br><span class="line">        app: nginx  <span class="comment"># Pod的标签</span></span><br><span class="line">    spec:  <span class="comment"># 定义Pod规格，包括容器配置。</span></span><br><span class="line">      containers:  <span class="comment"># 定义容器列表</span></span><br><span class="line">      - name: nginx  <span class="comment"># Pod名称</span></span><br><span class="line">        image: registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine  <span class="comment"># 容器镜像</span></span><br><span class="line">        ports:  <span class="comment"># 指定容器端口</span></span><br><span class="line">        - containerPort: 80 <span class="comment"># 容器的端口</span></span><br><span class="line">--------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建deploy资源</span></span><br><span class="line">$ kubectl create -f nginx-deploy.yaml</span><br><span class="line">deployment.apps/nginx created</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看ReplicaSet资源</span></span><br><span class="line">$ kubectl get rs</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/3.png" alt="image-20240619224610590"></p>
<blockquote>
<p>提示：<br>        <code>NAME</code> ：RS名称<br>        <code>DESIRED</code>：期望的 Pod 副本数。<br>        <code>CURRENT</code>：当前实际的 Pod 副本数<br>        <code>READY</code>：就绪的 Pod 副本数。<br>        <code>AGE</code>：存在时长</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看创建deploy的pod</span></span><br><span class="line">$ kubectl  get po -owide</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/4.png" alt="image-20240619224858434"></p>
<blockquote>
<p>提示：<br>        <strong>可以看到pod的前缀和RS的前缀一致。</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看deploy资源</span></span><br><span class="line">$ kubectl get deploy -owide</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/5.png" alt="image-20240619225325942"></p>
<blockquote>
<p><code>NAME</code>： Deployment名称<br><code>READY</code>：Pod的状态，已经Ready的个数<br><code>UP-TO-DAT</code>E：已经达到期望状态的被更新的副本数<br><code>AVAILABLE</code>：已经可以用的副本数<br><code>AGE</code>：显示应用程序运行的时间<br><code>CONTAINERS</code>：容器名称<br><code>IMAGES</code>：容器的镜像<br><code>SELECTOR</code>：管理的Pod的标签</p>
</blockquote>
<p><strong>测试删除某个Pod</strong></p>
<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/6.png" alt="image-20240619231712261"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 删除某个Pod</span></span><br><span class="line">$ kubectl delete po nginx-deployment-7bcc989f8f-97gsf  </span><br><span class="line">pod <span class="string">"nginx-deployment-7bcc989f8f-97gsf"</span> deleted</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 再次查看Pod</span></span><br><span class="line">$ kubectl get po</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/7.png" alt="image-20240619231915103"></p>
<blockquote>
<p>解释：<br>    <strong>自愈机制。期望状态 vs 当前状态</strong>：</p>
<p>Deployment 会创建一个 ReplicaSet 来管理 Pod 副本。ReplicaSet 持续监控当前实际的 Pod 副本数量与期望数量之间的差异。</p>
<p><strong>监控与调谐</strong>：当一个 Pod 被删除时（无论是手动删除还是因故障被删除），当前实际的 Pod 数量会减少。ReplicaSet Controller 会立即检测到这种变化，因为它不断地与 API Server 进行通信。<br><strong>创建新 Pod</strong>：当检测到当前 Pod 数量少于期望数量时，ReplicaSet Controller 会自动创建新的 Pod 来补足。这些新的 Pod 会根据 Pod 模板（在 Deployment 的 <code>spec.template</code> 中定义）创建，确保新 Pod 的配置与原始 Pod 一致。</p>
</blockquote>
<h3 id="1-3-Deployment资源更新"><a href="#1-3-Deployment资源更新" class="headerlink" title="1.3 Deployment资源更新"></a>1.3 Deployment资源更新</h3><h4 id="1-3-1-使用场景"><a href="#1-3-1-使用场景" class="headerlink" title="1.3.1 使用场景"></a>1.3.1 使用场景</h4><p>​    程序升级，变革更新</p>
<h4 id="1-3-2-更新配置"><a href="#1-3-2-更新配置" class="headerlink" title="1.3.2 更新配置"></a>1.3.2 更新配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 通过kubectl命令更新deploy的image</span></span><br><span class="line">$ kubectl <span class="built_in">set</span> image deploy nginx-deployment nginx=registry.cn-hangzhou.aliyuncs.com/hujiaming/nginx:1.24.0  --record</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看更新过程</span></span><br><span class="line">$ kubectl rollout status deploy nginx-deployment</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 通过yaml文件更新Deploy,首先查看deploy的名称</span></span><br><span class="line">kubectl replace -f </span><br><span class="line">$ kubectl get deploy nginx-deployment</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 更新</span></span><br><span class="line">$ kubectl edit deploy nginx-deployment</span><br><span class="line">    找到images修改镜像Tag</span><br><span class="line">    </span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看Deployment详细的更新过程</span></span><br><span class="line">$ kubectl describe deploy nginx-deployment</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/8.png" alt="image-20240620125712778"></p>
<blockquote>
<p>解释：<br>   <strong>在describe中可以看出，第一次创建时，它创建了一个名为nginx-deployment-786479c6df的ReplicaSet，并直接将其扩展为3个副本。更新部署时，它创建了一个新的ReplicaSet，命名为nginx-deployment-c5dcb4544，并将其副本数扩展为1，然后将旧的ReplicaSet缩小为2，这样至少可以有2个Pod可用，最多创建了4个Pod。以此类推，使用相同的滚动更新策略向上和向下扩展新旧ReplicaSet，最终新的ReplicaSet可以拥有3个副本，并将旧的ReplicaSet缩小为0。</strong></p>
</blockquote>
<h4 id="1-3-3-deployment更新过程"><a href="#1-3-3-deployment更新过程" class="headerlink" title="1.3.3 deployment更新过程"></a>1.3.3 deployment更新过程</h4><ol>
<li><strong>创建新的 ReplicaSet</strong>：当 Deployment 检测到 Pod 模板发生变化（例如镜像版本更新）时，会创建一个新的 ReplicaSet 来管理新的 Pod。</li>
<li><strong>生成新 ReplicaSet</strong>：新 ReplicaSet 的名称类似 <code>nginx-deployment-xxxxxx</code>，包含新的镜像版本信息。</li>
<li><strong>逐步更新</strong>：Deployment Controller 会逐步替换旧的 Pod，而不是一次性删除所有旧 Pod 并创建新 Pod。</li>
<li><strong>更新策略</strong>：默认情况下，Kubernetes 使用滚动更新策略，即每次终止一部分旧的 Pod 并创建一部分新的 Pod。</li>
<li><strong>新旧 Pod 共存</strong>：在更新过程中，新旧版本的 Pod 会共存一段时间，确保在任何时间点都有足够的 Pod 提供服务。</li>
<li><strong>健康检查</strong>：新的 Pod 在替换旧的 Pod 之前，必须通过健康检查，确保其能够正常运行。</li>
<li><strong>终止旧 Pod</strong>：当新的 Pod 通过健康检查后，Deployment Controller 会逐步终止旧的 Pod。</li>
<li><strong>创建新 Pod</strong>：与此同时，创建新的 Pod，直到新的 ReplicaSet 中的 Pod 数量达到期望值。</li>
<li><strong>更新完成</strong>：当所有新的 Pod 都被创建并通过健康检查，且旧的 Pod 被终止后，滚动更新过程完成。</li>
</ol>
<h3 id="1-4-Deployment回滚（生产环境用的较多）"><a href="#1-4-Deployment回滚（生产环境用的较多）" class="headerlink" title="1.4 Deployment回滚（生产环境用的较多）"></a>1.4 Deployment回滚（生产环境用的较多）</h3><p>​       <strong>使用场景：当新发的版本出现BUG或者因为某些原因无法正常使用时，就需要进行版本回退。一般情况都是回滚到上一个版本（deploy回滚不推荐使用修改yaml的方式，有可能历代版本有其他修改的参数）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看历史更新记录</span></span><br><span class="line">$ kubectl rollout <span class="built_in">history</span> deploy  nginx-deployment</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/9.png" alt="image-20240620130319537"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看更新历史的第2个版本的详细信息</span></span><br><span class="line">$ kubectl rollout <span class="built_in">history</span> deploy nginx-deployment --revision=2</span><br><span class="line">  <span class="comment"># --revision=2 查看第二个版本</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/10.png" alt="image-20240621002324924"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; kubectl命令行回滚到上一个版本（生产使用最多，不推荐使用edit）</span></span><br><span class="line">$ kubectl rollout undo deploy nginx-deployment</span><br><span class="line">deployment.apps/nginx-deployment rolled back</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; kubectl 命令行回滚到第二个版本</span></span><br><span class="line">$ kubectl rollout undo deploy nginx-deployment --to-revision=2</span><br><span class="line">deployment.apps/nginx-deployment rolled back</span><br></pre></td></tr></table></figure>



<h3 id="1-5-Deployment扩容和缩容"><a href="#1-5-Deployment扩容和缩容" class="headerlink" title="1.5 Deployment扩容和缩容"></a>1.5 Deployment扩容和缩容</h3><p>​       <strong>使用场景：当公司业务增大，Deploy的个数不足以支撑业务的正常运行，所以增加Pod的个数。或者公司推出某些活动需要临时增加Pod的个数。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; kubectl命令行扩容</span></span><br><span class="line">$ kubectl scale deploy nginx-deployment --replicas=5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看deploy的Pod</span></span><br><span class="line">$ kubectl get po </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改yaml文件的方式进行扩缩容(不推荐，容易导致资源清单和启动的Pod配置不一致)</span></span><br><span class="line">$ kubectl edit deploy nginx-deployment</span><br><span class="line">  找到容器数量修改参数</span><br></pre></td></tr></table></figure>



<h3 id="1-6-Deployment更新策略"><a href="#1-6-Deployment更新策略" class="headerlink" title="1.6 Deployment更新策略"></a>1.6 Deployment更新策略</h3><p><strong>==滚动更新（RollingUpdate）==</strong>：默认的更新策略，确保应用程序在更新过程中不会中断运行。滚动更新会逐渐用新的 Pod 替换旧的 Pod，在替换的过程中，集群始终保持可用状态。</p>
<ul>
<li><strong><code>maxUnavailable</code></strong>：在更新过程中，最多允许多少个 Pod 不可用。默认值是 25%。</li>
<li><strong><code>maxSurge</code></strong>：更新时可以超过期望副本数的最多的 Pod 数量。默认值是 25%。</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">3</span>        <span class="comment"># 更新时最多允许增加 3个 Pod</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span>  <span class="comment"># 更新过程中最多允许 1 个 Pod不可用</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/hujiaming/nginx:1.24.0</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>



<p><strong>==重建（Recreate）==</strong>：<code>Recreate</code> 策略下，Kubernetes 会先<strong>删除所有现有的 Pod</strong>，然后再启动新的 Pod。在更新过程中，应用程序会有一段时间不可用。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span>  <span class="comment"># 更新时，先删除旧版本所有的Pod，再启动新的Pod。</span></span><br><span class="line"><span class="comment">#    rollingUpdate:</span></span><br><span class="line"><span class="comment">#      maxSurge: 3</span></span><br><span class="line"><span class="comment">#      maxUnavailable: 1</span></span><br><span class="line"><span class="comment">#    type: RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>



<h2 id="2、StatefulSet-有状态资源调度"><a href="#2、StatefulSet-有状态资源调度" class="headerlink" title="2、StatefulSet 有状态资源调度"></a>2、StatefulSet 有状态资源调度</h2><p>​    StatefulSet（有状态集，缩写sts)常用于部署有状态的且需要有序启动的应用程序。</p>
<h3 id="2-1-前言"><a href="#2-1-前言" class="headerlink" title="2.1 前言"></a>2.1 前言</h3><p>​    在IT世界里，有状态的应用被类比为宠物，无状态的应用则被类比为牛羊，每个宠物在主人那里都是“唯一的存在”，宠物生病了，我们是要花很多钱去治疗的，需要我们用心照料，而无差别的牛羊则没有这个待遇。</p>
<h3 id="2-2-简介"><a href="#2-2-简介" class="headerlink" title="2.2 简介"></a>2.2 简介</h3><ul>
<li>每个节点都有<strong>固定的身份ID</strong>，通过这个ID，集群中的成员可以 相互发现并通信。</li>
<li>集群的规模是比较固定的，集群规模不能随意变动。</li>
<li>集群中的每个节点都是有状态的，通常会持久化数据到永久存储中，每个节点在重启后都需要使用原有的持久化数据。</li>
<li>集群中成员节点的启动顺序（以及关闭顺序）通常也是确定的。</li>
<li>如果磁盘损坏，则集群里的某个节点无法正常运行，集群功能受损。</li>
</ul>
<h3 id="2-3-StatefulSet特性"><a href="#2-3-StatefulSet特性" class="headerlink" title="2.3 StatefulSet特性"></a>2.3 StatefulSet特性</h3><ul>
<li><p><strong>需要稳定的独一无二的网络标识符</strong></p>
<ul>
<li>StatefulSet里的每个Pod都有稳定、唯一的网络标识，可以用来发现集群内的其他成员。每个 Pod 都会被赋予一个唯一且稳定的 DNS 名称。例如，第一个 Pod 的名称可能是 myapp-0，第二个是 myapp-1，依此类推，即使 Pod 被删除或重新创建，它们的名称依然保持不变。</li>
</ul>
</li>
<li><p><strong>需要有序的、优雅的部署和扩展</strong></p>
<ul>
<li>StatefulSet控制的Pod副本的启停顺序是受控的，启动第n个Pod 时，前n-1个Pod已经是运行且准备好的状态。</li>
<li>如 MySQL集群,要先启动主节点, 若从节点没有要求,则可一起启动,若从节点有启动顺序要求，可先启动第一个从节点，接着第二从节点；这个过程就是有顺序，平滑安全的启动。</li>
</ul>
</li>
<li><p><strong>需要持久化数据;</strong></p>
<ul>
<li>需要持久存储，新增或减少pod，存储不会随之发生变化。</li>
</ul>
</li>
<li><p><strong>需要有序的自动滚动更新</strong></p>
<ul>
<li>MySQL在更新时，应该先更新从节点，全部的从节点都更新完了，最后在更新主节点，因为新版本一般可兼容老版本，但是一定要注意，若新版本不兼容老版本就很麻烦。</li>
</ul>
</li>
</ul>
<p>​    </p>
<h3 id="2-4-Headless-Service-无头服务"><a href="#2-4-Headless-Service-无头服务" class="headerlink" title="2.4 Headless Service 无头服务"></a>2.4 Headless Service 无头服务</h3><h4 id="2-4-1-前言"><a href="#2-4-1-前言" class="headerlink" title="2.4.1 前言"></a>2.4.1 前言</h4><p>​    Headless Service的概念是这种服务没有入口访问地址（无ClusterIP 地址），kube-proxy不会为其创建负载转发规则，而服务名（DNS域名）的解析机制取决于该Headless Service是否设置了Label Selector。无头服务为每个匹配的 Pod 生成独立的 DNS A 记录，而不是单一的服务 IP。客户端可以通过这些 DNS 记录直接与某个特定的 Pod 通信。</p>
<h4 id="2-5-2-介绍"><a href="#2-5-2-介绍" class="headerlink" title="2.5.2 介绍"></a>2.5.2 介绍</h4><p>​    和Deployment类似，一个StatefulSet也同样管理着基于相同容器规范的Pod。不同的是，StatefulSet为每个Pod维护了一个<code>粘性标识</code>。而StatefulSet创建的Pod一般使用<code>Headless Service(无头服务）</code>进行Pod之前的通信，和普通的Service的区别在于Headless Service没有ClusterlP，它使用的是Endpoint进行互相通信，Headless一般的格式为:</p>
<p><strong><code>statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local</code></strong></p>
<ul>
<li>serviceName为Headless Service的名字，创建StatefulSet时必须指定Headless Service名称;</li>
<li>0..N-1为Pod所在的序号，从0开始到N-1;</li>
<li>statefulSetName为StatefulSet的名字;</li>
<li>namespace服务所在的命名空间;</li>
<li>svc.cluster.local为Cluster Domain（集群域）。</li>
</ul>
<h3 id="2-5-StatefulSet的yaml创建"><a href="#2-5-StatefulSet的yaml创建" class="headerlink" title="2.5 StatefulSet的yaml创建"></a>2.5 StatefulSet的yaml创建</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">vim</span> <span class="string">nginx-sts.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">"nginx"</span>  <span class="comment"># servive名称</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">web</span></span><br></pre></td></tr></table></figure>

<p>​        </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建sts</span></span><br><span class="line">$ kubectl create -f nginx-sts.yaml</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看pod</span></span><br><span class="line">$ kubectl get po </span><br><span class="line">执行结果：</span><br><span class="line">	NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line"> web-0   1/1     Running   0          4m7s</span><br><span class="line"> web-1   1/1     Running   0          4m6s</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看sts</span></span><br><span class="line">$ kubectl get sts</span><br><span class="line">执行结果：</span><br><span class="line">	NAME   READY   AGE</span><br><span class="line">	web    2/2     5m12s</span><br></pre></td></tr></table></figure>



<h3 id="2-6-StatefulSet创建和删除"><a href="#2-6-StatefulSet创建和删除" class="headerlink" title="2.6 StatefulSet创建和删除"></a>2.6 StatefulSet创建和删除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看多副本创建过程</span></span><br><span class="line">$ kubectl get po -w</span><br><span class="line"></span><br><span class="line">	NAME    READY   STATUS              RESTARTS   AGE</span><br><span class="line">web-0   1/1     Running             0          11m</span><br><span class="line">web-1   1/1     Running             0          11m</span><br><span class="line">web-2   1/1     Running             0          103s</span><br><span class="line">web-3   1/1     Running             0          101s</span><br><span class="line">web-4   1/1     Running             0          100s</span><br><span class="line">web-5   1/1     Running             0          1s</span><br><span class="line">web-6   0/1     ContainerCreating   0          0s</span><br><span class="line">web-6   0/1     ContainerCreating   0          1s</span><br><span class="line">web-6   1/1     Running             0          2s</span><br><span class="line">web-7   0/1     Pending             0          0s</span><br><span class="line">web-7   0/1     Pending             0          0s</span><br><span class="line">web-7   0/1     ContainerCreating   0          0s</span><br><span class="line">web-7   0/1     ContainerCreating   0          1s</span><br><span class="line">web-7   1/1     Running             0          2s</span><br><span class="line">web-8   0/1     Pending             0          0s</span><br><span class="line">web-8   0/1     Pending             0          0s</span><br><span class="line">web-8   0/1     ContainerCreating   0          0s</span><br><span class="line">web-8   0/1     ContainerCreating   0          1s</span><br><span class="line">web-8   1/1     Running             0          1s</span><br><span class="line"><span class="comment"># 结果发现是其次创建，且前一个pod完全启动且可以使用才会在再次创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看删除过程</span></span><br><span class="line">$ kubectl get po -w</span><br><span class="line">执行结果：</span><br><span class="line">	NAME    READY   STATUS        RESTARTS   AGE</span><br><span class="line">web-0   1/1     Running       0          16m</span><br><span class="line">web-1   1/1     Running       0          16m</span><br><span class="line">web-2   1/1     Running       0          6m16s</span><br><span class="line">web-3   1/1     Running       0          6m14s</span><br><span class="line">web-4   1/1     Running       0          6m13s</span><br><span class="line">web-5   1/1     Running       0          4m34s</span><br><span class="line">web-6   1/1     Running       0          4m33s</span><br><span class="line">web-7   1/1     Terminating   0          4m31s</span><br><span class="line">web-7   0/1     Terminating   0          4m32s</span><br><span class="line">web-7   0/1     Terminating   0          4m32s</span><br><span class="line">web-7   0/1     Terminating   0          4m32s</span><br><span class="line">web-6   1/1     Terminating   0          4m34s</span><br><span class="line">web-6   1/1     Terminating   0          4m34s</span><br><span class="line">web-6   0/1     Terminating   0          4m35s</span><br><span class="line">web-6   0/1     Terminating   0          4m35s</span><br><span class="line">web-6   0/1     Terminating   0          4m35s</span><br><span class="line">web-5   1/1     Terminating   0          4m36s</span><br><span class="line">web-5   1/1     Terminating   0          4m36s</span><br><span class="line">web-5   0/1     Terminating   0          4m37s</span><br><span class="line">web-5   0/1     Terminating   0          4m37s</span><br><span class="line">web-5   0/1     Terminating   0          4m37s</span><br><span class="line">web-4   1/1     Terminating   0          6m16s</span><br><span class="line">web-4   1/1     Terminating   0          6m16s</span><br><span class="line">web-4   0/1     Terminating   0          6m17s</span><br><span class="line">web-4   0/1     Terminating   0          6m17s</span><br><span class="line">web-4   0/1     Terminating   0          6m17s</span><br><span class="line">web-3   1/1     Terminating   0          6m18s</span><br><span class="line">web-3   1/1     Terminating   0          6m18s</span><br><span class="line">web-3   0/1     Terminating   0          6m19s</span><br><span class="line">web-3   0/1     Terminating   0          6m19s</span><br><span class="line">web-3   0/1     Terminating   0          6m19s</span><br><span class="line">web-2   1/1     Terminating   0          6m21s</span><br><span class="line">web-2   1/1     Terminating   0          6m21s</span><br><span class="line">web-2   0/1     Terminating   0          6m22s</span><br><span class="line">web-2   0/1     Terminating   0          6m22s</span><br><span class="line">web-2   0/1     Terminating   0          6m22s</span><br><span class="line">web-1   1/1     Terminating   0          16m</span><br><span class="line">web-1   1/1     Terminating   0          16m</span><br><span class="line">web-1   0/1     Terminating   0          16m</span><br><span class="line">web-1   0/1     Terminating   0          16m</span><br><span class="line">web-1   0/1     Terminating   0          16m</span><br><span class="line"><span class="comment"># 结果发现是倒序依次删除，且前一个pod完全删除后才会在从新删除</span></span><br></pre></td></tr></table></figure>





<h2 id="3、DaemonSet-守护进程集"><a href="#3、DaemonSet-守护进程集" class="headerlink" title="3、DaemonSet 守护进程集"></a>3、DaemonSet 守护进程集</h2><p>​    简介：DaemonSet（守护进程集，缩写为ds）和守护进程类似，它在符合匹配条件的节点上均部署一个Pod。当有新节点加入集群时，也会为它们新增一个Pod，当节点从集群中移除时，这些Pod也会被回收，删除DaemonSet将会删除它创建的所有Pod。</p>
<ul>
<li>运行集群存储daemon(守护进程)，例如在每个节点上运行Glusterd、Ceph等;</li>
<li>在每个节点运行日志收集daemon，例如Fluentd、 Logstash;</li>
<li>在每个节点运行监控daemon，比如Prometheus Node Exporter、Collectd、Datadog代理、New Relic代理或Ganglia gmond。</li>
</ul>
<h3 id="3-1-DaemonSet守护进程集yaml文件编写"><a href="#3-1-DaemonSet守护进程集yaml文件编写" class="headerlink" title="3.1 DaemonSet守护进程集yaml文件编写"></a>3.1 DaemonSet守护进程集yaml文件编写</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">vim</span> <span class="string">nginx-ds.yaml</span></span><br><span class="line">    <span class="string">---</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">selector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">labels:</span></span><br><span class="line">            <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建DaemonSet </span></span><br><span class="line">$ kubectl apply -f nginx-ds.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看ds的pod</span></span><br><span class="line">$ kubectl get po -owide</span><br><span class="line">执行结果：（发现每个节点都部署了一个Pod）</span><br><span class="line">	NAME          READY   STATUS    RESTARTS   AGE     IP               NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx-65zqs   1/1     Running   0          2m32s   172.25.244.226   k8s-master01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-ds77x   1/1     Running   0          2m32s   172.25.92.92     k8s-master02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-v4hxt   1/1     Running   0          2m32s   172.18.195.29    k8s-master03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-xbwl8   1/1     Running   0          2m32s   172.27.14.228    k8s-node02     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-zzwrt   1/1     Running   0          2m33s   172.17.125.29    k8s-node01     &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看ds的实例</span></span><br><span class="line">$ kubectl get ds</span><br><span class="line">执行结果：</span><br><span class="line">	NAME    DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span><br><span class="line">nginx   5         5         5       5            5           &lt;none&gt;          3m32s</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看其他命名空间下的ds</span></span><br><span class="line">$ kubectl  get ds -n kube-system</span><br><span class="line">执行结果：</span><br><span class="line">	NAME          DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE</span><br><span class="line">calico-node   5         5         5       5            5           kubernetes.io/os=linux   10d</span><br></pre></td></tr></table></figure>



<h3 id="3-3-DaemonSet指定节点部署Pod（只部署在ssd硬盘标签的节点上）"><a href="#3-3-DaemonSet指定节点部署Pod（只部署在ssd硬盘标签的节点上）" class="headerlink" title="3.3 DaemonSet指定节点部署Pod（只部署在ssd硬盘标签的节点上）"></a>3.3 DaemonSet指定节点部署Pod（只部署在ssd硬盘标签的节点上）</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">vim</span> <span class="string">nginx-ds.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span>    <span class="comment"># 标签选择器</span></span><br><span class="line">        <span class="attr">cloud:</span> <span class="string">study</span>  <span class="comment"># 标签类型，指定节点标签 </span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-zhangjiakou.aliyuncs.com/taosweet/nginx:1.24.0-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看所有节点状态</span></span><br><span class="line">$ kubectl get nodes</span><br><span class="line">执行结果：</span><br><span class="line">      k8s-master01   Ready    &lt;none&gt;   11d   v1.23.14</span><br><span class="line">      k8s-master02   Ready    &lt;none&gt;   11d   v1.23.14</span><br><span class="line">      k8s-master03   Ready    &lt;none&gt;   11d   v1.23.14</span><br><span class="line">	  k8s-node01     Ready    &lt;none&gt;   11d   v1.23.14</span><br><span class="line">      k8s-node02     Ready    &lt;none&gt;   11d   v1.23.14</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 将node节点打上标签(打上ssd硬盘标签)</span></span><br><span class="line">$ kubectl label nodes k8s-node01 k8s-node02 disktype=ssd</span><br><span class="line">执行结果：</span><br><span class="line">	node/k8s-node01 labeled</span><br><span class="line">    node/k8s-node02 labeled</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 更新DaemonSet</span></span><br><span class="line">$ kubectl  replace -f nginx-ds.yaml</span><br><span class="line">执行结果：</span><br><span class="line">	daemonset.apps/nginx replaced</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看Pod</span></span><br><span class="line">$ kubectl get po</span><br><span class="line">执行结果：（结果显示只在打了ssd标签的node节点上部署了Pod）</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE    IP              NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx-fd767   1/1     Running   0          2m5s   172.17.125.30   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-lgtvz   1/1     Running   0          2m7s   172.27.14.229   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看集群默认的标签</span></span><br><span class="line">$ kubectl get node --show-labels</span><br><span class="line">执行结果：</span><br><span class="line">NAME           STATUS   ROLES    AGE   VERSION    LABELS</span><br><span class="line">k8s-master01   Ready    &lt;none&gt;   11d   v1.23.14   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-master01,kubernetes.io/os=linux,node.kubernetes.io/node=</span><br><span class="line">k8s-master02   Ready    &lt;none&gt;   11d   v1.23.14   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-master02,kubernetes.io/os=linux,node.kubernetes.io/node=</span><br><span class="line">k8s-master03   Ready    &lt;none&gt;   11d   v1.23.14   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-master03,kubernetes.io/os=linux,node.kubernetes.io/node=</span><br><span class="line">k8s-node01     Ready    &lt;none&gt;   11d   v1.23.14   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,disktype=ssd,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node01,kubernetes.io/os=linux,node.kubernetes.io/node=</span><br><span class="line">k8s-node02     Ready    &lt;none&gt;   11d   v1.23.14   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,disktype=ssd,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node02,kubernetes.io/os=linux,node.kubernetes.io/node=</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/">https://l66stbz.github.io/2024/09/16/Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/03-Kubernetes%E5%9F%BA%E7%A1%80%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://l66stbz.github.io" target="_blank">L66</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Kubernetes/">Kubernetes</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/09/23/spring cloud k8s容器化部署/spring cloud k8s容器化部署若依/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2024/09/17/kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/04-kubernetes%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83/"><img class="prev_cover" src="https://l66stbz.github.io/2024/09/17/kubernetes服务发布/04-kubernetes服务发布/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kubernetes服务发布</div></div></a></div><div class="next-post pull_right"><a href="/2024/09/15/kubernetes%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%EF%BC%88v1.23+%EF%BC%89/kubernetes%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%EF%BC%88v1.23+%EF%BC%89/"><img class="next_cover" src="https://l66stbz.github.io/2024/09/15/kubernetes 二进制高可用安装部署（v1.23+）/kubernetes 二进制高可用安装部署（v1.23+）/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">kubernetes 二进制高可用安装部署（v1.23+）</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/09/23/spring cloud k8s容器化部署/spring cloud k8s容器化部署若依/" title="spring cloud k8s容器化部署"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/23/spring cloud k8s容器化部署/spring cloud k8s容器化部署若依/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-23</div><div class="relatedPosts_title">spring cloud k8s容器化部署</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/13/Kubernetes基础概念/01-Kubernetes基础概念/" title="Kubernetes基础概念"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/13/Kubernetes基础概念/01-Kubernetes基础概念/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-13</div><div class="relatedPosts_title">Kubernetes基础概念</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/14/Kubernetes容器编排工具部署（adm）/02-Kubernetes容器编排工具部署（adm）/" title="Kubernetes容器编排工具部署（adm）"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/14/Kubernetes容器编排工具部署（adm）/02-Kubernetes容器编排工具部署（adm）/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-14</div><div class="relatedPosts_title">Kubernetes容器编排工具部署（adm）</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/15/kubernetes 二进制高可用安装部署（v1.23+）/kubernetes 二进制高可用安装部署（v1.23+）/" title="kubernetes 二进制高可用安装部署（v1.23+）"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/15/kubernetes 二进制高可用安装部署（v1.23+）/kubernetes 二进制高可用安装部署（v1.23+）/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-15</div><div class="relatedPosts_title">kubernetes 二进制高可用安装部署（v1.23+）</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/19/Kubernetes RBAC细粒度权限划分/07-Kubernetes RBAC细粒度权限划分/" title="Kubernetes RBAC细粒度权限划分"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/19/Kubernetes RBAC细粒度权限划分/07-Kubernetes RBAC细粒度权限划分/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-19</div><div class="relatedPosts_title">Kubernetes RBAC细粒度权限划分</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/20/Kubernetes持久化文件存储/08-Kubernetes持久化文件存储/" title="Kubernetes持久化文件存储"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/20/Kubernetes持久化文件存储/08-Kubernetes持久化文件存储/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-20</div><div class="relatedPosts_title">Kubernetes持久化文件存储</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>