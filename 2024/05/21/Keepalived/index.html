<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Keepalived | L66</title><meta name="description" content="Keepalived12345678910111213141516keepalived是什么    keepalived是集群管理中保证集群高可用的一个服务软件，用来防止单节点故障。keepalived工作原理    keepalived是以VRRP协议为实现基础的，VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。    虚拟路由冗余协议，可以"><meta name="keywords" content="Linux,Keepalived"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Keepalived"><meta name="twitter:description" content="Keepalived12345678910111213141516keepalived是什么    keepalived是集群管理中保证集群高可用的一个服务软件，用来防止单节点故障。keepalived工作原理    keepalived是以VRRP协议为实现基础的，VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。    虚拟路由冗余协议，可以"><meta name="twitter:image" content="https://l66stbz.github.io/2024/05/21/Keepalived/1.png"><meta property="og:type" content="article"><meta property="og:title" content="Keepalived"><meta property="og:url" content="https://l66stbz.github.io/2024/05/21/Keepalived/"><meta property="og:site_name" content="L66"><meta property="og:description" content="Keepalived12345678910111213141516keepalived是什么    keepalived是集群管理中保证集群高可用的一个服务软件，用来防止单节点故障。keepalived工作原理    keepalived是以VRRP协议为实现基础的，VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。    虚拟路由冗余协议，可以"><meta property="og:image" content="https://l66stbz.github.io/2024/05/21/Keepalived/1.png"><meta property="article:published_time" content="2024-05-21T01:56:37.000Z"><meta property="article:modified_time" content="2024-06-22T07:52:09.693Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/05/21/Keepalived/"><link rel="prev" title="小组讨论问题" href="https://l66stbz.github.io/2024/05/22/%E5%B0%8F%E7%BB%84%E8%AE%A8%E8%AE%BA%E9%97%AE%E9%A2%98/"><link rel="next" title="基于云部署tomcat和jdk使jspgou项目上线" href="https://l66stbz.github.io/2024/05/20/%E5%9F%BA%E4%BA%8E%E4%BA%91%E9%83%A8%E7%BD%B2tomcat%E5%92%8Cjdk%E4%BD%BFjspgou%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">41</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">28</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Keepalived"><span class="toc-number">1.</span> <span class="toc-text">Keepalived</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实现nginx的反向代理"><span class="toc-number">1.1.</span> <span class="toc-text">实现nginx的反向代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置反向代理服务器端"><span class="toc-number">1.2.</span> <span class="toc-text">配置反向代理服务器端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keepalived实现调度器HA"><span class="toc-number">1.3.</span> <span class="toc-text">Keepalived实现调度器HA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加入检测服务脚本"><span class="toc-number">1.4.</span> <span class="toc-text">加入检测服务脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keepalived邮箱报警配置"><span class="toc-number">1.5.</span> <span class="toc-text">Keepalived邮箱报警配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置发送邮件的设置："><span class="toc-number">1.5.1.</span> <span class="toc-text">配置发送邮件的设置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#keepalived的vip不漂移问题"><span class="toc-number">1.5.2.</span> <span class="toc-text">keepalived的vip不漂移问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LVS-Director-KeepAlived"><span class="toc-number">1.6.</span> <span class="toc-text">LVS_Director + KeepAlived</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LVS-NAT-Keepalived"><span class="toc-number">1.7.</span> <span class="toc-text">LVS_NAT + Keepalived</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#访问测试"><span class="toc-number">1.7.0.1.</span> <span class="toc-text">访问测试</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/05/21/Keepalived/1.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Keepalived</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2024-05-21 09:56:37"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2024-05-21</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2024-06-22 15:52:09"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2024-06-22</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">keepalived是什么</span><br><span class="line">    keepalived是集群管理中保证集群高可用的一个服务软件，用来防止单节点故障。</span><br><span class="line"></span><br><span class="line">keepalived工作原理</span><br><span class="line">    keepalived是以VRRP协议为实现基础的，VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。</span><br><span class="line"></span><br><span class="line">    虚拟路由冗余协议，可以认为是实现高可用的协议，即将N台提供相同功能的路由器组成一个路由器组，这个组里面有一个master和多个backup，master上面有一个对外提供服务的vip（该路由器所在局域网内其他机器的默认路由为该vip），master会发组播，当backup收不到vrrp包时就认为master宕掉了，这时就需要根据VRRP的优先级来选举一个backup当master。这样的话就可以保证路由器的高可用了。</span><br><span class="line"></span><br><span class="line">keepalived主要有三个模块，分别是core、check和vrrp。core模块为keepalived的核心，负责主进程的启动、维护以及全局配置文件的加载和解析。check负责健康检查，包括常见的各种检查方式。vrrp模块是来实现VRRP协议的。</span><br><span class="line">============================================================================</span><br><span class="line">脑裂(裂脑)：</span><br><span class="line">Keepalived的BACKUP主机在收到不MASTER主机报文后就会切换成为master，如果是它们之间的通信线路出现问题，无法接收到彼此的组播通知，但是两个节点实际都处于正常工作状态，这时两个节点均为master强行绑定虚拟IP，导致不可预料的后果，这就是脑裂。</span><br><span class="line">解决方式:</span><br><span class="line">1、添加更多的检测手段，比如冗余的心跳线（两块网卡做健康监测），ping对方等等。尽量减少"裂脑"发生机会。(治标不治本，只是提高了检测到的概率)；</span><br><span class="line">2、做好对裂脑的监控报警（如邮件及手机短信等或值班）.在问题发生时人为第一时间介入仲裁，降低损失。例如，百度的监控报警短倍就有上行和下行的区别。报警消息发送到管理员手机上，管理员可以通过手机回复对应数字或简单的字符串操作返回给服务器.让服务器根据指令自动处理相应故障，这样解决故障的时间更短；</span><br><span class="line">3、爆头，将master停掉。然后检查机器之间的防火墙。网络之间的通信;</span><br></pre></td></tr></table></figure>

<h3 id="实现nginx的反向代理"><a href="#实现nginx的反向代理" class="headerlink" title="实现nginx的反向代理"></a>实现nginx的反向代理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">反向代理代理的是服务端，正向代理代理的是客户端。</span><br><span class="line">proxy:反向代理</span><br><span class="line">agent:正向代理</span><br><span class="line">反向代理服务器自己本身并不存放页面，当有用户申请访问时，反向代理服务器会向下面的真实服务器转发，从而提供页面，转发前会先确认是否"活着"。如果没有服务器“活着”，那么就无法提供页面，从而用户访问不到。</span><br></pre></td></tr></table></figure>

<p>配置安装nginx 所有的机器，关闭防火墙和selinux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-agent-node2 ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@zabbix-agent-node2 yum.repos.d]# vim nginx.repo</span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[root@zabbix-agent-node2 yum.repos.d]# yum install nginx -y</span><br></pre></td></tr></table></figure>

<p>此处将Alan游戏网站拖到了root目录下，因为想要展示的页面文件后缀名为htm。所以要想优先展示可以修改nginx的配置文件，让htm文件优先展示。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-agent-node2 ~]# mv /root/alan游戏网站/* /usr/share/nginx/html/</span><br><span class="line">[root@zabbix-agent-node2 ~]# vi /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure>

<p><strong><img src="/2024/05/21/Keepalived/1.png" class></strong></p>
<p>想让htm文件优先展示就让index.html文件在前，反之一样。</p>
<p>修改过后nginx的配置文件记得重启nginx服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server yum.repos.d]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>浏览器访问：<a href="http://192.168.100.40成功显示" target="_blank" rel="noopener">http://192.168.100.40成功显示</a><strong><img src="/2024/05/21/Keepalived/2.png" class></strong></p>
<p>下面在node1节点再次安装nginx服务也作为真实服务器端。具体操作同上，页面方面可以换成别的页面，两节点不一样方便最后对照显示。此处node1节点使用的页面是nginx默认显示的页面。</p>
<h3 id="配置反向代理服务器端"><a href="#配置反向代理服务器端" class="headerlink" title="配置反向代理服务器端"></a>配置反向代理服务器端</h3><p>同上一样，配置安装nginx，关闭防火墙和selinux。因为此节点的80端口被其他服务占用了，所以此节点的nginx服务需要额外修改一下端口，具体配置如下，此处是将upstream index和server放在了一个文件当中，笔记中是分了两个文件。两种都是可以的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">子配置文件不管怎么写最终其实也都是放到了主配置文件当中，以.conf结尾的一般都是主配置文件，一般都放在 /etc/服务名 目录下，conf.d一般都是子配置文件目录。</span></span><br></pre></td></tr></table></figure>

<p>配置完成后重启nginx服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server ~]# vi /etc/nginx/conf.d/default.conf </span><br><span class="line"></span><br><span class="line">upstream index &#123;</span><br><span class="line">        server 192.168.100.30:80 weight=1 max_fails=2 fail_timeout=2;</span><br><span class="line">        server 192.168.100.40:80 weight=2 max_fails=2 fail_timeout=2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">weight意为优先级，此处相当于找30一次，找40两次，由此往复，不写默认都是1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max_fails意为最大失败次数，也就是询问该节点2次如果都无回应则不会再询问该节点。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">fail_timeout意为失败后的再次询问时间间隔，也就是询问后2秒无回应再询问下一次</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 81;#80端口被占用，启用81端口</span><br><span class="line">        server_name     localhost;</span><br><span class="line">        access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">         proxy_pass http://index;</span><br><span class="line">         #此处http://后的内容要与第一行upstream后的内容一致</span><br><span class="line">         proxy_redirect default;</span><br><span class="line">         proxy_set_header Host $http_host;</span><br><span class="line">         proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">[root@zabbix-server ~]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>此时可以去浏览器访问：<a href="http://192.168.100.20:81,可以发现第一次是node1节点的nginx页面，刷新后是node2节点的设置的游戏页面，至此反向代理服务器设置成功。">http://192.168.100.20:81,可以发现第一次是node1节点的nginx页面，刷新后是node2节点的设置的游戏页面，至此反向代理服务器设置成功。</a></p>
<p><strong><img src="/2024/05/21/Keepalived/3.png" class></strong></p>
<p><strong><img src="/2024/05/21/Keepalived/4.png" class></strong></p>
<p>上述情况为高并发集群，当keepalived介入后，有了backup，就成了高可用集群，高可用集群是建立在高并发集群的基础上的。</p>
<h3 id="Keepalived实现调度器HA"><a href="#Keepalived实现调度器HA" class="headerlink" title="Keepalived实现调度器HA"></a>Keepalived实现调度器HA</h3><ol>
<li><p>主/备调度器安装软件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx-proxy-master ~]# yum install -y keepalived</span><br><span class="line">[root@nginx-proxy-slave ~]# yum install -y keepalived</span><br><span class="line">[root@nginx-proxy-slave ~]# cd /etc/nginx/conf.d/</span><br><span class="line">[root@nginx-proxy-slave conf.d]# mv default.conf default.conf.bak</span><br><span class="line">[root@nginx-proxy-master ~]# mv /etc/keepalived/keepalived.conf </span><br><span class="line">/etc/keepalived/keepalived.conf.bak</span><br><span class="line"><span class="meta">#</span><span class="bash">为了防止后续会用到原配置文件，所以将其加了后缀名封印了，重新创了新的进行编写</span></span><br><span class="line">[root@nginx-proxy-master ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id directory1   #辅助改为directory2，相当于是组内的主机名</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;     #组名</span><br><span class="line">    state MASTER        #定义主还是备</span><br><span class="line">    interface ens33     #VIP绑定接口</span><br><span class="line">    virtual_router_id 80  #整个集群的调度器一致</span><br><span class="line">    priority 100         #优先级，backup改为50</span><br><span class="line">    advert_int 1		 #心跳检测的时间间隔1s</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS   #认证方式，可以是PASS或AH两种认证方式</span><br><span class="line">        auth_pass 1111   #认证密码，组内须一致</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24  #VIP</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx-proxy-slave ~]# mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span><br><span class="line">[root@nginx-proxy-slave ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id directory2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP    #设置为backup</span><br><span class="line">    interface ens33</span><br><span class="line">    nopreempt        #设置到back上面，不抢占资源(VIP)</span><br><span class="line">    virtual_router_id 80</span><br><span class="line">    priority 50   #辅助改为50</span><br><span class="line">    advert_int 1	#检测间隔1s</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  2.启动KeepAlived（主备均启动）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx-proxy-master ~]# systemctl start keepalived</span><br><span class="line">[root@nginx-proxy-master ~]# systemctl enable keepalived</span><br><span class="line">[root@nginx-porxy-slave ~]# systemctl start keepalived</span><br><span class="line">[root@nginx-porxy-slave ~]# systemctl enable keepalived</span><br><span class="line">[root@nginx-proxy-master ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:8c:41:88 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.100.20/24 brd 192.168.100.255 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.100.100/24 scope global secondary ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:fe8c:4188/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>测试：<br>浏览器访问：<a href="http://192.168.100.100" target="_blank" rel="noopener">http://192.168.100.100</a><br>如能正常访问，将keepalived主节点关机，测试vip是否漂移</p>
<p>测试后发现VIP漂移到了从节点，并且浏览器访问：<a href="http://192.168.100.100依旧可以正常访问。" target="_blank" rel="noopener">http://192.168.100.100依旧可以正常访问。</a></p>
<h3 id="加入检测服务脚本"><a href="#加入检测服务脚本" class="headerlink" title="加入检测服务脚本"></a>加入检测服务脚本</h3><p>到此：<br>可以解决心跳故障keepalived<br>不能解决Nginx服务故障，也就是心跳检测，加入检测服务脚本的目的也就是要让主从反向代理服务器上的nginx服务和keepalived服务绑定在一起。</p>
<p>正常情况来讲，机器的keepalived服务挂掉了VIP才会进行漂移，但是在工作当中除了机器直接关机或者没了才会出现这种情况，大多数的情况是nginx挂掉而keepalived服务仍然正常，所以就会导致一种结果，nginx服务挂掉网页无法正常访问，但keepalived服务仍正常运行所以VIP并不会漂移到从节点。</p>
<p>所以加入检测脚本就是让脚本不断检测nginx服务是否挂掉，当确定挂掉时，脚本会关掉keepalived服务，使得VIP自动漂移到从节点。从而用户可以正常访问。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">让Keepalived以一定时间间隔执行一个外部脚本，脚本的功能是当Nginx失败，则关闭本机的Keepalived</span><br><span class="line">(1) script</span><br><span class="line">[root@nginx-proxy-master ~]# vim /etc/keepalived/check_nginx_status.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash					        </span></span><br><span class="line">/usr/bin/curl -I http://localhost &amp;&gt;/dev/null</span><br><span class="line">if [ $? -ne 0 ];then						    </span><br><span class="line"><span class="meta">#</span><span class="bash">	/etc/init.d/keepalived stop</span></span><br><span class="line">	systemctl stop keepalived</span><br><span class="line">fi														        	</span><br><span class="line">[root@nginx-proxy-master ~]# chmod a+x /etc/keepalived/check_nginx_status.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">赋予文件执行权限</span></span><br><span class="line">(2). keepalived使用script</span><br><span class="line">[root@nginx-proxy-master ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id directory1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_nginx &#123;     #check_nginx相当于文件的别名</span><br><span class="line">   script "/etc/keepalived/check_nginx_status.sh"  #文件路径</span><br><span class="line">   interval 5                #间隔时间，就是如果无回应多久进行下一次访问</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id 80</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_nginx            #文件别名，需与上方的一致</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">注：必须先启动Nginx，再启动keepalived</span><br><span class="line"></span><br><span class="line">测试访问：  </span><br><span class="line">将keepalived集群的主节点的Nginx服务关闭，查看vip是否漂移，如果漂移，即成功。</span><br><span class="line">VIP成功漂移后再次启动主节点nginx服务，VIP会自动漂移回来主节点，原因是主节点优先级高。</span><br><span class="line">正常工作中不论主从节点都需要安装检测服务，此处只是为了展示实验结果所以只在主节点进行了配置。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">面试题：高可用时，你的备份机器（从机）是否存在可用性？</span><br><span class="line">是存在的，只不过是没有流量分发到备份机器，VIP不在从机。</span><br></pre></td></tr></table></figure>

<h3 id="Keepalived邮箱报警配置"><a href="#Keepalived邮箱报警配置" class="headerlink" title="Keepalived邮箱报警配置"></a>Keepalived邮箱报警配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主备都配置</span></span><br><span class="line"></span><br><span class="line">[root@keepalived-1 keepalived]# cat /etc/keepalived/notify.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">contact='ldq20000603@163.com'</span><br><span class="line">notify() &#123;</span><br><span class="line">local mailsubject="$(hostname) to be $1, vip floating"</span><br><span class="line">local mailbody="$(date +'%F %T'): vrrp transition, $(hostname) changed to be $1"</span><br><span class="line">echo "$mailbody" | mail -s "$mailsubject" $contact</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">contack为全局变量，<span class="built_in">local</span>为局部变量，<span class="variable">$0</span>为脚本文件，<span class="variable">$1</span>为执行命令后定义的变量，<span class="variable">$2</span>即为执行命令后定义的第二个变量（根据顺序排队确定第几个变量）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#如：</span></span></span><br><span class="line">[root@zabbix-server ~]# cat $$$.sh</span><br><span class="line">echo "$1 你好呀"</span><br><span class="line">[root@zabbix-server ~]# bash $$$.sh 刘 李</span><br><span class="line">刘 你好呀</span><br><span class="line">[root@zabbix-server ~]# bash $$$.sh 李 李</span><br><span class="line">李 你好呀</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line">case $1 in</span><br><span class="line">master)</span><br><span class="line">        notify master</span><br><span class="line">        ;;</span><br><span class="line">backup)</span><br><span class="line">        notify backup</span><br><span class="line">        ;;</span><br><span class="line">fault)</span><br><span class="line">        notify fault</span><br><span class="line">        ;;</span><br><span class="line">*)</span><br><span class="line">        echo "Usage: $(basename $0) &#123;master|backup|fault&#125;"</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line">[root@keepalived-1 keepalived]# chmod 777 /etc/keepalived/notify.sh</span><br></pre></td></tr></table></figure>

<h4 id="配置发送邮件的设置："><a href="#配置发送邮件的设置：" class="headerlink" title="配置发送邮件的设置："></a>配置发送邮件的设置：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">主备都操作</span><br><span class="line">[root@keepalived-1 ~]# yum -y install mailx</span><br><span class="line">[root@keepalived-1 ~]# vim /etc/mail.rc  #在文件最后面添加</span><br><span class="line">set from=ldq20000603@163.com</span><br><span class="line">set smtp=smtp.163.com</span><br><span class="line">set smtp-auth-user=ldq20000603@163.com</span><br><span class="line">set smtp-auth-password=IKMQRYSVCTALDYNT  #邮箱需要开启POP3/SMTP服务并设置密钥</span><br><span class="line">set smtp-auth=login</span><br><span class="line">set ssl-verify=ignore</span><br><span class="line">[root@keepalived-1 ~]# echo test mail| mail -s "testa" ldq20000603@163.com</span><br></pre></td></tr></table></figure>

<p><strong><img src="/2024/05/21/Keepalived/5.png" class></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server ~]# vi /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   router_id directory1   <span class="comment">#辅助改为directory2</span></span></span><br><span class="line"></span><br><span class="line">   notification_email &#123;</span><br><span class="line">    ldq20000603@163.com    # 报警邮件地址，也就是接收者</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc  #发送者的邮箱，指定发件人</span><br><span class="line">   smtp_server smtp.163.com</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id directory1   #辅助改为directory2</span><br><span class="line">   vrrp_garp_interval 0  # ARP报文发送延迟时间，可以精确到毫秒级。默认是0.</span><br><span class="line">   vrrp_gna_interval 0   # 信息发送延迟时间</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script check_nginx &#123;</span><br><span class="line">   script "/etc/keepalived/check_nginx.sh"</span><br><span class="line">   interval 5</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER        #定义主还是备</span><br><span class="line">    interface ens33     #VIP绑定接口</span><br><span class="line">    virtual_router_id 80  #整个集群的调度器一致</span><br><span class="line">    priority 100         #优先级，backup改为50</span><br><span class="line">    advert_int 1                 #心跳检测的时间间隔1s</span><br><span class="line">    #nopreempt</span><br><span class="line">    notify_master "/etc/keepalived/notify.sh master"  #当前节点成为master时，通知脚本执行任务</span><br><span class="line">    notify_backup "/etc/keepalived/notify.sh backup"  #当前节点成为backup时，通知脚本执行任务</span><br><span class="line">    notify_fault "/etc/keepalived/notify.sh fault"    #当当前节点出现故障，执行的任务</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">track_script &#123;</span><br><span class="line">        check_nginx</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">参数解释：</span></span><br><span class="line">notification_email &#123;...&#125;：该指令用于应用一段邮件接收者的一个配置段，用大括号括起来，里面可以配置多个邮件接收者；</span><br><span class="line">notification_email_from：该指令用于指定邮件发出者的邮箱；</span><br><span class="line">smtp_server：该指令用于指定邮件服务器地址；</span><br><span class="line">smtp_connect_timeout：该指令用于指定连接邮件服务器的超时时长，默认30秒；</span><br><span class="line">notify_master：配置节点成为master角色的触发的动作；通常为执行一个脚本；</span><br><span class="line">notify_backup：配置节点角色转换为backup触发的动作；</span><br><span class="line">notify_fault：配置节点为失败状态触发的动作；</span><br></pre></td></tr></table></figure>

<p>正常来讲主从节点机器都需要进行以上邮件报警设置操作，这里为了展示实验结果只在主节点进行了上述操作。自己操作时需要主从节点机器都进行操作。主从节点基本配置没有什么区别，注意一些组内主机机器名和主从设备的定义。</p>
<p>测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@test-1 keepalived]# systemctl start keepalived</span><br></pre></td></tr></table></figure>

<p><strong><img src="/2024/05/21/Keepalived/6.png" class></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@test-1 keepalived]# systemctl stop keepalived</span><br></pre></td></tr></table></figure>

<p><strong><img src="/2024/05/21/Keepalived/7.png" class></strong></p>
<h4 id="keepalived的vip不漂移问题"><a href="#keepalived的vip不漂移问题" class="headerlink" title="keepalived的vip不漂移问题"></a>keepalived的vip不漂移问题</h4><p>详细看参考链接：<a href="https://blog.csdn.net/Laymany/article/details/122978075" target="_blank" rel="noopener">https://blog.csdn.net/Laymany/article/details/122978075</a></p>
<h3 id="LVS-Director-KeepAlived"><a href="#LVS-Director-KeepAlived" class="headerlink" title="LVS_Director + KeepAlived"></a>LVS_Director + KeepAlived</h3><p><strong><img src="/2024/05/21/Keepalived/8.png" class></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">实施步骤：</span><br><span class="line"></span><br><span class="line">1. 主/备调度器安装软件</span><br><span class="line">   [root@lvs-keepalived-master ~]# yum -y install ipvsadm keepalived </span><br><span class="line">   [root@lvs-keepalived-slave ~]# yum -y install ipvsadm keepalived</span><br><span class="line">2. Keepalived</span><br><span class="line">   lvs-master</span><br><span class="line">   [root@lvs-keepalived-master ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id directory1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id 80</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    #nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virtual_server 192.168.100.100 80 &#123;</span><br><span class="line">        delay_loop 3</span><br><span class="line">        lb_algo rr</span><br><span class="line">        lb_kind DR</span><br><span class="line">        nat_mask 255.255.255.0</span><br><span class="line">        protocol TCP</span><br><span class="line">        real_server 192.168.100.30 80 &#123;</span><br><span class="line">                weight 1</span><br><span class="line">                inhibit_on_failure</span><br><span class="line">                TCP_CHECK &#123;</span><br><span class="line">                        connect_port 80</span><br><span class="line">                        connect_timeout 3</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        real_server 192.168.100.40 80 &#123;</span><br><span class="line">                weight 1</span><br><span class="line">                inhibit_on_failure</span><br><span class="line">                TCP_CHECK &#123;</span><br><span class="line">                        connect_timeout 3</span><br><span class="line">                        connect_port 80</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@lvs-keepalived-slave ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id lvs-keepalived-slave</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens33</span><br><span class="line">    nopreempt                    #不抢占资源</span><br><span class="line">    virtual_router_id 80</span><br><span class="line">    priority 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.100.100 80 &#123;</span><br><span class="line">	delay_loop 3</span><br><span class="line">	lb_algo rr</span><br><span class="line">	lb_kind DR</span><br><span class="line">	nat_mask 255.255.255.0</span><br><span class="line">	protocol TCP</span><br><span class="line">	real_server 192.168.100.30 80 &#123;</span><br><span class="line">		weight 1</span><br><span class="line">		inhibit_on_failure</span><br><span class="line">		TCP_CHECK &#123;</span><br><span class="line">			connect_port 80</span><br><span class="line">			connect_timeout 3</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	real_server 192.168.100.40 80 &#123;</span><br><span class="line">		weight 1</span><br><span class="line">		inhibit_on_failure</span><br><span class="line">		TCP_CHECK &#123;</span><br><span class="line">			connect_timeout 3</span><br><span class="line">			connect_port 80</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3. 启动KeepAlived（主备均启动）</span><br><span class="line">   [root@lvs-keepalived-master ~]# systemctl start keepalived</span><br><span class="line">   [root@lvs-keepalived-master ~]# systemctl enable keepalived</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">所有RS配置(nginx1,nginx2)</span><br><span class="line">配置好网站服务器，测试所有RS</span><br><span class="line">[root@test-nginx1 ~]# yum install -y nginx</span><br><span class="line">[root@test-nginx2 ~]# yum install -y nginx</span><br><span class="line"></span><br><span class="line">[root@test-nginx1 ~]# ip addr add dev lo 192.168.246.110/32</span><br><span class="line">[root@test-nginx2 ~]# ip addr add dev lo 192.168.246.110/32</span><br><span class="line"></span><br><span class="line">[root@test-nginx1 ~]# echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore #忽略arp广播</span><br><span class="line">[root@test-nginx1 ~]# echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce #匹配精确ip地址回包</span><br><span class="line"></span><br><span class="line">[root@test-nginx2 ~]# echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore #忽略arp广播</span><br><span class="line">[root@test-nginx2 ~]# echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce #匹配精确ip地</span><br><span class="line">[root@test-nginx1 ~]# systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>测试<br>所有分发器和Real Server都正常。访问LVS的VIP可以访问到页面，关闭master节点的keepalived后，VIP漂移到slave节点。仍然可以访问到页面，master节点keepalived再次启动后，VIP飘回仍正常访问。</p>
<h3 id="LVS-NAT-Keepalived"><a href="#LVS-NAT-Keepalived" class="headerlink" title="LVS_NAT + Keepalived"></a>LVS_NAT + Keepalived</h3><p>四台机器（网络模式都设置为NAT模式）：<br>两台做lvs-nat模式的keepalived集群<br>两台做RS(Nginx提供静态页面即可)</p>
<p><strong><img src="/2024/05/21/Keepalived/9.png" class></strong></p>
<p>两台lvs操作<br>都添加一块桥接的网卡</p>
<p><strong><img src="/2024/05/21/Keepalived/10.png" class></strong></p>
<p>lvs的master节点配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@lvs-master ~]# yum -y install ipvsadm keepalived</span><br><span class="line">[root@lvs-master ~]# cat /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">     router_id directory1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens37		#桥接网卡名称</span><br><span class="line">    virtual_router_id 80</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">      10.8.153.200/24		#注意自己的网段</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.8.153.200 80 &#123;</span><br><span class="line">    delay_loop 3</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind NAT</span><br><span class="line">    nat_mask 255.255.255.0</span><br><span class="line">    protocol TCP</span><br><span class="line">real_server 192.168.100.30 80 &#123;</span><br><span class="line">    weight 1</span><br><span class="line">    inhibit_on_failure</span><br><span class="line">    TCP_CHECK &#123;</span><br><span class="line">        connect_port 80</span><br><span class="line">        connect_timeout 3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">real_server 192.168.100.40 80 &#123;</span><br><span class="line">    weight 1</span><br><span class="line">    inhibit_on_failure</span><br><span class="line">    TCP_CHECK &#123;</span><br><span class="line">    connect_timeout 3</span><br><span class="line">    connect_port 80</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_2 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens33		#NAT模式网卡名称</span><br><span class="line">    virtual_router_id 100</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 2222</span><br><span class="line">        &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lvs的slave节点配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@lvs-slave ~]# yum -y install ipvsadm keepalived</span><br><span class="line">[root@lvs-slave ~]# cat /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">     router_id directory2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens37</span><br><span class="line">    nopreempt</span><br><span class="line">    virtual_router_id 80</span><br><span class="line">    priority 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">      10.8.153.200/24</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.8.153.200 80 &#123;</span><br><span class="line">    delay_loop 3</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind NAT</span><br><span class="line">    nat_mask 255.255.255.0</span><br><span class="line">    protocol TCP</span><br><span class="line">real_server 192.168.100.30 80 &#123;</span><br><span class="line">    weight 1</span><br><span class="line">    inhibit_on_failure</span><br><span class="line">    TCP_CHECK &#123;</span><br><span class="line">        connect_port 80</span><br><span class="line">        connect_timeout 3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">real_server 192.168.100.40 80 &#123;</span><br><span class="line">    weight 1</span><br><span class="line">    inhibit_on_failure</span><br><span class="line">    TCP_CHECK &#123;</span><br><span class="line">    connect_timeout 3</span><br><span class="line">    connect_port 80</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_2 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens33</span><br><span class="line">    nopreempt</span><br><span class="line">    virtual_router_id 100</span><br><span class="line">    priority 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 2222</span><br><span class="line">        &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.100.100/24</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">注意开启路由转发</span><br><span class="line">[root@lvs-master ~]# vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">[root@lvs-master ~]# sysctl -p</span><br><span class="line"></span><br><span class="line">[root@lvs-slave ~]# vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">[root@lvs-slave ~]# sysctl -p</span><br><span class="line"></span><br><span class="line">安装nginx服务器，配置不同的静态页面过程：略</span><br><span class="line"></span><br><span class="line">[root@test-nginx1 ~]# route add default gw 192.168.100.100  dev ens33</span><br><span class="line">[root@test-nginx2 ~]# route add default gw 192.168.100.100  dev ens33</span><br><span class="line"></span><br><span class="line">提示：由于临时添加的方式，网关有可能会消失。也可以直接去网卡配置文件中修改网关，保存退出后记得重启网络。重启网络命令:systemctl restart network</span><br><span class="line">====================================================================================</span><br><span class="line"></span><br><span class="line">启动Keepalived服务</span><br><span class="line">[root@lvs-master ~]# systemctl start keepalived</span><br><span class="line">[root@lvs-slave ~]# systemctl start keepalived</span><br></pre></td></tr></table></figure>

<h5 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h5><p>当两个vip在master节点上时，访问浏览器</p>
<p>把master节点的keepalived服务停止，两个vip会漂移到backup节点，再次用浏览器访问</p>
<p>总结：如果ip漂移之后，访问不到，<br>1.查看backup节点是否开启了路由转发<br>2.查看RS上面的网关有没有消失</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/05/21/Keepalived/">https://l66stbz.github.io/2024/05/21/Keepalived/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://l66stbz.github.io" target="_blank">L66</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Keepalived/">Keepalived</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/08/21/企业自动化运维神器Ansible(2)/1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2024/05/22/%E5%B0%8F%E7%BB%84%E8%AE%A8%E8%AE%BA%E9%97%AE%E9%A2%98/"><img class="prev_cover" src="https://l66stbz.github.io/2024/05/22/小组讨论问题/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">小组讨论问题</div></div></a></div><div class="next-post pull_right"><a href="/2024/05/20/%E5%9F%BA%E4%BA%8E%E4%BA%91%E9%83%A8%E7%BD%B2tomcat%E5%92%8Cjdk%E4%BD%BFjspgou%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/"><img class="next_cover" src="https://l66stbz.github.io/2024/05/20/基于云部署tomcat和jdk使jspgou项目上线/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于云部署tomcat和jdk使jspgou项目上线</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/08/13/LVS-NAT-Keepalived/" title="LVS-NAT-Keepalived"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/13/LVS-NAT-Keepalived/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-13</div><div class="relatedPosts_title">LVS-NAT-Keepalived</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/24/自动化脚本/" title="自动化脚本"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/24/自动化脚本/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-24</div><div class="relatedPosts_title">自动化脚本</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/12/负载均衡+keepalived/" title="负载均衡+keepalived"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/12/负载均衡+keepalived/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-12</div><div class="relatedPosts_title">负载均衡+keepalived</div></div></a></div><div class="relatedPosts_item"><a href="/2024/06/29/作业小合集/" title="作业小合集"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/06/29/作业小合集/1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-06-29</div><div class="relatedPosts_title">作业小合集</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/14/NoSQL-Redis/" title="NoSQL-Redis"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/14/NoSQL-Redis/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-14</div><div class="relatedPosts_title">NoSQL-Redis</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/16/RabbitMQ消息队列/" title="RabbitMQ消息队列"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/16/RabbitMQ消息队列/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-16</div><div class="relatedPosts_title">RabbitMQ消息队列</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>