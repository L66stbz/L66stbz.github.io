<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>企业自动化运维神器Ansible(1) | L66</title><meta name="description" content="企业级自动化运维工具Ansible[TOC] 一、介绍1、自动化运维发展历程 手动运维阶段  特点：  早期计算机时代：主要依赖运维人员手动管理服务器等。 集中管理和人工操作：系统更新、配置、监控、故障排查等任务全部手动完成。 局限性：效率低下、容易出现人为错误，且无法应对大规模环境。  典型场景：小型数据中心，几台服务器，运维人员使用SSH等手动登录服务器进行操作。  脚本化运维阶段  特点："><meta name="keywords" content="Linux,Ansible"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="企业自动化运维神器Ansible(1)"><meta name="twitter:description" content="企业级自动化运维工具Ansible[TOC] 一、介绍1、自动化运维发展历程 手动运维阶段  特点：  早期计算机时代：主要依赖运维人员手动管理服务器等。 集中管理和人工操作：系统更新、配置、监控、故障排查等任务全部手动完成。 局限性：效率低下、容易出现人为错误，且无法应对大规模环境。  典型场景：小型数据中心，几台服务器，运维人员使用SSH等手动登录服务器进行操作。  脚本化运维阶段  特点："><meta name="twitter:image" content="https://l66stbz.github.io/2024/08/20/企业自动化运维神器Ansible(1)/1.png"><meta property="og:type" content="article"><meta property="og:title" content="企业自动化运维神器Ansible(1)"><meta property="og:url" content="https://l66stbz.github.io/2024/08/20/%E4%BC%81%E4%B8%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%A5%9E%E5%99%A8Ansible(1)/"><meta property="og:site_name" content="L66"><meta property="og:description" content="企业级自动化运维工具Ansible[TOC] 一、介绍1、自动化运维发展历程 手动运维阶段  特点：  早期计算机时代：主要依赖运维人员手动管理服务器等。 集中管理和人工操作：系统更新、配置、监控、故障排查等任务全部手动完成。 局限性：效率低下、容易出现人为错误，且无法应对大规模环境。  典型场景：小型数据中心，几台服务器，运维人员使用SSH等手动登录服务器进行操作。  脚本化运维阶段  特点："><meta property="og:image" content="https://l66stbz.github.io/2024/08/20/企业自动化运维神器Ansible(1)/1.png"><meta property="article:published_time" content="2024-08-20T13:50:00.000Z"><meta property="article:modified_time" content="2024-08-24T06:07:26.872Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/08/20/%E4%BC%81%E4%B8%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%A5%9E%E5%99%A8Ansible(1)/"><link rel="prev" title="企业自动化运维神器Ansible(2)" href="https://l66stbz.github.io/2024/08/21/%E4%BC%81%E4%B8%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%A5%9E%E5%99%A8Ansible(2)/"><link rel="next" title="RabbitMQ消息队列" href="https://l66stbz.github.io/2024/08/16/RabbitMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">36</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#企业级自动化运维工具Ansible"><span class="toc-number">1.</span> <span class="toc-text">企业级自动化运维工具Ansible</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、介绍"><span class="toc-number">1.1.</span> <span class="toc-text">一、介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、自动化运维发展历程"><span class="toc-number">1.1.1.</span> <span class="toc-text">1、自动化运维发展历程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#手动运维阶段"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">手动运维阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#脚本化运维阶段"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">脚本化运维阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运维工具化阶段"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">运维工具化阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#容器化和微服务运维阶段"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">容器化和微服务运维阶段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、自动化运维工具对比"><span class="toc-number">1.1.2.</span> <span class="toc-text">2、自动化运维工具对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、Ansible简介"><span class="toc-number">1.1.3.</span> <span class="toc-text">3、Ansible简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、ansible安装"><span class="toc-number">1.2.</span> <span class="toc-text">二、ansible安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-环境准备"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">1.  环境准备</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、Ansible-文件介绍"><span class="toc-number">1.3.</span> <span class="toc-text">三、Ansible 文件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、主配置文件"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、主配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、主机清单"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、主机清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、测试"><span class="toc-number">1.3.3.</span> <span class="toc-text">3、测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、Ansible执行过程"><span class="toc-number">1.3.4.</span> <span class="toc-text">4、Ansible执行过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、Ansible执行颜色分类"><span class="toc-number">1.3.5.</span> <span class="toc-text">5、Ansible执行颜色分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、Ansible中shell模块几乎可以做任何事情，那为什么要有别的那么多模块且写剧本的时候明明可以从头到尾使用shell模块，但是为什么还是要使用别的模块呢？"><span class="toc-number">1.3.6.</span> <span class="toc-text">6、Ansible中shell模块几乎可以做任何事情，那为什么要有别的那么多模块且写剧本的时候明明可以从头到尾使用shell模块，但是为什么还是要使用别的模块呢？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、Ansible模块使用"><span class="toc-number">1.4.</span> <span class="toc-text">四、Ansible模块使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、command模块（默认）"><span class="toc-number">1.4.1.</span> <span class="toc-text">1、command模块（默认）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、shell模块"><span class="toc-number">1.4.2.</span> <span class="toc-text">2、shell模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、USER模块"><span class="toc-number">1.4.3.</span> <span class="toc-text">3、USER模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、yum模块"><span class="toc-number">1.4.4.</span> <span class="toc-text">4、yum模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、service模块"><span class="toc-number">1.4.5.</span> <span class="toc-text">5、service模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、file模块"><span class="toc-number">1.4.6.</span> <span class="toc-text">6、file模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7、copy模块"><span class="toc-number">1.4.7.</span> <span class="toc-text">7、copy模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8、Script模块"><span class="toc-number">1.4.8.</span> <span class="toc-text">8、Script模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9、archive模块"><span class="toc-number">1.4.9.</span> <span class="toc-text">9、archive模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10、unarchive模块"><span class="toc-number">1.4.10.</span> <span class="toc-text">10、unarchive模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11、Fetch模块"><span class="toc-number">1.4.11.</span> <span class="toc-text">11、Fetch模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12、Hostname模块"><span class="toc-number">1.4.12.</span> <span class="toc-text">12、Hostname模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13、Cron模块"><span class="toc-number">1.4.13.</span> <span class="toc-text">13、Cron模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14、Setup模块"><span class="toc-number">1.4.14.</span> <span class="toc-text">14、Setup模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、ansible-playbook-剧本"><span class="toc-number">1.5.</span> <span class="toc-text">五、ansible-playbook  剧本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、介绍"><span class="toc-number">1.5.1.</span> <span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、playbook格式"><span class="toc-number">1.5.2.</span> <span class="toc-text">2、playbook格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1、hosts"><span class="toc-number">1.5.3.</span> <span class="toc-text">1、hosts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、tasks"><span class="toc-number">1.5.4.</span> <span class="toc-text">2、tasks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、示例"><span class="toc-number">1.5.5.</span> <span class="toc-text">3、示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-安装nginx服务，并且发布服务"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">1. 安装nginx服务，并且发布服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-vars变量引用"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">2. vars变量引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-handlers和notify引用"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">3. handlers和notify引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-item和loop引用"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">4. item和loop引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-when判断"><span class="toc-number">1.5.5.5.</span> <span class="toc-text">5. when判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-vars-files-变量文件"><span class="toc-number">1.5.5.6.</span> <span class="toc-text">6. vars_files 变量文件</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/08/20/企业自动化运维神器Ansible(1)/1.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/photo/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">企业自动化运维神器Ansible(1)</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2024-08-20 21:50:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2024-08-20</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2024-08-24 14:07:26"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2024-08-24</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="企业级自动化运维工具Ansible"><a href="#企业级自动化运维工具Ansible" class="headerlink" title="企业级自动化运维工具Ansible"></a>企业级自动化运维工具Ansible</h1><p>[TOC]</p>
<h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><h3 id="1、自动化运维发展历程"><a href="#1、自动化运维发展历程" class="headerlink" title="1、自动化运维发展历程"></a>1、自动化运维发展历程</h3><ol>
<li><h4 id="手动运维阶段"><a href="#手动运维阶段" class="headerlink" title="手动运维阶段"></a><strong>手动运维阶段</strong></h4></li>
</ol>
<p><strong>特点：</strong></p>
<ul>
<li><strong>早期计算机时代</strong>：主要依赖运维人员手动管理服务器等。</li>
<li><strong>集中管理和人工操作</strong>：系统更新、配置、监控、故障排查等任务全部手动完成。</li>
<li><strong>局限性</strong>：效率低下、容易出现人为错误，且无法应对大规模环境。</li>
</ul>
<p><strong>典型场景：</strong>小型数据中心，几台服务器，运维人员使用SSH等手动登录服务器进行操作。</p>
<ol start="2">
<li><h4 id="脚本化运维阶段"><a href="#脚本化运维阶段" class="headerlink" title="脚本化运维阶段"></a><strong><code>脚本化运维阶段</code></strong></h4></li>
</ol>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>自动化初步萌芽</strong>：运维人员开始使用Shell、Python、Perl等脚本语言来实现部分重复性任务的自动化，如批量部署、日志收集、监控和报警等。</li>
<li><strong>自定义脚本和工具</strong>：企业根据需求编写自定义脚本来简化日常运维工作，减少手动操作。</li>
</ul>
<p><strong>典型场景：</strong>通过Shell脚本实现批量管理、定时任务调度等，减轻重复性工作负担。</p>
<ol start="3">
<li><h4 id="运维工具化阶段"><a href="#运维工具化阶段" class="headerlink" title="运维工具化阶段"></a><strong><code>运维工具化阶段</code></strong></h4></li>
</ol>
<p><strong>特点：</strong></p>
<ul>
<li><strong>引入专用运维工具</strong>：随着IT基础设施的复杂化，运维工具逐渐普及。常见工具如Puppet、Ansible、SaltStack等开始出现，提供了标准化的自动化运维能力。</li>
<li><strong>集中式管理</strong>：通过工具的集中式管理能力，运维人员可以统一管理多台服务器，实现大规模环境下的自动化部署、配置管理和系统更新。</li>
</ul>
<p><strong>典型应用：</strong>使用Puppet进行配置管理，Ansible进行批量操作，SaltStack进行大规模部署。</p>
<ol start="4">
<li><h4 id="容器化和微服务运维阶段"><a href="#容器化和微服务运维阶段" class="headerlink" title="容器化和微服务运维阶段"></a><strong><code>容器化和微服务运维阶段</code></strong></h4></li>
</ol>
<p><strong>特点：</strong></p>
<ul>
<li><strong>容器化</strong>：随着Docker和Kubernetes等技术的普及，运维自动化进入了容器化时代。基础设施以容器为单位进行管理，运维流程更加简化和标准化。</li>
<li><strong>微服务架构</strong>：应用被拆解为独立的微服务，运维需要应对大量的分布式服务，自动化工具集成了容器编排、服务发现、动态伸缩等功能。</li>
<li><strong>持续集成和持续交付（CI/CD）</strong>：Jenkins、GitLab CI等工具与Kubernetes和Docker相结合，实现了自动化的应用交付和部署。</li>
</ul>
<p><strong>典型应用：</strong>Kubernetes用于容器编排，结合CI/CD流水线实现自动化应用发布和扩展。</p>
<h3 id="2、自动化运维工具对比"><a href="#2、自动化运维工具对比" class="headerlink" title="2、自动化运维工具对比"></a>2、自动化运维工具对比</h3><ul>
<li><strong>Puppet：</strong>基于 Ruby 开发,采用 C/S 架构,扩展性强,基于SSL,远程命令执行相对较弱；</li>
<li><strong>SaltStack：</strong>基于 Python 开发,采用 C/S 架构,相对 puppet 更轻量级,配置语法使用YAML,使得配置脚本更简单.需要配置客户端以及服务器端。每台被控制节点需要安装agent；</li>
<li><strong>Ansible：</strong>基于Python开发,分布式,无需客户端,轻量级,配置语法使用YAML语言,更强的远程命令执行操作。</li>
</ul>
<h3 id="3、Ansible简介"><a href="#3、Ansible简介" class="headerlink" title="3、Ansible简介"></a>3、Ansible简介</h3><p>​    <strong>ansible是自动化运维工具，基于Python开发、分布式、无需客户端、轻量级。实现了批量系统配置、批量程序部署、批量运行命令等功能。</strong></p>
<p><strong>ansible是基于模块工作的,本身没有批量部署的能力。真正具有批量部署的是ansible所运行的模块,ansible只是提供一种框架。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Ansible特性</span><br><span class="line">    1)、no agents：不需要在被管控主机上安装任何客户端,更新时,只需在操作机上进行一次更新即可（不用安装客户端。分布式的）</span><br><span class="line">    2)、no server：无服务器端,使用时直接运行命令即可</span><br><span class="line">    3)、modules in any languages：基于模块工作,可使用任意语言开发模块</span><br><span class="line">    4)、yaml,not code：使用yaml语言定制剧本playbook</span><br><span class="line">    5)、ssh by default：基于SSH工作</span><br><span class="line">    6)、strong multi-tier solution：可实现多级指挥</span><br></pre></td></tr></table></figure>

<p><img src="https://youngfitfei.oss-cn-beijing.aliyuncs.com/img/1567243310363.png" alt="1567243310363"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">connection plugins：连接插件,负责和被监控端实现通信,默认使用SSH连接。</span><br><span class="line">host inventory：主机清单,是一个配置文件里面定义监控的主机。</span><br><span class="line">modules : 模块,核心模块、command模块、自定义模块等。</span><br><span class="line">plugins : modules功能的补充,包括连接插件,邮件插件等。</span><br><span class="line">playbook：编排,定义 Ansible 多任务配置文件,非必需。</span><br></pre></td></tr></table></figure>

<h2 id="二、ansible安装"><a href="#二、ansible安装" class="headerlink" title="二、ansible安装"></a>二、ansible安装</h2><h4 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.  环境准备"></a>1.  环境准备</h4><ol>
<li><strong>初始化工作</strong></li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 本地解析</span></span><br><span class="line">$ cat /etc/hosts</span><br><span class="line">192.168.174.20 ansible-server</span><br><span class="line">192.168.174.21 ansible-web01</span><br><span class="line">192.168.174.22 ansible-web02</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 关闭防火墙及selinux</span></span><br><span class="line">$ systemctl disable --now firewalld &amp;&amp; setenforce 0</span><br><span class="line">$ sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong><code>ansible-server</code>生成SSH密钥对</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 生成密钥</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ssh-keygen</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看密钥</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ll ~/.ssh/</span></span><br><span class="line">总用量 8</span><br><span class="line">-rw-------. 1 root root 1679 8月  18 13:33 id_rsa</span><br><span class="line">-rw-r--r--. 1 root root  408 8月  18 13:33 id_rsa.pub</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong><code>ansible-server</code>传递公钥</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 传递公钥</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># for i in ansible-web0&#123;1..2&#125;;do ssh-copy-id -i $i;done</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>安装</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 配置EPEL网络yum源</span></span><br><span class="line">[root@ansible-server ~]# curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 安装ansible</span></span><br><span class="line">[root@ansible-server ~]# yum install -y ansible</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看版本</span></span><br><span class="line">[root@ansiable-server ~]# ansible --version</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看帮助</span></span><br><span class="line">[root@ansible-server ~]# ansible --help</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181440961.png" alt="image-20240818144013877"></p>
<h2 id="三、Ansible-文件介绍"><a href="#三、Ansible-文件介绍" class="headerlink" title="三、Ansible 文件介绍"></a>三、Ansible 文件介绍</h2><h3 id="1、主配置文件"><a href="#1、主配置文件" class="headerlink" title="1、主配置文件"></a>1、主配置文件</h3><p><strong>文件位置：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/ansible/ansible.cfg</span><br></pre></td></tr></table></figure>

<p><strong>常用文件内容介绍：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#inventory      = /etc/ansible/hosts</span></span><br><span class="line"><span class="comment">#library        = /usr/share/my_modules/</span></span><br><span class="line"><span class="comment">#module_utils   = /usr/share/my_module_utils/</span></span><br><span class="line"><span class="comment">#remote_tmp     = ~/.ansible/tmp</span></span><br><span class="line"><span class="comment">#local_tmp      = ~/.ansible/tmp</span></span><br><span class="line"><span class="comment">#plugin_filters_cfg = /etc/ansible/plugin_filters.yml</span></span><br><span class="line"><span class="comment">#forks          = 5</span></span><br><span class="line"><span class="comment">#poll_interval  = 15</span></span><br><span class="line"><span class="comment">#sudo_user      = root</span></span><br><span class="line"><span class="comment">#ask_sudo_pass = True</span></span><br><span class="line"><span class="comment">#ask_pass      = True</span></span><br><span class="line"><span class="comment">#transport      = smart</span></span><br><span class="line"><span class="comment">#remote_port    = 22</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>#inventory = /etc/ansible/hosts</code></li>
</ol>
<ul>
<li><strong>解释</strong>： Ansible 的默认<code>主机清单</code>位置。主机清单列出了目标主机的 IP 地址或主机名。</li>
</ul>
<ol start="2">
<li><code>#library = /usr/share/my_modules/</code></li>
</ol>
<ul>
<li><strong>解释</strong>：指定 Ansible 自定义模块的库路径。默认情况下，Ansible 使用内置的模块，但通过设置 <code>library</code>，你可以将自己编写的自定义模块放在 <code>/usr/share/my_modules/</code> 目录中。</li>
</ul>
<ol start="4">
<li><code>#remote_tmp = ~/.ansible/tmp</code></li>
</ol>
<ul>
<li><strong>解释</strong>：指定 Ansible 在远程主机上存储临时文件的路径。默认情况下，Ansible 会在远程主机的 <code>~/.ansible/tmp</code> 目录中创建临时文件和目录。</li>
</ul>
<ol start="5">
<li><code>#local_tmp = ~/.ansible/tmp</code></li>
</ol>
<ul>
<li><strong>解释</strong>：指定 Ansible 在本地主机上存储临时文件的路径。Ansible 会在执行任务时在本地生成临时文件，默认路径是 <code>~/.ansible/tmp</code>。</li>
</ul>
<ol start="6">
<li><code>#plugin_filters_cfg = /etc/ansible/plugin_filters.yml</code></li>
</ol>
<ul>
<li><strong>解释</strong>：过滤 Ansible 插件的配置文件路径。这个配置文件控制哪些插件可以加载和使用。</li>
</ul>
<ol start="7">
<li><code>#forks = 5</code></li>
</ol>
<ul>
<li><strong>解释</strong>：Ansible 并行处理的最大任务数量。</li>
</ul>
<ol start="8">
<li><code>#poll_interval = 15</code></li>
</ol>
<ul>
<li><strong>解释</strong>：Ansible 检查后台任务状态的轮询间隔，单位是秒。默认情况下，Ansible 每隔 15 秒检查一次后台运行的任务状态。</li>
</ul>
<ol start="9">
<li><code>#sudo_user = root</code></li>
</ol>
<ul>
<li><strong>解释</strong>：远程主机上执行命令时的默认 sudo 用户。这里配置的是 <code>root</code> 用户，意味着 Ansible 在使用 sudo 提权时会尝试以 root 用户身份执行任务。</li>
</ul>
<ol start="10">
<li><code>#ask_sudo_pass = True</code></li>
</ol>
<ul>
<li><strong>解释</strong>：Ansible 将在运行任务时提示输入 sudo 密码。这在目标主机配置了需要输入 sudo 密码的情况下使用。</li>
</ul>
<ol start="11">
<li><code>#ask_pass = True</code></li>
</ol>
<ul>
<li><strong>解释</strong>：Ansible 将在运行任务时提示输入 SSH 密码。如果目标主机不使用密钥认证而是通过密码登录，可以启用此项。</li>
</ul>
<ol start="12">
<li><code>#transport = smart</code></li>
</ol>
<ul>
<li><strong>解释</strong>：Ansible 与目标主机通信时使用的传输方式。默认的 <code>smart</code> 模式会自动选择最佳的传输方式（通常是基于 SSH）。</li>
</ul>
<ol start="13">
<li><code>#remote_port = 22</code></li>
</ol>
<ul>
<li><strong>解释</strong>：Ansible 连接到远程主机时使用的默认 SSH 端口。默认值为 <code>22</code>。</li>
</ul>
<h3 id="2、主机清单"><a href="#2、主机清单" class="headerlink" title="2、主机清单"></a>2、主机清单</h3><p><strong>文件位置：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/ansible/hosts</span><br></pre></td></tr></table></figure>

<p>官方文档:  <a href="http://docs.ansible.com/ansible/intro_inventory.html#" target="_blank" rel="noopener">http://docs.ansible.com/ansible/intro_inventory.html#</a></p>
<p><strong><code>Inventory文件</code>通常用于定义要管理主机的认证信息，例如ssh登录用户名、密码以及key相关信息。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看配置文件</span></span><br><span class="line">[root@ansible-server ~]# rpm  -qc ansible</span><br><span class="line">/etc/ansible/ansible.cfg</span><br><span class="line">/etc/ansible/hosts		#ansible主机清单文件</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt;语法:</span></span><br><span class="line">[root@ansible-server ~]# vim /etc/ansible/hosts</span><br><span class="line">ansible-web1  # 单独指定主机，可以使用主机名称或IP地址</span><br><span class="line"></span><br><span class="line">[webservers]  # 主机群组自定义</span><br><span class="line">192.168.174.21 # 未做本地解析的主机地址</span><br><span class="line">192.168.174.22 # 未做本地解析的主机地址</span><br><span class="line"></span><br><span class="line">[dbservers] # 自定义主机群组</span><br><span class="line">192.168.174.[21:22]</span><br><span class="line"></span><br><span class="line">[zabbix] # 自定义主机群组</span><br><span class="line">192.168.174.21:22 # 未做本地解析的主机地址加端口</span><br><span class="line"></span><br><span class="line">[redis] # 自定义主机名</span><br><span class="line">ansible-web02 # 经过本地解析的主机名</span><br><span class="line"></span><br><span class="line">[servers:children] # 集合多个子群组</span><br><span class="line">zabbix</span><br><span class="line">redis</span><br><span class="line"></span><br><span class="line">[webservers01] # 自定义主机群组</span><br><span class="line">ansible-web0[1:2] # 经过本地解析的主机名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为一个组指定变量，组内每个主机都可以使用该变量：</span></span><br><span class="line">[weball:vars]         # 设置变量,vars--照写</span><br><span class="line">ansible_ssh_port=2222     </span><br><span class="line">ansible_ssh_user=root   </span><br><span class="line">ansible_ssh_private_key_file=/root/.ssh/id_rsa  </span><br><span class="line"><span class="meta">#</span><span class="bash">ansible_ssh_pass=<span class="built_in">test</span>      <span class="comment">#也可以定义密码，如果没有互传秘钥可以使用密码。</span></span></span><br></pre></td></tr></table></figure>

<p> Ansible Inventory 常见的内置参数：</p>
<p><img src="https://youngfitfei.oss-cn-beijing.aliyuncs.com/img/1567262857205.png" alt="1567262857205"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看组内主机列表：</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 语法：ansible  组名  --list-hosts</span></span><br><span class="line">[root@ansible-server ~]# ansible webservers --list-host</span><br><span class="line">  hosts (2):</span><br><span class="line">    192.168.174.21</span><br><span class="line">    192.168.174.22</span><br></pre></td></tr></table></figure>

<h3 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h3><p><code>Ansible</code>常用命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 列出所有模块</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible-doc -l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看某个模块帮助用法</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible-doc ping</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看某个模块帮助用法</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible-doc  -s ping</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="meta">#</span><span class="bash"> ansible  &lt;pattern&gt;   -m &lt;module_name&gt;   -a &lt;arguments&gt;</span></span><br><span class="line">pattern--主机清单里定义的主机组名、主机名、IP等,all表示所有的主机,支持通配符,正则</span><br><span class="line">-m	# 模块名称,默认为command</span><br><span class="line">-a	# 传递给模块的参数</span><br><span class="line">-o	# 单行显示</span><br><span class="line">-c	# 检查，不执行命令</span><br><span class="line">-k	# 提示输入ssh连接密码。默认ssh key认证</span><br><span class="line">-v	# 详细过程 -vv -vvv更详细</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 示例</span></span><br><span class="line">[root@ansible-server ~]# ansible webservers -m ping</span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181526198.png" alt="image-20240818152656146"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]<span class="comment"># ansible all -m ping -o</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181605472.png" alt="image-20240818160505421"></p>
<p>使用案例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 指定单台机器：</span></span><br><span class="line">[root@ansible-server ~]# ansible ansible-web1 -m ping -o</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 同时指定多台机器：</span></span><br><span class="line">[root@ansible-server ~]# ansible ansible-web1,ansible-web2 -m ping -o</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 指定组名:</span></span><br><span class="line">[root@ansible-server ~]# ansible  webservers1 -m ping -o</span><br></pre></td></tr></table></figure>

<h3 id="4、Ansible执行过程"><a href="#4、Ansible执行过程" class="headerlink" title="4、Ansible执行过程"></a>4、Ansible执行过程</h3><ol>
<li><p>Ansible 在执行命令之前会加载配置文件（通常位于 <code>/etc/ansible/ansible.cfg</code>）并读取主机清单文件。</p>
</li>
<li><p>Ansible 根据配置文件或命令行参数决定如何连接远程主机。</p>
</li>
<li><p>Ansible 使用<strong>模块</strong>（module）在远程主机上执行具体任务。Ansible 会将模块发送到远程主机，并通过 Python 解释器或其他指定解释器执行这些模块。但需要注意的是：ansible会将模块或者命令生成对应的临时文件，并将文件通过ssh传输至远程主机的对应执行用户的<code>$HOME/.ansible/tmp/ansible-tmp-随机数字/随机字符串.py</code>文件。并添加执行权限。</p>
</li>
<li><p>模块执行完成后，Ansible 会收集结果并将其返回到控制节点。每个模块返回的数据为 JSON 格式，Ansible 会将这些数据解析为易读的输出，显示在控制台中。删除临时py文件。并退出。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 测试</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible all -m ping  -vvv   &gt; test.log</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># grep rm  test.log</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181647679.png" alt="image-20240818164734639"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]<span class="comment"># grep rm  test.log</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181648295.png" alt="image-20240818164827261"></p>
<h3 id="5、Ansible执行颜色分类"><a href="#5、Ansible执行颜色分类" class="headerlink" title="5、Ansible执行颜色分类"></a>5、Ansible执行颜色分类</h3><ul>
<li><p><strong><code>绿色</code></strong>：执行成功并且没有改变内容；</p>
</li>
<li><p><strong><code>黄色</code></strong>：执行成功并且对目标主机做的更改操作；</p>
</li>
<li><p><strong><code>红色</code></strong>：命令或模块没有执行成功。</p>
</li>
</ul>
<h3 id="6、Ansible中shell模块几乎可以做任何事情，那为什么要有别的那么多模块且写剧本的时候明明可以从头到尾使用shell模块，但是为什么还是要使用别的模块呢？"><a href="#6、Ansible中shell模块几乎可以做任何事情，那为什么要有别的那么多模块且写剧本的时候明明可以从头到尾使用shell模块，但是为什么还是要使用别的模块呢？" class="headerlink" title="6、Ansible中shell模块几乎可以做任何事情，那为什么要有别的那么多模块且写剧本的时候明明可以从头到尾使用shell模块，但是为什么还是要使用别的模块呢？"></a>6、Ansible中shell模块几乎可以做任何事情，那为什么要有别的那么多模块且写剧本的时候明明可以从头到尾使用shell模块，但是为什么还是要使用别的模块呢？</h3><p>因为幂等性。在 Ansible 中，幂等性指的是运行相同的剧本或任务多次时，其结果应该是相同的，不会产生副作用或重复更改。也就是说，不论你执行剧本多少次，系统的最终状态都应保持一致，不会改变。</p>
<p>而如果我们从头到尾shell的话，是无法保证幂等性的，有的时候可能一些操作之前已经之前过了，如果使用shell的话他还会再给我们执行一次，回显颜色会为黄色。但是如果我们使用的是其对应功能的模块的话，那么他会检查我们之前是否做过这步操作，如果做过他就不会再执行。回显为绿色。</p>
<p>所以这会对运维人员有些许干扰，因为大部分情况我们会根据回显颜色来判断执行的结果。情况严重的话，有可能会产生一些副作用。</p>
<p>ansible中分模块来干不同的事情有点类似于微服务架构，采用分布式，降低了紧密型（解耦），增加了可维护性。</p>
<h2 id="四、Ansible模块使用"><a href="#四、Ansible模块使用" class="headerlink" title="四、Ansible模块使用"></a>四、Ansible模块使用</h2><h3 id="1、command模块（默认）"><a href="#1、command模块（默认）" class="headerlink" title="1、command模块（默认）"></a>1、<code>command</code>模块（默认）</h3><p>​    <code>ansible</code> 的 <code>command</code> 模块是最常用的模块之一，它用于在远程主机上运行命令。与 <code>shell</code> 模块不同的是，<code>command</code> 模块执行命令时不会通过 shell 执行，因此不支持管道、重定向等 shell 特性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m command -a "uptime"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181659986.png" alt="image-20240818165933947"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers  -a "df -Th"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181659305.png" alt="image-20240818165959247"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers  -a "ls "</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181701718.png" alt="image-20240818170134686"></p>
<h3 id="2、shell模块"><a href="#2、shell模块" class="headerlink" title="2、shell模块"></a>2、<code>shell</code>模块</h3><p>​        Ansible 的 <code>shell</code> 模块用于在远程主机上通过 shell 执行命令。与 <code>command</code> 模块不同的是，<code>shell</code> 模块允许你使用所有的 shell 特性，例如管道、重定向、变量扩展等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers  -m shell  -a "df -Th | grep root"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181705083.png" alt="image-20240818170522034"></p>
<h3 id="3、USER模块"><a href="#3、USER模块" class="headerlink" title="3、USER模块"></a>3、<code>USER</code>模块</h3><p>​         <code>user</code> 模块用于在远程主机上管理用户账户。它能够创建、删除、修改用户以及设置用户的权限、组和密码等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建用户</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m user -a "name=maoxiansheng state=present" -o</span></span><br><span class="line"></span><br><span class="line">name	<span class="comment"># 用户名</span></span><br><span class="line">state	<span class="comment"># 创建</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181713168.png" alt="image-20240818171306121"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 删除用户</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m user -a "name=maoxiansheng state=absent remove=yes"  -o</span></span><br><span class="line"></span><br><span class="line">name	<span class="comment"># 用户名</span></span><br><span class="line">state	<span class="comment"># 删除操作</span></span><br><span class="line">remove	<span class="comment"># 慎用！删除用户时，除了删除用户本身，还会删除该用户的相关资源（如用户的家目录及相关文件）。默认情况下，这个选项是 no，即只删除用户而不删除其文件。</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181714153.png" alt="image-20240818171430115"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建用户并设置Shell和主目录</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  webservers -m user -a "user=mingge home=/home/mingge state=present shell=/bin/bash" -o</span></span><br><span class="line"></span><br><span class="line">name	<span class="comment"># 用户名</span></span><br><span class="line">state	<span class="comment"># 创建</span></span><br><span class="line">shell	<span class="comment"># 指定所创建用户shell</span></span><br><span class="line">home	<span class="comment"># 指定所创建用户家目录</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181717407.png" alt="image-20240818171717360"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 添加用户到指定组</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m user -a "name=feige groups=mingge append=yes password='123'"  -o</span></span><br><span class="line"></span><br><span class="line">name	<span class="comment"># 用户名</span></span><br><span class="line">groups	<span class="comment"># 加入指定组</span></span><br><span class="line">append	<span class="comment"># 不会删除他已经属于的其他组。即追加到该组，而不是替换原来的组。</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408181723058.png" alt="image-20240818172331003"></p>
<h3 id="4、yum模块"><a href="#4、yum模块" class="headerlink" title="4、yum模块"></a>4、<code>yum</code>模块</h3><p>​     <code>yum</code> 模块用于主要通过 <code>yum</code> 包管理器进行安装、升级、删除和管理仓库。它是处理软件包的一个常见模块，适用于基于 <code>yum</code> 包管理器的 Linux 发行版。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 安装服务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m yum -a "name=nginx state=present"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 删除服务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m yum -a "name=nginx state=removed"</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m yum -a "name=nginx state=absent" </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 升级软件包到最新版本</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m yum -a "name=nginx state=latest" </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 安装指定版本</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m yum -a "name=nginx-1.24.0  state=present" </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 安装多个软件包</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m yum -a "name=git,vim state=present"</span></span><br></pre></td></tr></table></figure>

<h3 id="5、service模块"><a href="#5、service模块" class="headerlink" title="5、service模块"></a>5、<code>service</code>模块</h3><p>​        <code>service</code> 模块用于管理系统服务，例如启动、停止、重启服务或确保服务处于特定状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 启动服务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m service -a "name=nginx  state=started"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 停止服务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m service -a "name=nginx  state=stopped"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 重启服务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m service -a "name=nginx  state=restarted"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 启动服务并加入开机自启</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m service -a "name=nginx  state=started enabled=yes"</span></span><br></pre></td></tr></table></figure>

<h3 id="6、file模块"><a href="#6、file模块" class="headerlink" title="6、file模块"></a>6、<code>file</code>模块</h3><p>​        <code>file</code> 模块用于管理文件、目录和符号链接的属性，包括创建、删除、修改权限等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建目录</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "path=/tmp/mingge state=directory" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建文件</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "path=/tmp/mingge/1.txt state=touch" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 删除目录或者文件</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "path=/tmp/mingge/1.txt state=absent" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改文件权限</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "path=/tmp/mingge mode=0777" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 修改文件属主和属组</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "path=/tmp/mingge/ owner=mingge group=mingge" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建文件并设置权限</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "path=/tmp/2.txt state=touch mode=0777 owner=mingge group=mingge" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 创建符号链接</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m file -a "src=/tmp/2.txt dest=/root/2.txt state=link" -o</span></span><br></pre></td></tr></table></figure>

<h3 id="7、copy模块"><a href="#7、copy模块" class="headerlink" title="7、copy模块"></a>7、<code>copy</code>模块</h3><p>​         <code>copy</code> 模块用于从控制节点将文件或目录复制到目标主机。</p>
<p><strong>常见选项：</strong></p>
<ul>
<li><strong><code>src</code></strong>：源文件或目录的路径。</li>
<li><strong><code>dest</code></strong>：目标路径。</li>
<li><strong><code>backup</code></strong>：是否在目标上备份现有文件（值为 <code>yes</code> 时备份）。</li>
<li><strong><code>force</code></strong>：是否强制覆盖目标文件（默认为 <code>yes</code>）。</li>
<li><strong><code>mode</code></strong>：设置目标文件或目录的权限（如 <code>0644</code>）。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 复制单个文件到远程主机</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "src=/etc/hosts dest=/etc/ force=yes" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 复制目录到远程主机</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "src=/root/ops dest=/root/  force=yes" -o</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<strong>如果需要拷贝的目录为空，则无法拷贝至目标主机。</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 复制文件并修改权限</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "src=/root/test dest=/root/test01 mode=0777" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 复制文件并备份现有文件</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "src=/root/test dest=/root/test01 backup=yes" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 不覆盖已有文件</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "src=/root/test dest=/root/test01 force=no" -o</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：不覆盖文件代表含义就是。但是需要拷贝的文件在目标主机的路径下存在。则不执行copy</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 利用字符串生成新文件</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "content='name mingge\nage 18\n' dest=/tmp/test.txt" -o </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看文件内容</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m shell -a "cat /tmp/test.txt" -o</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182129331.png" alt="image-20240818212923301"></p>
<h3 id="8、Script模块"><a href="#8、Script模块" class="headerlink" title="8、Script模块"></a>8、<code>Script</code>模块</h3><p>​         <code>script</code> 模块用于在<strong>目标主机</strong>上执行<strong>本地脚本</strong>。但需要注意的是<code>script</code> 模块只是在远程主机上执行<strong>ansible</strong>本地脚本，因此需要确保脚本是可以在远程主机的环境中正确执行的。执行脚本的路径必须是相对于控制节点的路径，而不是远程主机的路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 编写测试脚本</span></span><br><span class="line">cat &gt;&gt; echo.sh &lt;&lt;-EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hello.world"</span></span><br><span class="line">sleep 10</span><br><span class="line">touch test01.txt</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 执行脚本</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m script  -a "./echo.sh" -o</span></span><br></pre></td></tr></table></figure>



<h3 id="9、archive模块"><a href="#9、archive模块" class="headerlink" title="9、archive模块"></a>9、<code>archive</code>模块</h3><p>​         <code>archive</code> 模块用于在目标主机上创建压缩文件（归档文件）到目标主机的指定目录。它可以将文件或目录打包成 tar、zip 或其他格式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 压缩目录</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m archive -a "path=/root dest=./root.zip format=zip" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 压缩多个目录或文件</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m archive -a "path=/root,/opt,/tmp/test10.txt dest=/tar/lastest.tar.gz" -o</span></span><br></pre></td></tr></table></figure>

<h3 id="10、unarchive模块"><a href="#10、unarchive模块" class="headerlink" title="10、unarchive模块"></a>10、<code>unarchive</code>模块</h3><p>​        <code>unarchive</code> 模块用于在目标主机上解压存档文件（如 <code>.tar</code>, <code>.zip</code> 等）。也可以将控制主机的压缩包拷贝至目标主机解压或远程的压缩文件，并将其解压到指定的目录中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 将当前主机的压缩包拷贝目标主机并解压,并且修改相关权限</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m unarchive -a 'src=./nginx-1.24.0.tar.gz dest=/usr/local/ owner=root group=root mode=0755' -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  webservers  -m shell -a "ls -l  /usr/local/ | grep nginx"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182159547.png" alt="image-20240818215951506"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 将目标主机压缩包解压到指定目录</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m copy -a "src=./nginx-1.24.0.tar.gz dest=/root" -o</span></span><br><span class="line"></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m unarchive -a 'src=/root/nginx-1.24.0.tar.gz dest=/usr/local/ owner=root group=root mode=0755 copy=no' -o</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182205827.png" alt="image-20240818220503783"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 从远程连接下载安装包，并解压到指定目录</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m unarchive -a "src=https://nginx.org/download/nginx-1.27.1.tar.gz dest=/opt owner=root group=root mode=0755 copy=no" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  webservers  -m shell -a "ls -l  /opt | grep nginx"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182211648.png" alt="image-20240818221117597"></p>
<h3 id="11、Fetch模块"><a href="#11、Fetch模块" class="headerlink" title="11、Fetch模块"></a>11、<code>Fetch</code>模块</h3><p>​        <code>fetch</code> 模块用于从远程主机复制<strong>文件</strong>到本地主机。该模块的主要用途是从目标机器获取文件（如日志、配置文件等）并存储在控制节点的指定位置。目前还没有远程拷贝目录到控制主机的功能。未来可能会实现！记住是可能哟。嘿嘿！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 将目标主机文件拷贝到当前主机目录下</span></span><br><span class="line">[root@ansible-server ~]# ansible webservers -m fetch -a "src=/etc/redhat-release dest=/tmp" -o</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 查看本地目录</span></span><br><span class="line">[root@ansible-server ~]# tree /tmp/</span><br><span class="line">/tmp/</span><br><span class="line">├── 192.168.174.21</span><br><span class="line">│   └── etc</span><br><span class="line">│       └── redhat-release</span><br><span class="line">├── 192.168.174.22</span><br><span class="line">│   └── etc</span><br><span class="line">│       └── redhat-release</span><br></pre></td></tr></table></figure>



<h3 id="12、Hostname模块"><a href="#12、Hostname模块" class="headerlink" title="12、Hostname模块"></a>12、<code>Hostname</code>模块</h3><p>​         <code>hostname</code> 模块用于在远程主机上设置或获取主机名。无法通过命令行设置多个主机名。否则会出现冲突。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 修改单个主机的主机名</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible 192.168.174.21 -m hostname  -a "name=web01" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  192.168.174.21  -m shell -a "hostname"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182217372.png" alt="image-20240818221715339"></p>
<h3 id="13、Cron模块"><a href="#13、Cron模块" class="headerlink" title="13、Cron模块"></a>13、<code>Cron</code>模块</h3><p>​        <code>cron</code> 模块用于管理远程主机上的计划任务（cron jobs），可以添加、删除或修改已有的任务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 创建计划任务：周一至周五每天凌晨2点20备份数据库</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible 192.168.174.22 -m cron -a 'hour=2 minute=20 weekday=1-5 name="backup data mysql" job=/root/mysql_backup.sh'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  192.168.174.22  -m shell -a "crontab -l"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182226482.png" alt="image-20240818222648449"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 禁用计划任务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible 192.168.174.22 -m cron -a 'hour=2 minute=20 weekday=1-5 name="backup data mysql" job=/root/mysql_backup.sh disabled=yes'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disabled=yes 禁用计划任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  192.168.174.22  -m shell -a "crontab -l"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182230517.png" alt="image-20240818223011478"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 启动计划任务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible 192.168.174.22 -m cron -a 'hour=2 minute=20 weekday=1-5 name="backup data mysql" job=/root/mysql_backup.sh disabled=no'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  192.168.174.22  -m shell -a "crontab -l"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182231113.png" alt="image-20240818223116065"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 删除计划任务</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible 192.168.174.22 -m cron -a "name='backup data mysql' state=absent" -o</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># state=absent 删除计划任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 查看</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible  192.168.174.22  -m shell -a "crontab -l"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182232755.png" alt="image-20240818223258724"></p>
<h3 id="14、Setup模块"><a href="#14、Setup模块" class="headerlink" title="14、Setup模块"></a>14、<code>Setup</code>模块</h3><p>​        <code>setup</code> 模块用于从远程主机收集“事实”，即主机的硬件、网络和操作系统相关的信息。<code>setup</code> 模块会收集诸如 IP 地址、操作系统类型、磁盘空间、内存、环境变量等信息，默认情况下，Ansible 在执行任务时会自动收集这些信息，但也可以通过显式调用 <code>setup</code> 模块来手动收集。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看主机内核版本</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m setup  -a "filter=ansible_kernel"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182243264.png" alt="image-20240818224336209"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看主机ipv4相关信息</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m setup  -a "filter=ansible_default_ipv4"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182245946.png" alt="image-20240818224520882"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 查看内存的总大小</span></span><br><span class="line">[root@ansible-server ~]<span class="comment"># ansible webservers -m setup -a 'filter=ansible_memtotal_mb'</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408182247379.png" alt="image-20240818224701311"></p>
<h2 id="五、ansible-playbook-剧本"><a href="#五、ansible-playbook-剧本" class="headerlink" title="五、ansible-playbook  剧本"></a>五、ansible-playbook  剧本</h2><h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>​    <strong>playbook是ansible用于配置，部署，和管理被控节点的剧本</strong>。通过playbook的详细描述，执行其中的tasks，可以让远端主机达到预期的状态。playbook是由一个或多个”play”组成的列表。  当对一台机器做环境初始化的时候往往需要不止做一件事情，这时使用playbook会更加适合。通过playbook你可以一次在多台机器执行多个指令。通过这种预先设计的配置保持了机器的配置统一，并很简单的执行日常任务。</p>
<p>​    ansible通过不同的模块实现相应的管理，管理的方式通过定义的清单文件(hosts)所管理的主机包括认证的方式连接的端口等。所有的功能都是通过调用不同的模块(modules)来完成不同的功能的。不管是执行单条命令还是play-book都是基于清单文件。</p>
<h3 id="2、playbook格式"><a href="#2、playbook格式" class="headerlink" title="2、playbook格式"></a>2、<strong>playbook格式</strong></h3><p>playbook由yaml语言编写。YMAL格式是类似于JSON的文件格式，便于人理解和阅读，同时便于书写。 <code>驼峰式</code></p>
<p><strong>一个剧本里面可以有多个play，每个play只能有一个tasks，每个tasks可以有多个name</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Variables     	# 变量元素,可传递给Tasks/Templates使用;  </span><br><span class="line">Tasks           # 任务元素,由模块定义的操作的列表，即调用模块完成任务;  </span><br><span class="line">Templates  		# 模板元素,使用了模板语法的文本文件;  </span><br><span class="line">Handlers    	# 处理器元素,通常指在某事件满足时触发的操作;  </span><br><span class="line">Roles           # 角色元素</span><br></pre></td></tr></table></figure>

<p><strong>playbook的基础组件：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tasks:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">拷贝nginx安装包</span></span><br><span class="line">  <span class="attr">copy:</span> <span class="string">src=/opt/nginx-1.24.0.tar.gz</span> <span class="string">dest=/tmp</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">解压安装包</span></span><br><span class="line">  <span class="attr">unarchive:</span> <span class="string">src=/tmp/nginx-1.24.0.tar.gz</span> <span class="string">dest=/usr/local</span> <span class="string">copy=no</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建启动用户</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">name=nginx</span> <span class="string">shell=/sbin/nologin</span></span><br></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">name: </span><br><span class="line">    定义playbook或者task的名称(描述信息)，每一个play都可以完成一个任务。</span><br><span class="line">    </span><br><span class="line">hosts: </span><br><span class="line">    hosts用于指定要执行指定任务的主机。</span><br><span class="line">    </span><br><span class="line">user:</span><br><span class="line">    remote_user则用于指定远程主机上的执行任务的用户</span><br><span class="line">    </span><br><span class="line">tasks:</span><br><span class="line">    任务列表play的主体部分是task list. task list中的各任务按次序逐个在hosts中指定的所有主机上执行，即在所有主机上完成第一个任务后再开始第二个。</span><br><span class="line">    </span><br><span class="line">vars:</span><br><span class="line">   定义变量（如果不使用内部变量需要提前定义）</span><br><span class="line">   </span><br><span class="line">vars_files:</span><br><span class="line">  调用定义变量文件</span><br><span class="line">  </span><br><span class="line">notify:</span><br><span class="line">    任务执行结果如果是发生更改了的则触发定义在handler的任务执行</span><br><span class="line">    </span><br><span class="line">handlers:</span><br><span class="line">    用于当前关注的资源发生变化时采取一定指定的操作</span><br></pre></td></tr></table></figure>

<h3 id="1、hosts"><a href="#1、hosts" class="headerlink" title="1、hosts"></a>1、hosts</h3><p>​    <code>hosts</code> 组件定义了任务要运行在哪些主机或主机组上。<code>hosts</code> 是 Playbook 的核心部分之一，因为它决定了将这些任务分发到哪些远程主机执行。</p>
<ol>
<li><strong>语法格式</strong></li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">&lt;目标主机或主机组&gt;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">示例任务</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">echo</span> <span class="string">"Hello World"</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>常见用法</strong></li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 指定单个主机</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">server01</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 指定主机组</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 指定IP地址</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.174</span><span class="number">.22</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 指定所有主机</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 排除特定主机：将在所有主机上运行，除了dbservers组中的主机。</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all:!dbservers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 模式匹配：只选择既属于 webservers 组又属于dbservers组的主机。</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers:&amp;dbservers</span></span><br></pre></td></tr></table></figure>

<h3 id="2、tasks"><a href="#2、tasks" class="headerlink" title="2、tasks"></a>2、tasks</h3><p>​        <code>tasks</code> 组件用于定义一系列将被执行的操作。每个 <code>tasks</code> 列表中的任务都描述了一项操作（如安装软件、修改文件、管理服务等），并且它们是按顺序执行的。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test</span> <span class="string">ploybook</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span> <span class="string">name=nginx</span> <span class="string">state=present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">启动并启用</span> <span class="string">nginx</span> <span class="string">服务</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br></pre></td></tr></table></figure>

<h3 id="3、示例"><a href="#3、示例" class="headerlink" title="3、示例"></a>3、示例</h3><h4 id="1-安装nginx服务，并且发布服务"><a href="#1-安装nginx服务，并且发布服务" class="headerlink" title="1. 安装nginx服务，并且发布服务"></a>1. <strong>安装nginx服务，并且发布服务</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; 切换目录</span></span><br><span class="line"><span class="string">[root@ansible-server</span> <span class="string">~]#</span> <span class="string">cd</span> <span class="string">/opt/playbook/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 编写playbook文件</span></span><br><span class="line"><span class="string">[root@ansible-server</span> <span class="string">playbook]#</span> <span class="string">vim</span> <span class="string">nginx-install.yaml</span> </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装nginx</span></span><br><span class="line">    <span class="attr">yum:</span> <span class="string">name=nginx-1.24.0</span> <span class="string">state=present</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">拷贝发布文件</span></span><br><span class="line">    <span class="attr">copy:</span> <span class="string">src=/tmp/index.html</span>  <span class="string">dest=/usr/share/nginx/html/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">启动nginx</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; 测试是否能够正常执行</span></span><br><span class="line"><span class="string">[root@ansible-server</span> <span class="string">playbook]#</span> <span class="string">ansible-playbook</span> <span class="string">-C</span> <span class="string">nginx-install.yaml</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202408192030619.png" alt="image-20240819203043504"></p>
<p><strong>具体字段的含义如下：</strong></p>
<ul>
<li><strong><code>192.168.174.21</code></strong>: 目标主机的 IP 地址。</li>
<li><strong><code>ok=4</code></strong>: 有 4 个任务成功执行，没有发生错误。</li>
<li><strong><code>changed=0</code></strong>: 表示没有任何任务更改了目标主机的状态（例如安装软件、修改文件等）。</li>
<li><strong><code>unreachable=0</code></strong>: 表示目标主机是可达的（网络正常），没有主机是不可达的。</li>
<li><strong><code>failed=0</code></strong>: 表示没有任务失败，所有任务都成功完成。</li>
<li><strong><code>skipped=0</code></strong>: 表示没有任务被跳过。</li>
<li><strong><code>rescued=0</code></strong>: 表示没有任务进入救援模式（通常在任务失败时触发）。</li>
<li><strong><code>ignored=0</code></strong>: 表示没有被忽略的任务（例如使用 <code>ignore_errors: yes</code> 忽略的任务）。</li>
</ul>
<h4 id="2-vars变量引用"><a href="#2-vars变量引用" class="headerlink" title="2. vars变量引用"></a>2. vars变量引用</h4><p>​        <code>vars</code> 用于定义在任务中可以被引用的变量。可以通过两种方式引用变量：使用 <code></code> 或直接通过关键字引用。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">nginx_version:</span> <span class="string">"1.24.0"</span></span><br><span class="line">    <span class="attr">copy_dir:</span> <span class="string">"/tmp"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">拷贝安装包到目标主机并解压</span></span><br><span class="line">      <span class="attr">unarchive:</span> <span class="string">src=/root/nginx-&#123;&#123;</span> <span class="string">nginx_version</span> <span class="string">&#125;&#125;.tar.gz</span> <span class="string">dest=&#123;&#123;</span> <span class="string">copy_dir</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">实例二：</span><br><span class="line">[root@ansible-server ~]# cd /etc/ansible/</span><br><span class="line">[root@ansible-server ansible]# vim test.yml  #创建文件必须以.yml/.yaml结尾</span><br><span class="line">---</span><br><span class="line"> - hosts: webservers1</span><br><span class="line">   user: root</span><br><span class="line">   tasks:</span><br><span class="line">   - name: playbook_test</span><br><span class="line">     file: state=touch path=/tmp/playbook.txt</span><br><span class="line">========================================================================</span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数解释：</span></span><br><span class="line">    hosts: 参数指定了对哪些主机进行操作；</span><br><span class="line">    user: 参数指定了使用什么用户登录远程主机操作；</span><br><span class="line">    tasks: 指定了一个任务.</span><br><span class="line">    name:参数同样是对任务的描述，在执行过程中会打印出来。</span><br></pre></td></tr></table></figure>

<p><img src="https://youngfitfei.oss-cn-beijing.aliyuncs.com/img/1567316641470.png" alt="1567316641470"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 检测语法：</span></span><br><span class="line">[root@ansible-server ansible]# ansible-playbook -C test.yml </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">&gt;&gt;&gt; 运行Playbook</span></span><br><span class="line">[root@ansible-server ansible]# ansible-playbook test.yml #加剧本名称</span><br></pre></td></tr></table></figure>

<h4 id="3-handlers和notify引用"><a href="#3-handlers和notify引用" class="headerlink" title="3. handlers和notify引用"></a>3. handlers和notify引用</h4><p>​        <code>handlers</code>（处理器）和 <code>notify</code>（触发器）用于在某些任务状态发生变化时自动执行特定操作。<code>handlers</code> 只有在被 <code>notify</code> 触发时才会执行，而 <code>notify</code> 会在任务状态为 <code>changed</code> 时触发处理器。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">Nginx</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/tmp/default.conf</span> <span class="string">dest=/etc/nginx/conf.d/default.conf</span> <span class="string">backup=yes</span></span><br><span class="line">      <span class="attr">notify:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">Restart</span> <span class="string">Nginx</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">Nginx</span> <span class="string">service</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restart</span> <span class="string">Nginx</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=restarted</span></span><br></pre></td></tr></table></figure>



<h4 id="4-item和loop引用"><a href="#4-item和loop引用" class="headerlink" title="4. item和loop引用"></a>4. item和loop引用</h4><p>​        <code>item</code> 通常用于在循环（<code>loop</code>）中遍历列表或字典。它允许任务在多次迭代中使用不同的值。最常见的用法是通过 <code>loop</code> 模块来执行相同的操作多次，但使用不同的参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- hosts: webservers2</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: install packages</span><br><span class="line">    yum: name=&#123;&#123; item &#125;&#125; state=latest         #相当于for循环里面的i </span><br><span class="line">    loop:                               #取值 。但是不支持通配符</span><br><span class="line">     - httpd</span><br><span class="line">     - php</span><br><span class="line">     - php-mysql</span><br><span class="line">     - php-mbstring</span><br><span class="line">     - php-gd</span><br><span class="line">     </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 或者</span></span><br><span class="line">- hosts: webservers2</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: install packages</span><br><span class="line">    yum: name=&#123;&#123; item &#125;&#125; state=latest         #相当于for循环里面的i </span><br><span class="line">    with_items:                               #取值 。但是不支持通配符</span><br><span class="line">     - httpd</span><br><span class="line">     - php</span><br><span class="line">     - php-mysql</span><br><span class="line">     - php-mbstring</span><br><span class="line">     - php-gd</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>with_items</code> 与 <code>loop</code> 类似，但 <code>loop</code> 是 Ansible 2.5 及更高版本的推荐使用方法。</p>
</blockquote>
<h4 id="5-when判断"><a href="#5-when判断" class="headerlink" title="5. when判断"></a>5. when判断</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">lrzsz</span> <span class="string">yum</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">vim-enhanced</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">installed</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_os_family</span> <span class="string">=="RedHat"</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">lrzsz</span> <span class="string">apt</span></span><br><span class="line">      <span class="attr">apt:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">vim</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">installed</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_os_family</span> <span class="string">=="Debian"</span></span><br></pre></td></tr></table></figure>

<h4 id="6-vars-files-变量文件"><a href="#6-vars-files-变量文件" class="headerlink" title="6. vars_files 变量文件"></a>6. vars_files 变量文件</h4></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/08/20/%E4%BC%81%E4%B8%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%A5%9E%E5%99%A8Ansible(1)/">https://l66stbz.github.io/2024/08/20/%E4%BC%81%E4%B8%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%A5%9E%E5%99%A8Ansible(1)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://l66stbz.github.io" target="_blank">L66</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Ansible/">Ansible</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/09/12/Docker容器化部署若依项目/Docker容器化部署若依项目/bg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2024/08/21/%E4%BC%81%E4%B8%9A%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%A5%9E%E5%99%A8Ansible(2)/"><img class="prev_cover" src="https://l66stbz.github.io/2024/08/21/企业自动化运维神器Ansible(2)/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">企业自动化运维神器Ansible(2)</div></div></a></div><div class="next-post pull_right"><a href="/2024/08/16/RabbitMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"><img class="next_cover" src="https://l66stbz.github.io/2024/08/16/RabbitMQ消息队列/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RabbitMQ消息队列</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/08/21/企业自动化运维神器Ansible(2)/" title="企业自动化运维神器Ansible(2)"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/21/企业自动化运维神器Ansible(2)/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-21</div><div class="relatedPosts_title">企业自动化运维神器Ansible(2)</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/05/Jenkins_CI_CD应用/Jenkins_CI_CD应用/" title="Jenkins_CI_CD应用"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/05/Jenkins_CI_CD应用/Jenkins_CI_CD应用/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-05</div><div class="relatedPosts_title">Jenkins_CI_CD应用</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/06/Jenkins结合Ansible/Jenkins结合Ansible实战/" title="Jenkins结合Ansible实战"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/06/Jenkins结合Ansible/Jenkins结合Ansible实战/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-06</div><div class="relatedPosts_title">Jenkins结合Ansible实战</div></div></a></div><div class="relatedPosts_item"><a href="/2024/09/03/study/test/" title="study"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/09/03/study/test/1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-09-03</div><div class="relatedPosts_title">study</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/23/基础测试脚本题/" title="基础测试脚本题"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/23/基础测试脚本题/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-23</div><div class="relatedPosts_title">基础测试脚本题</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/16/RabbitMQ消息队列/" title="RabbitMQ消息队列"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/16/RabbitMQ消息队列/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-16</div><div class="relatedPosts_title">RabbitMQ消息队列</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>