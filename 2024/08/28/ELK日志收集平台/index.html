<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ELKæ—¥å¿—æ”¶é›†å¹³å° | L66</title><meta name="description" content="[TOC] 1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜ â½£äº§ç¯å¢ƒå‡ºç°é—®é¢˜åï¼Œéœ€è¦æŸ¥çœ‹å„ç§â½‡å¿—è¿›â¾åˆ†ææ’é”™ï¼› æ—¥å¸¸è¿ç»´å·¥ä½œï¼Œæ—¥å¿—æ–‡ä»¶åˆ†æ•£ï¼Œè¿ç»´å·¥ä½œç¹çã€‚å¯ä»¥å®ç°æ—¥å¿—èšåˆï¼› å¼€å‘â¼ˆå‘˜æ²¡æœ‰ç™»é™†æœåŠ¡å™¨çš„æƒé™ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡webç•Œé¢æŸ¥çœ‹æ—¥å¿—ï¼› é¢å¯¹å¤§é‡çš„è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥ç»Ÿè®¡å‡ºå„é¡¹æŒ‡æ ‡ï¼Œæ¯”å¦‚PV UVã€‚2ã€ Elastic Stack ç»„ä»¶ä»‹ç»   Elasticsearchï¼ˆç®€ç§°ESï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTfulé£æ ¼çš„å¼€æº"><meta name="keywords" content="Linux,ELK"><meta name="author" content="L66"><meta name="copyright" content="L66"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/3.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ELKæ—¥å¿—æ”¶é›†å¹³å°"><meta name="twitter:description" content="[TOC] 1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜ â½£äº§ç¯å¢ƒå‡ºç°é—®é¢˜åï¼Œéœ€è¦æŸ¥çœ‹å„ç§â½‡å¿—è¿›â¾åˆ†ææ’é”™ï¼› æ—¥å¸¸è¿ç»´å·¥ä½œï¼Œæ—¥å¿—æ–‡ä»¶åˆ†æ•£ï¼Œè¿ç»´å·¥ä½œç¹çã€‚å¯ä»¥å®ç°æ—¥å¿—èšåˆï¼› å¼€å‘â¼ˆå‘˜æ²¡æœ‰ç™»é™†æœåŠ¡å™¨çš„æƒé™ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡webç•Œé¢æŸ¥çœ‹æ—¥å¿—ï¼› é¢å¯¹å¤§é‡çš„è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥ç»Ÿè®¡å‡ºå„é¡¹æŒ‡æ ‡ï¼Œæ¯”å¦‚PV UVã€‚2ã€ Elastic Stack ç»„ä»¶ä»‹ç»   Elasticsearchï¼ˆç®€ç§°ESï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTfulé£æ ¼çš„å¼€æº"><meta name="twitter:image" content="https://l66stbz.github.io/2024/08/28/ELKæ—¥å¿—æ”¶é›†å¹³å°/1.png"><meta property="og:type" content="article"><meta property="og:title" content="ELKæ—¥å¿—æ”¶é›†å¹³å°"><meta property="og:url" content="https://l66stbz.github.io/2024/08/28/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0/"><meta property="og:site_name" content="L66"><meta property="og:description" content="[TOC] 1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜ â½£äº§ç¯å¢ƒå‡ºç°é—®é¢˜åï¼Œéœ€è¦æŸ¥çœ‹å„ç§â½‡å¿—è¿›â¾åˆ†ææ’é”™ï¼› æ—¥å¸¸è¿ç»´å·¥ä½œï¼Œæ—¥å¿—æ–‡ä»¶åˆ†æ•£ï¼Œè¿ç»´å·¥ä½œç¹çã€‚å¯ä»¥å®ç°æ—¥å¿—èšåˆï¼› å¼€å‘â¼ˆå‘˜æ²¡æœ‰ç™»é™†æœåŠ¡å™¨çš„æƒé™ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡webç•Œé¢æŸ¥çœ‹æ—¥å¿—ï¼› é¢å¯¹å¤§é‡çš„è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥ç»Ÿè®¡å‡ºå„é¡¹æŒ‡æ ‡ï¼Œæ¯”å¦‚PV UVã€‚2ã€ Elastic Stack ç»„ä»¶ä»‹ç»   Elasticsearchï¼ˆç®€ç§°ESï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTfulé£æ ¼çš„å¼€æº"><meta property="og:image" content="https://l66stbz.github.io/2024/08/28/ELKæ—¥å¿—æ”¶é›†å¹³å°/1.png"><meta property="article:published_time" content="2024-08-28T13:50:00.000Z"><meta property="article:modified_time" content="2024-08-31T02:30:55.772Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://l66stbz.github.io/2024/08/28/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0/"><link rel="prev" title="IPtables" href="https://l66stbz.github.io/2024/09/02/IPtables/iptables/"><link rel="next" title="Zabbixå‘Šè­¦åª’ä»‹" href="https://l66stbz.github.io/2024/08/27/Zabbix%E5%91%8A%E8%AD%A6%E5%AA%92%E4%BB%8B/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="L66" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/2.jpg" onerror="onerror=null;src='/img/2.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">54</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">35</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> åˆ—è¡¨</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜"><span class="toc-number">1.</span> <span class="toc-text">1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€-Elastic-Stack-ç»„ä»¶ä»‹ç»"><span class="toc-number">2.</span> <span class="toc-text">2ã€ Elastic Stack ç»„ä»¶ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€ã€å®‰è£…JAVAç¯å¢ƒï¼ˆæ‰€æœ‰esèŠ‚ç‚¹ï¼ŒlogstashèŠ‚ç‚¹ï¼ŒkinbanaèŠ‚ç‚¹ï¼‰"><span class="toc-number">3.</span> <span class="toc-text">ä¸€ã€å®‰è£…JAVAç¯å¢ƒï¼ˆæ‰€æœ‰esèŠ‚ç‚¹ï¼ŒlogstashèŠ‚ç‚¹ï¼ŒkinbanaèŠ‚ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äºŒã€-å®‰è£…ESé›†ç¾¤"><span class="toc-number">4.</span> <span class="toc-text">äºŒã€ å®‰è£…ESé›†ç¾¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€å•èŠ‚ç‚¹éƒ¨ç½²"><span class="toc-number">4.1.</span> <span class="toc-text">1ã€å•èŠ‚ç‚¹éƒ¨ç½²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ã€ES-JAVAè°ƒä¼˜-å †-heap-å†…å­˜å¤§å°"><span class="toc-number">4.2.</span> <span class="toc-text">2ã€ES JAVAè°ƒä¼˜ å †(heap)å†…å­˜å¤§å°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ã€éƒ¨ç½²ESé›†ç¾¤"><span class="toc-number">4.3.</span> <span class="toc-text">3ã€éƒ¨ç½²ESé›†ç¾¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å››ã€Logstashå®‰è£…ï¼ˆelk02ï¼‰"><span class="toc-number">5.</span> <span class="toc-text">å››ã€Logstashå®‰è£…ï¼ˆelk02ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äº”ã€Filebeatå®‰è£…ï¼ˆelk01ï¼‰"><span class="toc-number">6.</span> <span class="toc-text">äº”ã€Filebeatå®‰è£…ï¼ˆelk01ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1ã€Filebeatæ¶æ„"><span class="toc-number">6.0.1.</span> <span class="toc-text">1ã€Filebeatæ¶æ„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…­ã€Filebeatæ—¥å¿—æ”¶é›†"><span class="toc-number">7.</span> <span class="toc-text">å…­ã€Filebeatæ—¥å¿—æ”¶é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1ã€Filebeatæ ‡å‡†è¾“å…¥å’Œè¾“å‡º"><span class="toc-number">7.0.1.</span> <span class="toc-text">1ã€Filebeatæ ‡å‡†è¾“å…¥å’Œè¾“å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2ã€-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥"><span class="toc-number">7.0.2.</span> <span class="toc-text">2ã€ Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰å­—æ®µ"><span class="toc-number">7.0.2.1.</span> <span class="toc-text">2.1 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰å­—æ®µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰Tags"><span class="toc-number">7.0.2.2.</span> <span class="toc-text">2.2 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰Tags</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-offsetåç§»é‡æ¦‚å¿µ"><span class="toc-number">7.0.2.3.</span> <span class="toc-text">2.3 offsetåç§»é‡æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°æ—¥å¿—åˆ é™¤"><span class="toc-number">7.0.2.4.</span> <span class="toc-text">2.4 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°æ—¥å¿—åˆ é™¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°åŒ¹é…æ—¥å¿—è¾“å‡º"><span class="toc-number">7.0.2.5.</span> <span class="toc-text">2.5 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°åŒ¹é…æ—¥å¿—è¾“å‡º</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-include-lineså’Œexclude-linesä¼˜å…ˆçº§"><span class="toc-number">7.0.2.6.</span> <span class="toc-text">2.6 include_lineså’Œexclude_linesä¼˜å…ˆçº§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-7-Nginx-erroræ—¥å¿—è¿‡æ»¤å¤„ç†å®æˆ˜"><span class="toc-number">7.0.2.7.</span> <span class="toc-text">2.7 Nginx erroræ—¥å¿—è¿‡æ»¤å¤„ç†å®æˆ˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-8-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤"><span class="toc-number">7.0.2.8.</span> <span class="toc-text">2.8 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-9-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å•ä¸ªç´¢å¼•"><span class="toc-number">7.0.2.9.</span> <span class="toc-text">2.9 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å•ä¸ªç´¢å¼•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å¤šä¸ªç´¢å¼•"><span class="toc-number">7.0.2.10.</span> <span class="toc-text">2.10 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å¤šä¸ªç´¢å¼•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-11-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è®¾å®šå‰¯æœ¬åˆ†ç‰‡"><span class="toc-number">7.0.2.11.</span> <span class="toc-text">2.11 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è®¾å®šå‰¯æœ¬åˆ†ç‰‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-12-FIlebeat-æ”¶é›†JSONæ ¼å¼çš„nginxè®¿é—®æ—¥å¿—"><span class="toc-number">7.0.2.12.</span> <span class="toc-text">2.12 FIlebeat æ”¶é›†JSONæ ¼å¼çš„nginxè®¿é—®æ—¥å¿—</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ƒã€Logstash-æ—¥å¿—æ”¶é›†"><span class="toc-number">8.</span> <span class="toc-text">ä¸ƒã€Logstash æ—¥å¿—æ”¶é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€Logstashå®‰è£…"><span class="toc-number">8.1.</span> <span class="toc-text">1ã€Logstashå®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2ã€Logstash-æ ‡å‡†è¾“å…¥è¾“å‡º"><span class="toc-number">8.1.1.</span> <span class="toc-text">2ã€Logstash æ ‡å‡†è¾“å…¥è¾“å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3ã€LogstashåŸºäºFileçš„å½¢å¼è¿›è¡Œinput"><span class="toc-number">8.1.2.</span> <span class="toc-text">3ã€LogstashåŸºäºFileçš„å½¢å¼è¿›è¡Œinput</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4ã€LogstashåŸºäºFilebeatå½¢å¼è¿›è¡Œinput"><span class="toc-number">8.1.3.</span> <span class="toc-text">4ã€LogstashåŸºäºFilebeatå½¢å¼è¿›è¡Œinput</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5ã€LogstashåŸºäºESå½¢å¼è¿›è¡Œoutput"><span class="toc-number">8.1.4.</span> <span class="toc-text">5ã€LogstashåŸºäºESå½¢å¼è¿›è¡Œoutput</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6ã€Logstash-grokæ’ä»¶ä½¿ç”¨"><span class="toc-number">8.1.5.</span> <span class="toc-text">6ã€Logstash grokæ’ä»¶ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-Logstash-å†…ç½®æ­£åˆ™ä½¿ç”¨"><span class="toc-number">8.1.5.1.</span> <span class="toc-text">6.1 Logstash å†…ç½®æ­£åˆ™ä½¿ç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-LogstashåŸºäºå†…ç½®æ­£åˆ™å®ç°æ—¥å¿—ç»“æ„åŒ–"><span class="toc-number">8.1.5.2.</span> <span class="toc-text">6.2 LogstashåŸºäºå†…ç½®æ­£åˆ™å®ç°æ—¥å¿—ç»“æ„åŒ–</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-Logstashåˆ é™¤æŒ‡å®šå­—æ®µ"><span class="toc-number">8.1.5.3.</span> <span class="toc-text">6.4 Logstashåˆ é™¤æŒ‡å®šå­—æ®µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-5-Logstash-æ·»åŠ æŒ‡å®šå­—æ®µ"><span class="toc-number">8.1.5.4.</span> <span class="toc-text">6.5 Logstash æ·»åŠ æŒ‡å®šå­—æ®µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-6-Logstash-è‡ªå®šä¹‰Tags"><span class="toc-number">8.1.5.5.</span> <span class="toc-text">6.6 Logstash è‡ªå®šä¹‰Tags</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7ã€Logstash-geoipæ’ä»¶åˆ†æç”¨æˆ·IPæ‰€å±åœ°"><span class="toc-number">8.1.6.</span> <span class="toc-text">7ã€Logstash geoipæ’ä»¶åˆ†æç”¨æˆ·IPæ‰€å±åœ°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8ã€Logstash-useragentæ’ä»¶åˆ†æç”¨æˆ·å®¢æˆ·ç«¯ç±»å‹"><span class="toc-number">8.1.7.</span> <span class="toc-text">8ã€Logstash useragentæ’ä»¶åˆ†æç”¨æˆ·å®¢æˆ·ç«¯ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9ã€Logstash-Filterå¤šifåˆ†æ”¯"><span class="toc-number">8.1.8.</span> <span class="toc-text">9ã€Logstash Filterå¤šifåˆ†æ”¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…«ã€Kibanaæ“ä½œä½¿ç”¨"><span class="toc-number">9.</span> <span class="toc-text">å…«ã€Kibanaæ“ä½œä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€kibanaæ‰‹åŠ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿"><span class="toc-number">9.1.</span> <span class="toc-text">1ã€kibanaæ‰‹åŠ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¹ã€kafkaç®€ä»‹å’Œä½¿ç”¨"><span class="toc-number">10.</span> <span class="toc-text">ä¹ã€kafkaç®€ä»‹å’Œä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€MQä¸¤ç§æ¨¡å¼"><span class="toc-number">10.1.</span> <span class="toc-text">1ã€MQä¸¤ç§æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-P2Pæ¨¡å¼"><span class="toc-number">10.1.1.</span> <span class="toc-text">1.1 P2Pæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-1-æ¶æ„å›¾"><span class="toc-number">10.1.1.1.</span> <span class="toc-text">1.1.1 æ¶æ„å›¾</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-2-ç®€ä»‹"><span class="toc-number">10.1.1.2.</span> <span class="toc-text">1.1.2 ç®€ä»‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-3-å·¥ä½œæµç¨‹"><span class="toc-number">10.1.1.3.</span> <span class="toc-text">1.1.3 å·¥ä½œæµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><span class="toc-number">10.1.2.</span> <span class="toc-text">1.2 å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-æ¶æ„å›¾"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">1.2.1 æ¶æ„å›¾</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-ç®€ä»‹"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">1.2.2 ç®€ä»‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-3-å·¥ä½œæµç¨‹"><span class="toc-number">10.1.2.3.</span> <span class="toc-text">1.2.3 å·¥ä½œæµç¨‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ã€kafkaç›¸å…³æ¦‚å¿µ"><span class="toc-number">10.2.</span> <span class="toc-text">2ã€kafkaç›¸å…³æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-ä»‹ç»"><span class="toc-number">10.2.1.</span> <span class="toc-text">2.1 ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Kafkaç›¸å…³ä¸“ä¸šæœ¯è¯­"><span class="toc-number">10.2.2.</span> <span class="toc-text">2.2 Kafkaç›¸å…³ä¸“ä¸šæœ¯è¯­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ã€Zookeeperä½¿ç”¨å’Œé…ç½®"><span class="toc-number">10.3.</span> <span class="toc-text">3ã€Zookeeperä½¿ç”¨å’Œé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-ç®€ä»‹ï¼š"><span class="toc-number">10.3.1.</span> <span class="toc-text">3.1 ç®€ä»‹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-zookeeperé›†ç¾¤éƒ¨ç½²ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€"><span class="toc-number">10.3.2.</span> <span class="toc-text">3.2 zookeeperé›†ç¾¤éƒ¨ç½²ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Zookeeperè§’è‰²åˆ’åˆ†"><span class="toc-number">10.3.3.</span> <span class="toc-text">3.3 Zookeeperè§’è‰²åˆ’åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-zookeeperé…ç½®å†…å­˜å †æ ˆ"><span class="toc-number">10.3.4.</span> <span class="toc-text">3.4 zookeeperé…ç½®å†…å­˜å †æ ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4ã€kafkaé›†ç¾¤å®‰è£…ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€"><span class="toc-number">10.4.</span> <span class="toc-text">4ã€kafkaé›†ç¾¤å®‰è£…ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5ã€Kafka-Topicæ—¥å¸¸æ“ä½œ"><span class="toc-number">10.5.</span> <span class="toc-text">5ã€Kafka Topicæ—¥å¸¸æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-æŸ¥çœ‹Topicç›¸å…³ä¿¡æ¯"><span class="toc-number">10.5.1.</span> <span class="toc-text">5.1 æŸ¥çœ‹Topicç›¸å…³ä¿¡æ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-åˆ›å»ºTopic"><span class="toc-number">10.5.2.</span> <span class="toc-text">5.2 åˆ›å»ºTopic</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6ã€Filebeatæ”¶é›†æ—¥å¿—è‡³Kafka"><span class="toc-number">10.6.</span> <span class="toc-text">6ã€Filebeatæ”¶é›†æ—¥å¿—è‡³Kafka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7ã€Logstashæ”¶é›†Kafka-Topicæ—¥å¿—"><span class="toc-number">10.7.</span> <span class="toc-text">7ã€Logstashæ”¶é›†Kafka Topicæ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åã€Elasticsearch-Restfulé£æ ¼APIå®æˆ˜"><span class="toc-number">11.</span> <span class="toc-text">åã€Elasticsearch Restfulé£æ ¼APIå®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€ESé›†ç¾¤çŠ¶æ€"><span class="toc-number">11.1.</span> <span class="toc-text">1ã€ESé›†ç¾¤çŠ¶æ€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ã€Elasticsearchæœ¯è¯­"><span class="toc-number">11.2.</span> <span class="toc-text">2ã€Elasticsearchæœ¯è¯­</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1ã€Elasticsearchåˆ†ç‰‡åˆ†é…çš„åŸºæœ¬ç­–ç•¥"><span class="toc-number">11.2.1.</span> <span class="toc-text">2.1ã€Elasticsearchåˆ†ç‰‡åˆ†é…çš„åŸºæœ¬ç­–ç•¥</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://l66stbz.github.io/2024/08/28/ELKæ—¥å¿—æ”¶é›†å¹³å°/1.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">L66</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> åˆ—è¡¨</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Photo</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">ELKæ—¥å¿—æ”¶é›†å¹³å°</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="å‘è¡¨äº 2024-08-28 21:50:00"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2024-08-28</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="æ›´æ–°äº 2024-08-31 10:30:55"><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2024-08-31</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>[TOC]</p>
<h2 id="1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜"><a href="#1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜" class="headerlink" title="1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜"></a>1ã€æ—¥å¿—æ”¶é›†æ‰€è§£å†³çš„é—®é¢˜</h2><ol>
<li>â½£äº§ç¯å¢ƒå‡ºç°é—®é¢˜åï¼Œéœ€è¦æŸ¥çœ‹å„ç§â½‡å¿—è¿›â¾åˆ†ææ’é”™ï¼›</li>
<li>æ—¥å¸¸è¿ç»´å·¥ä½œï¼Œæ—¥å¿—æ–‡ä»¶åˆ†æ•£ï¼Œè¿ç»´å·¥ä½œç¹çã€‚å¯ä»¥å®ç°æ—¥å¿—èšåˆï¼›</li>
<li>å¼€å‘â¼ˆå‘˜æ²¡æœ‰ç™»é™†æœåŠ¡å™¨çš„æƒé™ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡webç•Œé¢æŸ¥çœ‹æ—¥å¿—ï¼›</li>
<li>é¢å¯¹å¤§é‡çš„è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥ç»Ÿè®¡å‡ºå„é¡¹æŒ‡æ ‡ï¼Œæ¯”å¦‚PV UVã€‚<h2 id="2ã€-Elastic-Stack-ç»„ä»¶ä»‹ç»"><a href="#2ã€-Elastic-Stack-ç»„ä»¶ä»‹ç»" class="headerlink" title="2ã€ Elastic Stack ç»„ä»¶ä»‹ç»"></a>2ã€ Elastic Stack ç»„ä»¶ä»‹ç»</h2></li>
</ol>
<ul>
<li>Elasticsearchï¼ˆç®€ç§°ESï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€<strong>RESTful</strong>é£æ ¼çš„å¼€æºæœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼Œä¸“ä¸ºå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æã€å’Œæ•°æ®å¯è§†åŒ–è€Œè®¾è®¡ã€‚æ”¯æŒå‡ ä¹å®æ—¶çš„æœç´¢ï¼Œå¹¶ä¸”å…·æœ‰é«˜æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿå¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚<ul>
<li><strong>Indexï¼ˆç´¢å¼•ï¼‰</strong>ï¼š ç´¢å¼•ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼Œå®ƒå­˜å‚¨ç€ç›¸ä¼¼ç»“æ„çš„æ•°æ®ã€‚åœ¨Elasticsearchä¸­ï¼Œæ¯ä¸ªç´¢å¼•åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ï¼ˆDocumentï¼‰ã€‚</li>
<li><strong>Documentï¼ˆæ–‡æ¡£ï¼‰</strong>ï¼š æ–‡æ¡£æ˜¯Elasticsearchçš„åŸºæœ¬æ•°æ®å•ä½ï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ã€‚æ–‡æ¡£ä»¥JSONæ ¼å¼å­˜å‚¨ï¼ŒåŒ…å«å­—æ®µå’Œå€¼çš„å¯¹ã€‚</li>
<li><strong>Shardsï¼ˆåˆ†ç‰‡ï¼‰å’ŒReplicasï¼ˆå‰¯æœ¬ï¼‰</strong>ï¼š Elasticsearchå°†æ•°æ®åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡å­˜å‚¨ï¼Œæ¯ä¸ªç´¢å¼•å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ã€‚åˆ†ç‰‡å¯ä»¥æé«˜å¹¶è¡ŒæŸ¥è¯¢çš„æ€§èƒ½ã€‚å‰¯æœ¬æ˜¯åˆ†ç‰‡çš„å¤‡ä»½ï¼Œä¿è¯äº†æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚</li>
<li><strong>Clusterï¼ˆé›†ç¾¤ï¼‰</strong>ï¼š Elasticsearché›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ç»„æˆã€‚æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼Œå¹¶å‚ä¸é›†ç¾¤ä¸­çš„ç´¢å¼•å’Œæœç´¢æ“ä½œã€‚é›†ç¾¤æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œç”¨äºç®¡ç†é›†ç¾¤çŠ¶æ€ã€‚</li>
<li><strong>Nodeï¼ˆèŠ‚ç‚¹ï¼‰</strong>ï¼š èŠ‚ç‚¹æ˜¯Elasticsearchçš„è¿è¡Œå®ä¾‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å±äºæŸä¸ªé›†ç¾¤ã€‚èŠ‚ç‚¹å¯ä»¥å……å½“ä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹ã€‚</li>
<li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong><ul>
<li><strong>æ—¥å¿—å’Œäº‹ä»¶æ•°æ®åˆ†æ</strong>ï¼š Elasticsearchå¸¸ç”¨äºé›†ä¸­åŒ–æ—¥å¿—ç®¡ç†å’Œåˆ†æï¼Œå¸®åŠ©ä¼ä¸šåœ¨æµ·é‡æ—¥å¿—ä¸­å¿«é€Ÿå®šä½é—®é¢˜ã€‚</li>
<li><strong>ç”µå•†ç½‘ç«™çš„æœç´¢åŠŸèƒ½</strong>ï¼š Elasticsearchè¢«å¹¿æ³›ç”¨äºç”µå•†ç½‘ç«™çš„äº§å“æœç´¢ï¼Œæä¾›å¿«é€Ÿã€ç›¸å…³æ€§é«˜çš„æœç´¢ç»“æœã€‚</li>
<li><strong>æ•°æ®å­˜å‚¨ä¸æ£€ç´¢</strong>ï¼š Elasticsearchèƒ½æœ‰æ•ˆå­˜å‚¨å’Œæ£€ç´¢ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®çš„ç®¡ç†ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>Logstash</strong><ul>
<li>Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†ã€å¤„ç†å’Œä¼ è¾“å¼•æ“ï¼Œä¸»è¦ç”¨äºå®æ—¶çš„æ•°æ®ç®¡é“ç®¡ç†ã€‚å®ƒæ˜¯ Elastic Stackï¼ˆELK Stackï¼šElasticsearchã€Logstashã€Kibanaï¼‰çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å°†å„ç§æ¥æºçš„æ•°æ®æ”¶é›†èµ·æ¥ï¼Œè¿›è¡Œè¿‡æ»¤å’Œæ ¼å¼åŒ–å¤„ç†ï¼Œå¹¶æœ€ç»ˆå°†å…¶è¾“å‡ºåˆ°æŒ‡å®šçš„ç›®æ ‡ï¼Œå¦‚ Elasticsearchã€æ–‡ä»¶æˆ–å…¶ä»–å­˜å‚¨ç³»ç»Ÿã€‚</li>
</ul>
</li>
<li><strong>Kibana</strong><ul>
<li>Kibana æä¾›å¼ºå¤§çš„æ•°æ®å¯è§†åŒ–èƒ½åŠ›ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å®æ—¶æŸ¥çœ‹ã€æœç´¢å’Œåˆ†æå­˜å‚¨åœ¨ Elasticsearch ä¸­çš„æ•°æ®ã€‚å®ƒæä¾›ä¸°å¯Œçš„å¯è§†åŒ–é€‰é¡¹ï¼Œå¦‚å›¾è¡¨ã€åœ°å›¾å’Œè¡¨æ ¼ï¼Œæ”¯æŒæ„å»ºäº¤äº’å¼ä»ªè¡¨æ¿ã€‚</li>
</ul>
</li>
<li><strong>Filebeat</strong><ul>
<li>Filebeat æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—æ”¶é›†å’Œä¼ è¾“å·¥å…·ã€‚å®ƒé€šå¸¸ç”¨äºä»å„ç§æ•°æ®æºæ”¶é›†æ—¥å¿—ï¼Œå¹¶å°†è¿™äº›æ—¥å¿—ä¼ è¾“åˆ° Logstash æˆ– Elasticsearch è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†å’Œåˆ†æã€‚Filebeat æ˜¯ä¸€ä¸ªè¾¹è½¦ä»£ç†ï¼Œå®‰è£…åœ¨éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Šï¼Œç”¨äºé«˜æ•ˆåœ°è¯»å–å’Œè½¬å‘æ—¥å¿—æ•°æ®ã€‚å®ƒæ—¨åœ¨å‡å°‘èµ„æºæ¶ˆè€—ï¼Œæä¾›å¯é çš„æ—¥å¿—ä¼ è¾“ï¼Œå¹¶ç¡®ä¿åœ¨å‡ºç°æ•…éšœæ—¶ä¸ä¼šä¸¢å¤±æ—¥å¿—æ•°æ®ã€‚<h2 id="ä¸€ã€å®‰è£…JAVAç¯å¢ƒï¼ˆæ‰€æœ‰esèŠ‚ç‚¹ï¼ŒlogstashèŠ‚ç‚¹ï¼ŒkinbanaèŠ‚ç‚¹ï¼‰"><a href="#ä¸€ã€å®‰è£…JAVAç¯å¢ƒï¼ˆæ‰€æœ‰esèŠ‚ç‚¹ï¼ŒlogstashèŠ‚ç‚¹ï¼ŒkinbanaèŠ‚ç‚¹ï¼‰" class="headerlink" title="ä¸€ã€å®‰è£…JAVAç¯å¢ƒï¼ˆæ‰€æœ‰esèŠ‚ç‚¹ï¼ŒlogstashèŠ‚ç‚¹ï¼ŒkinbanaèŠ‚ç‚¹ï¼‰"></a>ä¸€ã€å®‰è£…JAVAç¯å¢ƒï¼ˆæ‰€æœ‰esèŠ‚ç‚¹ï¼ŒlogstashèŠ‚ç‚¹ï¼ŒkinbanaèŠ‚ç‚¹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; ä¸Šä¼ jdk1.8å®‰è£…åŒ…</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># ll jdk-8u381-linux-x64.tar.gz </span></span><br><span class="line">-rw-r--r--. 1 root root 139273048 7æœˆ  31 10:23 jdk-8u381-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; è§£å‹jdkåˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># tar xf jdk-8u381-linux-x64.tar.gz  -C /usr/local/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºè½¯é“¾æ¥</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># cd /usr/local/</span></span><br><span class="line">[root@elk03 <span class="built_in">local</span>]<span class="comment"># ln -s jdk1.8.0_381/ java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å£°æ˜Javaç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk03 <span class="built_in">local</span>]<span class="comment"># cat  &gt;&gt; /etc/profile.d/jdk.sh &lt;&lt;-EOF</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java</span><br><span class="line"><span class="built_in">export</span> PATH=\<span class="variable">$PATH</span>:\<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 <span class="built_in">local</span>]<span class="comment"># source /etc/profile.d/jdk.sh </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•java</span></span><br><span class="line">[root@elk03 <span class="built_in">local</span>]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_381"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_381-b09)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.381-b09, mixed mode)</span><br></pre></td></tr></table></figure>
<img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405282051529.png#id=LinjU&originHeight=287&originWidth=1568&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><h2 id="äºŒã€-å®‰è£…ESé›†ç¾¤"><a href="#äºŒã€-å®‰è£…ESé›†ç¾¤" class="headerlink" title="äºŒã€ å®‰è£…ESé›†ç¾¤"></a>äºŒã€ å®‰è£…ESé›†ç¾¤</h2><h3 id="1ã€å•èŠ‚ç‚¹éƒ¨ç½²"><a href="#1ã€å•èŠ‚ç‚¹éƒ¨ç½²" class="headerlink" title="1ã€å•èŠ‚ç‚¹éƒ¨ç½²"></a>1ã€å•èŠ‚ç‚¹éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; è§£å‹eså®‰è£…åŒ…åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># tar xf elasticsearch-7.17.11-linux-x86_64.tar.gz  -C /usr/local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºesè½¯é“¾æ¥</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cd /usr/local/</span></span><br><span class="line">[root@elk01 <span class="built_in">local</span>]<span class="comment"># ln -s elasticsearch-7.17.11/ es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å£°æ˜ESç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01 loacl]<span class="comment"># cat &gt;&gt; /etc/profile.d/es.sh &lt;&lt;-EOF</span></span><br><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="built_in">export</span> ES_HOME=/usr/<span class="built_in">local</span>/es</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:\<span class="variable">$ES_HOME</span>/bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01 <span class="built_in">local</span>]<span class="comment"># source /etc/profile.d/es.sh </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨eså®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># elasticsearch</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ­¤æ—¶å¯åŠ¨ä¼šæœ‰æŠ¥é”™ä¿¡æ¯ï¼Œè®°ä½è¯¦ç»†çœ‹æŠ¥é”™ä¿¡æ¯å“Ÿï¼</strong><code>å˜¿å˜¿</code><strong>ã€‚æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼šæ­¤æœåŠ¡ä¸èƒ½ä»¥è¶…çº§ç®¡ç†å‘˜çš„èº«ä»½è¿è¡Œï¼Œéœ€è¦å•ç‹¬åˆ›å»ºesæ™®é€šç”¨æˆ·ã€‚</strong><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405282057083.png#id=hPod8&originHeight=524&originWidth=2323&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>è§£å†³æ–¹æ³•å¦‚ä¸‹æ“ä½œï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºç”¨äºå¯åŠ¨ESçš„ç”¨æˆ·</span></span><br><span class="line">[root@elk01 <span class="built_in">local</span>]<span class="comment"># useradd es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦åˆ›å»º</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># id es</span></span><br><span class="line">uid=1000(es) gid=1000(es) ç»„=1000(es)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹elasticsearchå±ä¸»å’Œæ•°ç»„</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># chown  -R es.es /usr/local/elasticsearch-7.17.11/</span></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># ll /usr/local/elasticsearch-7.17.11/</span></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ‡æ¢eså·¥ä½œç›®å½•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cd /usr/local/elasticsearch-7.17.11/config/</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å¤‡ä»½esé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 config]<span class="comment"># cp elasticsearch.yml&#123;,.bak&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹æ–‡ä»¶ç›¸å…³å‚æ•°</span></span><br><span class="line">[root@elk01 config]<span class="comment"># egrep -v  "^(#|$)" elasticsearch.yml</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="comment"># esé›†ç¾¤åç§°</span></span><br><span class="line">cluster.name: study-elk-cluster</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°(ä¸€èˆ¬ä»¥å½“å‰ä¸»æœºåä¸€è‡´)</span></span><br><span class="line">node.name: elk01	</span><br><span class="line"><span class="comment"># ç›‘å¬åœ°å€ï¼Œï¼Œé…ç½®IPåˆ™çŸ¥å…è®¸åŸºäºIPåœ°å€è¿›è¡Œè®¿é—®</span></span><br><span class="line">network.host: 0.0.0.0	</span><br><span class="line"><span class="comment"># è‡ªåŠ¨å‘ç°èŠ‚ç‚¹IP</span></span><br><span class="line">discovery.seed_hosts: [<span class="string">"192.168.100.160"</span>]	</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–masterèŠ‚ç‚¹</span></span><br><span class="line">cluster.initial_master_nodes: [<span class="string">"192.168.100.160"</span>] </span><br><span class="line"><span class="comment"># æ·»åŠ ä»¥ä¸‹å‚æ•°å…³é—­geoipæ•°æ®åº“çš„æ›´æ–°,å‡å°‘å¯¹å¸¦å®½å’Œå­˜å‚¨çš„æ¶ˆè€—ï¼Œç¦ç”¨è‡ªåŠ¨æ›´æ–°ã€‚GeoIPæ ¹æ®IPåœ°å€ç¡®å®šåœ°ç†ä½ç½®çš„æŠ€æœ¯ï¼Œç”¨äºæ—¥å¿—åˆ†æã€ç”¨æˆ·æ´»åŠ¨è¿½è¸ªç­‰åœºæ™¯ã€‚</span></span><br><span class="line">ingest.geoip.downloader.enabled: <span class="literal">false</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•å¯åŠ¨ES</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># su -c "elasticsearch" es</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è™½ç„¶esèƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯å¯åŠ¨æ—¥å¿—ä¼šå‡ºä¸‹æŠ¥é”™ä¿¡æ¯ï¼Œéœ€è¦æˆ‘ä»¬ä¿®æ”¹å¯åŠ¨çš„å†…æ ¸å‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºä¿®æ”¹ç³»æœ€å¤§çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç¬¬äºŒä¸ªä¿®æ”¹ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ã€‚</strong></p>
</blockquote>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405282123794.png#id=Yu4ws&originHeight=300&originWidth=2519&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹eséœ€è¦çš„limitså‚æ•°ï¼ˆé‡æ–°è¿æ¥ä¼šè¯æ¡†æ‰èƒ½æˆåŠŸåŠ è½½å‚æ•°ï¼‰</span></span><br><span class="line">[root@elk01 logs]<span class="comment"># cat &gt;&gt;/etc/security/limits.d/elk.conf &lt;&lt;EOF</span></span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 131070</span><br><span class="line">EOF</span><br><span class="line">    <span class="comment"># å‚æ•°è§£é‡Šï¼š</span></span><br><span class="line">        soft nofile 65535è¡¨ç¤ºå°†æ–‡ä»¶æè¿°ç¬¦çš„è½¯é™åˆ¶è®¾ç½®ä¸º65535ã€‚</span><br><span class="line">        hard nofile 131070è¡¨ç¤ºå°†æ–‡ä»¶æè¿°ç¬¦çš„ç¡¬é™åˆ¶è®¾ç½®ä¸º131070ã€‚</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹limitså‚æ•°æ˜¯å¦åŠ è½½</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># ulimit -Sn</span></span><br><span class="line">65535</span><br><span class="line">[root@elk01 ~]<span class="comment"># ulimit -Hn</span></span><br><span class="line">131070</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹å†…æ ¸å‚æ•°</span></span><br><span class="line">[root@elk01 config]<span class="comment"># cat &gt;&gt; /etc/sysctl.d/elk.conf &lt;&lt;'EOF'</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line">EOF</span><br><span class="line">    <span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line">        vm.max_map_count = 262144 ç”¨äºè®¾ç½®å•ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„å†…å­˜æ˜ å°„çš„æœ€å¤§æ•°é‡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åŠ è½½å†…æ ¸å‚æ•°</span></span><br><span class="line">[root@elk01 config]<span class="comment"># sysctl -f /etc/sysctl.d/elk.conf</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line">[root@elk01 config]<span class="comment"># sysctl -q vm.max_map_count</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•å¯åŠ¨ES</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># su -c "elasticsearch" es</span></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æˆ–è€…ä½¿ç”¨ä¸€ä¸‹çš„å‚æ•°å®ç°åå°è¿è¡Œ</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># su -c "elasticsearch -d" es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•èŠ‚ç‚¹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># curl   192.168.100.160:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"elk01"</span>,  <span class="comment"># èŠ‚ç‚¹çš„åç§°,ä¸€èˆ¬ä»¥å½“å‰ä¸»æœºåå‘½åã€‚</span></span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"study-elk-cluster"</span>,		<span class="comment">#  Elasticsearché›†ç¾¤çš„åç§°ï¼Œå¤šä¸ªèŠ‚ç‚¹å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå…±åŒæä¾›æœç´¢å’Œå­˜å‚¨åŠŸèƒ½ã€‚</span></span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"EyOTgfNNSHOvUsQNLQ9f7Q"</span>, <span class="comment"># é›†ç¾¤çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ã€‚æ¯ä¸ªElasticsearché›†ç¾¤éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„cluster_uuidï¼Œç”¨äºåœ¨é›†ç¾¤å†…è¯†åˆ«å’Œç®¡ç†èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ã€‚</span></span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"7.17.11"</span>,  <span class="comment"># Elasticsearch å®ä¾‹çš„ç‰ˆæœ¬</span></span><br><span class="line">    <span class="string">"build_flavor"</span> : <span class="string">"default"</span>,  <span class="comment"># ç¤ºè¿™ä¸ªç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šçš„è‡ªå®šä¹‰ä¿®æ”¹æˆ–å˜åŒ–ã€‚</span></span><br><span class="line">    <span class="string">"build_type"</span> : <span class="string">"tar"</span>,  <span class="comment"># Elasticsearch æ˜¯é€šè¿‡ tar åŒ…å®‰è£…çš„ã€‚</span></span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"eeedb98c60326ea3d46caef960fb4c77958fb885"</span>,  <span class="comment"># Gitæäº¤å“ˆå¸Œã€‚</span></span><br><span class="line">    <span class="string">"build_date"</span> : <span class="string">"2023-06-23T05:33:12.261262042Z"</span>, <span class="comment"># ç‰ˆæœ¬çš„æ„å»ºæ—¥æœŸå’Œæ—¶é—´ã€‚</span></span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,  <span class="comment"># æ­¤ç‰ˆæœ¬é€‚ç”¨äºç”Ÿäº§</span></span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"8.11.1"</span>,  <span class="comment"># Luceneç‰ˆæœ¬</span></span><br><span class="line">    <span class="string">"minimum_wire_compatibility_version"</span> : <span class="string">"6.8.0"</span>, <span class="comment"># lasticsearchå®ä¾‹èƒ½å¤Ÿä¸è¿è¡Œ 6.8.0 åŠä»¥ä¸Šç‰ˆæœ¬çš„å…¶ä»–èŠ‚ç‚¹è¿›è¡Œé€šè®¯ã€‚</span></span><br><span class="line">    <span class="string">"minimum_index_compatibility_version"</span> : <span class="string">"6.0.0-beta1"</span>  <span class="comment"># Elasticsearchå…¼å®¹çš„æœ€ä½ç´¢å¼•ç‰ˆæœ¬ã€‚</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span> <span class="comment">#  Elasticsearchçš„æ ‡è¯­æˆ–å®£ä¼ å£å·ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç«¯å£è§£é‡Šï¼š</strong></p>
<ul>
<li>*<em>9200 å¯¹å¤–æš´éœ²ç«¯å£ï¼Œä½¿ç”¨çš„HTTPåè®®ï¼Œ Elasticsearch çš„ REST API æœåŠ¡çš„é»˜è®¤ç«¯å£ã€‚å¼€å‘è€…å’Œåº”ç”¨ç¨‹åºé€šè¿‡ HTTP åè®®ä¸ Elasticsearch è¿›è¡Œäº¤äº’ï¼Œå‘é€æŸ¥è¯¢ã€ç´¢å¼•æ–‡æ¡£ã€ç®¡ç†é›†ç¾¤ç­‰æ“ä½œã€‚  *</em></li>
<li>*<em>9300 é›†ç¾¤å†…éƒ¨é€šè®¯ç«¯å£ã€‚ä½¿ç”¨TCPåè®®ã€‚ ç”¨äºé›†ç¾¤å†…çš„èŠ‚ç‚¹é—´åŒæ­¥å’Œåè°ƒã€‚èŠ‚ç‚¹ä¹‹é—´é€šè¿‡è¿™ä¸ªç«¯å£äº¤æ¢æ•°æ®ï¼ŒåŒ…æ‹¬é›†ç¾¤ç®¡ç†ä¿¡æ¯ã€ç´¢å¼•å’Œæœç´¢æ“ä½œç­‰ã€‚  *</em><h3 id="2ã€ES-JAVAè°ƒä¼˜-å †-heap-å†…å­˜å¤§å°"><a href="#2ã€ES-JAVAè°ƒä¼˜-å †-heap-å†…å­˜å¤§å°" class="headerlink" title="2ã€ES JAVAè°ƒä¼˜ å †(heap)å†…å­˜å¤§å°"></a>2ã€ES JAVAè°ƒä¼˜ å †(heap)å†…å­˜å¤§å°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹è¿è¡Œçš„JAVAç¨‹åº</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># jps  </span></span><br><span class="line">14917 Jps</span><br><span class="line">14713 Elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹ESå †å†…å­˜å¤§å°</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># jmap -heap 14713(pid)</span></span><br></pre></td></tr></table></figure>
<img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405282346087.png#id=mf04i&originHeight=619&originWidth=1348&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹å †å†…å­˜å¤§å°ï¼ˆæœ€å¤§è®¾ç½®ä¸º32Gï¼Œè¦ä¹ˆå†…å­˜çš„ä¸€åŠï¼‰</span></span><br><span class="line">[root@elk01 config]<span class="comment"># vim /usr/local/elasticsearch-7.17.11/config/jvm.options</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">-Xms256m</span><br><span class="line">-Xmx256m</span><br><span class="line">Â·Â·Â·</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ é™¤æ•°æ®ã€æ—¥å¿—</span></span><br><span class="line">[root@elk01 config]<span class="comment"># rm -rf /usr/local/es/&#123;data,logs&#125;/*</span></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ é™¤ç¼“å­˜æ•°æ®</span></span><br><span class="line">[root@elk01 config]<span class="comment"># rm -rf /tmp/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å‡†å¤‡ESå¯åŠ¨è„šæœ¬å¹¶å¯åŠ¨ï¼ˆåŠ å…¥systemdï¼‰</span></span><br><span class="line">[root@elk01 config]<span class="comment"># cat &gt;&gt; /usr/lib/systemd/system/es.service &lt;&lt;EOF</span></span><br><span class="line">[Unit]</span><br><span class="line"><span class="comment"># æè¿°æœåŠ¡çš„ç®€çŸ­è¯´æ˜ï¼Œè¿™é‡Œæè¿°ä¸º "ELK"ã€‚</span></span><br><span class="line">Description=ELK</span><br><span class="line"><span class="comment"># æŒ‡å®šæœåŠ¡çš„å¯åŠ¨é¡ºåºã€‚è¡¨ç¤ºè¯¥æœåŠ¡åœ¨ç½‘ç»œç›®æ ‡ (network.target) ä¹‹åå¯åŠ¨ï¼Œç¡®ä¿ç½‘ç»œæœåŠ¡å·²å¯åŠ¨å¹¶å¯ç”¨ã€‚</span></span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="comment"># æŒ‡å®šæœåŠ¡çš„å¯åŠ¨ç±»å‹ä¸º forkingï¼Œè¡¨ç¤ºæœåŠ¡å¯åŠ¨åä¼šäº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä¸”ä¸»è¿›ç¨‹ä¼šåœ¨å¯åŠ¨å®Œæˆåé€€å‡ºã€‚è¿™é€šå¸¸ç”¨äºåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ã€‚</span></span><br><span class="line">Type=forking</span><br><span class="line"><span class="comment"># æŒ‡å®šå¯åŠ¨æœåŠ¡çš„å‘½ä»¤</span></span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/es/bin/elasticsearch -d</span><br><span class="line"><span class="comment"># æŒ‡å®šæœåŠ¡åœ¨é€€å‡ºåä¸é‡å¯ã€‚å¯ä»¥æ ¹æ®éœ€è¦å°†å…¶æ›´æ”¹ä¸º always æˆ– on-failureï¼Œä»¥ç¡®ä¿æœåŠ¡åœ¨å¤±è´¥åè‡ªåŠ¨é‡å¯ã€‚</span></span><br><span class="line">Restart=no</span><br><span class="line"><span class="comment"># æŒ‡å®šä»¥ es ç”¨æˆ·çš„èº«ä»½è¿è¡ŒæœåŠ¡ã€‚</span></span><br><span class="line">User=es</span><br><span class="line"><span class="comment"># æŒ‡å®šæœåŠ¡æ‰€å±çš„ç»„ä¸º esã€‚</span></span><br><span class="line">Group=es</span><br><span class="line"><span class="comment"># è®¾ç½®è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼ˆæ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼‰</span></span><br><span class="line">LimitNOFILE=131070</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"><span class="comment"># æŒ‡å®šæœåŠ¡çš„ç›®æ ‡ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡åœ¨å¤šç”¨æˆ·æ¨¡å¼ä¸‹å¯ç”¨ã€‚</span></span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½systemdé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 config]<span class="comment"># systemctl daemon-reload</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨es</span></span><br><span class="line">[root@elk01 config]<span class="comment"># systemctl restart es</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3ã€éƒ¨ç½²ESé›†ç¾¤"><a href="#3ã€éƒ¨ç½²ESé›†ç¾¤" class="headerlink" title="3ã€éƒ¨ç½²ESé›†ç¾¤"></a>3ã€éƒ¨ç½²ESé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºç”¨äºå¯åŠ¨ESçš„ç”¨æˆ·</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># useradd es </span></span><br><span class="line">[root@elk01 opt]<span class="comment"># id es</span></span><br><span class="line">uid=1000(elasticsearch) gid=1000(elasticsearch) ç»„=1000(elasticsearch)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºESæ•°æ®ç›®å½•å’Œæ—¥å¿—ç›®å½•å­˜æ”¾ç›®å½•</span></span><br><span class="line">[root@elk01 usr]<span class="comment"># mkdir -p /opt/&#123;data,logs&#125;</span></span><br><span class="line">[root@elk01 usr]<span class="comment"># install -d /opt/&#123;data,logs&#125;/es -o es -g es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; è§£å‹eså®‰è£…åŒ…åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># tar xf elasticsearch-7.17.11-linux-x86_64.tar.gz  -C /opt/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ›´æ”¹ç›®å½•å</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cd /opt/ &amp;&amp; mv  elasticsearch-7.17.11  es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºESç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># vim  &gt;&gt; /etc/profile.d/es.sh &lt;&lt;-EOF</span></span><br><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="built_in">export</span> ES_HOME=/opt/es</span><br><span class="line"><span class="built_in">export</span> PATH=\<span class="variable">$PATH</span>:\<span class="variable">$ES_HOME</span>/bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># source /etc/profile.d/es.sh </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹elasticsearchå±ä¸»å’Œæ•°ç»„</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># chown -R  es,es  /opt/es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹eséœ€è¦çš„limitså‚æ•°ï¼ˆé‡æ–°è¿æ¥ä¼šè¯æ¡†æ‰èƒ½æˆåŠŸåŠ è½½å‚æ•°ï¼‰</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># cat &gt;&gt; /etc/security/limits.d/elk.conf &lt;&lt;-EOF</span></span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 131070</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹limitså‚æ•°æ˜¯å¦åŠ è½½</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># ulimit -Sn</span></span><br><span class="line">65535</span><br><span class="line">[root@elk01 opt]<span class="comment"># ulimit -Hn</span></span><br><span class="line">131070</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹å†…æ ¸å‚æ•°</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># cat &gt; /etc/sysctl.d/elk.conf &lt;&lt;EOF</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line">EOF</span><br><span class="line">    </span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åŠ è½½å†…æ ¸å‚æ•°</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># sysctl -f /etc/sysctl.d/elk.conf</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line">[root@elk01 opt]<span class="comment"># sysctl -q vm.max_map_count</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹å †å†…å­˜å¤§å°ï¼ˆæœ€å¤§è®¾ç½®ä¸º32Gï¼Œè¦ä¹ˆå†…å­˜çš„ä¸€åŠï¼‰</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># vim /opt/elasticsearch-7.17.11/config/jvm.options</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">-Xms256m</span><br><span class="line">-Xmx256m</span><br><span class="line">Â·Â·Â·</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; elk01ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># egrep -v "^(#|$)" /opt/es/config/elasticsearch.yml </span></span><br><span class="line">cluster.name: study-elk-cluster</span><br><span class="line">node.name: elk01</span><br><span class="line">path.data: /opt/data/es	<span class="comment"># æŒ‡å®šæ•°æ®ç›®å½•</span></span><br><span class="line">path.logs: /opt/logs/es	<span class="comment"># æŒ‡å®šæ—¥å¿—ç›®å½•</span></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">discovery.seed_hosts: [<span class="string">"192.168.100.160"</span>,<span class="string">"192.168.100.161"</span>,<span class="string">"192.168.100.162"</span>]</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">"192.168.100.160"</span>,<span class="string">"192.168.100.161"</span>,<span class="string">"192.168.100.162"</span>]</span><br><span class="line">ingest.geoip.downloader.enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; elk02ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk02 opt]<span class="comment"># egrep -v "^(#|$)" /opt/es/config/elasticsearch.yml </span></span><br><span class="line">cluster.name: study-elk-cluster</span><br><span class="line">node.name: elk02</span><br><span class="line">path.data: /opt/data/es</span><br><span class="line">path.logs: /opt/logs/es</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">discovery.seed_hosts: [<span class="string">"192.168.100.160"</span>,<span class="string">"192.168.100.161"</span>,<span class="string">"192.168.100.162"</span>]</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">"192.168.100.160"</span>,<span class="string">"192.168.100.161"</span>,<span class="string">"192.168.100.162"</span>]</span><br><span class="line">ingest.geoip.downloader.enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; elk03ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 opt]<span class="comment"># egrep -v "^#|^$" /opt/es/config/elasticsearch.yml </span></span><br><span class="line">cluster.name: study-elk-cluster</span><br><span class="line">node.name: elk03</span><br><span class="line">path.data: /opt/data/es</span><br><span class="line">path.logs: /opt/logs/es</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">discovery.seed_hosts: [<span class="string">"192.168.100.160"</span>,<span class="string">"192.168.100.161"</span>,<span class="string">"192.168.100.162"</span>]</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">"192.168.100.160"</span>,<span class="string">"192.168.100.161"</span>,<span class="string">"192.168.100.162"</span>]</span><br><span class="line">ingest.geoip.downloader.enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; æ‰€æœ‰èŠ‚ç‚¹æ·»åŠ elkå¯åŠ¨è„šæœ¬</span></span><br><span class="line">[root@elk03 opt]<span class="comment"># cat &gt; /usr/lib/systemd/system/es.service &lt;&lt;EOF</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=ELK</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/opt/es/bin/elasticsearch -d</span><br><span class="line">Restart=no</span><br><span class="line">User=es</span><br><span class="line">Group=es</span><br><span class="line">LimitNOFILE=131070</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ‰€æœ‰èŠ‚ç‚¹é‡æ–°åŠ è½½å¹¶å¯åŠ¨</span></span><br><span class="line">[root@elk01 config]<span class="comment"># systemctl daemon-reload</span></span><br><span class="line">[root@elk01 config]<span class="comment"># systemctl restart es</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•é›†ç¾¤</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># curl 192.168.100.160:9200/_cat/nodes</span></span><br><span class="line">192.168.100.160 40 59  8 0.14 0.10 0.06 cdfhilmrstw * elk01</span><br><span class="line">192.168.100.161 54 30 11 0.55 0.29 0.11 cdfhilmrstw - elk02</span><br><span class="line">192.168.100.162 48 28  8 0.29 0.16 0.06 cdfhilmrstw - elk03</span><br><span class="line">  <span class="comment"># å‚æ•°è§£é‡Šï¼š</span></span><br><span class="line">    ç¬¬ä¸€åˆ—ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„IPåœ°å€ï¼›</span><br><span class="line">    ç¬¬äºŒåˆ—ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„CPUä½¿ç”¨ç‡ï¼›</span><br><span class="line">    ç¬¬ä¸‰åˆ—ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜çš„ä½¿ç”¨ç‡ï¼›</span><br><span class="line">    ç¬¬å››åˆ—ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„æ´»è·ƒåˆ†ç‰‡æ•°é‡ï¼›</span><br><span class="line">    ç¬¬äº”åˆ—ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå¹³å‡è´Ÿè½½ï¼›</span><br><span class="line">    ç¬¬å…­åˆ—ï¼šæ¯ä¸ªèŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­çš„è§’è‰²ï¼›</span><br><span class="line">    ç¬¬ä¸ƒåˆ—ï¼š*ä»£è¡¨ä¸»èŠ‚ç‚¹ï¼›ä¸»èŠ‚ç‚¹è´Ÿè´£ç®¡ç†é›†ç¾¤çš„å…ƒæ•°æ®ã€åˆ†ç‰‡åˆ†é…å’Œé›†ç¾¤çŠ¶æ€ç­‰ä»»åŠ¡ã€‚</span><br><span class="line">    ç¬¬å…«åˆ—ï¼šèŠ‚ç‚¹çš„åç§°</span><br></pre></td></tr></table></figure>


<p>ä¸‰ã€Kibanaå®‰è£…ï¼ˆelk03èŠ‚ç‚¹ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; å®‰è£…kibana</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># yum localinstall -y kibana-7.17.11-x86_64.rpm </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å¤‡ä»½é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># cd /etc/kibana/</span></span><br><span class="line">[root@elk03 kibana]<span class="comment"># cp kibana.yml kibana.yml.bak</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹kibanaé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 kibana]<span class="comment"># egrep -v "^(#|$)" kibana.yml </span></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯å£</span></span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="comment"># ä¸»æœºåœ°å€æˆ–è€…ä¸»æœºå</span></span><br><span class="line">server.host: <span class="string">"0.0.0.0"</span></span><br><span class="line"><span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">server.name: <span class="string">"study-elk-kibana"</span></span><br><span class="line"><span class="comment"># ESä¸»æœºç»„åœ°å€</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">"http://192.168.100.160:9200"</span>,<span class="string">"http://192.168.100.161:9200"</span>,<span class="string">"http://192.168.100.162:9200"</span>]</span><br><span class="line"><span class="comment"># ä¿®æ”¹è¯­è¨€</span></span><br><span class="line">i18n.locale: <span class="string">"zh-CN"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å¯åŠ¨Kibana</span></span><br><span class="line">[root@elk03 kibana]<span class="comment"># systemctl enable --now kibana</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ¸¸è§ˆå™¨IP+5601è®¿é—®</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405291424194.png#id=mXN3G&originHeight=1368&originWidth=2544&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h2 id="å››ã€Logstashå®‰è£…ï¼ˆelk02ï¼‰"><a href="#å››ã€Logstashå®‰è£…ï¼ˆelk02ï¼‰" class="headerlink" title="å››ã€Logstashå®‰è£…ï¼ˆelk02ï¼‰"></a>å››ã€Logstashå®‰è£…ï¼ˆelk02ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; å®‰è£…Logstash</span></span><br><span class="line">[root@elk02 ~]<span class="comment"># yum localinstall -y logstash-7.17.11-x86_64.rpm </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line">[root@elk02 <span class="built_in">local</span>]<span class="comment"># ln -s /usr/share/logstash/bin/logstash   /usr/bin/logstash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ç¼–å†™æµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">[root@elk02 ~]<span class="comment"># mkdir conf-logstash</span></span><br><span class="line">[root@elk02 ~]<span class="comment"># cat  conf-logstash/01-stdin-to-stdout.conf </span></span><br><span class="line">input &#123;</span><br><span class="line"> stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line"> stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•Logstash</span></span><br><span class="line">[root@elk02 ~]<span class="comment"># logstash -f ~/conf-logstash/01-stdin-to-stdout.conf</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40379882/1724775298040-1170b872-9cec-4b44-8a9f-5f4336aad57a.png#averageHue=%23070706&clientId=u75f1b712-9c51-4&from=paste&height=294&id=uf9f627e0&originHeight=294&originWidth=1095&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21705&status=done&style=none&taskId=ud3c9e175-6ee9-419e-8bd5-8122d076e6e&title=&width=1095" alt="image.png"></p>
<h2 id="äº”ã€Filebeatå®‰è£…ï¼ˆelk01ï¼‰"><a href="#äº”ã€Filebeatå®‰è£…ï¼ˆelk01ï¼‰" class="headerlink" title="äº”ã€Filebeatå®‰è£…ï¼ˆelk01ï¼‰"></a>äº”ã€Filebeatå®‰è£…ï¼ˆelk01ï¼‰</h2><p>å¸®åŠ©æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/index.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; å®‰è£…Filebeat</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># yum localinstall -y filebeat-7.17.11-x86_64.rpm </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•Filebeat</span></span><br><span class="line">[root@elk01 opt]<span class="comment"># cd filebeat</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># mkdir filebeat-config</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># cp filebeat.yml  filebeat-config/01-test.yml</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># cat filebeat-config/01-test.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: stdin</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span>    <span class="comment"># å¯åŠ¨ç¾è§‚æ ¼å¼è¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># filebeat -e -c /opt/filebeat/filebeat-config/01-test.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405291142027.png#from=url&id=FZw9q&originHeight=1186&originWidth=1471&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" alt></p>
<h4 id="1ã€Filebeatæ¶æ„"><a href="#1ã€Filebeatæ¶æ„" class="headerlink" title="1ã€Filebeatæ¶æ„"></a>1ã€Filebeatæ¶æ„</h4><p>æ¶æ„å›¾ï¼š<br>    Inputï¼ˆæ•°æ®æºï¼‰æ”¶é›†æ–¹å¼ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/configuration-filebeat-options.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/configuration-filebeat-options.html</a><br>    Outputï¼ˆè¾“å‡ºåœ°ï¼‰æ¨é€æ–¹å¼ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/configuring-output.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/configuring-output.html</a><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405291516016.png#id=NuwUn&originHeight=658&originWidth=1714&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h2 id="å…­ã€Filebeatæ—¥å¿—æ”¶é›†"><a href="#å…­ã€Filebeatæ—¥å¿—æ”¶é›†" class="headerlink" title="å…­ã€Filebeatæ—¥å¿—æ”¶é›†"></a>å…­ã€Filebeatæ—¥å¿—æ”¶é›†</h2><p><code>Input</code>æ–¹å¼ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-input-stdin.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-input-stdin.html</a></p>
<h4 id="1ã€Filebeatæ ‡å‡†è¾“å…¥å’Œè¾“å‡º"><a href="#1ã€Filebeatæ ‡å‡†è¾“å…¥å’Œè¾“å‡º" class="headerlink" title="1ã€Filebeatæ ‡å‡†è¾“å…¥å’Œè¾“å‡º"></a>1ã€Filebeatæ ‡å‡†è¾“å…¥å’Œè¾“å‡º</h4><p>â€‹    æ ‡å‡†è¾“å…¥å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-input-stdin.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-input-stdin.html</a><br>â€‹    æ ‡å‡†è¾“å‡ºå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/console-output.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/console-output.html</a><br>â€‹    <strong>ç®€ä»‹</strong>ï¼šä½¿ç”¨ç»ˆç«¯è¾“å…¥ä»æ ‡å‡†è¾“å…¥è¯»å–äº‹ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºFilebeaté…ç½®æ–‡ä»¶æµ‹è¯•ç›®å½•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># mkdir filebeat-config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/01-stdin-on-stdout.yml </span></span><br><span class="line"><span class="comment"># æŒ‡å®šè¾“å…¥ç±»å‹</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">  <span class="comment"># ç»ˆç«¯æ ‡å‡†è¾“å…¥</span></span><br><span class="line">- <span class="built_in">type</span>: stdin</span><br><span class="line"><span class="comment"># æ ‡å‡†è¾“å‡ºç±»å‹ï¼šç»ˆç«¯è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  <span class="comment">#å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™å†™å…¥ stdout çš„äº‹ä»¶å°†é‡‡ç”¨è‰¯å¥½çš„æ ¼å¼ã€‚é»˜è®¤å€¼ä¸º falseã€‚</span></span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c /root/filebeat-config/01-stdin-on-stdout.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292047924.png#from=url&id=lfzKX&originHeight=1267&originWidth=1816&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" alt></p>
<h4 id="2ã€-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥"><a href="#2ã€-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥" class="headerlink" title="2ã€ Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥"></a>2ã€ Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥</h4><p>â€‹    <code>Log</code>æ–¹å¼ç±»å‹è¾“å…¥ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-input-log.html#input-paths" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-input-log.html#input-paths</a><br>â€‹    <strong>ç®€ä»‹</strong>ï¼š <code>Logç±»å‹</code>è¾“å…¥å°†æ—¥å¿—æ–‡ä»¶å‘é€åˆ°è¾“å‡ºã€‚ä½¿ç”¨è¾“å…¥ä»æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–è¡Œã€‚æ­¤ç±»å‹<code>[ 7.16.0 ]</code>ç‰ˆæœ¬ä»¥ååºŸå¼ƒï¼Œæ¨èä½¿ç”¨<code>filestream input</code>ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; ç¼–å†™Logç±»å‹æ—¥å¿—è¾“å…¥æµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/02-log-on-stdout.yml </span></span><br><span class="line"><span class="comment"># æŒ‡å®šè¾“å…¥ç±»å‹</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line"><span class="comment"># æ—¥å¿—è¾“å…¥ç±»å‹</span></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  <span class="comment"># æ—¥å¿—å­˜æ”¾è·¯å¾„</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/messages</span><br><span class="line">    - /var/<span class="built_in">log</span>/*.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; è®¾ç½®æ ‡å‡†ç»ˆç«¯è¾“å‡ºè‡³å±å¹•</span></span><br><span class="line">output.console:</span><br><span class="line">  <span class="comment">#å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™å†™å…¥stdoutçš„äº‹ä»¶å°†é‡‡ç”¨è‰¯å¥½çš„æ ¼å¼ã€‚é»˜è®¤å€¼ä¸º falseã€‚</span></span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æµ‹è¯•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c /root/filebeat-config/02-log-on-stdout.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292111651.png#id=xCb24&originHeight=1048&originWidth=2017&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="2-1-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰å­—æ®µ"><a href="#2-1-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰å­—æ®µ" class="headerlink" title="2.1 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰å­—æ®µ"></a><strong>2.1 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰å­—æ®µ</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]<span class="comment"># vim  filebeat-config/02-log-on-stdout.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/messages</span><br><span class="line">  <span class="comment"># å¼€å¯è‡ªå®šä¹‰å­—æ®µ</span></span><br><span class="line">  fields:</span><br><span class="line">    <span class="comment"># æ·»åŠ è‡ªå®šä¹‰å­—æ®µ</span></span><br><span class="line">    log_type: system</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  <span class="comment"># å¼€å¯è‡ªå®šä¹‰å­—æ®µ</span></span><br><span class="line">  fields:</span><br><span class="line">    <span class="comment"># å¼€å¯è‡ªå®šä¹‰å­—æ®µ</span></span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ¸…é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># filebeat  -e -c /root/filebeat-config/02-log-on-stdout.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292301452.png#id=f6HAq&originHeight=691&originWidth=1962&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<blockquote>
<p>æ³¨æ„ï¼š<br>    å¦‚æœfields_under_rootè®¾ç½®ä¸ºtrueï¼Œåˆ™è‡ªå®šä¹‰å­—æ®µå°†ä½œä¸ºé¡¶çº§å­—æ®µå­˜å‚¨åœ¨è¾“å‡ºæ–‡æ¡£ä¸­ï¼Œè€Œä¸æ˜¯åˆ†ç»„åœ¨å­—æ®µå­å­—å…¸ä¸‹ã€‚å¦‚æœè‡ªå®šä¹‰å­—æ®µåç§°ä¸Filebeatæ·»åŠ çš„å…¶ä»–å­—æ®µåç§°å†²çªï¼Œåˆ™è‡ªå®šä¹‰å­—æ®µå°†è¦†ç›–å…¶ä»–å­—æ®µã€‚æ•ˆæœå›¾å¦‚ä¸‹ï¼š<br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292336305.png#from=url&id=Qq88e&originHeight=757&originWidth=1828&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" alt></p>
</blockquote>
<h5 id="2-2-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰Tags"><a href="#2-2-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰Tags" class="headerlink" title="2.2 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰Tags"></a><strong>2.2 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å¹¶ä¸”è‡ªå®šä¹‰Tags</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]<span class="comment"># vim  filebeat-config/02-log-on-stdout.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/messages</span><br><span class="line">  <span class="comment"># å¯¹å½“å‰çš„è¾“å…¥æ—¥å¿—æ–‡ä»¶ï¼ŒæŒ‡å®šç‹¬æœ‰çš„æ ‡ç­¾</span></span><br><span class="line">  tags: [<span class="string">"system logs"</span>,<span class="string">""</span>,<span class="string">""</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: system</span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  <span class="comment"># å¯¹å½“å‰çš„è¾“å…¥æ—¥å¿—æ–‡ä»¶ï¼ŒæŒ‡å®šç‹¬æœ‰çš„æ ‡ç­¾ </span></span><br><span class="line">  tags: [<span class="string">"nginx access_log"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># &gt; /var/lib/filebeat/registry/filebeat/log.json </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># filebeat  -e -c /root/filebeat-config/02-log-on-stdout.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292322333.png#id=UMxF5&originHeight=1077&originWidth=2002&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<blockquote>
<p>å¯¹äºTagsçš„è®¾å®šï¼Œå°†Filebeatæ”¶é›†åˆ°çš„æ—¥å¿—è½¬å‘è‡³ESé›†ç¾¤æ—¶ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„Tagè®¾ç½®ä¸åŒçš„ç´¢å¼•ï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚</p>
</blockquote>
<h5 id="2-3-offsetåç§»é‡æ¦‚å¿µ"><a href="#2-3-offsetåç§»é‡æ¦‚å¿µ" class="headerlink" title="2.3 offsetåç§»é‡æ¦‚å¿µ"></a>2.3 offsetåç§»é‡æ¦‚å¿µ</h5><p><strong>ç®€ä»‹</strong>ï¼šåç§»é‡ï¼ˆoffsetï¼‰åœ¨ Filebeat ä¸­æŒ‡çš„æ˜¯æ–‡ä»¶è¯»å–ä½ç½®çš„æ ‡è®°ï¼Œç”¨äºè¿½è¸ªæ–‡ä»¶ä¸­çš„è¯»å–è¿›åº¦ã€‚<br>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ“ä½œåç§»é‡ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å‡å¦‚æƒ³è¦<code>é‡æ–°è¯»å–</code>ä¸€ä¸ª<code>æ—¥å¿—æ–‡ä»¶</code>ï¼Œå¯ä»¥åˆ é™¤å¯¹åº”çš„æ³¨å†Œè¡¨æ¡ç›®æˆ–è€…ç¼–è¾‘åç§»é‡å€¼ã€‚æ³¨æ„ï¼šè¯·ç¡®ä¿ Filebeat æš‚åœè¿è¡ŒæœŸé—´è¿›è¡Œè¿™äº›æ“ä½œä»¥é˜²æ­¢å†²çªã€‚</li>
</ul>
<p><code>RPMæ–¹å¼</code>å®‰è£…çš„Filebeat offsetå­˜æ”¾è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢ç›®å½•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cd  /var/lib/filebeat/registry/filebeat/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡ä»¶</span></span><br><span class="line">[root@elk01 filebeat]<span class="comment"># ls</span></span><br><span class="line">log.json  meta.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤åç§»é‡æ–‡ä»¶ï¼Œå¯åŠ¨Filebeaté‡æ–°è¯»å–æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk01 registry]<span class="comment"># &gt; log.json</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>log.json</code>ä¸ºåç§»é‡å­˜æ”¾æ–‡ä»¶ã€‚æ¸…ç©ºåç§»é‡åï¼Œå†æ¬¡å¯åŠ¨Filebeatä¼š<code>é‡æ–°è¯»å–æ—¥å¿—æ–‡ä»¶</code>ã€‚</p>
</blockquote>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292210601.png#id=Q39yO&originHeight=135&originWidth=2296&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><strong>æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆFilebeatéœ€è¦è®¾ç½®è¿™ä¸ªåç§»é‡ï¼Ÿ</strong></p>
<h5 id="2-4-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°æ—¥å¿—åˆ é™¤"><a href="#2-4-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°æ—¥å¿—åˆ é™¤" class="headerlink" title="2.4 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°æ—¥å¿—åˆ é™¤"></a>2.4 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°æ—¥å¿—åˆ é™¤</h5><p>æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/regexp-support.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/regexp-support.html</a><br>    <strong>ç®€ä»‹</strong>ï¼š<code>exclude_lines</code>ä¸è¦Filebeatæ’é™¤çš„è¡ŒåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨ã€‚Filebeatå°†åˆ é™¤åˆ—è¡¨ä¸­ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ‰€æœ‰è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä¼šåˆ é™¤ä»»ä½•è¡Œã€‚ç©ºè¡Œå°†è¢«å¿½ç•¥ã€‚å¦‚æœè¿˜æŒ‡å®šäº†å¤šè¡Œè®¾ç½®ï¼Œåˆ™åœ¨é€šè¿‡exclude_linesè¿‡æ»¤è¡Œä¹‹å‰ï¼Œæ¯æ¡å¤šè¡Œæ¶ˆæ¯éƒ½å°†åˆå¹¶ä¸ºä¸€è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–å†™æµ‹è¯•æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cat &gt;&gt; /tmp/test.log &lt;&lt; EOF</span></span><br><span class="line">hi cloud</span><br><span class="line">hello world</span><br><span class="line">Hello cloud</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™Filebeaté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/03-log-exclude-stdin.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/test.log</span><br><span class="line">  tags: [<span class="string">"test"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: <span class="built_in">test</span></span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># åˆ é™¤ä»¥helloå¼€å¤´çš„è¡Œï¼Œæ³¨æ„åŒºåˆ†å¤§å°å†™</span></span><br><span class="line">  exclude_lines: [<span class="string">'^hello'</span>,<span class="string">'^haha'</span>,<span class="string">'^lala'</span>]</span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c /root/filebeat-config/03-log-exclude-stdin.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292358366.png#from=url&id=lsydL&originHeight=1264&originWidth=1980&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" alt><br><strong>æŸ¥çœ‹offsetåç§»é‡</strong><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292359570.png#id=B1zCR&originHeight=144&originWidth=2299&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><strong>æŸ¥çœ‹æ–‡ä»¶å­—ç¬¦</strong><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405292359075.png#id=DvN9D&originHeight=100&originWidth=1249&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<blockquote>
<p>æ­¤å‚æ•°æ˜¯åœ¨è¯¥æ—¥å¿—æ–‡ä»¶é˜…è¯»å®Œæˆä»¥åï¼Œåœ¨è¿›è¡Œè¿‡æ»¤åˆ é™¤ï¼Œæ•…åœ¨offsetæ–‡ä»¶ä¸­è¿˜æ˜¯æœ‰æ‰€ä½“ç°ã€‚</p>
</blockquote>
<h5 id="2-5-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°åŒ¹é…æ—¥å¿—è¾“å‡º"><a href="#2-5-Filebeat-åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°åŒ¹é…æ—¥å¿—è¾“å‡º" class="headerlink" title="2.5 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°åŒ¹é…æ—¥å¿—è¾“å‡º"></a>2.5 Filebeat åŸºäºLogç±»å‹è¿›è¡Œè¾“å…¥å®ç°åŒ¹é…æ—¥å¿—è¾“å‡º</h5><p>æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/regexp-support.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/regexp-support.html</a><br><strong>ç®€ä»‹</strong>ï¼š<code>include_lines</code>å¸Œæœ›FilebeatåŒ…å«çš„è¡Œç›¸åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨ã€‚Filebeatä»…å¯¼å‡ºä¸åˆ—è¡¨ä¸­æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†å¯¼å‡ºæ‰€æœ‰è¡Œã€‚ç©ºè¡Œå°†è¢«å¿½ç•¥ã€‚å¦‚æœè¿˜æŒ‡å®šäº†å¤šè¡Œè®¾ç½®ï¼Œåˆ™åœ¨é€šè¿‡include_linesè¿‡æ»¤è¡Œä¹‹å‰ï¼Œæ¯æ¡å¤šè¡Œæ¶ˆæ¯å°†åˆå¹¶ä¸ºä¸€è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡†å¤‡æµ‹è¯•æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cat &gt;&gt;/tmp/test02.log  &lt;&lt;EOF</span></span><br><span class="line">ERR haha</span><br><span class="line">WARN haha</span><br><span class="line">info haha</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™Filebeatæµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/04-log-include-stdin.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/test02.log</span><br><span class="line">  tags: [<span class="string">"test"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: <span class="built_in">test</span></span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># åªè¿‡æ»¤å‡ºä»¥ERR WARNçš„è¡Œï¼ŒåŒºåˆ†å¤§å°å†™</span></span><br><span class="line">  include_lines: [<span class="string">'^ERR'</span>,<span class="string">'^WARN'</span>]</span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat -e -c  /root/filebeat-config/04-log-include-stdin.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300017494.png#from=url&id=tK5b7&originHeight=850&originWidth=1818&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=" alt></p>
<h5 id="2-6-include-lineså’Œexclude-linesä¼˜å…ˆçº§"><a href="#2-6-include-lineså’Œexclude-linesä¼˜å…ˆçº§" class="headerlink" title="2.6 include_lineså’Œexclude_linesä¼˜å…ˆçº§"></a>2.6 include_lineså’Œexclude_linesä¼˜å…ˆçº§</h5><p>â€‹    å¦‚æœåŒæ—¶å®šä¹‰äº†<code>include_lines</code>å’Œ<code>exclude_lines</code>ï¼Œåˆ™Filebeaté¦–å…ˆæ‰§è¡Œ<code>include_lines</code>ï¼Œç„¶åæ‰§è¡Œ<code>exclude_line</code>ã€‚å®šä¹‰è¿™ä¸¤ä¸ªé€‰é¡¹çš„é¡ºåºæ— å…³ç´§è¦ã€‚<code>include_lines</code>é€‰é¡¹å°†å§‹ç»ˆåœ¨<code>exclude_lines</code>é€‰é¡¹ä¹‹å‰æ‰§è¡Œï¼Œå³ä½¿<code>exclude_line</code>å‡ºç°åœ¨é…ç½®æ–‡ä»¶ä¸­çš„<code>include_lines</code>ä¹‹å‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<h5 id="2-7-Nginx-erroræ—¥å¿—è¿‡æ»¤å¤„ç†å®æˆ˜"><a href="#2-7-Nginx-erroræ—¥å¿—è¿‡æ»¤å¤„ç†å®æˆ˜" class="headerlink" title="2.7 Nginx erroræ—¥å¿—è¿‡æ»¤å¤„ç†å®æˆ˜"></a>2.7 Nginx erroræ—¥å¿—è¿‡æ»¤å¤„ç†å®æˆ˜</h5><p><strong>ç®€ä»‹</strong>ï¼šåœ¨å…¬å¸ä¸­ï¼Œå¯¹äºåº”ç”¨çš„é”™è¯¯æ—¥å¿—ä¸€èˆ¬åªå…³å¿ƒåŒ…å«<code>error</code>ç­‰ç›¸å…³å†…å®¹çš„è¡Œï¼Œå…¶å®ƒçš„æˆ‘ä»¬éƒ½éœ€è¦å¯¹å…¶è¿›è¡Œè¿‡æ»¤å¤„ç†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; ç¼–å†™æµ‹è¯•æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim  /var/log/nginx/error.log </span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: worker process 976 exited with code 0</span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: signal 29 (SIGIO) received</span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: signal 17 (SIGCHLD) received from 977</span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: worker process 977 exited with code 0</span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: signal 17 (SIGCHLD) received from 975</span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: worker process 975 exited with code 0</span></span><br><span class="line">2024/05/30 01:55:13 [notice] 967<span class="comment">#967: exit</span></span><br><span class="line">2024/05/30 01:55:33 [emerg] 2359<span class="comment">#2359: unexpected "&#125;" in /etc/nginx/nginx.conf:11</span></span><br><span class="line">2024/05/30 01:55:16 [emerg] 2384<span class="comment">#2384: "access_log" directive is not allowed here in /etc/nginx/nginx.conf:22</span></span><br><span class="line">2024/05/30 01:55:41 [notice] 2396<span class="comment">#2396: using the "epoll" event method</span></span><br><span class="line">2024/05/30 01:55:41 [notice] 2396<span class="comment">#2396: nginx/1.24.0</span></span><br><span class="line">2024/05/30 01:55:41 [notice] 2396<span class="comment">#2396: built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) </span></span><br><span class="line">2024/05/30 01:55:41 [notice] 2396<span class="comment">#2396: OS: Linux 3.10.0-1160.el7.x86_64</span></span><br><span class="line">2024/05/30 01:55:41 [notice] 2396<span class="comment">#2396: getrlimit(RLIMIT_NOFILE): 1024:4096</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ç¼–å†™Filebeatæµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/05-log-nginx-error-stdin.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">  tags: [<span class="string">"nginx_error"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_error</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  include_lines: [<span class="string">'\[emerg\]'</span>]</span><br><span class="line"></span><br><span class="line">output.console:</span><br><span class="line">  pretty: <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#&gt;&gt;&gt; å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat -e -c /root/filebeat-config/05-log-nginx-error-stdin.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300034705.png#id=PKtHd&originHeight=621&originWidth=2215&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="2-8-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤"><a href="#2-8-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤" class="headerlink" title="2.8 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤"></a>2.8 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤</h5><p>å®˜æ–¹é“¾æ¥ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/elasticsearch-output.html#elasticsearch-output" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/elasticsearch-output.html#elasticsearch-output</a><br>    ç®€ä»‹ï¼šElasticsearchè¾“å‡ºä½¿ç”¨Elasticsearch <code>HTTP API</code>å°†äº‹ä»¶ç›´æ¥å‘é€åˆ°Elasticearchã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–å†™Filebeaté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/06-log-nginx-access-es.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"nginx_access"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºè‡³ESé›†ç¾¤</span></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  <span class="comment"># ESé›†ç¾¤åœ°å€</span></span><br><span class="line">  hosts: [<span class="string">"http://192.168.174.140:9200"</span>,<span class="string">"http://192.168.174.141:9200"</span>,<span class="string">"http://192.168.174.142:9200"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c /root/filebeat-config/06-log-nginx-access-es.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300051042.png#id=b1B1L&originHeight=457&originWidth=2308&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><strong>KibanaæŸ¥çœ‹ESæ•°æ®</strong><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300053155.png#id=M9HFQ&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300053167.png#id=J99r5&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300054359.png#id=i3BKi&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300056067.png" alt></p>
<blockquote>
<p>é€šè¿‡ç´¢å¼•æ¨¡å¼æ¥åŒ¹é…ç´¢å¼•</p>
</blockquote>
<img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300059360.png">
![](https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300059590.png#id=b38Ds&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none)



<h5 id="2-9-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å•ä¸ªç´¢å¼•"><a href="#2-9-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å•ä¸ªç´¢å¼•" class="headerlink" title="2.9 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å•ä¸ªç´¢å¼•"></a>2.9 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å•ä¸ªç´¢å¼•</h5><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/elasticsearch-output.html#index-option-es" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/elasticsearch-output.html#index-option-es</a><br>    <strong>ç®€ä»‹</strong>ï¼šä½¿ç”¨æ¯æ—¥ç´¢å¼•æ—¶è¦å°†äº‹ä»¶å†™å…¥çš„ç´¢å¼•åç§°ã€‚é»˜è®¤å€¼ä¸ºâ€œfilebeat-%ï½›[agent.version]ï½-%ï½›+yyyy.MM.ddï½â€ï¼Œä¾‹å¦‚â€œfilebeat-7.17.21-2024-05-22â€ã€‚<code>åœ¨å…¬å¸ä¸­ä¸€èˆ¬ä¼šæ ¹æ®æ—¥å¿—çš„ç±»å‹è®¾ç½®ä¸åŒçš„ç´¢å¼•</code>ã€‚ä½†æ˜¯å¦‚æœéœ€è¦è‡ªå®šä»¥ç´¢å¼•ï¼Œéœ€è¦æŠŠç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ç»™ç¦ç”¨æ‰<code>setup.ilm.enabled: false</code>ï¼Œå¦åˆ™è‡ªå®šä»¥ç´¢å¼•æ— æ³•ç”Ÿæ•ˆã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–å†™Filebeatæµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/07-log-nginx-access-es.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"nginx_access"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">"http://192.168.174.140:9200"</span>,<span class="string">"http://192.168.174.141:9200"</span>,<span class="string">"http://192.168.174.142:9200"</span>]</span><br><span class="line">  index: <span class="string">"web-nginx-access-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line"><span class="comment"># ç¦ç”¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åç§°</span></span><br><span class="line">setup.template.name: <span class="string">"web"</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åŒ¹é…æ¨¡å¼ </span></span><br><span class="line">setup.template.pattern: <span class="string">"web*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat -e -c  /root/filebeat-config/07-log-nginx-access-es.yml</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>å‚æ•°è§£é‡Šï¼š</strong><br>setup.ilm.enabled: false        #  ç¦ç”¨äº† Filebeat çš„ ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œ ILM æ˜¯ Elasticsearch æä¾›çš„ä¸€ç§åŠŸèƒ½ï¼Œç”¨äºè‡ªåŠ¨ç®¡ç†ç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸã€‚é€šè¿‡ ILMï¼Œç®¡ç†å‘˜å¯ä»¥å®šä¹‰ç´¢å¼•çš„åˆ›å»ºã€æ»šåŠ¨ï¼ˆå¦‚æ¯å¤©åˆ›å»ºä¸€ä¸ªæ–°ç´¢å¼•ï¼‰ã€è¿ç§»ï¼ˆå¦‚å°†æ•°æ®ä»çƒ­èŠ‚ç‚¹è¿ç§»åˆ°å†·èŠ‚ç‚¹ï¼‰ã€å½’æ¡£å’Œåˆ é™¤ç­‰æ“ä½œã€‚<br>setup.template.name: â€œwebâ€    #  æŒ‡å®šäº† Filebeatåˆ›å»ºçš„ç´¢å¼•æ¨¡æ¿çš„åç§°ã€‚ç´¢å¼•æ¨¡æ¿å®šä¹‰äº† Elasticsearch ä¸­æ–°åˆ›å»ºçš„ç´¢å¼•çš„é»˜è®¤è®¾ç½®å’Œæ˜ å°„ã€‚æ¯å½“ä¸€ä¸ªæ–°ç´¢å¼•ä¸æŒ‡å®šçš„æ¨¡æ¿æ¨¡å¼åŒ¹é…æ—¶ï¼ŒElasticsearch ä¼šåº”ç”¨è¯¥æ¨¡æ¿ä¸­çš„è®¾ç½®å’Œæ˜ å°„è§„åˆ™ã€‚<br>setup.template.pattern: web #  å®šä¹‰ç´¢å¼•æ¨¡æ¿çš„ åŒ¹é…æ¨¡å¼ã€‚  webï¼šè¡¨ç¤º Filebeatåˆ›å»ºçš„æ‰€æœ‰ç´¢å¼•åç§°ä¸­ï¼Œåªè¦ç¬¦åˆ webçš„æ¨¡å¼ï¼Œéƒ½ä¼šä½¿ç”¨åä¸º webçš„æ¨¡æ¿ã€‚ æ˜¯é€šé…ç¬¦ï¼Œè¡¨ç¤ºä»»æ„å­—ç¬¦ã€‚</p>
</blockquote>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300145654.png#id=GlOsK&originHeight=186&originWidth=2311&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><strong>kibanaæ“ä½œå’ŒæŸ¥çœ‹</strong><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300145138.png#id=G65HQ&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300146998.png#id=c4WDn&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300146229.png#id=XsxCy&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300146120.png#id=kIljc&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300147625.png#id=Bux5a&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300147139.png#id=W7lQm&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300148550.png#id=gJChe&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300149819.png#id=kOa4s&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300149995.png#id=DjuYD&originHeight=1417&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="2-10-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å¤šä¸ªç´¢å¼•"><a href="#2-10-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å¤šä¸ªç´¢å¼•" class="headerlink" title="2.10 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å¤šä¸ªç´¢å¼•"></a>2.10 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è‡ªå®šä¹‰å¤šä¸ªç´¢å¼•</h5><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/elasticsearch-output.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/elasticsearch-output.html</a><br><strong>ç®€ä»‹</strong>ï¼šæ¯ä¸ªè§„åˆ™éƒ½æŒ‡å®šç”¨äºä¸è¯¥è§„åˆ™åŒ¹é…çš„äº‹ä»¶çš„ç´¢å¼•ã€‚åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ï¼ŒFilebeatä½¿ç”¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªåŒ¹é…è§„åˆ™ã€‚è§„åˆ™å¯ä»¥åŒ…å«æ¡ä»¶ã€åŸºäºå­—ç¬¦ä¸²çš„å­—æ®µæ ¼å¼å’Œåç§°æ˜ å°„ã€‚å¦‚æœç¼ºå°‘ç´¢å¼•è®¾ç½®æˆ–æ²¡æœ‰åŒ¹é…çš„è§„åˆ™ï¼Œåˆ™ä½¿ç”¨ç´¢å¼•è®¾ç½®ã€‚ä¸ç´¢å¼•ç±»ä¼¼ï¼Œå®šä¹‰è‡ªå®šä¹‰ç´¢å¼•å°†ç¦ç”¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; ç¼–å†™Filebeaté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/08-log-nginx-log-es.yml </span></span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/.<span class="built_in">log</span></span><br><span class="line">  tags: [<span class="string">"nginx_access"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">  tags: [<span class="string">"nginx_error"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_error</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  include_lines: [<span class="string">'\[emerg\]'</span>]</span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">"http://192.168.174.140:9200"</span>,<span class="string">"http://192.168.174.141:9200"</span>,<span class="string">"http://192.168.174.142:9200"</span>] </span><br><span class="line">  indices:</span><br><span class="line">    <span class="comment"># ç´¢å¼•åç§°</span></span><br><span class="line">    - index: <span class="string">"web-nginx-access-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">      <span class="comment"># åŒ¹é…æ ‡ç­¾</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">"nginx_access"</span></span><br><span class="line">    <span class="comment"># ç´¢å¼•åç§°</span></span><br><span class="line">    - index: <span class="string">"web-nginx-error-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">      <span class="comment"># åŒ¹é…æ ‡ç­¾</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">"nginx_error"</span></span><br><span class="line"><span class="comment"># ç¦ç´¢å¼•å‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åç§°</span></span><br><span class="line">setup.template.name: <span class="string">"web"</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åŒ¹é…æ¨¡å¼ </span></span><br><span class="line">setup.template.pattern: <span class="string">"web*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat -e -c /root/filebeat-config/08-log-nginx-log-es.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300740915.png#id=JynSZ&originHeight=93&originWidth=2309&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><strong>kibanaæ“ä½œå’ŒæŸ¥çœ‹</strong><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300741244.png#id=kqKes&originHeight=1339&originWidth=2558&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300741426.png#id=nzAhr&originHeight=1399&originWidth=2557&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300741233.png#id=mgB03&originHeight=1389&originWidth=2556&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" style="zoom:67%;"><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300743134.png#id=PIKA3&originHeight=1106&originWidth=2552&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405300743612.png#id=vqoCm&originHeight=856&originWidth=2556&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<blockquote>
<p>æ³¨æ„ï¼šæ—¥å¿—æ˜¯ä»¥ç´¢å¼•çš„æ–¹å¼å†™å…¥çš„ï¼</p>
</blockquote>
<h5 id="2-11-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è®¾å®šå‰¯æœ¬åˆ†ç‰‡"><a href="#2-11-Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è®¾å®šå‰¯æœ¬åˆ†ç‰‡" class="headerlink" title="2.11 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è®¾å®šå‰¯æœ¬åˆ†ç‰‡"></a>2.11 Filebeatè¾“å‡ºæ•°æ®è‡³Elasticsearché›†ç¾¤å¹¶è®¾å®šå‰¯æœ¬åˆ†ç‰‡</h5><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/configuration-template.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/configuration-template.html</a><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302048641.png#id=QwD2a&originHeight=846&originWidth=1361&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><strong>ç®€ä»‹</strong>ï¼š</p>
<ul>
<li><code>index.number_of_shards: 3</code>ï¼šä¸»åˆ†ç‰‡ï¼ˆprimary shardï¼‰æ˜¯å°†æ•°æ®åˆ†å‰²æˆè¾ƒå°éƒ¨åˆ†ä»¥ä¾¿åˆ†å¸ƒå­˜å‚¨å’ŒåŸºç¡€å•ä½ã€‚è®¾ç½®ä¸»åˆ†ç‰‡æ•°ä¸º3æ„å‘³ç€æ¯ä¸ªç´¢å¼•å°†åˆ†æˆ3ä¸ªä¸»åˆ†ç‰‡ã€‚ä¸»åˆ†ç‰‡çš„æ•°é‡åœ¨ç´¢å¼•åˆ›å»ºåæ— æ³•æ›´æ”¹ã€‚</li>
<li><code>index.number_of_replicas: 1</code>ï¼šå‰¯æœ¬åˆ†ç‰‡ï¼ˆreplica shardï¼‰æ˜¯ä¸»åˆ†ç‰‡çš„å‰¯æœ¬ï¼Œç”¨äºæä¾›é«˜å¯ç”¨æ€§å’Œæ•…éšœæ¢å¤èƒ½åŠ›ã€‚å¦‚æœä¸»åˆ†ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹æ•…éšœï¼Œå‰¯æœ¬åˆ†ç‰‡å¯ä»¥ä½œä¸ºå¤‡ä»½ç»§ç»­æä¾›æ•°æ®æœåŠ¡ã€‚è®¾ç½®å‰¯æœ¬åˆ†ç‰‡æ•°ä¸º1æ„å‘³ç€æ¯ä¸ªä¸»åˆ†ç‰‡å°†æœ‰1ä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–å†™Filebeatæµ‹è¯•æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/09-log-nginx-log-shard-es.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"nginx_access"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">  tags: [<span class="string">"nginx_error"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_error</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  include_lines: [<span class="string">'\[emerg\]'</span>]</span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">"http://192.168.174.140:9200"</span>,<span class="string">"http://192.168.174.141:9200"</span>,<span class="string">"http://192.168.174.142:9200"</span>] </span><br><span class="line">  indices:</span><br><span class="line">    <span class="comment"># ç´¢å¼•åç§°</span></span><br><span class="line">    - index: <span class="string">"web-nginx-access-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">      <span class="comment"># åŒ¹é…æ ‡ç­¾</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">"nginx_access"</span></span><br><span class="line">    <span class="comment"># ç´¢å¼•åç§°</span></span><br><span class="line">    - index: <span class="string">"web-nginx-error-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">      <span class="comment"># åŒ¹é…æ ‡ç­¾</span></span><br><span class="line">      when.contains:</span><br><span class="line">        tags: <span class="string">"nginx_error"</span></span><br><span class="line"><span class="comment"># ç¦ç´¢å¼•å‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åç§°</span></span><br><span class="line">setup.template.name: <span class="string">"web"</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åŒ¹é…æ¨¡å¼ </span></span><br><span class="line">setup.template.pattern: <span class="string">"web*"</span></span><br><span class="line"><span class="comment"># é…ç½®ç´¢å¼•æ¨¡æ¿</span></span><br><span class="line">setup.template.settings:</span><br><span class="line">  <span class="comment"># è®¾ç½®åˆ†ç‰‡æ•°é‡</span></span><br><span class="line">  index.number_of_shards: 3</span><br><span class="line">  <span class="comment"># è®¾ç½®å‰¯æœ¬æ•°é‡ï¼Œè¦æ±‚å°äºé›†ç¾¤çš„æ•°é‡</span></span><br><span class="line">  index.number_of_replicas: 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat -e -c /root/filebeat-config/09-log-nginx-error-shard-es.yml</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼šä¸‰åˆ†ç‰‡ä¸€å‰¯æœ¬ï¼Œè¡¨ç¤ºæ¯ä¸ªä¸»åˆ†ç‰‡éƒ½ä¼šæœ‰ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œåˆ†ç‰‡æ•°é‡ä¸€æ—¦ç¡®å®šï¼Œä¸èƒ½ä¿®æ”¹(ç¼©å®¹/æ‰©å®¹)ã€‚ä¼šå¯¼è‡´æ•°æ®æ— æ³•æŸ¥æ‰¾ã€‚å‰¯æœ¬åˆ†ç‰‡å¯ä»¥æ‰©å®¹ã€‚</strong></p>
</blockquote>
</li>
</ul>
<p><code>è®°å¾—æŠŠåŸæœ‰çš„æ¨¡æ¿ç»™åˆ é™¤æ‰ï¼Œå¦åˆ™åˆ†ç‰‡å’Œå‰¯æœ¬æ•°é‡æ— æ³•ä¿®æ”¹æˆåŠŸ</code><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302104084.png#id=olh8D&originHeight=1530&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302104604.png#id=VZdWu&originHeight=1530&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="2-12-FIlebeat-æ”¶é›†JSONæ ¼å¼çš„nginxè®¿é—®æ—¥å¿—"><a href="#2-12-FIlebeat-æ”¶é›†JSONæ ¼å¼çš„nginxè®¿é—®æ—¥å¿—" class="headerlink" title="2.12 FIlebeat æ”¶é›†JSONæ ¼å¼çš„nginxè®¿é—®æ—¥å¿—"></a>2.12 FIlebeat æ”¶é›†JSONæ ¼å¼çš„nginxè®¿é—®æ—¥å¿—</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…nginx</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim /etc/yum.repos.d/nginx.repo</span></span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># yum install -y nginx</span></span><br><span class="line"><span class="comment"># å¯åŠ¨nginx</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># systemctl enable --now nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹nginxè®¿é—®æ—¥å¿—æ ¼å¼</span></span><br><span class="line">[root@elk-01 ~]<span class="comment"># vim /etc/nginx/nginx.conf </span></span><br><span class="line">Â·Â·Â·</span><br><span class="line">   log_format  test_nginx_json <span class="string">'&#123;"@timestamp":"$time_iso8601",'</span></span><br><span class="line">                                <span class="string">'"host":"$server_addr",'</span></span><br><span class="line">                                <span class="string">'"clientip":"$remote_addr",'</span></span><br><span class="line">                                <span class="string">'"SendBytes":$body_bytes_sent,'</span></span><br><span class="line">                                <span class="string">'"responsetime":$request_time,'</span></span><br><span class="line"> </span><br><span class="line">   <span class="string">'"upstreamtime":"$upstream_response_time",'</span></span><br><span class="line">                                <span class="string">'"upstreamhost":"$upstream_addr",'</span></span><br><span class="line">                                <span class="string">'"http_host":"$host",'</span></span><br><span class="line">                                <span class="string">'"uri":"$uri",'</span></span><br><span class="line">                                <span class="string">'"domain":"$host",'</span></span><br><span class="line">                                <span class="string">'"xff":"$http_x_forwarded_for",'</span></span><br><span class="line">                                <span class="string">'"referer":"$http_referer",'</span></span><br><span class="line">                                <span class="string">'"tcp_xff":"$proxy_protocol_addr",'</span></span><br><span class="line">                                <span class="string">'"http_user_agent":"$http_user_agent",'</span></span><br><span class="line">                                <span class="string">'"status":"$status"&#125;'</span>;</span><br><span class="line">      access_log  /var/<span class="built_in">log</span>/nginx/access.log  test_nginx_json;</span><br><span class="line">Â·Â·Â·</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥è¯­æ³•æ ¼å¼</span></span><br><span class="line">[root@elk-01 ~]<span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯nginx</span></span><br><span class="line">[root@elk-01 ~]<span class="comment"># systemctl reload nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># curl localhost</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># cat /var/log/nginx/access.log</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302119292.png#id=RmNGX&originHeight=137&originWidth=2271&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹Filebeaté…ç½®(è¯†åˆ«jsonæ ¼å¼æ—¥å¿—ï¼Œç”Ÿæˆç›¸å…³å­—æ®µ)</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-config/10-log-nginx-log-shard-json-es.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log*</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line"><span class="comment"># å¯åŠ¨jsonæ ¼å¼  </span></span><br><span class="line">  json.keys_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">"http://192.168.174.140:9200"</span>,<span class="string">"http://192.168.174.141:9200"</span>,<span class="string">"http://192.168.174.142:9200"</span>]</span><br><span class="line">  index: <span class="string">"web-nginx-access-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line"><span class="comment"># ç¦ç´¢å¼•å‘½å‘¨æœŸç®¡ç†</span></span><br><span class="line">setup.ilm.enabled: <span class="literal">false</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åç§°</span></span><br><span class="line">setup.template.name: <span class="string">"web"</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç´¢å¼•æ¨¡æ¿çš„åŒ¹é…æ¨¡å¼ </span></span><br><span class="line">setup.template.pattern: <span class="string">"web*"</span></span><br><span class="line"><span class="comment"># è¦†ç›–å·²æœ‰çš„ç´¢å¼•æ¨¡æ¿ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™ä¼šç›´æ¥è¦†ç›–ç°æœ‰çš„ç´¢å¼•æ¨¡æ¿ï¼Œå¦‚æœä¸ºfalseåˆ™ä¸è¦†ç›–!</span></span><br><span class="line">setup.template.overwrite: <span class="literal">true</span></span><br><span class="line"><span class="comment"># é…ç½®ç´¢å¼•æ¨¡æ¿</span></span><br><span class="line">setup.template.settings:</span><br><span class="line"><span class="comment"># è®¾ç½®åˆ†ç‰‡æ•°é‡</span></span><br><span class="line">  index.number_of_shards: 3</span><br><span class="line"><span class="comment"># è®¾ç½®å‰¯æœ¬æ•°é‡ï¼Œè¦æ±‚â¼©äºé›†ç¾¤çš„æ•°é‡</span></span><br><span class="line">  index.number_of_replicas: 1</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤filebeatçš„æŒ‡é’ˆåç§»ï¼Œç”¨äºä»ç¬¬ä¸€è¡Œé‡æ–°è¯»å–æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk-01 <span class="built_in">log</span>]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…æ¥šä»¥å‰çš„ES nginxç´¢å¼•ï¼Œé˜²æ­¢å‡ºç°è„æ•°æ®</span></span><br><span class="line">ç•¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯filebeat</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat -e -c ~/filebeat-config/10-log-nginx-log-shard-json-es.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302132161.png#id=FYhqo&originHeight=1530&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h2 id="ä¸ƒã€Logstash-æ—¥å¿—æ”¶é›†"><a href="#ä¸ƒã€Logstash-æ—¥å¿—æ”¶é›†" class="headerlink" title="ä¸ƒã€Logstash æ—¥å¿—æ”¶é›†"></a>ä¸ƒã€Logstash æ—¥å¿—æ”¶é›†</h2><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/</a><br>ç®€ä»‹ï¼šLogstashæ˜¯ä¸€ä¸ªå…·æœ‰å®æ—¶æµæ°´çº¿åŠŸèƒ½çš„å¼€æºæ•°æ®æ”¶é›†å¼•æ“ã€‚Logstashå¯ä»¥åŠ¨æ€åœ°ç»Ÿä¸€æ¥è‡ªä¸åŒæ¥æºçš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®è§„èŒƒåŒ–ä¸ºæ‚¨é€‰æ‹©çš„ç›®çš„åœ°ã€‚ä¸ºå„ç§é«˜çº§ä¸‹æ¸¸åˆ†æå’Œå¯è§†åŒ–ç”¨ä¾‹æ¸…ç†å’Œæ°‘ä¸»åŒ–æ‚¨çš„æ‰€æœ‰æ•°æ®ã€‚<br>è™½ç„¶Logstashæœ€åˆæ¨åŠ¨äº†æ—¥å¿—æ”¶é›†çš„åˆ›æ–°ï¼Œä½†å…¶åŠŸèƒ½è¿œè¿œè¶…å‡ºäº†è¯¥ç”¨ä¾‹ã€‚ä»»ä½•ç±»å‹çš„äº‹ä»¶éƒ½å¯ä»¥é€šè¿‡å¹¿æ³›çš„è¾“å…¥ã€è¿‡æ»¤å’Œè¾“å‡ºæ’ä»¶è¿›è¡Œä¸°å¯Œå’Œè½¬æ¢ã€‚</p>
<h3 id="1ã€Logstashå®‰è£…"><a href="#1ã€Logstashå®‰è£…" class="headerlink" title="1ã€Logstashå®‰è£…"></a>1ã€Logstashå®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># yum install -y logstash-7.17.11-x86_64.rpm </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å£°æ˜è½¯è¿æ¥</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># ln -s /usr/share/logstash/bin/logstash   /sbin/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºLogstash æµ‹è¯•æ–‡ä»¶ç›®å½•</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># mkdir logstash-config</span></span><br></pre></td></tr></table></figure>
<h4 id="2ã€Logstash-æ ‡å‡†è¾“å…¥è¾“å‡º"><a href="#2ã€Logstash-æ ‡å‡†è¾“å…¥è¾“å‡º" class="headerlink" title="2ã€Logstash æ ‡å‡†è¾“å…¥è¾“å‡º"></a>2ã€Logstash æ ‡å‡†è¾“å…¥è¾“å‡º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–å†™Logstashé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># cd logstash-config/</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># vim 01_test.conf</span></span><br><span class="line">input &#123;</span><br><span class="line">  stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># logstash  -tf ~/logstash-config/01_test.conf</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302310091.png#id=WRB0E&originHeight=392&originWidth=2283&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨Logstash</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># logstash  -f ~/logstash-config/01_test.conf</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302312127.png#id=qkBSN&originHeight=266&originWidth=1027&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h4 id="3ã€LogstashåŸºäºFileçš„å½¢å¼è¿›è¡Œinput"><a href="#3ã€LogstashåŸºäºFileçš„å½¢å¼è¿›è¡Œinput" class="headerlink" title="3ã€LogstashåŸºäºFileçš„å½¢å¼è¿›è¡Œinput"></a>3ã€LogstashåŸºäºFileçš„å½¢å¼è¿›è¡Œinput</h4><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-file.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-file.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–å†™é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># vim 02-file-input.conf </span></span><br><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">  <span class="comment"># æŒ‡å®šæ—¥å¿—æ–‡ä»¶æ”¶é›†çš„è·¯å¾„</span></span><br><span class="line">  path =&gt; [<span class="string">"/tmp/*.txt"</span>]</span><br><span class="line">  <span class="comment"># ä»æ—¥å¿—æ–‡ä»¶çš„ç¬¬ä¸€è¡Œè¿›è¡Œè¯»å–ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä»å¤´è¯»å–</span></span><br><span class="line">  start_position =&gt; <span class="string">"beginning"</span> </span><br><span class="line">  <span class="comment"># ä»æ—¥å¿—æ–‡ä»¶çš„å°¾è¡Œè¯»å–æ—¥å¿—ï¼Œä¸”åç§»æŒ‡é’ˆæ–‡ä»¶å¯¹åŸæ—¥å¿—æ–‡ä»¶åç§»é‡æœªè®°å½•</span></span><br><span class="line">  <span class="comment"># start_position =&gt; "end" </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡æµ‹è¯•æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk01 stduy-logstash-config]<span class="comment"># ech0 1111 &gt; /tmp/1.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk01 stduy-logstash-config]<span class="comment"># logstash -f /root/stduy-logstash-config/02_input_file.conf</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405302324437.png#id=PA09v&originHeight=887&originWidth=2284&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹åç§»é‡</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># cat /usr/share/logstash/data/plugins/inputs/file/.sincedb_820ddbbd098cfece4b56f4fcbf67a9bb</span></span><br><span class="line">16789540 0 64768 4 1717082577.147625 /tmp/1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># ll -i /tmp/1.txt </span></span><br><span class="line">16789540 -rw-r--r-- 1 root root 4 5æœˆ  30 23:20 /tmp/1.txt</span><br></pre></td></tr></table></figure>

<h4 id="4ã€LogstashåŸºäºFilebeatå½¢å¼è¿›è¡Œinput"><a href="#4ã€LogstashåŸºäºFilebeatå½¢å¼è¿›è¡Œinput" class="headerlink" title="4ã€LogstashåŸºäºFilebeatå½¢å¼è¿›è¡Œinput"></a>4ã€LogstashåŸºäºFilebeatå½¢å¼è¿›è¡Œinput</h4><p>Filebeat output Logstashå®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/logstash-output.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/logstash-output.html</a><br>Logstash input Fliebeatå®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-beats.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-beats.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹Filebeaté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 filebeat-config]<span class="comment"># vim /root/filebeat-config/output-logstash.yml </span></span><br><span class="line"></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /tmp/test.log</span><br><span class="line">  tags: [<span class="string">"test"</span>]</span><br><span class="line">  fields:</span><br><span class="line">    log_type: <span class="built_in">test</span></span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  <span class="comment"># Logstashä¸»æœºåœ°å€</span></span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 <span class="built_in">test</span>]<span class="comment"># filebeat -e -c /root/filebeat-conifg/output-logstash.yml</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹Logstashé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 stduy-logstash-config]<span class="comment"># vim input-beats.conf </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    <span class="comment"># é€šè®¯ç«¯å£å·ï¼Œé»˜è®¤5044</span></span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstash</span></span><br><span class="line">[root@elk01 logstash-config]<span class="comment"># logstash -rf /root/logstash-config/input-beats.conf</span></span><br></pre></td></tr></table></figure>

<h4 id="5ã€LogstashåŸºäºESå½¢å¼è¿›è¡Œoutput"><a href="#5ã€LogstashåŸºäºESå½¢å¼è¿›è¡Œoutput" class="headerlink" title="5ã€LogstashåŸºäºESå½¢å¼è¿›è¡Œoutput"></a>5ã€LogstashåŸºäºESå½¢å¼è¿›è¡Œoutput</h4><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-outputs-elasticsearch.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-outputs-elasticsearch.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹Logstashé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># cat 08_output_es.conf </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    <span class="comment"># é€šè®¯ç«¯å£å·ï¼Œé»˜è®¤5044</span></span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    <span class="comment"># ESé›†ç¾¤IP</span></span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>] </span><br><span class="line">    <span class="comment"># ç´¢å¼•æ¨¡å¼åç§°</span></span><br><span class="line">    index =&gt; <span class="string">"test-log-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstash</span></span><br><span class="line">[root@elk03 logstash-config]<span class="comment"># logstash -f /root/stduy-logstash-config/08_output_es.conf</span></span><br></pre></td></tr></table></figure>

<h4 id="6ã€Logstash-grokæ’ä»¶ä½¿ç”¨"><a href="#6ã€Logstash-grokæ’ä»¶ä½¿ç”¨" class="headerlink" title="6ã€Logstash grokæ’ä»¶ä½¿ç”¨"></a>6ã€Logstash grokæ’ä»¶ä½¿ç”¨</h4><p>å®˜ç½‘ï¼š <a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-grok.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-grok.html</a><br>ç®€ä»‹ï¼šè§£æä»»æ„æ–‡æœ¬å¹¶å¯¹å…¶è¿›è¡Œç»“æ„åŒ–ã€‚Grok æ˜¯å°†éç»“æ„åŒ–æ—¥å¿—æ•°æ®è§£æä¸ºç»“æ„åŒ–å’Œå¯æŸ¥è¯¢å†…å®¹çš„å¥½æ–¹æ³•ã€‚è¯¥å·¥å…·éå¸¸é€‚åˆç³»ç»Ÿæ—¥å¿—ï¼Œapacheå’Œå…¶ä»–WebæœåŠ¡å™¨æ—¥å¿—ï¼Œmysql æ—¥å¿—ï¼Œä»¥åŠé€šå¸¸ä¸ºäººç±»ç¼–å†™çš„ä»»ä½•æ—¥å¿—æ ¼å¼ã€‚</p>
<h5 id="6-1-Logstash-å†…ç½®æ­£åˆ™ä½¿ç”¨"><a href="#6-1-Logstash-å†…ç½®æ­£åˆ™ä½¿ç”¨" class="headerlink" title="6.1 Logstash å†…ç½®æ­£åˆ™ä½¿ç”¨"></a>6.1 Logstash å†…ç½®æ­£åˆ™ä½¿ç”¨</h5><p>ç®€ä»‹ï¼šå°†éç»“æ„åŒ–çš„æ—¥å¿—æ ¼å¼é€šè¿‡Grokå†…ç½®çš„æ­£åˆ™è½¬åŒ–ä¸ºç»“æ„åŒ–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—æ ¼å¼</span></span><br><span class="line">192.168.174.1 - - [01/Jun/2024:10:37:16 +0800] <span class="string">"GET / HTTP/1.1"</span> 304 0 <span class="string">"-"</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0"</span> <span class="string">"-"</span></span><br><span class="line">192.168.174.1 - - [01/Jun/2024:10:37:16 +0800] <span class="string">"GET / HTTP/1.1"</span> 304 0 <span class="string">"-"</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0"</span> <span class="string">"-"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™Filebeaté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-out-logstash.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹             </span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™Logstashé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">"message"</span> =&gt; <span class="string">"%&#123;HTTPD_COMMONLOG&#125;"</span> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>] </span><br><span class="line">    index =&gt; <span class="string">"test-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstash</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash  -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406011048944.png#id=sObcG&originHeight=510&originWidth=2279&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="6-2-LogstashåŸºäºå†…ç½®æ­£åˆ™å®ç°æ—¥å¿—ç»“æ„åŒ–"><a href="#6-2-LogstashåŸºäºå†…ç½®æ­£åˆ™å®ç°æ—¥å¿—ç»“æ„åŒ–" class="headerlink" title="6.2 LogstashåŸºäºå†…ç½®æ­£åˆ™å®ç°æ—¥å¿—ç»“æ„åŒ–"></a>6.2 LogstashåŸºäºå†…ç½®æ­£åˆ™å®ç°æ—¥å¿—ç»“æ„åŒ–</h5><p>å®˜ç½‘ï¼š <a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-grok.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-grok.html</a><br>Logstashå†…ç½®å˜é‡ï¼š<a href="https://github.com/logstash-plugins/logstash-patterns-core/blob/main/patterns/legacy/httpd" target="_blank" rel="noopener">https://github.com/logstash-plugins/logstash-patterns-core/blob/main/patterns/legacy/httpd</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯•æ—¥å¿—å‡†å¤‡</span></span><br><span class="line">55.3.244.1 GET /index.html 15824 0.043</span><br><span class="line">    <span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line">        55.3.244.1 <span class="comment"># å®¢æˆ·ç«¯IP</span></span><br><span class="line">        GET		   <span class="comment"># è¯·æ±‚æ–¹å¼</span></span><br><span class="line">        /index.html	<span class="comment"># è¯·æ±‚è·¯å¾„</span></span><br><span class="line">        15824		<span class="comment"># å‘é€å­—èŠ‚å¤§å°</span></span><br><span class="line">        0.043		<span class="comment"># ç›¸åº”æ—¶å¸¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstash é…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim stdin_grok_stdout.conf</span></span><br><span class="line">input &#123;</span><br><span class="line">  stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;IP:client_ip&#125; %&#123;WORD:Request_method&#125; %&#123;URIPATHPARAM:request_uri&#125; %&#123;NUMBER:bytes&#125; %&#123;NUMBER:response_time&#125;"</span> &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash  -rf ~/stdin_grok_stdout.conf</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406011104673.png#id=pHhH3&originHeight=511&originWidth=1485&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<blockquote>
<p>æç¤ºï¼š<br>    %{IP:client} å˜é‡è§£é‡Šï¼š IPä¸ºå†…ç½®å˜é‡ï¼Œclientä¸ºå­—æ®µåç§°æˆ–è€…å«æ ‡è¯†ç¬¦ã€‚å¯ä»¥è‡ªè¡Œä¿®æ”¹,ä¾‹å¦‚ï¼š%{IP:req-client}</p>
</blockquote>
<h5 id="6-4-Logstashåˆ é™¤æŒ‡å®šå­—æ®µ"><a href="#6-4-Logstashåˆ é™¤æŒ‡å®šå­—æ®µ" class="headerlink" title="6.4 Logstashåˆ é™¤æŒ‡å®šå­—æ®µ"></a>6.4 Logstashåˆ é™¤æŒ‡å®šå­—æ®µ</h5><p>ç®€ä»‹ï¼šå¦‚æœæ­¤ç­›é€‰å™¨æˆåŠŸï¼Œè¯·ä»æ­¤äº‹ä»¶ä¸­åˆ é™¤ä»»æ„å­—æ®µã€‚</p>
<p><code>æœªåˆ é™¤å­—æ®µç»ˆç«¯æ‰“å°å¦‚ä¸‹</code>ï¼š<br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406011154600.png#id=TRqxM&originHeight=1276&originWidth=2285&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filebeaté…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-out-logstash.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstashé…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">"message"</span> =&gt; <span class="string">"%&#123;HTTPD_COMMONLOG&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment"># You can also remove multiple fields at once: </span></span><br><span class="line">   remove_field =&gt; [ <span class="string">"type"</span>,<span class="string">"offset"</span>,<span class="string">"ecs"</span>,<span class="string">"input"</span>,<span class="string">"@version"</span>,<span class="string">"log"</span>,<span class="string">"agent"</span>,<span class="string">"tags"</span> ]</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">    index =&gt; <span class="string">"test-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>
<p>åˆ é™¤æŒ‡å®šå­—æ®µåç»ˆç«¯æ•°æ®æ˜¾ç¤ºå¦‚ä¸‹ï¼š<br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406011210897.png#id=A8WhB&originHeight=751&originWidth=2283&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="6-5-Logstash-æ·»åŠ æŒ‡å®šå­—æ®µ"><a href="#6-5-Logstash-æ·»åŠ æŒ‡å®šå­—æ®µ" class="headerlink" title="6.5 Logstash æ·»åŠ æŒ‡å®šå­—æ®µ"></a>6.5 Logstash æ·»åŠ æŒ‡å®šå­—æ®µ</h5><p>ç®€ä»‹ï¼šå¦‚æœæ­¤ç­›é€‰æˆåŠŸï¼Œåˆ™å‘æ­¤äº‹ä»¶æ·»åŠ ä»»æ„å­—æ®µã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filebeaté…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-out-logstash.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstashé…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">"message"</span> =&gt; <span class="string">"%&#123;HTTPD_COMMONLOG&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment"># You can also remove multiple fields at once: </span></span><br><span class="line">   remove_field =&gt; [ <span class="string">"type"</span>,<span class="string">"offset"</span>,<span class="string">"ecs"</span>,<span class="string">"input"</span>,<span class="string">"@version"</span>,<span class="string">"log"</span>,<span class="string">"agent"</span>,<span class="string">"tags"</span> ]</span><br><span class="line">    <span class="comment"># You can also add multiple fields at once:</span></span><br><span class="line">   add_field =&gt; &#123; </span><br><span class="line">     <span class="string">"host-name"</span> =&gt; <span class="string">"%&#123;host&#125;"</span></span><br><span class="line">     <span class="string">"service"</span> =&gt; <span class="string">"ELK stack"</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">    index =&gt; <span class="string">"test-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406011249952.png#id=UaKvc&originHeight=812&originWidth=2289&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="6-6-Logstash-è‡ªå®šä¹‰Tags"><a href="#6-6-Logstash-è‡ªå®šä¹‰Tags" class="headerlink" title="6.6 Logstash è‡ªå®šä¹‰Tags"></a>6.6 Logstash è‡ªå®šä¹‰Tags</h5><p>ç®€ä»‹ï¼šå¦‚æœæ­¤ç­›é€‰æˆåŠŸï¼Œè¯·å‘äº‹ä»¶æ·»åŠ ä»»æ„æ ‡è®°ã€‚ æ ‡è®°å¯ä»¥æ˜¯åŠ¨æ€çš„ï¼Œå¹¶ä½¿ç”¨è¯­æ³•åŒ…å«äº‹ä»¶çš„æŸäº›éƒ¨åˆ†ã€‚<code>%{field}</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filebeaté…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-out-logstash.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstashé…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">"message"</span> =&gt; <span class="string">"%&#123;HTTPD_COMMONLOG&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment"># You can also remove multiple fields at once: </span></span><br><span class="line">   remove_field =&gt; [ <span class="string">"type"</span>,<span class="string">"offset"</span>,<span class="string">"ecs"</span>,<span class="string">"input"</span>,<span class="string">"@version"</span>,<span class="string">"log"</span>,<span class="string">"agent"</span>,<span class="string">"tags"</span> ]</span><br><span class="line">    <span class="comment"># You can also add multiple fields at once:</span></span><br><span class="line">   add_field =&gt; &#123; </span><br><span class="line">     <span class="string">"host-name"</span> =&gt; <span class="string">"%&#123;host&#125;"</span></span><br><span class="line">     <span class="string">"service"</span> =&gt; <span class="string">"ELK stack"</span></span><br><span class="line">     &#125;</span><br><span class="line">   <span class="comment"># You can also add multiple tags at once:</span></span><br><span class="line">   add_tag =&gt; [ <span class="string">"Filebeat"</span>, <span class="string">"Logstash"</span>,<span class="string">"Nginx"</span>,<span class="string">"Tomcat"</span>,<span class="string">"Kibana"</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">    index =&gt; <span class="string">"test-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406011255129.png#id=mVQ7M&originHeight=1125&originWidth=2286&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h4 id="7ã€Logstash-geoipæ’ä»¶åˆ†æç”¨æˆ·IPæ‰€å±åœ°"><a href="#7ã€Logstash-geoipæ’ä»¶åˆ†æç”¨æˆ·IPæ‰€å±åœ°" class="headerlink" title="7ã€Logstash geoipæ’ä»¶åˆ†æç”¨æˆ·IPæ‰€å±åœ°"></a>7ã€Logstash geoipæ’ä»¶åˆ†æç”¨æˆ·IPæ‰€å±åœ°</h4><p>å®˜æ–¹ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-geoip.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-geoip.html</a><br>ç®€ä»‹ï¼šGeoIP è¿‡æ»¤å™¨æ·»åŠ æœ‰å…³ IP åœ°å€åœ°ç†ä½ç½®çš„ä¿¡æ¯ï¼Œ åŸºäº MaxMind GeoLite2 æ•°æ®åº“çš„æ•°æ®ã€‚ MaxMind GeoLite2 æ•°æ®åº“ï¼šå¼€æºIPåœ°å€å®šä½æ•°æ®åº“ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filebeaté…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-out-logstash.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstashé…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">      <span class="string">"message"</span> =&gt; <span class="string">"%&#123;HTTPD_COMMONLOG&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment"># You can also remove multiple fields at once: </span></span><br><span class="line">   remove_field =&gt; [ <span class="string">"type"</span>,<span class="string">"offset"</span>,<span class="string">"ecs"</span>,<span class="string">"input"</span>,<span class="string">"@version"</span>,<span class="string">"log"</span>,<span class="string">"agent"</span>,<span class="string">"tags"</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># æŒ‡å®šgeoipæ’ä»¶</span></span><br><span class="line">  geoip &#123;</span><br><span class="line">      <span class="comment"># é…ç½®å®¢æˆ·ç«¯IPå­—æ®µåç§°</span></span><br><span class="line">      <span class="built_in">source</span> =&gt; <span class="string">"clientip"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">    index =&gt; <span class="string">"test-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>

<h4 id="8ã€Logstash-useragentæ’ä»¶åˆ†æç”¨æˆ·å®¢æˆ·ç«¯ç±»å‹"><a href="#8ã€Logstash-useragentæ’ä»¶åˆ†æç”¨æˆ·å®¢æˆ·ç«¯ç±»å‹" class="headerlink" title="8ã€Logstash useragentæ’ä»¶åˆ†æç”¨æˆ·å®¢æˆ·ç«¯ç±»å‹"></a>8ã€Logstash useragentæ’ä»¶åˆ†æç”¨æˆ·å®¢æˆ·ç«¯ç±»å‹</h4><p>â€‹    å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-useragent.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-filters-useragent.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filebeaté…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim filebeat-out-logstash.yml</span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  tags: [<span class="string">"access"</span>]</span><br><span class="line">  json.keys_under_root: <span class="literal">true</span>  </span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstashé…ç½®æ–‡ä»¶ç¼–å†™</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  grok &#123; </span><br><span class="line">   remove_field =&gt; [ <span class="string">"type"</span>,<span class="string">"offset"</span>,<span class="string">"ecs"</span>,<span class="string">"input"</span>,<span class="string">"@version"</span>,<span class="string">"log"</span>,<span class="string">"agent"</span>,<span class="string">"tags"</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># æŒ‡å®šgeoipæ’ä»¶</span></span><br><span class="line">  geoip &#123;</span><br><span class="line">      <span class="comment"># é…ç½®å®¢æˆ·ç«¯IPå­—æ®µåç§°</span></span><br><span class="line">      <span class="built_in">source</span> =&gt; <span class="string">"clientip"</span></span><br><span class="line">  &#125;</span><br><span class="line">  useragent &#123;</span><br><span class="line">    <span class="built_in">source</span> =&gt; <span class="string">"http_user_agent"</span></span><br><span class="line">    target =&gt; <span class="string">"test_user_agent"</span></span><br><span class="line">    remove_field =&gt; [ <span class="string">"agent"</span>,<span class="string">"@version"</span>,<span class="string">"tags"</span>,<span class="string">"ecs"</span>,<span class="string">"log"</span>,<span class="string">"offset"</span>,<span class="string">"type"</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">    index =&gt; <span class="string">"test-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>

<h4 id="9ã€Logstash-Filterå¤šifåˆ†æ”¯"><a href="#9ã€Logstash-Filterå¤šifåˆ†æ”¯" class="headerlink" title="9ã€Logstash Filterå¤šifåˆ†æ”¯"></a>9ã€Logstash Filterå¤šifåˆ†æ”¯</h4><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/event-dependent-configuration.html#metadata" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/event-dependent-configuration.html#metadata</a><br>ç®€ä»‹ï¼š é’ˆå¯¹ä¸åŒçš„æ—¥å¿—ç±»å‹ã€‚filterå»åšä¸åŒçš„å¤„ç†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Filebeaté…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># vim  filebeat-out-logstash.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  json.keys_under_root: <span class="literal">true</span>   </span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_error</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/messages</span><br><span class="line">  fields:</span><br><span class="line">    log_type: system_log</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"192.168.174.142:5044"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åç§»é‡</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># rm -rf /var/lib/filebeat/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Filebeatå®ä¾‹</span></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filebeat-out-logstash.yml </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logstash é…ç½®æ–‡ä»¶å‡†å¤‡</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># vim filter_grok.yml </span></span><br><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">"name"</span> =&gt; <span class="string">"ELK stack"</span> </span><br><span class="line">    &#125;</span><br><span class="line">    remove_field =&gt; [<span class="string">"agent"</span>,<span class="string">"ephemeral_id"</span>,<span class="string">"ecs"</span>,<span class="string">"@version"</span>,<span class="string">"tags"</span>,<span class="string">"input"</span>,<span class="string">"log"</span>,<span class="string">"offest"</span>]  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> [log_type] == <span class="string">"nginx_access"</span> &#123;</span><br><span class="line">     geoip &#123;</span><br><span class="line">       <span class="built_in">source</span> =&gt; <span class="string">"clientip"</span></span><br><span class="line">     &#125;</span><br><span class="line">     useragent &#123;</span><br><span class="line">       <span class="built_in">source</span> =&gt; <span class="string">"http_user_agent"</span> </span><br><span class="line">       target =&gt; <span class="string">"study_user_agent"</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [log_type] == <span class="string">"nginx_access"</span> &#123;  </span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">      hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>] </span><br><span class="line">      index =&gt; <span class="string">"web-access-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line">    &#125; </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> [log_type] == <span class="string">"nginx_error"</span> &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">          hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">          index =&gt; <span class="string">"web-error-%&#123;+yyyy.MM.dd&#125;"</span>   </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  <span class="keyword">else</span> <span class="keyword">if</span> [log_type] == <span class="string">"system_log"</span> &#123;</span><br><span class="line">       elasticsearch &#123;</span><br><span class="line">         hosts =&gt; [<span class="string">"192.168.174.140:9200"</span>,<span class="string">"192.168.174.141:9200"</span>,<span class="string">"192.168.174.142:9200"</span>]</span><br><span class="line">         index =&gt; <span class="string">"system-log-%&#123;+yyyy.MM.dd&#125;"</span>     </span><br><span class="line">    &#125; </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstash</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash  -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>


<h2 id="å…«ã€Kibanaæ“ä½œä½¿ç”¨"><a href="#å…«ã€Kibanaæ“ä½œä½¿ç”¨" class="headerlink" title="å…«ã€Kibanaæ“ä½œä½¿ç”¨"></a>å…«ã€Kibanaæ“ä½œä½¿ç”¨</h2><h3 id="1ã€kibanaæ‰‹åŠ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿"><a href="#1ã€kibanaæ‰‹åŠ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿" class="headerlink" title="1ã€kibanaæ‰‹åŠ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿"></a>1ã€kibanaæ‰‹åŠ¨åˆ›å»ºç´¢å¼•æ¨¡æ¿</h3><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405310044720.png#id=TjLJ0&originHeight=1260&originWidth=2507&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405310044170.png#id=Ty1KL&originHeight=1037&originWidth=2100&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405310045784.png#id=PjKWz&originHeight=1244&originWidth=1917&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt><br><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405310047016.png#id=a7ORh&originHeight=1252&originWidth=2011&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"number_of_replicas"</span>:1,</span><br><span class="line"><span class="string">"number_of_shards"</span>:3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202405310049148.png#id=CosFV&originHeight=1000&originWidth=2096&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h2 id="ä¹ã€kafkaç®€ä»‹å’Œä½¿ç”¨"><a href="#ä¹ã€kafkaç®€ä»‹å’Œä½¿ç”¨" class="headerlink" title="ä¹ã€kafkaç®€ä»‹å’Œä½¿ç”¨"></a>ä¹ã€kafkaç®€ä»‹å’Œä½¿ç”¨</h2><h3 id="1ã€MQä¸¤ç§æ¨¡å¼"><a href="#1ã€MQä¸¤ç§æ¨¡å¼" class="headerlink" title="1ã€MQä¸¤ç§æ¨¡å¼"></a>1ã€MQä¸¤ç§æ¨¡å¼</h3><h4 id="1-1-P2Pæ¨¡å¼"><a href="#1-1-P2Pæ¨¡å¼" class="headerlink" title="1.1 P2Pæ¨¡å¼"></a>1.1 P2Pæ¨¡å¼</h4><h5 id="1-1-1-æ¶æ„å›¾"><a href="#1-1-1-æ¶æ„å›¾" class="headerlink" title="1.1.1 æ¶æ„å›¾"></a>1.1.1 æ¶æ„å›¾</h5><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406020000698.png" alt></p>
<h5 id="1-1-2-ç®€ä»‹"><a href="#1-1-2-ç®€ä»‹" class="headerlink" title="1.1.2 ç®€ä»‹"></a>1.1.2 ç®€ä»‹</h5><p>â€‹    åœ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ç³»ç»Ÿä¸­ï¼Œ==ç‚¹å¯¹ç‚¹æ¨¡å¼==ï¼ˆPoint-to-Point Modelï¼‰æ˜¯æœ€åŸºæœ¬çš„æ¶ˆæ¯é€šä¿¡æ¨¡å¼ä¹‹ä¸€ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼Œè€Œæ¶ˆæ¯æ¶ˆè´¹è€…ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­æ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯ã€‚æ¯æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¬¡ï¼Œè¿™ä¸å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼ˆPub/Sub Modelï¼‰ä¸­çš„å¤šæ’­æœºåˆ¶ä¸åŒã€‚</p>
<h5 id="1-1-3-å·¥ä½œæµç¨‹"><a href="#1-1-3-å·¥ä½œæµç¨‹" class="headerlink" title="1.1.3 å·¥ä½œæµç¨‹"></a>1.1.3 å·¥ä½œæµç¨‹</h5><ol>
<li><strong>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</strong>ï¼šç”Ÿäº§è€…åˆ›å»ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶å°†å…¶å‘é€åˆ°æŒ‡å®šçš„<strong>é˜Ÿåˆ—</strong>ï¼ˆQueueï¼‰ã€‚</li>
<li><strong>é˜Ÿåˆ—æš‚å­˜æ¶ˆæ¯</strong>ï¼šé˜Ÿåˆ—æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶<strong>å­˜å‚¨</strong>ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¥æ¥æ”¶ã€‚</li>
<li><strong>æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</strong>ï¼šæ¶ˆè´¹è€…ä»<strong>é˜Ÿåˆ—</strong>ä¸­<strong>æ£€ç´¢</strong>æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œæ¯æ¡æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ã€‚</li>
<li><strong>æ¶ˆæ¯ç¡®è®¤</strong>ï¼šæ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œå‘é˜Ÿåˆ—å‘é€ç¡®è®¤ï¼Œè¡¨ç¤ºæ¶ˆæ¯å·²ç»æˆåŠŸå¤„ç†ã€‚MQ<strong>åˆ é™¤æ¶ˆè´¹æ•°æ®</strong>ã€‚<strong>å¦‚æœæ¶ˆè´¹è€…æ²¡æœ‰ç¡®è®¤æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šè¢«é‡æ–°æŠ•é€’åˆ°é˜Ÿåˆ—ä¸­ä¾›å…¶ä»–æ¶ˆè´¹è€…å¤„ç†ã€‚</strong></li>
</ol>
<h4 id="1-2-å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="#1-2-å‘å¸ƒ-è®¢é˜…æ¨¡å¼" class="headerlink" title="1.2 å‘å¸ƒ/è®¢é˜…æ¨¡å¼"></a>1.2 å‘å¸ƒ/è®¢é˜…æ¨¡å¼</h4><h5 id="1-2-1-æ¶æ„å›¾"><a href="#1-2-1-æ¶æ„å›¾" class="headerlink" title="1.2.1 æ¶æ„å›¾"></a>1.2.1 æ¶æ„å›¾</h5><p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406020008444.png#id=wvuow&originHeight=609&originWidth=1648&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<h5 id="1-2-2-ç®€ä»‹"><a href="#1-2-2-ç®€ä»‹" class="headerlink" title="1.2.2 ç®€ä»‹"></a>1.2.2 ç®€ä»‹</h5><p>â€‹    åœ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ç³»ç»Ÿä¸­ï¼Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆPublish-Subscribe Modelï¼Œç®€ç§°Pub/Subï¼‰æ˜¯ä¸€ç§å¸¸è§çš„æ¶ˆæ¯é€šä¿¡æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘å¸ƒè€…ï¼‰å°†æ¶ˆæ¯å‘å¸ƒåˆ°ä¸€ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œè€Œæ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆè®¢é˜…è€…ï¼‰åˆ™è®¢é˜…è¯¥ä¸»é¢˜ï¼Œä»è€Œæ¥æ”¶å‘å¸ƒè€…å‘å¸ƒçš„æ¶ˆæ¯ã€‚ä¸ç‚¹å¯¹ç‚¹æ¨¡å¼ä¸åŒï¼Œå‘å¸ƒåˆ°ä¸»é¢˜çš„<strong>æ¯æ¡æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªè®¢é˜…è€…æ¥æ”¶å’Œå¤„ç†</strong>ã€‚</p>
<h5 id="1-2-3-å·¥ä½œæµç¨‹"><a href="#1-2-3-å·¥ä½œæµç¨‹" class="headerlink" title="1.2.3 å·¥ä½œæµç¨‹"></a>1.2.3 å·¥ä½œæµç¨‹</h5><ol>
<li><strong>å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯</strong>ï¼šå‘å¸ƒè€…åˆ›å»ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ°æŒ‡å®šçš„ä¸»é¢˜ã€‚</li>
<li><strong>ä¸»é¢˜å¹¿æ’­æ¶ˆæ¯</strong>ï¼šä¸»é¢˜æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¹¶å°†å…¶å¹¿æ’­ç»™æ‰€æœ‰è®¢é˜…äº†è¯¥ä¸»é¢˜çš„è®¢é˜…è€…ã€‚</li>
<li><strong>è®¢é˜…è€…æ¥æ”¶æ¶ˆæ¯</strong>ï¼šè®¢é˜…è€…æ¥æ”¶æˆ–è€…æ‹‰å–ä¸»é¢˜å¹¿æ’­çš„æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚</li>
</ol>
<ul>
<li><strong>Pullæ–¹å¼</strong><ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆè´¹è€…æ ¹æ®è‡ªèº«æ¶ˆè´¹æ•°æ®çš„èƒ½åŠ›å»é˜Ÿåˆ—ä¸­æ‹‰å–æ•°æ®ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆè´¹è€…éœ€è¦é•¿æœŸæ‰“å¼€ä¸€ä¸ªè¿›ç¨‹æ¥ç›‘è§†é˜Ÿåˆ—æ˜¯å¦æœ‰æ•°æ®äº§ç”Ÿã€‚</li>
</ul>
</li>
<li><strong>Pushæ–¹å¼</strong><ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¸»åŠ¨æ¨é€æ•°æ®ï¼Œä¾‹å¦‚ï¼š<strong>å…¬ä¼—å·è¯é¢˜æ¨é€ï¼ŒAPPæ›´æ–°æ¨é€</strong>ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—è‡ªèº«éœ€è¦ç»´æŠ¤ä¸€å¼ è®¢é˜…è€…åå•ã€‚<strong>å½“è®¢é˜…è€…è¿‡å¤šæ—¶ï¼Œç‰¹åˆ«æ¶ˆè€—èµ„æºã€‚</strong></li>
</ul>
</li>
</ul>
<h3 id="2ã€kafkaç›¸å…³æ¦‚å¿µ"><a href="#2ã€kafkaç›¸å…³æ¦‚å¿µ" class="headerlink" title="2ã€kafkaç›¸å…³æ¦‚å¿µ"></a>2ã€kafkaç›¸å…³æ¦‚å¿µ</h3><p>â€‹    <strong>å®˜ç½‘</strong>ï¼š<a href="https://kafka.apache.org/" target="_blank" rel="noopener">https://kafka.apache.org/</a></p>
<h4 id="2-1-ä»‹ç»"><a href="#2-1-ä»‹ç»" class="headerlink" title="2.1 ä»‹ç»"></a>2.1 ä»‹ç»</h4><p>â€‹    ==Apache Kafka==æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>åˆ†å¸ƒå¼</strong>äº‹ä»¶æµå¹³å°ï¼Œç”±æ•°ä»¥åƒè®¡çš„å…¬å¸æä¾›é«˜æ€§èƒ½æ•°æ®ç®¡é“ã€æµåˆ†æã€ æ•°æ®é›†æˆå’Œä»»åŠ¡å…³é”®å‹åº”ç”¨ç¨‹åºã€‚</p>
<ul>
<li><p><strong>é«˜ååé‡</strong>ï¼šä½¿ç”¨å»¶è¿Ÿä½è‡³2msçš„æœºå™¨é›†ç¾¤ä»¥ç½‘ç»œæœ‰é™çš„ååé‡ä¼ é€’æ¶ˆæ¯ã€‚</p>
</li>
<li><p><strong>å¯ä¼¸ç¼©</strong>ï¼šå°†ç”Ÿäº§é›†ç¾¤æ‰©å±•åˆ°1000ä¸ªä»£ç†ã€æ¯å¤©æ•°ä¸‡äº¿æ¡æ¶ˆæ¯ã€PBçš„æ•°æ®å’Œæ•°åä¸‡ä¸ªåˆ†åŒºã€‚å¼¹æ€§æ‰©å±•å’Œæ”¶ç¼©å­˜å‚¨å’Œå¤„ç†ã€‚</p>
</li>
<li><p><strong>æ°¸ä¹…å­˜å‚¨å™¨</strong>ï¼šå°†æ•°æ®æµå®‰å…¨åœ°å­˜å‚¨åœ¨åˆ†å¸ƒå¼ã€æŒä¹…ã€å®¹é”™çš„é›†ç¾¤ä¸­ã€‚</p>
</li>
<li><p><strong>é«˜å¯ç”¨æ€§</strong>ï¼šåœ¨å¯ç”¨æ€§åŒºåŸŸä¸Šé«˜æ•ˆåœ°æ‰©å±•é›†ç¾¤ï¼Œæˆ–è€…è·¨åœ°ç†åŒºåŸŸè¿æ¥å•ç‹¬çš„é›†ç¾¤ã€‚</p>
<h4 id="2-2-Kafkaç›¸å…³ä¸“ä¸šæœ¯è¯­"><a href="#2-2-Kafkaç›¸å…³ä¸“ä¸šæœ¯è¯­" class="headerlink" title="2.2 Kafkaç›¸å…³ä¸“ä¸šæœ¯è¯­"></a>2.2 Kafkaç›¸å…³ä¸“ä¸šæœ¯è¯­</h4></li>
<li><p><strong>ä¸»é¢˜ï¼ˆTopicï¼‰</strong>ï¼šä¸»é¢˜æ˜¯Kafkaä¸­ç”¨äºå¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»çš„é€»è¾‘åˆ†ç»„ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥çœ‹ä½œæ˜¯æ¶ˆæ¯çš„åˆ†ç±»å™¨ã€‚ä¸»é¢˜æ˜¯å¤šè®¢é˜…è€…æ¨¡å¼ï¼Œå³ä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…ã€‚</p>
</li>
<li><p><strong>åˆ†åŒºï¼ˆPartitionï¼‰</strong>ï¼šæ¯ä¸ªä¸»é¢˜è¢«åˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºã€‚åˆ†åŒºæ˜¯æ¶ˆæ¯å­˜å‚¨çš„åŸºæœ¬å•å…ƒã€‚åˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½†ä¸åŒåˆ†åŒºä¹‹é—´æ— åºã€‚æ¯ä¸ªåˆ†åŒºå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„KafkaæœåŠ¡å™¨ä¸Šï¼Œä»è€Œå®ç°æ°´å¹³æ‰©å±•ã€‚</p>
<ul>
<li><strong>leader partition</strong> è´Ÿè´£å¯¹kafkaé›†ç¾¤çš„è¯»å†™æ“ä½œï¼Œå’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’</li>
<li><strong>follower partition</strong> è´Ÿè´£å»leader partition åŒæ­¥æ•°æ®ï¼Œä¸å¯ä»¥å’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’</li>
</ul>
</li>
<li><p><strong>åç§»é‡ï¼ˆOffsetï¼‰</strong>ï¼šåç§»é‡æ˜¯åˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒæ˜¯ä¸€ä¸ªé€’å¢çš„æ•´æ•°ï¼Œè®°å½•äº†æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„ä½ç½®ã€‚æ¶ˆè´¹è€…ä½¿ç”¨åç§»é‡æ¥è·Ÿè¸ªè¯»å–æ¶ˆæ¯çš„ä½ç½®ã€‚</p>
</li>
<li><p><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼šç”Ÿäº§è€…æ˜¯è´Ÿè´£å‘Kafkaä¸»é¢˜å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ä¸»é¢˜å’Œåˆ†åŒºã€‚</p>
</li>
<li><p><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šæ¶ˆè´¹è€…æ˜¯è´Ÿè´£ä»Kafkaä¸»é¢˜è¯»å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚æ¶ˆè´¹è€…é€šè¿‡è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜æ¥è¯»å–æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨åç§»é‡æ¥è·Ÿè¸ªè¯»å–è¿›åº¦ã€‚</p>
</li>
<li><p><strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼šæ¶ˆè´¹è€…ç»„æ˜¯ä¸€ç»„æ¶ˆè´¹è€…å®ä¾‹ï¼Œå…±åŒæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜çš„æ¶ˆæ¯ã€‚</p>
</li>
<li><p><strong>ä»£ç†ï¼ˆBrokerï¼‰</strong>ï¼šä»£ç†æ˜¯Kafkaé›†ç¾¤ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨å’Œä¼ è¾“æ¶ˆæ¯æ•°æ®ã€‚ä¸€ä¸ªKafkaé›†ç¾¤ç”±å¤šä¸ªä»£ç†ç»„æˆï¼Œæ¯ä¸ªä»£ç†å¯ä»¥å¤„ç†å¤šä¸ªåˆ†åŒºã€‚</p>
</li>
<li><p><strong>å¤åˆ¶ï¼ˆReplicationï¼‰</strong>ï¼šKafkaä¸­çš„å¤åˆ¶æœºåˆ¶å°†åˆ†åŒºæ•°æ®å¤åˆ¶åˆ°å¤šä¸ªä»£ç†ä¸Šï¼Œä»¥ç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚æ¯ä¸ªåˆ†åŒºæœ‰ä¸€ä¸ªé¢†å¯¼å‰¯æœ¬ï¼ˆLeaderï¼‰å’Œè‹¥å¹²ä¸ªè·Ÿéšå‰¯æœ¬ï¼ˆFollowerï¼‰ã€‚æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½ç”±é¢†å¯¼å‰¯æœ¬å¤„ç†ï¼Œè·Ÿéšå‰¯æœ¬åªéœ€åŒæ­¥é¢†å¯¼å‰¯æœ¬çš„æ•°æ®ã€‚ä½†æ˜¯Leaderå’ŒFollweréƒ½å±äºå‰¯æœ¬ã€‚åˆ›å»ºæ—¶ä¸èƒ½å‰¯æœ¬æ•°ä¸èƒ½ä¸º0ã€‚</p>
</li>
</ul>
<h3 id="3ã€Zookeeperä½¿ç”¨å’Œé…ç½®"><a href="#3ã€Zookeeperä½¿ç”¨å’Œé…ç½®" class="headerlink" title="3ã€Zookeeperä½¿ç”¨å’Œé…ç½®"></a>3ã€Zookeeperä½¿ç”¨å’Œé…ç½®</h3><p>å®˜ç½‘é“¾æ¥ï¼š<a href="https://dlcdn.apache.org/zookeeper/" target="_blank" rel="noopener">https://dlcdn.apache.org/zookeeper/</a></p>
<p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz" target="_blank" rel="noopener">https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</a></p>
<h4 id="3-1-ç®€ä»‹ï¼š"><a href="#3-1-ç®€ä»‹ï¼š" class="headerlink" title="3.1 ç®€ä»‹ï¼š"></a>3.1 ç®€ä»‹ï¼š</h4><p>â€‹    Zookeeper æ˜¯ Apache æ——ä¸‹çš„ä¸€ä¸ªå¼€æº<strong>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</strong>ï¼Œç”¨äºç®¡ç†å’Œåè°ƒåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„å„ç§æœåŠ¡å’Œç»„ä»¶ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—é«˜æ•ˆä¸”å¯é çš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§å’Œåè°ƒæœºåˆ¶ã€‚</p>
<h4 id="3-2-zookeeperé›†ç¾¤éƒ¨ç½²ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€"><a href="#3-2-zookeeperé›†ç¾¤éƒ¨ç½²ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€" class="headerlink" title="3.2 zookeeperé›†ç¾¤éƒ¨ç½²ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€"></a>3.2 zookeeperé›†ç¾¤éƒ¨ç½²ï¼š<code>ä¸‰èŠ‚ç‚¹</code>ğŸ˜€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; è§£å‹å®‰è£…åŒ…åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">$ tar xf apache-zookeeper-3.8.2-bin.tar.gz  -C /opt/ &amp;&amp; <span class="built_in">cd</span> /opt/</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ›´æ”¹ç›®å½•åç§°</span></span><br><span class="line">$ mv apache-zookeeper-3.8.2-bin/   zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é…ç½®zkç¯å¢ƒå˜é‡</span></span><br><span class="line">$ cat &gt;&gt; /etc/profile.d/zookeeper.sh &lt;&lt;-EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> ZK_HOME=/opt/zookeeper</span><br><span class="line"><span class="built_in">export</span> PATH=\<span class="variable">$PATH</span>:\<span class="variable">$ZK_HOME</span>/bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡ </span></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile.d/zookeeper.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºzkæ•°æ®å­˜æ”¾ç›®å½•</span></span><br><span class="line">$ mkdir -p /opt/data/zk</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹zkçš„é…ç½®æ–‡ä»¶(ä¸‰èŠ‚ç‚¹)</span></span><br><span class="line">$ cp /opt/zookeeper/conf/zoo_sample.cfg  /opt/zookeeper/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">$ egrep -v <span class="string">"^(#|$)"</span> /opt/zookeeper/conf/zoo.cfg </span><br><span class="line">	<span class="comment"># Zookeeperçš„å¿ƒè·³é—´éš”æ—¶é—´ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šé€šè¿‡å¿ƒè·³åŒ…ç»´æŒè¿æ¥çŠ¶æ€ã€‚</span></span><br><span class="line">tickTime=2000</span><br><span class="line">	<span class="comment"># ä»èŠ‚ç‚¹æœ€å¤šå¯ä»¥ç­‰å¾…10 ä¸ªtickTimeï¼ˆå³ 10 * 2000 æ¯«ç§’ = 20 ç§’ï¼‰æ¥ä¸é¢†å¯¼è€…åŒæ­¥æ•°æ®çŠ¶æ€ã€‚å¦åˆ™å®ƒå°†è¢«è®¤ä¸ºæ˜¯ä¸å¯ç”¨çš„ã€‚</span></span><br><span class="line">initLimit=10</span><br><span class="line">	<span class="comment"># å®šä¹‰Zookeeperé¢†å¯¼è€…å’Œä»èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³å’ŒåŒæ­¥è¯·æ±‚çš„æœ€å¤§å…è®¸å»¶è¿Ÿæ—¶é—´ã€‚é¢†å¯¼è€…ä¸ä»èŠ‚ç‚¹ä¹‹é—´çš„å“åº”æ—¶é—´å¦‚æœè¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼Œä»èŠ‚ç‚¹å°†è¢«è®¤ä¸ºå¤±å»åŒæ­¥çŠ¶æ€ã€‚ï¼ˆå³ 5 * 2000 æ¯«ç§’ = 10 ç§’ï¼‰ã€‚</span></span><br><span class="line">syncLimit=5</span><br><span class="line">	<span class="comment"># å®šä¹‰zkæ•°æ®ç›®å½•</span></span><br><span class="line">dataDir=/opt/data/zk</span><br><span class="line">	<span class="comment"># å®šä¹‰Zookeeperé›†ç¾¤çš„å®¢æˆ·ç«¯è¿æ¥ç«¯å£</span></span><br><span class="line">clientPort=2181</span><br><span class="line">server.140=192.168.174.140:2888:3888</span><br><span class="line">server.141=192.168.174.141:2888:3888</span><br><span class="line">server.142=192.168.174.142:2888:3888</span><br><span class="line">    <span class="comment"># å‚æ•°è§£é‡Šï¼š</span></span><br><span class="line">            <span class="comment"># dataDir		zkæ•°æ®ç›®å½•</span></span><br><span class="line">            <span class="comment"># clientPort	ç«¯å£å·</span></span><br><span class="line">            <span class="comment"># server.140	zkèŠ‚ç‚¹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">            <span class="comment"># 192.168.100.160	zkèŠ‚ç‚¹ä¸»æœºåœ°å€</span></span><br><span class="line">            <span class="comment"># 2888				é›†ç¾¤å†…éƒ¨é€šè®¯ç«¯å£</span></span><br><span class="line">            <span class="comment"># 3888				leaderé€‰ä¸¾ç«¯å£</span></span><br><span class="line">            </span><br><span class="line"><span class="comment"># åˆ›å»ºIDæ–‡ä»¶(ä½ç½®å­˜æ”¾åœ¨zkçš„æ•°æ®å­˜æ”¾è·¯å¾„ä¸‹)</span></span><br><span class="line">        101èŠ‚ç‚¹</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"140"</span> &gt; /opt/data/zk/myid</span><br><span class="line">        102èŠ‚ç‚¹</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"141"</span> &gt; /opt/data/zk/myid</span><br><span class="line">        103èŠ‚ç‚¹</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"142"</span> &gt; /opt/data/zk/myid</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨zk</span></span><br><span class="line">$ zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹zkçŠ¶æ€</span></span><br><span class="line">$ zkServer.sh status</span><br></pre></td></tr></table></figure>
<p><strong>myidæ–‡ä»¶</strong>ï¼šåœ¨Zookeeperé›†ç¾¤ä¸­ï¼Œ<strong>myid</strong>æ–‡ä»¶æ˜¯æ¯ä¸ªZookeeperæœåŠ¡å™¨èŠ‚ç‚¹çš„é‡è¦é…ç½®æ–‡ä»¶ä¹‹ä¸€ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡å™¨ã€‚</p>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406020109804.png" alt></p>
<h4 id="3-3-Zookeeperè§’è‰²åˆ’åˆ†"><a href="#3-3-Zookeeperè§’è‰²åˆ’åˆ†" class="headerlink" title="3.3 Zookeeperè§’è‰²åˆ’åˆ†"></a>3.3 Zookeeperè§’è‰²åˆ’åˆ†</h4><p>åœ¨Zookeeperé›†ç¾¤ä¸­ï¼Œä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹å¯ä»¥æ‰¿æ‹…ä¸åŒçš„è§’è‰²ï¼Œä»¥ç¡®ä¿é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€æ•°æ®ä¸€è‡´æ€§å’Œæ•…éšœæ¢å¤èƒ½åŠ›ã€‚ä¸»è¦è§’è‰²åŒ…æ‹¬ï¼š==<strong>server.140=192.168.174.140:2888:3888:è§’è‰²</strong>==</p>
<ol>
<li><p><strong>é¢†å¯¼è€…ï¼ˆLeaderï¼‰</strong></p>
<ul>
<li><p>å¤„ç†æ‰€æœ‰å†™æ“ä½œï¼ˆå¦‚åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤èŠ‚ç‚¹ï¼‰å¹¶ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
</li>
<li><p>ç®¡ç†å¹¶åè°ƒé›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹çš„æ´»åŠ¨ã€‚</p>
</li>
<li><p>è´Ÿè´£ä¸ºå®¢æˆ·ç«¯è¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„äº‹åŠ¡IDï¼ˆzxidï¼‰ã€‚</p>
</li>
<li><p>åœ¨é›†ç¾¤å¯åŠ¨æˆ–é¢†å¯¼è€…å¤±æ•ˆæ—¶ï¼Œä¼šè¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ï¼Œé€‰å‡ºæ–°çš„é¢†å¯¼è€…ã€‚</p>
</li>
<li><p>å®šæœŸå‘é€å¿ƒè·³ç»™è·Ÿéšè€…ï¼Œç¡®ä¿è‡ªå·±å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>è·Ÿéšè€…ï¼ˆFollowerï¼‰</strong></p>
<ul>
<li>å¤„ç†æ‰€æœ‰è¯»å–æ“ä½œï¼ˆå¦‚è¯»å–èŠ‚ç‚¹æ•°æ®ï¼‰ã€‚</li>
<li>æ¥æ”¶å¹¶è½¬å‘å®¢æˆ·ç«¯çš„å†™è¯·æ±‚ç»™é¢†å¯¼è€…è¿›è¡Œå¤„ç†ã€‚</li>
<li>å°†é¢†å¯¼è€…çš„äº‹åŠ¡æ—¥å¿—åŒæ­¥åˆ°æœ¬åœ°ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li>
<li>å‚ä¸é¢†å¯¼è€…é€‰ä¸¾ã€‚</li>
<li>ä¸é¢†å¯¼è€…ä¿æŒåŒæ­¥ï¼Œæ¥æ”¶å¹¶åº”ç”¨é¢†å¯¼è€…çš„äº‹åŠ¡ã€‚</li>
</ul>
</li>
<li><p><strong>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰</strong></p>
<ul>
<li>å¤„ç†è¯»å–æ“ä½œï¼Œå‡è½»é¢†å¯¼è€…å’Œè·Ÿéšè€…çš„è´Ÿæ‹…ã€‚</li>
<li>ä¸å‚ä¸é¢†å¯¼è€…é€‰ä¸¾å’Œäº‹åŠ¡æŠ•ç¥¨ï¼ŒåªåŒæ­¥é¢†å¯¼è€…çš„äº‹åŠ¡æ—¥å¿—ã€‚</li>
<li>æé«˜é›†ç¾¤çš„è¯»å–æ‰©å±•èƒ½åŠ›ï¼Œé€‚åˆéœ€è¦é«˜è¯»å–ååé‡çš„åœºæ™¯ã€‚</li>
</ul>
</li>
<li><p><strong>å®¢æˆ·ç«¯ï¼ˆClientï¼‰</strong></p>
<ul>
<li>è¿æ¥åˆ°é›†ç¾¤ä¸­çš„ä»»ä¸€èŠ‚ç‚¹è¿›è¡Œè¯»å–æˆ–å†™å…¥æ“ä½œã€‚</li>
<li>è‡ªåŠ¨å¤„ç†èŠ‚ç‚¹æ•…éšœå¹¶é‡æ–°è¿æ¥åˆ°å…¶ä»–å¯ç”¨èŠ‚ç‚¹ã€‚</li>
<li>é€šè¿‡å®¢æˆ·ç«¯APIä¸Zookeeperé›†ç¾¤è¿›è¡Œäº¤äº’ã€‚<h4 id="3-4-zookeeperé…ç½®å†…å­˜å †æ ˆ"><a href="#3-4-zookeeperé…ç½®å†…å­˜å †æ ˆ" class="headerlink" title="3.4 zookeeperé…ç½®å†…å­˜å †æ ˆ"></a>3.4 zookeeperé…ç½®å†…å­˜å †æ ˆ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹zkè¿›ç¨‹</span></span><br><span class="line">$ jps</span><br><span class="line">1367 Elasticsearch</span><br><span class="line">5400 QuorumPeerMain</span><br><span class="line">5593 Jps</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹zkçš„å †æ ˆå¤§å°</span></span><br><span class="line">$ jmap -heap 5400</span><br></pre></td></tr></table></figure>
<img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406020135738.png" alt></li>
</ul>
</li>
</ol>
<p><strong>zookeeperé»˜è®¤å †å†…å­˜å¤§å°ä¸º1GBï¼Œä¸€èˆ¬è®¾ç½®ä¸º2GBæˆ–è€…4GB</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; è°ƒèŠ‚zookeeperæ¨å†…å­˜å¤§å°ä¸º256MB</span></span><br><span class="line">$ vim /opt/zookeeper/conf/java.env</span><br><span class="line"><span class="meta">#! /bin/bash </span></span><br><span class="line"> <span class="comment"># æŒ‡å®šJDKå®‰è£…è·¯å¾„ </span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java </span><br><span class="line"> <span class="comment"># æŒ‡å®šzookeeperçš„å †å†…å­˜å¤§å° </span></span><br><span class="line"><span class="built_in">export</span> JVMFLAGS=<span class="string">"-Xms256m -Xmx256m <span class="variable">$JVMFLAGS</span>"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åŒæ­¥æ–‡ä»¶</span></span><br><span class="line">$ scp /opt/zookeeper/conf/java.env  elk02:/opt/zookeeper/conf/</span><br><span class="line">$ scp /opt/zookeeper/conf/java.env  elk03:/opt/zookeeper/conf/</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ‰€æœ‰èŠ‚ç‚¹é‡å¯zk</span></span><br><span class="line">$ zkServer.sh restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; éªŒè¯å †å†…å­˜</span></span><br><span class="line">$ jmap -heap `jps | grep QuorumPeerMain | awk <span class="string">'&#123;print $1&#125;'</span>`</span><br></pre></td></tr></table></figure>

<h3 id="4ã€kafkaé›†ç¾¤å®‰è£…ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€"><a href="#4ã€kafkaé›†ç¾¤å®‰è£…ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€" class="headerlink" title="4ã€kafkaé›†ç¾¤å®‰è£…ï¼šä¸‰èŠ‚ç‚¹ğŸ˜€"></a>4ã€kafkaé›†ç¾¤å®‰è£…ï¼š<code>ä¸‰èŠ‚ç‚¹</code>ğŸ˜€</h3><p>â€‹    ä¸‹è½½é“¾æ¥ï¼š<a href="https://kafka.apache.org/downloads" target="_blank" rel="noopener">https://kafka.apache.org/downloads</a><br>â€‹    å®˜ç½‘ï¼š<a href="https://kafka.apache.org/" target="_blank" rel="noopener">https://kafka.apache.org/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; è§£å‹å®‰è£…åŒ…åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">$ tar xf kafka_2.13-3.2.1.tgz  -C /opt/ &amp;&amp;  <span class="built_in">cd</span> /opt/</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹ç›®å½•åç§°</span></span><br><span class="line">$ mv kafka_2.13-3.2.1/  kafka</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é…ç½®kafkaç¯å¢ƒå˜é‡</span></span><br><span class="line">$ cat &gt;&gt; /etc/profile.d/kafka.sh &lt;&lt;-EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_HOME=/opt/kafka</span><br><span class="line"><span class="built_in">export</span> PATH=\<span class="variable">$PATH</span>:\<span class="variable">$KAFKA_HOME</span>/bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile.d/kafka.sh </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºæ•°æ®ç›®å½•</span></span><br><span class="line">$ mkdir /opt/data/kafka -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 1.kafka101èŠ‚ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ egrep -v <span class="string">"^(#|$)"</span> kafka/config/server.properties</span><br><span class="line">broker.id=140</span><br><span class="line">log.dirs=/opt/data/kafka/</span><br><span class="line">zookeeper.connect=192.168.174.140:2181,192.168.174.141:2181,192.168.174.142:2181/kafka</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 2.kafka102èŠ‚ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ egrep -v <span class="string">"^(#|$)"</span> kafka/config/server.properties  </span><br><span class="line">broker.id=141</span><br><span class="line">log.dirs=/opt/data/kafka/</span><br><span class="line">zookeeper.connect=192.168.174.140:2181,192.168.174.141:2181,192.168.174.142:2181/kafka	<span class="comment"># /kafkaä¸ºzkä¸­çš„znode</span></span><br><span class="line"> </span><br><span class="line"> 	<span class="comment"># 3.kafka103èŠ‚ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ egrep -v <span class="string">"^(#|$)"</span> kafka/config/server.properties  </span><br><span class="line">broker.id=142</span><br><span class="line">log.dirs=/opt/data/kafka/</span><br><span class="line">zookeeper.connect=192.168.174.140:2181,192.168.174.141:2181,192.168.174.142:2181/kafka</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨kafka</span></span><br><span class="line">$ kafka-server-start.sh -daemon /opt/kafka/config/server.properties </span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; zkèŠ‚ç‚¹æŸ¥çœ‹kafkaæ³¨å†Œä¿¡æ¯</span></span><br><span class="line">$ zkCli.sh ls /kafka/brokers/ids | grep  <span class="string">"^\["</span></span><br><span class="line">[140, 141, 142]</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; kafkaåœæ­¢è„šæœ¬</span></span><br><span class="line">$ kafka-server-stop.sh</span><br></pre></td></tr></table></figure>



<h3 id="5ã€Kafka-Topicæ—¥å¸¸æ“ä½œ"><a href="#5ã€Kafka-Topicæ—¥å¸¸æ“ä½œ" class="headerlink" title="5ã€Kafka Topicæ—¥å¸¸æ“ä½œ"></a>5ã€Kafka Topicæ—¥å¸¸æ“ä½œ</h3><h4 id="5-1-æŸ¥çœ‹Topicç›¸å…³ä¿¡æ¯"><a href="#5-1-æŸ¥çœ‹Topicç›¸å…³ä¿¡æ¯" class="headerlink" title="5.1 æŸ¥çœ‹Topicç›¸å…³ä¿¡æ¯"></a>5.1 æŸ¥çœ‹Topicç›¸å…³ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰Topic</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092,192.168.174.141:9092,192.168.174.142:9092  --list</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹æ‰€æœ‰Topicè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092,192.168.174.141:9092,192.168.174.142:9092  --describe</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹æŸä¸ªTopicä¿¡æ¯</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092,192.168.174.141:9092,192.168.174.142:9092  --describe  --topic  Topiceåç§°</span><br></pre></td></tr></table></figure>


<h4 id="5-2-åˆ›å»ºTopic"><a href="#5-2-åˆ›å»ºTopic" class="headerlink" title="5.2 åˆ›å»ºTopic"></a>5.2 åˆ›å»ºTopic</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºtest-elk Topic</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092 --create --topic <span class="built_in">test</span>-elk</span><br><span class="line">Created topic <span class="built_in">test</span>-elk.</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºTopicï¼Œå¹¶æŒ‡å®šå‰¯æœ¬æ•°é‡</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092 --create --topic <span class="built_in">test</span>-elk-02  --partitions 10 --replication-factor 1</span><br><span class="line">Created topic <span class="built_in">test</span>-elk.</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt;&gt;&gt; æŸ¥çœ‹Topicçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092  --describe --topic <span class="built_in">test</span>-elk-02</span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406020407871.png#id=PAr2v&originHeight=504&originWidth=2263&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&gt;&gt;&gt; åˆ›å»ºTopicï¼Œå¹¶æŒ‡å®šå‰¯æœ¬æ•°é‡</span></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092 --create --topic <span class="built_in">test</span>-elk-03  --partitions 10 --replication-factor 2</span><br><span class="line"></span><br><span class="line">$ kafka-topics.sh   --bootstrap-server  192.168.174.140:9092  --describe --topic <span class="built_in">test</span>-elk-03</span><br></pre></td></tr></table></figure>
<p><img src="https://hjmimage.oss-cn-zhangjiakou.aliyuncs.com/202406020410226.png#id=xl6sS&originHeight=504&originWidth=2282&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none" alt="     "></p>
<p><strong>æ³¨æ„ï¼šå‰¯æœ¬æ•°é‡ä¸èƒ½å¤§äºBrokerçš„æ•°é‡</strong></p>
<h3 id="6ã€Filebeatæ”¶é›†æ—¥å¿—è‡³Kafka"><a href="#6ã€Filebeatæ”¶é›†æ—¥å¿—è‡³Kafka" class="headerlink" title="6ã€Filebeatæ”¶é›†æ—¥å¿—è‡³Kafka"></a>6ã€Filebeatæ”¶é›†æ—¥å¿—è‡³Kafka</h3><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/beats/filebeat/7.17/kafka-output.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.17/kafka-output.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@elk01 ~]<span class="comment"># cat filbeat-out-kafka.yml </span></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/<span class="built_in">log</span>/nginx/access.log</span><br><span class="line">  fields:</span><br><span class="line">    log_type: nginx_access</span><br><span class="line">  fields_under_root: <span class="literal">true</span></span><br><span class="line">  json.keys_under_root: <span class="literal">true</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment">#- type: log</span></span><br><span class="line"><span class="comment">#  paths:</span></span><br><span class="line"><span class="comment">#    - /var/log/nginx/error.log</span></span><br><span class="line"><span class="comment">#  fields:</span></span><br><span class="line"><span class="comment">#    log_type: nginx_error</span></span><br><span class="line"><span class="comment">#  fields_under_root: true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">  <span class="comment"># initial brokers for reading cluster metadata</span></span><br><span class="line">  hosts: [<span class="string">"192.168.174.140:9092"</span>, <span class="string">"192.168.174.141:9092"</span>, <span class="string">"192.168.174.142:9092"</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># message topic selection + partitioning</span></span><br><span class="line">  topic: <span class="string">"test-kafka-topic"</span></span><br><span class="line"></span><br><span class="line">[root@elk01 ~]<span class="comment"># filebeat  -e -c ~/filbeat-out-kafka.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kafkaæµ‹è¯•æ‹‰å–æ•°æ®</span></span><br><span class="line">[root@elk03 opt]<span class="comment"># kafka-console-consumer.sh   --topic test-kafka-topic  --bootstrap-server 192.168.174.140:9092,192.168.174.141:9092,192.168.174.142:9092  --from-beginning</span></span><br></pre></td></tr></table></figure>


<h3 id="7ã€Logstashæ”¶é›†Kafka-Topicæ—¥å¿—"><a href="#7ã€Logstashæ”¶é›†Kafka-Topicæ—¥å¿—" class="headerlink" title="7ã€Logstashæ”¶é›†Kafka Topicæ—¥å¿—"></a>7ã€Logstashæ”¶é›†Kafka Topicæ—¥å¿—</h3><p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-kafka.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-kafka.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    bootstrap_servers =&gt; <span class="string">"192.168.174.140:9092,192.168.174.141:9092,192.168.174.142:9092"</span>  <span class="comment"># Kafkaé›†ç¾¤IP</span></span><br><span class="line">    topics =&gt; [<span class="string">"test-kafka-topic"</span>]     <span class="comment"># æŒ‡å®šTopicè¿›è¡Œæ¶ˆè´¹æ•°æ®</span></span><br><span class="line">    group_id =&gt; <span class="string">"test-kafka"</span>     <span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">    codec =&gt; json &#123;                      <span class="comment"># æŒ‡å®šæ¶ˆè´¹çš„æ•°æ®æ˜¯JSONæ ¼å¼ã€‚</span></span><br><span class="line">             charset =&gt; <span class="string">"UTF-8"</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  mutate &#123;</span><br><span class="line">    add_field =&gt; &#123;</span><br><span class="line">      <span class="string">"name"</span> =&gt; <span class="string">"ELK stack"</span> </span><br><span class="line">    &#125;</span><br><span class="line">    remove_field =&gt; [<span class="string">"agent"</span>,<span class="string">"ephemeral_id"</span>,<span class="string">"ecs"</span>,<span class="string">"@version"</span>,<span class="string">"tags"</span>,<span class="string">"input"</span>,<span class="string">"log"</span>,<span class="string">"offest"</span>]  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> [log_type] == <span class="string">"nginx_access"</span> &#123;</span><br><span class="line">     geoip &#123;</span><br><span class="line">       <span class="built_in">source</span> =&gt; <span class="string">"clientip"</span></span><br><span class="line">     &#125;</span><br><span class="line">     useragent &#123;</span><br><span class="line">       <span class="built_in">source</span> =&gt; <span class="string">"http_user_agent"</span> </span><br><span class="line">       target =&gt; <span class="string">"study_user_agent"</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†ä¸‹é¢è§£å¼€æ³¨é‡Šå³å¯å°†æ•°æ®å­˜å…¥esé›†ç¾¤ä¸­ï¼Œåˆ†ç±»æ·»åŠ ç´¢å¼•åˆ°kibanaç•Œé¢ä¸Šç„¶åå‘ˆç°æ•°æ®</span></span><br><span class="line"><span class="comment">#  if [log_type] == "nginx_access" &#123;  </span></span><br><span class="line"><span class="comment">#    elasticsearch &#123;</span></span><br><span class="line"><span class="comment">#      hosts =&gt; ["192.168.174.140:9200","192.168.174.141:9200","192.168.174.142:9200"] </span></span><br><span class="line"><span class="comment">#      index =&gt; "web-access-%&#123;+yyyy.MM.dd&#125;"</span></span><br><span class="line"><span class="comment">#    &#125; </span></span><br><span class="line"><span class="comment">#  &#125; else if [log_type] == "nginx_error" &#123;</span></span><br><span class="line"><span class="comment">#        elasticsearch &#123;</span></span><br><span class="line"><span class="comment">#          hosts =&gt; ["192.168.174.140:9200","192.168.174.141:9200","192.168.174.142:9200"]</span></span><br><span class="line"><span class="comment">#          index =&gt; "web-error-%&#123;+yyyy.MM.dd&#125;"   </span></span><br><span class="line"><span class="comment">#    &#125;</span></span><br><span class="line"><span class="comment">#  &#125;  else if [log_type] == "system_log" &#123;</span></span><br><span class="line"><span class="comment">#       elasticsearch &#123;</span></span><br><span class="line"><span class="comment">#         hosts =&gt; ["192.168.174.140:9200","192.168.174.141:9200","192.168.174.142:9200"]</span></span><br><span class="line"><span class="comment">#         index =&gt; "system-log-%&#123;+yyyy.MM.dd&#125;"     </span></span><br><span class="line"><span class="comment">#    &#125; </span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Logstashå®ä¾‹</span></span><br><span class="line">[root@elk03 ~]<span class="comment"># logstash  -rf ~/filter_grok.yml</span></span><br></pre></td></tr></table></figure>

<h2 id="åã€Elasticsearch-Restfulé£æ ¼APIå®æˆ˜"><a href="#åã€Elasticsearch-Restfulé£æ ¼APIå®æˆ˜" class="headerlink" title="åã€Elasticsearch Restfulé£æ ¼APIå®æˆ˜"></a>åã€Elasticsearch Restfulé£æ ¼APIå®æˆ˜</h2><h3 id="1ã€ESé›†ç¾¤çŠ¶æ€"><a href="#1ã€ESé›†ç¾¤çŠ¶æ€" class="headerlink" title="1ã€ESé›†ç¾¤çŠ¶æ€"></a>1ã€ESé›†ç¾¤çŠ¶æ€</h3><ol>
<li>ç»¿è‰²ï¼ˆGreenï¼‰</li>
</ol>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šé›†ç¾¤å¥åº·çŠ¶æ€æ­£å¸¸ï¼Œæ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å·²åˆ†é…ã€‚</li>
<li><strong>è§£é‡Š</strong>ï¼šç»¿è‰²çŠ¶æ€è¡¨ç¤ºé›†ç¾¤ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¯ä»¥è®¿é—®ï¼Œæ‰€æœ‰åˆ†ç‰‡ï¼ˆåŒ…æ‹¬ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ï¼‰éƒ½åˆ†é…åˆ°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸Šã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾é›†ç¾¤æœ‰3ä¸ªä¸»åˆ†ç‰‡ï¼Œæ¯ä¸ªä¸»åˆ†ç‰‡æœ‰1ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œé‚£ä¹ˆç»¿è‰²çŠ¶æ€ä¸‹è¿™6ä¸ªåˆ†ç‰‡éƒ½å·²æˆåŠŸåˆ†é…ä¸”æ­£å¸¸è¿è¡Œã€‚</li>
</ul>
<ol start="2">
<li>é»„è‰²ï¼ˆYellowï¼‰</li>
</ol>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šé›†ç¾¤å¥åº·çŠ¶æ€éƒ¨åˆ†æ­£å¸¸ï¼Œæ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½å·²åˆ†é…ï¼Œä½†æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬åˆ†ç‰‡æœªåˆ†é…ã€‚</li>
<li><strong>è§£é‡Š</strong>ï¼šé»„è‰²çŠ¶æ€è¡¨ç¤ºé›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»åˆ†ç‰‡éƒ½å¯ä»¥è®¿é—®ï¼Œä½†ä¸€äº›å‰¯æœ¬åˆ†ç‰‡ç”±äºæŸç§åŸå› ï¼ˆä¾‹å¦‚èŠ‚ç‚¹æ•…éšœæˆ–èµ„æºä¸è¶³ï¼‰æœªèƒ½åˆ†é…ã€‚è¿™æ„å‘³ç€æ•°æ®æ˜¯å®‰å…¨çš„ï¼Œä½†æ²¡æœ‰é«˜å¯ç”¨æ€§ï¼Œå› ä¸ºå¦‚æœæŸä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ•°æ®æ— æ³•è®¿é—®ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾é›†ç¾¤æœ‰3ä¸ªä¸»åˆ†ç‰‡å’Œæ¯ä¸ªä¸»åˆ†ç‰‡1ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œå¦‚æœæœ‰3ä¸ªä¸»åˆ†ç‰‡å’Œ2ä¸ªå‰¯æœ¬åˆ†ç‰‡å·²åˆ†é…ï¼Œä½†1ä¸ªå‰¯æœ¬åˆ†ç‰‡æœªèƒ½åˆ†é…ï¼Œåˆ™é›†ç¾¤ä¸ºé»„è‰²çŠ¶æ€ã€‚</li>
</ul>
<ol start="3">
<li>çº¢è‰²ï¼ˆRedï¼‰</li>
</ol>
<ul>
<li><strong>å«ä¹‰</strong>ï¼šé›†ç¾¤å¥åº·çŠ¶æ€ä¸æ­£å¸¸ï¼Œæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸»åˆ†ç‰‡æœªåˆ†é…ã€‚</li>
<li><strong>è§£é‡Š</strong>ï¼šçº¢è‰²çŠ¶æ€è¡¨ç¤ºé›†ç¾¤ä¸­æœ‰ä¸€äº›æ•°æ®ä¸å¯è®¿é—®ï¼Œå› ä¸ºä¸»åˆ†ç‰‡æœªèƒ½åˆ†é…ã€‚æ­¤æ—¶ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ï¼Œéœ€è¦ç«‹å³é‡‡å–æªæ–½æ¥ä¿®å¤é—®é¢˜ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾é›†ç¾¤æœ‰3ä¸ªä¸»åˆ†ç‰‡å’Œæ¯ä¸ªä¸»åˆ†ç‰‡1ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œå¦‚æœæœ‰2ä¸ªä¸»åˆ†ç‰‡å’Œæ‰€æœ‰å‰¯æœ¬åˆ†ç‰‡æœªèƒ½åˆ†é…ï¼Œåˆ™é›†ç¾¤ä¸ºçº¢è‰²çŠ¶æ€ã€‚</li>
</ul>
<h3 id="2ã€Elasticsearchæœ¯è¯­"><a href="#2ã€Elasticsearchæœ¯è¯­" class="headerlink" title="2ã€Elasticsearchæœ¯è¯­"></a>2ã€Elasticsearchæœ¯è¯­</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Document</span><br><span class="line">    æ–‡æ¡£ï¼Œç”¨æˆ·å­˜å‚¨åœ¨ESçš„æ•°æ®ï¼ŒESæœ€å°å•å…ƒï¼Œæ–‡æ¡£ä¸å¯è¢«æ‹†åˆ†ã€‚æ–‡æ¡£ä½¿ç”¨JSONçš„å¯¹è±¡å­˜å‚¨ç±»å‹ã€‚</span><br><span class="line">    </span><br><span class="line">filed</span><br><span class="line">    ç›¸å½“äºæ•°æ®è¡¨çš„å­—æ®µï¼Œå¯¹æ–‡æ¡£æ•°æ®æ ¹æ®ä¸åŒå±æ€§è¿›è¡Œåˆ†ç±»æ ‡è¯†ã€‚</span><br><span class="line">    </span><br><span class="line">index</span><br><span class="line">    ç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•å°±æ˜¯æ‹¥æœ‰ç›¸ä¼¼ç‰¹å¾æ–‡æ¡£çš„é›†åˆã€‚</span><br><span class="line">    </span><br><span class="line">shard</span><br><span class="line">    åˆ†ç‰‡ï¼Œå­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œæ¯ä¸ªåº•å±‚å¯¹åº”çš„ä½¿ä¸€ä¸ªLuceneåº“ï¼Œä¸€ä¸ªç´¢å¼•è‡³å°‘æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ã€‚</span><br><span class="line">    </span><br><span class="line">replica</span><br><span class="line">    å‰¯æœ¬ï¼Œä¸€ä¸ªåˆ†ç‰‡å¯ä»¥æœ‰0ä¸ªæˆ–è€…å¤šä¸ªå‰¯æœ¬ã€‚ä½œç”¨æ˜¯å¯¹æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œä¸€æ—¦å‰¯æœ¬æ•°é‡ä¸ä¸º0ï¼Œå°±ä¼šå¼•å…¥ä¸»åˆ†ç‰‡ï¼ˆprimary shardï¼‰å’Œå‰¯æœ¬åˆ†ç‰‡ï¼ˆreplica shardï¼‰çš„æ¦‚å¿µã€‚</span><br><span class="line">        ä¸»åˆ†ç‰‡ï¼ˆprimary shardï¼‰</span><br><span class="line">            å®ç°æ•°æ®çš„è¯»å†™æ“ä½œã€‚</span><br><span class="line">        å‰¯æœ¬åˆ†ç‰‡ï¼ˆreplica shardï¼‰</span><br><span class="line">            å¯ä»¥å®ç°æ•°æ®çš„è¯»æ“ä½œï¼Œéœ€è¦ä¸»åˆ†ç‰‡åŒæ­¥æ•°æ®ï¼Œå½“ä¸»åˆ†ç‰‡æŒ‚æ‰æ—¶ï¼Œå‰¯æœ¬åˆ†ç‰‡ä¼šå˜ä¸ºä¸»åˆ†ç‰‡ã€‚</span><br><span class="line">        </span><br><span class="line">Allocation</span><br><span class="line">    åˆ†é…ã€‚å°†åˆ†ç‰‡åˆ†é…ç»™æŸä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ã€‚å¦‚æœå‰¯æœ¬åˆ†ç‰‡ï¼Œè¿˜åŒ…å«ä»ä¸»åˆ†ç‰‡å¤åˆ¶æ•°æ®çš„è¿‡ç¨‹ï¼Œæ­¤è¿‡ç¨‹ç”±MasterèŠ‚ç‚¹è°ƒåº¦å®Œæˆã€‚</span><br></pre></td></tr></table></figure>
<h4 id="2-1ã€Elasticsearchåˆ†ç‰‡åˆ†é…çš„åŸºæœ¬ç­–ç•¥"><a href="#2-1ã€Elasticsearchåˆ†ç‰‡åˆ†é…çš„åŸºæœ¬ç­–ç•¥" class="headerlink" title="2.1ã€Elasticsearchåˆ†ç‰‡åˆ†é…çš„åŸºæœ¬ç­–ç•¥"></a>2.1ã€Elasticsearchåˆ†ç‰‡åˆ†é…çš„åŸºæœ¬ç­–ç•¥</h4><p>â€‹    ESä½¿ç”¨æ•°æ®åˆ†ç‰‡ï¼ˆshardï¼‰æ¥æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå°†æ•°æ®åˆ†æ•£ä¿å­˜åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šä»¥é™ä½å½“å•ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶å¯¹æ•°æ®å®Œæ•´æ€§çš„å½±å“ï¼ŒåŒæ—¶ä½¿ç”¨å‰¯æœ¬ï¼ˆrepiicaï¼‰æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚å…³äºåˆ†ç‰‡çš„é»˜è®¤åˆ†é…ç­–ç•¥ï¼Œåœ¨7.xä¹‹å‰ï¼Œé»˜è®¤5ä¸ªprimary shardï¼Œæ¯ä¸ªprimary shardé»˜è®¤åˆ†é…ä¸€ä¸ªreplicaï¼Œå³5ä¸»1å‰¯ï¼Œè€Œ7.xä¹‹åï¼Œé»˜è®¤1ä¸»1å‰¯ESåœ¨åˆ†é…å•ä¸ªç´¢å¼•çš„åˆ†ç‰‡æ—¶ä¼šå°†æ¯ä¸ªåˆ†ç‰‡å°½å¯èƒ½åˆ†é…åˆ°æ›´å¤šçš„èŠ‚ç‚¹ä¸Šã€‚ä½†æ˜¯ï¼Œå®é™…æƒ…å†µå–å†³äºé›†ç¾¤æ‹¥æœ‰çš„åˆ†ç‰‡å’Œç´¢å¼•çš„æ•°é‡ä»¥åŠå®ƒä»¬çš„å¤§å°ï¼Œä¸ä¸€å®šæ€»æ˜¯èƒ½å‡åŒ€åœ°åˆ†å¸ƒã€‚</p>
<p>â€‹    Paimaryåªèƒ½åœ¨ç´¢å¼•åˆ›å»ºæ—¶é…ç½®æ•°é‡ï¼Œè€Œreplicaå¯ä»¥åœ¨ä»»ä½•æ—¶é—´åˆ†é…ï¼Œå¹¶ä¸”primaryæ”¯æŒè¯»å’Œå†™æ“ä½œï¼Œè€Œreplicaåªæ”¯æŒå®¢æˆ·ç«¯çš„è¯»å–æ“ä½œï¼Œæ•°æ®ç”±esè‡ªåŠ¨ç®¡ç†ï¼Œä»primaryåŒæ­¥ã€‚ESä¸å…è®¸Primaryå’Œå®ƒçš„Replicaæ”¾åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”åŒä¸€ä¸ªèŠ‚ç‚¹ä¸æ¥å—å®Œå…¨ç›¸åŒçš„ä¸¤ä¸ªReplica,åŒä¸€ä¸ªèŠ‚ç‚¹å…è®¸å¤šä¸ªç´¢å¼•çš„åˆ†ç‰‡åŒæ—¶å­˜åœ¨ã€‚</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">L66</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://l66stbz.github.io/2024/08/28/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0/">https://l66stbz.github.io/2024/08/28/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://l66stbz.github.io" target="_blank">L66</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/ELK/">ELK</a></div><div class="post_share"><div class="social-share" data-image="https://l66stbz.github.io/2024/09/09/è‹¥ä¾é¡¹ç›®åŠ¨é™åˆ†ç¦»/è‹¥ä¾é¡¹ç›®åŠ¨é™åˆ†ç¦»é¡¹ç›®å®ç°/6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="å¾®ä¿¡"/><div class="post-qr-code__desc">å¾®ä¿¡</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="æ”¯ä»˜å¯¶"/><div class="post-qr-code__desc">æ”¯ä»˜å¯¶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2024/09/02/IPtables/iptables/"><img class="prev_cover" src="https://l66stbz.github.io/2024/09/02/IPtables/iptables/1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">IPtables</div></div></a></div><div class="next-post pull_right"><a href="/2024/08/27/Zabbix%E5%91%8A%E8%AD%A6%E5%AA%92%E4%BB%8B/"><img class="next_cover" src="https://l66stbz.github.io/2024/08/27/Zabbixå‘Šè­¦åª’ä»‹/1.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Zabbixå‘Šè­¦åª’ä»‹</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2024/05/23/åŸºç¡€æµ‹è¯•è„šæœ¬é¢˜/" title="åŸºç¡€æµ‹è¯•è„šæœ¬é¢˜"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/23/åŸºç¡€æµ‹è¯•è„šæœ¬é¢˜/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-23</div><div class="relatedPosts_title">åŸºç¡€æµ‹è¯•è„šæœ¬é¢˜</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/15/2024.05éšè®°/" title="2024.05éšè®°"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/15/2024.05éšè®°/66.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-15</div><div class="relatedPosts_title">2024.05éšè®°</div></div></a></div><div class="relatedPosts_item"><a href="/2024/07/31/Linuxå†…æ ¸å‡çº§/" title="Linuxå†…æ ¸å‡çº§"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/07/31/Linuxå†…æ ¸å‡çº§/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-07-31</div><div class="relatedPosts_title">Linuxå†…æ ¸å‡çº§</div></div></a></div><div class="relatedPosts_item"><a href="/2024/07/27/Mysqlé«˜å¯ç”¨-MHA/" title="Mysqlé«˜å¯ç”¨-MHA"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/07/27/Mysqlé«˜å¯ç”¨-MHA/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-07-27</div><div class="relatedPosts_title">Mysqlé«˜å¯ç”¨-MHA</div></div></a></div><div class="relatedPosts_item"><a href="/2024/08/16/RabbitMQæ¶ˆæ¯é˜Ÿåˆ—/" title="RabbitMQæ¶ˆæ¯é˜Ÿåˆ—"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/08/16/RabbitMQæ¶ˆæ¯é˜Ÿåˆ—/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-08-16</div><div class="relatedPosts_title">RabbitMQæ¶ˆæ¯é˜Ÿåˆ—</div></div></a></div><div class="relatedPosts_item"><a href="/2024/05/21/Keepalived/" title="Keepalived"><img class="relatedPosts_cover" src="https://l66stbz.github.io/2024/05/21/Keepalived/1.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2024-05-21</div><div class="relatedPosts_title">Keepalived</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By L66</div><div class="framework-info"><span>é©±åŠ¨ </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="ç®€ç¹è½¬æ¢" target="_self">ç¹</a><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/third-party/click_heart.js"></script></body></html>